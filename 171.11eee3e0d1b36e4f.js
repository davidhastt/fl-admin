(self.webpackChunkautApp=self.webpackChunkautApp||[]).push([[171],{8171:(Eg,Yc,gi)=>{"use strict";gi.r(Yc),gi.d(Yc,{ProtectedModule:()=>xw});var Ri=gi(9808),ti=gi(2382),xn=gi(5772);class f{constructor(){this.id_persona=0,this.nombre="",this.aPaterno="",this.aMaterno="",this.telefonoM="",this.email="",this.genero=0,this.fecha_nac="00/00/0000",this.rfc="",this.x=0,this.y=0}}var _=gi(1223),Ls=gi(9298);const sa=function(){return{exact:!0}};let ut=(()=>{class e{constructor(r,o){this.router=r,this.authService=o,this.persona=new f,this.persona.nombre=this.authService.usuario.nombre}ngOnInit(){}logout(){this.router.navigateByUrl("/auth"),this.authService.logout()}}return e.\u0275fac=function(r){return new(r||e)(_.Y36(xn.F0),_.Y36(Ls.e))},e.\u0275cmp=_.Xpm({type:e,selectors:[["app-main"]],decls:73,vars:3,consts:[[1,"row","container","mt-4"],[1,"col-3"],["src","../../../../assets/images/logo.png","alt","Imagen no localizada","width","200"],[1,"list-group"],["routerLink","dashboard","routerLinkActive","active",1,"list-group-item",3,"routerLinkActiveOptions"],["routerLink","tiendas","routerLinkActive","active",1,"list-group-item"],["routerLink","categorias","routerLinkActive","active",1,"list-group-item"],["routerLink","clientes","routerLinkActive","active",1,"list-group-item"],["routerLink","pedidos","routerLinkActive","active",1,"list-group-item"],["routerLink","cobertura","routerLinkActive","active",1,"list-group-item"],["routerLink","faqs","routerLinkActive","active",1,"list-group-item"],[1,"list-group-item",3,"click"],[1,"col-9"],["id","dk-footer",1,"dk-footer"],[1,"container"],[1,"row"],[1,"col-md-12","col-lg-4"],["href","index.html",1,"footer-logo"],["src","../../../../assets/images/logo.png","alt","Imagen no localizada","width","200",1,"img-fluid"],[1,"footer-info-text"],[1,"animate-border","border-black"],[1,"col-md-12","col-lg-8"],[1,"col-md-6"],[1,"contact-us"],[1,"contact-icon"],["aria-hidden","true",1,"fa","fa-map-o"],[1,"contact-info"],[1,"contact-us","contact-us-last"],["aria-hidden","true",1,"fa","fa-volume-control-phone"],[1,"col-md-12","col-lg-6"],[1,"footer-widget"],[1,"section-heading"],[1,"copyright"]],template:function(r,o){1&r&&(_.TgZ(0,"div",0)(1,"div",1),_._UZ(2,"img",2)(3,"hr"),_.TgZ(4,"h6"),_._uU(5),_.qZA(),_.TgZ(6,"ul",3)(7,"li",4),_._uU(8,"Tablero"),_.qZA(),_.TgZ(9,"li",5),_._uU(10,"Tiendas"),_.qZA(),_.TgZ(11,"li",6),_._uU(12,"Categor\xedas"),_.qZA(),_.TgZ(13,"li",7),_._uU(14,"Clientes"),_.qZA(),_.TgZ(15,"li",8),_._uU(16,"Pedidos"),_.qZA(),_.TgZ(17,"li",9),_._uU(18,"Cobertura"),_.qZA(),_.TgZ(19,"li",10),_._uU(20,"FAQS"),_.qZA(),_.TgZ(21,"li",11),_.NdJ("click",function(){return o.logout()}),_._uU(22,"Salir"),_.qZA()()(),_.TgZ(23,"div",12),_._UZ(24,"router-outlet"),_.qZA()(),_.TgZ(25,"footer",13)(26,"div",14)(27,"div",15)(28,"div",16)(29,"div")(30,"a",17),_._UZ(31,"img",18),_.qZA(),_.TgZ(32,"p",19),_._uU(33," P\xe1gina web de administraci\xf3n del sistema de informaci\xf3n Fresco Local. "),_.qZA(),_._UZ(34,"span",20),_.qZA()(),_.TgZ(35,"div",21)(36,"div",15)(37,"div",22)(38,"div",23)(39,"div",24),_._UZ(40,"i",25),_.qZA(),_.TgZ(41,"div",26)(42,"h3"),_._uU(43,"Ixtapan de la Sal"),_.qZA(),_._UZ(44,"span",20),_.TgZ(45,"p"),_._uU(46,"Boulevard Ixtapan - Tonatico KM. 2 No. 1918, El Salitre"),_.qZA()()()(),_.TgZ(47,"div",22)(48,"div",27)(49,"div",24),_._UZ(50,"i",28),_.qZA(),_.TgZ(51,"div",26)(52,"h3"),_._uU(53,"Tel\xe9fono "),_.qZA(),_._UZ(54,"span",20),_.TgZ(55,"p"),_._uU(56,"722 926 6076"),_.qZA()()()()(),_.TgZ(57,"div",15),_._UZ(58,"div",29),_.TgZ(59,"div",29)(60,"div",30)(61,"div",31)(62,"h3"),_._uU(63,"Email"),_.qZA(),_._UZ(64,"span",20),_.qZA(),_.TgZ(65,"p"),_._uU(66," frescolocal0@gmail.com"),_.qZA()()()()()()(),_.TgZ(67,"div",32)(68,"div",14)(69,"div",15)(70,"div",22)(71,"span"),_._uU(72,"Derechos reservados \xa9 2020. Frutos con sabor a M\xe9xico S.P.R. DE R.L."),_.qZA()()()()()()),2&r&&(_.xp6(5),_.hij("Bienvenido ",o.persona.nombre,""),_.xp6(2),_.Q6J("routerLinkActiveOptions",_.DdM(2,sa)))},directives:[xn.rH,xn.Od,xn.lC],styles:['.animate-border[_ngcontent-%COMP%]{position:relative;display:block;width:115px;height:3px;background:#007bff}.animate-border[_ngcontent-%COMP%]:after{position:absolute;content:"";width:35px;height:3px;left:0;bottom:0;border-left:10px solid #fff;border-right:10px solid #fff;animation:animborder 2s linear infinite}@keyframes animborder{0%{transform:translate(0)}to{transform:translate(113px)}}.animate-border.border-white[_ngcontent-%COMP%]:after{border-color:#fff}.animate-border.border-yellow[_ngcontent-%COMP%]:after{border-color:#f5b02e}.animate-border.border-orange[_ngcontent-%COMP%]:after{border-right-color:#007bff;border-left-color:#007bff}.animate-border.border-ash[_ngcontent-%COMP%]:after{border-right-color:#eef0ef;border-left-color:#eef0ef}.animate-border.border-offwhite[_ngcontent-%COMP%]:after{border-right-color:#f7f9f8;border-left-color:#f7f9f8}@keyframes primary-short{0%{width:15%}50%{width:90%}to{width:10%}}@keyframes primary-long{0%{width:80%}50%{width:0%}to{width:80%}}.footer-info-text[_ngcontent-%COMP%]{margin:26px 0 32px}.footer-left-widget[_ngcontent-%COMP%]{padding-left:80px}.footer-widget[_ngcontent-%COMP%]   .section-heading[_ngcontent-%COMP%]{margin-bottom:35px}.footer-widget[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{font-size:24px;color:#fff;position:relative;margin-bottom:15px;max-width:-moz-fit-content;max-width:fit-content}.footer-widget[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]{width:50%;float:left;list-style:none;margin:0;padding:0}.footer-widget[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{margin-bottom:18px}.footer-widget[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin-bottom:27px}.footer-widget[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{color:#878787;transition:all .3s}.footer-widget[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:hover{color:#007bff}.footer-widget[_ngcontent-%COMP%]:after{content:"";display:block;clear:both}.contact-info[_ngcontent-%COMP%]{margin-left:75px;color:#fff}.contact-info[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{font-size:20px;color:#fff;margin-bottom:0}.copyright[_ngcontent-%COMP%]{padding:28px 0;margin-top:55px;background-color:#202020}.copyright[_ngcontent-%COMP%]   span[_ngcontent-%COMP%], .copyright[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{color:#878787;transition:all .3s linear}.copyright[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:hover{color:#007bff}.copyright-menu[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]{text-align:right;margin:0}.copyright-menu[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{display:inline-block;padding-left:20px}.dk-footer[_ngcontent-%COMP%]{padding:75px 0 0;background-color:#151414;position:relative;z-index:2}.dk-footer[_ngcontent-%COMP%]   .contact-us[_ngcontent-%COMP%]{margin-top:0;margin-bottom:30px;padding-left:80px}.dk-footer[_ngcontent-%COMP%]   .contact-us[_ngcontent-%COMP%]   .contact-info[_ngcontent-%COMP%]{margin-left:50px}.dk-footer[_ngcontent-%COMP%]   .contact-us.contact-us-last[_ngcontent-%COMP%]{margin-left:-80px}.dk-footer[_ngcontent-%COMP%]   .contact-icon[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:24px;top:-15px;position:relative;color:#007bff}.dk-footer-box-info[_ngcontent-%COMP%]{position:absolute;top:-122px;background:#202020;padding:40px;z-index:2}.dk-footer-box-info[_ngcontent-%COMP%]   .footer-social-link[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{color:#fff;font-size:24px;margin-bottom:25px}.dk-footer-box-info[_ngcontent-%COMP%]   .footer-social-link[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]{list-style-type:none;padding:0;margin:0}.dk-footer-box-info[_ngcontent-%COMP%]   .footer-social-link[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{display:inline-block}.dk-footer-box-info[_ngcontent-%COMP%]   .footer-social-link[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{display:block;width:40px;height:40px;border-radius:50%;text-align:center;line-height:40px;background:#000;margin-right:5px;color:#fff}.dk-footer-box-info[_ngcontent-%COMP%]   .footer-social-link[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]   i.fa-facebook[_ngcontent-%COMP%]{background-color:#3b5998}.dk-footer-box-info[_ngcontent-%COMP%]   .footer-social-link[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]   i.fa-twitter[_ngcontent-%COMP%]{background-color:#55acee}.dk-footer-box-info[_ngcontent-%COMP%]   .footer-social-link[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]   i.fa-google-plus[_ngcontent-%COMP%]{background-color:#dd4b39}.dk-footer-box-info[_ngcontent-%COMP%]   .footer-social-link[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]   i.fa-linkedin[_ngcontent-%COMP%]{background-color:#0976b4}.dk-footer-box-info[_ngcontent-%COMP%]   .footer-social-link[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]   i.fa-instagram[_ngcontent-%COMP%]{background-color:#b7242a}.footer-awarad[_ngcontent-%COMP%]{margin-top:285px;display:flex;flex:0 0 100%;align-items:center}.footer-awarad[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:#fff;font-size:24px;font-weight:700;margin-left:20px;padding-top:15px}']}),e})();var Rt=gi(520),Zt=gi(2340);let Ga=(()=>{class e{constructor(r){this.http=r,this.url=Zt.N.url_version}getpromedioscalificaciontiendas(){const r=(new Rt.WM).set("Authorization",localStorage.getItem("token")||"");return this.http.get(`${this.url}tiendas/gettiendasxcalificacion`,{headers:r})}gettotalproductosxvariedad(){const r=(new Rt.WM).set("Authorization",localStorage.getItem("token")||"");return this.http.get(`${this.url}tiendas/totalproductosxvariedad`,{headers:r})}get10Mas10MenosVendidos(){const r=(new Rt.WM).set("Authorization",localStorage.getItem("token")||"");return this.http.get(`${this.url}tiendas/estadisticasventas/0`,{headers:r})}getPedidosEntregados(){const r=(new Rt.WM).set("Authorization",localStorage.getItem("token")||"");return this.http.get(`${this.url}tiendas/getcounttotalpedidosentregados`,{headers:r})}getTiendasNuevas(){const r=(new Rt.WM).set("Authorization",localStorage.getItem("token")||"");return this.http.get(`${this.url}tiendas/getcounttiendasnuevas`,{headers:r})}getTotalClientes(){const r=(new Rt.WM).set("Authorization",localStorage.getItem("token")||"");return this.http.get(`${this.url}users/getcounttotalclientes`,{headers:r})}}return e.\u0275fac=function(r){return new(r||e)(_.LFG(Rt.eN))},e.\u0275prov=_.Yz7({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();var ki=gi(4004),Pr=gi(727);class Gn extends Pr.w0{constructor(i,r){super()}schedule(i,r=0){return this}}const ho={setInterval(...e){const{delegate:i}=ho;return((null==i?void 0:i.setInterval)||setInterval)(...e)},clearInterval(e){const{delegate:i}=ho;return((null==i?void 0:i.clearInterval)||clearInterval)(e)},delegate:void 0};var fo=gi(8737);const Ia={now:()=>(Ia.delegate||Date).now(),delegate:void 0};class wr{constructor(i,r=wr.now){this.schedulerActionCtor=i,this.now=r}schedule(i,r=0,o){return new this.schedulerActionCtor(this,i).schedule(o,r)}}wr.now=Ia.now;const Ma=new class Ql extends wr{constructor(i,r=wr.now){super(i,r),this.actions=[],this._active=!1,this._scheduled=void 0}flush(i){const{actions:r}=this;if(this._active)return void r.push(i);let o;this._active=!0;do{if(o=i.execute(i.state,i.delay))break}while(i=r.shift());if(this._active=!1,o){for(;i=r.shift();)i.unsubscribe();throw o}}}(class po extends Gn{constructor(i,r){super(i,r),this.scheduler=i,this.work=r,this.pending=!1}schedule(i,r=0){if(this.closed)return this;this.state=i;const o=this.id,c=this.scheduler;return null!=o&&(this.id=this.recycleAsyncId(c,o,r)),this.pending=!0,this.delay=r,this.id=this.id||this.requestAsyncId(c,this.id,r),this}requestAsyncId(i,r,o=0){return ho.setInterval(i.flush.bind(i,this),o)}recycleAsyncId(i,r,o=0){if(null!=o&&this.delay===o&&!1===this.pending)return r;ho.clearInterval(r)}execute(i,r){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;const o=this._execute(i,r);if(o)return o;!1===this.pending&&null!=this.id&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))}_execute(i,r){let c,o=!1;try{this.work(i)}catch(x){o=!0,c=x||new Error("Scheduled action threw falsy error")}if(o)return this.unsubscribe(),c}unsubscribe(){if(!this.closed){const{id:i,scheduler:r}=this,{actions:o}=r;this.work=this.state=this.scheduler=null,this.pending=!1,(0,fo.P)(o,this),null!=i&&(this.id=this.recycleAsyncId(r,i,null)),this.delay=null,super.unsubscribe()}}}),rl=Ma;var ec=gi(7272),Gi=gi(5698),tc=gi(4482),il=gi(5403),Kc=gi(5032),nl=gi(5577);function Fa(e,i){return i?r=>(0,ec.z)(i.pipe((0,Gi.q)(1),function Jc(){return(0,tc.e)((e,i)=>{e.subscribe(new il.Q(i,Kc.Z))})}()),r.pipe(Fa(e))):(0,nl.z)((r,o)=>e(r,o).pipe((0,Gi.q)(1),function mo(e){return(0,ki.U)(()=>e)}(r)))}var Rs=gi(8306),rc=gi(3532);function Rr(e,i=Ma){const r=function Qc(e=0,i,r=rl){let o=-1;return null!=i&&((0,rc.K)(i)?r=i:o=i),new Rs.y(c=>{let x=function ma(e){return e instanceof Date&&!isNaN(e)}(e)?+e-r.now():e;x<0&&(x=0);let y=0;return r.schedule(function(){c.closed||(c.next(y++),0<=o?this.schedule(void 0,o):c.complete())},x)})}(e,i);return Fa(()=>r)}let cn=(()=>{class e{constructor(r){this.http=r,this.url=Zt.N.url_version}getPedidos(){const r=(new Rt.WM).set("Authorization",localStorage.getItem("token")||"");return this.http.get(`${this.url}tiendas/getpedidosactivos/all`,{headers:r}).pipe((0,ki.U)(this.crearArreglo),Rr(0))}crearArreglo(r){const o=[];return null===(r=r.message.pedidos)?[]:(Object.keys(r).forEach(c=>{let x=r[c];switch(x.estatusPedido){case 0:x.estatusPedido="Solicitando pesaje";break;case 1:x.estatusPedido="Surtiendo";break;case 2:x.estatusPedido="Pesaje terminado";break;case 3:x.estatusPedido="Pagado";break;case 4:x.estatusPedido="En camino";break;case 5:x.estatusPedido="Entregado";break;case 6:x.estatusPedido="Cancelado";break;case 7:x.estatusPedido="Devoluci\xf3n";break;case 8:x.estatusPedido="Venta en piso";break;default:console.log("Error")}o.push(x)}),o)}}return e.\u0275fac=function(r){return new(r||e)(_.LFG(Rt.eN))},e.\u0275prov=_.Yz7({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();function Os(e,i){if(1&e&&(_.TgZ(0,"div",42),_._uU(1),_.qZA()),2&e){const r=i.$implicit;_.xp6(1),_.hij(" ",r.nombreProducto," ")}}function Da(e,i){if(1&e&&(_.TgZ(0,"div",43),_._uU(1),_.qZA()),2&e){const r=i.$implicit;_.xp6(1),_.hij(" ",r.nombreProducto," ")}}function al(e,i){if(1&e&&(_.TgZ(0,"li",44),_._uU(1),_.TgZ(2,"span",45),_._uU(3),_.qZA()()),2&e){const r=i.$implicit;_.xp6(1),_.hij(" ",r.nom_variedad," "),_.xp6(2),_.Oqu(r.total)}}function zs(e,i){if(1&e&&(_.TgZ(0,"li",46)(1,"div",47)(2,"div",48),_._uU(3),_.qZA()(),_.TgZ(4,"span",45),_._uU(5),_.qZA()()),2&e){const r=i.$implicit;_.xp6(3),_.Oqu(r.nombreTienda),_.xp6(2),_.Oqu(r.promedioCalificaciones)}}let ic=(()=>{class e{constructor(r,o){this._estadisticasService=r,this._pedidosService=o,this.tiendasNuevas=0,this.totalClientes=0,this.ordenesActivas=0,this.ordenesEtregadas=0,this.totalGanancias=0,this.productoMasVendido="Cargando...",this.diezMasVendidos=[],this.productoMenosVendido="Cargando...",this.diezMenosVendidos=[],this.totalproductos=0,this.totalproductosxvariedad=[],this.promedioCalificacionesTiendas=[]}ngOnInit(){this._estadisticasService.getpromedioscalificaciontiendas().subscribe(r=>{this.promedioCalificacionesTiendas=r.message.promedios}),this._estadisticasService.get10Mas10MenosVendidos().subscribe(r=>{this.diezMasVendidos=r.message[0].productosMasVendidos,this.productoMasVendido=r.message[0].productosMasVendidos[0].nombreProducto,this.diezMenosVendidos=r.message[1].productosMenosVendidos,this.productoMenosVendido=r.message[1].productosMenosVendidos[0].nombreProducto}),this._estadisticasService.getPedidosEntregados().subscribe(r=>{this.ordenesEtregadas=r.message[0].totalEntregas}),this._pedidosService.getPedidos().subscribe(r=>{this.ordenesActivas=r.length}),this._estadisticasService.getTiendasNuevas().subscribe(r=>{this.tiendasNuevas=r.message[0].tiendasNuevas}),this._estadisticasService.getTotalClientes().subscribe(r=>{this.totalClientes=r.message[0].totalClientes}),this._estadisticasService.gettotalproductosxvariedad().subscribe(r=>{this.totalproductosxvariedad=r.message.totalproductosxvariedad,this.totalproductosxvariedad.forEach(o=>{this.totalproductos+=o.total})})}}return e.\u0275fac=function(r){return new(r||e)(_.Y36(Ga),_.Y36(cn))},e.\u0275cmp=_.Xpm({type:e,selectors:[["app-dashboard"]],decls:124,vars:12,consts:[["rel","canonical","href","https://getbootstrap.com/docs/5.0/examples/features/"],["xmlns","http://www.w3.org/2000/svg",2,"display","none"],["id","home","viewBox","0 0 16 16"],["d","M8.354 1.146a.5.5 0 0 0-.708 0l-6 6A.5.5 0 0 0 1.5 7.5v7a.5.5 0 0 0 .5.5h4.5a.5.5 0 0 0 .5-.5v-4h2v4a.5.5 0 0 0 .5.5H14a.5.5 0 0 0 .5-.5v-7a.5.5 0 0 0-.146-.354L13 5.793V2.5a.5.5 0 0 0-.5-.5h-1a.5.5 0 0 0-.5.5v1.293L8.354 1.146zM2.5 14V7.707l5.5-5.5 5.5 5.5V14H10v-4a.5.5 0 0 0-.5-.5h-3a.5.5 0 0 0-.5.5v4H2.5z"],["id","people-circle","viewBox","0 0 16 16"],["d","M11 6a3 3 0 1 1-6 0 3 3 0 0 1 6 0z"],["fill-rule","evenodd","d","M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8zm8-7a7 7 0 0 0-5.468 11.37C3.242 11.226 4.805 10 8 10s4.757 1.225 5.468 2.37A7 7 0 0 0 8 1z"],["id","ordenesProcesando","viewBox","0 0 16 16"],["d","M2 10h3a1 1 0 0 1 1 1v3a1 1 0 0 1-1 1H2a1 1 0 0 1-1-1v-3a1 1 0 0 1 1-1zm9-9h3a1 1 0 0 1 1 1v3a1 1 0 0 1-1 1h-3a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1zm0 9a1 1 0 0 0-1 1v3a1 1 0 0 0 1 1h3a1 1 0 0 0 1-1v-3a1 1 0 0 0-1-1h-3zm0-10a2 2 0 0 0-2 2v3a2 2 0 0 0 2 2h3a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2h-3zM2 9a2 2 0 0 0-2 2v3a2 2 0 0 0 2 2h3a2 2 0 0 0 2-2v-3a2 2 0 0 0-2-2H2zm7 2a2 2 0 0 1 2-2h3a2 2 0 0 1 2 2v3a2 2 0 0 1-2 2h-3a2 2 0 0 1-2-2v-3zM0 2a2 2 0 0 1 2-2h3a2 2 0 0 1 2 2v3a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2V2zm5.354.854a.5.5 0 1 0-.708-.708L3 3.793l-.646-.647a.5.5 0 1 0-.708.708l1 1a.5.5 0 0 0 .708 0l2-2z"],["id","geo-fill","viewBox","0 0 16 16"],["fill-rule","evenodd","d","M4 4a4 4 0 1 1 4.5 3.969V13.5a.5.5 0 0 1-1 0V7.97A4 4 0 0 1 4 3.999zm2.493 8.574a.5.5 0 0 1-.411.575c-.712.118-1.28.295-1.655.493a1.319 1.319 0 0 0-.37.265.301.301 0 0 0-.057.09V14l.002.008a.147.147 0 0 0 .016.033.617.617 0 0 0 .145.15c.165.13.435.27.813.395.751.25 1.82.414 3.024.414s2.273-.163 3.024-.414c.378-.126.648-.265.813-.395a.619.619 0 0 0 .146-.15.148.148 0 0 0 .015-.033L12 14v-.004a.301.301 0 0 0-.057-.09 1.318 1.318 0 0 0-.37-.264c-.376-.198-.943-.375-1.655-.493a.5.5 0 1 1 .164-.986c.77.127 1.452.328 1.957.594C12.5 13 13 13.4 13 14c0 .426-.26.752-.544.977-.29.228-.68.413-1.116.558-.878.293-2.059.465-3.34.465-1.281 0-2.462-.172-3.34-.465-.436-.145-.826-.33-1.116-.558C3.26 14.752 3 14.426 3 14c0-.599.5-1 .961-1.243.505-.266 1.187-.467 1.957-.594a.5.5 0 0 1 .575.411z"],["id","ganancias","viewBox","0 0 16 16"],["d","M4 10.781c.148 1.667 1.513 2.85 3.591 3.003V15h1.043v-1.216c2.27-.179 3.678-1.438 3.678-3.3 0-1.59-.947-2.51-2.956-3.028l-.722-.187V3.467c1.122.11 1.879.714 2.07 1.616h1.47c-.166-1.6-1.54-2.748-3.54-2.875V1H7.591v1.233c-1.939.23-3.27 1.472-3.27 3.156 0 1.454.966 2.483 2.661 2.917l.61.162v4.031c-1.149-.17-1.94-.8-2.131-1.718H4zm3.391-3.836c-1.043-.263-1.6-.825-1.6-1.616 0-.944.704-1.641 1.8-1.828v3.495l-.2-.05zm1.591 1.872c1.287.323 1.852.859 1.852 1.769 0 1.097-.826 1.828-2.2 1.939V8.73l.348.086z"],["id","topVentas","viewBox","0 0 16 16"],["fill-rule","evenodd","d","M5 11.5a.5.5 0 0 1 .5-.5h9a.5.5 0 0 1 0 1h-9a.5.5 0 0 1-.5-.5zm0-4a.5.5 0 0 1 .5-.5h9a.5.5 0 0 1 0 1h-9a.5.5 0 0 1-.5-.5zm0-4a.5.5 0 0 1 .5-.5h9a.5.5 0 0 1 0 1h-9a.5.5 0 0 1-.5-.5zm-3 1a1 1 0 1 0 0-2 1 1 0 0 0 0 2zm0 4a1 1 0 1 0 0-2 1 1 0 0 0 0 2zm0 4a1 1 0 1 0 0-2 1 1 0 0 0 0 2z"],["id","menosVendidos","viewBox","0 0 16 16"],["fill-rule","evenodd","d","M5 11.5a.5.5 0 0 1 .5-.5h9a.5.5 0 0 1 0 1h-9a.5.5 0 0 1-.5-.5zm0-4a.5.5 0 0 1 .5-.5h9a.5.5 0 0 1 0 1h-9a.5.5 0 0 1-.5-.5zm0-4a.5.5 0 0 1 .5-.5h9a.5.5 0 0 1 0 1h-9a.5.5 0 0 1-.5-.5z"],["d","M1.713 11.865v-.474H2c.217 0 .363-.137.363-.317 0-.185-.158-.31-.361-.31-.223 0-.367.152-.373.31h-.59c.016-.467.373-.787.986-.787.588-.002.954.291.957.703a.595.595 0 0 1-.492.594v.033a.615.615 0 0 1 .569.631c.003.533-.502.8-1.051.8-.656 0-1-.37-1.008-.794h.582c.008.178.186.306.422.309.254 0 .424-.145.422-.35-.002-.195-.155-.348-.414-.348h-.3zm-.004-4.699h-.604v-.035c0-.408.295-.844.958-.844.583 0 .96.326.96.756 0 .389-.257.617-.476.848l-.537.572v.03h1.054V9H1.143v-.395l.957-.99c.138-.142.293-.304.293-.508 0-.18-.147-.32-.342-.32a.33.33 0 0 0-.342.338v.041zM2.564 5h-.635V2.924h-.031l-.598.42v-.567l.629-.443h.635V5z"],["id","delivery","viewBox","0 0 16 16"],["d","M0 3.5A1.5 1.5 0 0 1 1.5 2h9A1.5 1.5 0 0 1 12 3.5V5h1.02a1.5 1.5 0 0 1 1.17.563l1.481 1.85a1.5 1.5 0 0 1 .329.938V10.5a1.5 1.5 0 0 1-1.5 1.5H14a2 2 0 1 1-4 0H5a2 2 0 1 1-3.998-.085A1.5 1.5 0 0 1 0 10.5v-7zm1.294 7.456A1.999 1.999 0 0 1 4.732 11h5.536a2.01 2.01 0 0 1 .732-.732V3.5a.5.5 0 0 0-.5-.5h-9a.5.5 0 0 0-.5.5v7a.5.5 0 0 0 .294.456zM12 10a2 2 0 0 1 1.732 1h.768a.5.5 0 0 0 .5-.5V8.35a.5.5 0 0 0-.11-.312l-1.48-1.85A.5.5 0 0 0 13.02 6H12v4zm-9 1a1 1 0 1 0 0 2 1 1 0 0 0 0-2zm9 0a1 1 0 1 0 0 2 1 1 0 0 0 0-2z"],["id","productosEnCatalogo","viewBox","0 0 16 16"],["d","M1.92.506a.5.5 0 0 1 .434.14L3 1.293l.646-.647a.5.5 0 0 1 .708 0L5 1.293l.646-.647a.5.5 0 0 1 .708 0L7 1.293l.646-.647a.5.5 0 0 1 .708 0L9 1.293l.646-.647a.5.5 0 0 1 .708 0l.646.647.646-.647a.5.5 0 0 1 .708 0l.646.647.646-.647a.5.5 0 0 1 .801.13l.5 1A.5.5 0 0 1 15 2v12a.5.5 0 0 1-.053.224l-.5 1a.5.5 0 0 1-.8.13L13 14.707l-.646.647a.5.5 0 0 1-.708 0L11 14.707l-.646.647a.5.5 0 0 1-.708 0L9 14.707l-.646.647a.5.5 0 0 1-.708 0L7 14.707l-.646.647a.5.5 0 0 1-.708 0L5 14.707l-.646.647a.5.5 0 0 1-.708 0L3 14.707l-.646.647a.5.5 0 0 1-.801-.13l-.5-1A.5.5 0 0 1 1 14V2a.5.5 0 0 1 .053-.224l.5-1a.5.5 0 0 1 .367-.27zm.217 1.338L2 2.118v11.764l.137.274.51-.51a.5.5 0 0 1 .707 0l.646.647.646-.646a.5.5 0 0 1 .708 0l.646.646.646-.646a.5.5 0 0 1 .708 0l.646.646.646-.646a.5.5 0 0 1 .708 0l.646.646.646-.646a.5.5 0 0 1 .708 0l.646.646.646-.646a.5.5 0 0 1 .708 0l.509.509.137-.274V2.118l-.137-.274-.51.51a.5.5 0 0 1-.707 0L12 1.707l-.646.647a.5.5 0 0 1-.708 0L10 1.707l-.646.647a.5.5 0 0 1-.708 0L8 1.707l-.646.647a.5.5 0 0 1-.708 0L6 1.707l-.646.647a.5.5 0 0 1-.708 0L4 1.707l-.646.647a.5.5 0 0 1-.708 0l-.509-.51z"],["d","M3 4.5a.5.5 0 0 1 .5-.5h6a.5.5 0 1 1 0 1h-6a.5.5 0 0 1-.5-.5zm0 2a.5.5 0 0 1 .5-.5h6a.5.5 0 1 1 0 1h-6a.5.5 0 0 1-.5-.5zm0 2a.5.5 0 0 1 .5-.5h6a.5.5 0 1 1 0 1h-6a.5.5 0 0 1-.5-.5zm0 2a.5.5 0 0 1 .5-.5h6a.5.5 0 0 1 0 1h-6a.5.5 0 0 1-.5-.5zm8-6a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 0 1h-1a.5.5 0 0 1-.5-.5zm0 2a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 0 1h-1a.5.5 0 0 1-.5-.5zm0 2a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 0 1h-1a.5.5 0 0 1-.5-.5zm0 2a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 0 1h-1a.5.5 0 0 1-.5-.5z"],["id","icon-grid",1,"container","px-4","py-7"],[1,"row","row-cols-1","row-cols-sm-2","row-cols-md-3","row-cols-lg-4","g-4","py-5"],[1,"col","d-flex","align-items-start"],["width","1.75em","height","1.75em",1,"bi","text-muted","flex-shrink-0","me-3"],[0,"xlink","href","#home"],[1,"fw-bold","mb-0"],[0,"xlink","href","#people-circle"],[0,"xlink","href","#ordenesProcesando"],[0,"xlink","href","#delivery"],[0,"xlink","href","#ganancias"],[0,"xlink","href","#menosVendidos"],[0,"xlink","href","#topVentas"],[0,"xlink","href","#productosEnCatalogo"],["class","alert alert-primary","role","alert",4,"ngFor","ngForOf"],["class","alert alert-warning","role","alert",4,"ngFor","ngForOf"],[1,"list-group"],["class","list-group-item d-flex justify-content-between align-items-center",4,"ngFor","ngForOf"],[1,"list-group","list-group-numbered"],["class","list-group-item d-flex justify-content-between align-items-start",4,"ngFor","ngForOf"],["role","alert",1,"alert","alert-primary"],["role","alert",1,"alert","alert-warning"],[1,"list-group-item","d-flex","justify-content-between","align-items-center"],[1,"badge","bg-primary","rounded-pill"],[1,"list-group-item","d-flex","justify-content-between","align-items-start"],[1,"ms-2","me-auto"],[1,"fw-bold"]],template:function(r,o){1&r&&(_._UZ(0,"link",0),_.O4$(),_.TgZ(1,"svg",1)(2,"symbol",2),_._UZ(3,"path",3),_.qZA(),_.TgZ(4,"symbol",4),_._UZ(5,"path",5)(6,"path",6),_.qZA(),_.TgZ(7,"symbol",7),_._UZ(8,"path",8),_.qZA(),_.TgZ(9,"symbol",9),_._UZ(10,"path",10),_.qZA(),_.TgZ(11,"symbol",11),_._UZ(12,"path",12),_.qZA(),_.TgZ(13,"symbol",13),_._UZ(14,"path",14),_.qZA(),_.TgZ(15,"symbol",15),_._UZ(16,"path",16)(17,"path",17),_.qZA(),_.TgZ(18,"symbol",18),_._UZ(19,"path",19),_.qZA(),_.TgZ(20,"symbol",20),_._UZ(21,"path",21)(22,"path",22),_.qZA()(),_.kcU(),_.TgZ(23,"h1"),_._uU(24,"Tablero de control"),_.qZA(),_.TgZ(25,"div",23)(26,"div",24)(27,"div",25),_.O4$(),_.TgZ(28,"svg",26),_._UZ(29,"use",27),_.qZA(),_.kcU(),_.TgZ(30,"div")(31,"h4",28),_._uU(32),_.qZA(),_.TgZ(33,"p"),_._uU(34,"Tiendas nuevas"),_.qZA()()(),_.TgZ(35,"div",25),_.O4$(),_.TgZ(36,"svg",26),_._UZ(37,"use",29),_.qZA(),_.kcU(),_.TgZ(38,"div")(39,"h4",28),_._uU(40),_.qZA(),_.TgZ(41,"p"),_._uU(42,"Clientes"),_.qZA()()(),_.TgZ(43,"div",25),_.O4$(),_.TgZ(44,"svg",26),_._UZ(45,"use",30),_.qZA(),_.kcU(),_.TgZ(46,"div")(47,"h4",28),_._uU(48),_.qZA(),_.TgZ(49,"p"),_._uU(50,"Ordenes en proceso"),_.qZA()()(),_.TgZ(51,"div",25),_.O4$(),_.TgZ(52,"svg",26),_._UZ(53,"use",31),_.qZA(),_.kcU(),_.TgZ(54,"div")(55,"h4",28),_._uU(56),_.qZA(),_.TgZ(57,"p"),_._uU(58,"Entregas"),_.qZA()()(),_.TgZ(59,"div",25),_.O4$(),_.TgZ(60,"svg",26),_._UZ(61,"use",32),_.qZA(),_.kcU(),_.TgZ(62,"div")(63,"h4",28),_._uU(64),_.qZA(),_.TgZ(65,"p"),_._uU(66,"Ganancias"),_.qZA()()(),_.TgZ(67,"div",25),_.O4$(),_.TgZ(68,"svg",26),_._UZ(69,"use",33),_.qZA(),_.kcU(),_.TgZ(70,"div")(71,"h4",28),_._uU(72),_.qZA(),_.TgZ(73,"p"),_._uU(74,"Mas vendido"),_.qZA()()(),_.TgZ(75,"div",25),_.O4$(),_.TgZ(76,"svg",26),_._UZ(77,"use",34),_.qZA(),_.kcU(),_.TgZ(78,"div")(79,"h4",28),_._uU(80),_.qZA(),_.TgZ(81,"p"),_._uU(82,"Menos vendido"),_.qZA()()(),_.TgZ(83,"div",25),_.O4$(),_.TgZ(84,"svg",26),_._UZ(85,"use",35),_.qZA(),_.kcU(),_.TgZ(86,"div")(87,"h4",28),_._uU(88),_.qZA(),_.TgZ(89,"p"),_._uU(90,"Productos en cat\xe1logos"),_.qZA()()()(),_.TgZ(91,"h3"),_._uU(92,"Los 10 productos m\xe1s vendidos"),_.qZA(),_._UZ(93,"hr"),_.YNc(94,Os,2,1,"div",36),_._UZ(95,"br")(96,"br"),_.TgZ(97,"h3"),_._uU(98,"Los 10 productos menos vendidos"),_.qZA(),_._UZ(99,"hr")(100,"br")(101,"br"),_.YNc(102,Da,2,1,"div",37),_._UZ(103,"br")(104,"br"),_.TgZ(105,"h3"),_._uU(106,"\xbfQue productos estan listos para vender?"),_.qZA(),_._UZ(107,"br")(108,"br"),_.TgZ(109,"p"),_._uU(110,"Esta lista muestra los productos que han sido dados de alta en la base de datos por parte de los retailers, el n\xfamero en color azul con blanco indica el n\xfamero de tiendas que han capturado el miso producto."),_.qZA(),_._UZ(111,"hr"),_.TgZ(112,"ul",38),_.YNc(113,al,4,2,"li",39),_.qZA(),_._UZ(114,"br")(115,"br"),_.TgZ(116,"h3"),_._uU(117,"Tiendas mejor evaluadas por los clientes"),_.qZA(),_._UZ(118,"br")(119,"br"),_.TgZ(120,"ol",40),_.YNc(121,zs,6,2,"li",41),_.qZA(),_._UZ(122,"br")(123,"br"),_.qZA()),2&r&&(_.xp6(32),_.Oqu(o.tiendasNuevas),_.xp6(8),_.Oqu(o.totalClientes),_.xp6(8),_.Oqu(o.ordenesActivas),_.xp6(8),_.Oqu(o.ordenesEtregadas),_.xp6(8),_.Oqu(o.totalGanancias),_.xp6(8),_.Oqu(o.productoMasVendido),_.xp6(8),_.Oqu(o.productoMenosVendido),_.xp6(8),_.Oqu(o.totalproductos),_.xp6(6),_.Q6J("ngForOf",o.diezMasVendidos),_.xp6(8),_.Q6J("ngForOf",o.diezMenosVendidos),_.xp6(11),_.Q6J("ngForOf",o.totalproductosxvariedad),_.xp6(8),_.Q6J("ngForOf",o.promedioCalificacionesTiendas))},directives:[Ri.sg],styles:[".b-example-divider[_ngcontent-%COMP%]{height:3rem;background-color:#0000001a;border:solid rgba(0,0,0,.15);border-width:1px 0;box-shadow:inset 0 .5em 1.5em #0000001a,inset 0 .125em .5em #00000026}.bi[_ngcontent-%COMP%]{vertical-align:-.125em;fill:currentColor}.feature-icon[_ngcontent-%COMP%]{display:inline-flex;align-items:center;justify-content:center;width:4rem;height:4rem;margin-bottom:1rem;font-size:2rem;color:#fff;border-radius:.75rem}.icon-link[_ngcontent-%COMP%]{display:inline-flex;align-items:center}.icon-link[_ngcontent-%COMP%] > .bi[_ngcontent-%COMP%]{margin-top:.125rem;margin-left:.125rem;transition:transform .25s ease-in-out;fill:currentColor}.icon-link[_ngcontent-%COMP%]:hover > .bi[_ngcontent-%COMP%]{transform:translate(.25rem)}.icon-square[_ngcontent-%COMP%]{display:inline-flex;align-items:center;justify-content:center;width:3rem;height:3rem;font-size:1.5rem;border-radius:.75rem}.rounded-4[_ngcontent-%COMP%]{border-radius:.5rem}.rounded-5[_ngcontent-%COMP%]{border-radius:1rem}.text-shadow-1[_ngcontent-%COMP%]{text-shadow:0 .125rem .25rem rgba(0,0,0,.25)}.text-shadow-2[_ngcontent-%COMP%]{text-shadow:0 .25rem .5rem rgba(0,0,0,.25)}.text-shadow-3[_ngcontent-%COMP%]{text-shadow:0 .5rem 1.5rem rgba(0,0,0,.25)}.card-cover[_ngcontent-%COMP%]{background-repeat:no-repeat;background-position:center center;background-size:cover}"]}),e})();function Bs(e,i,r,o,c,x,y){try{var T=e[x](y),C=T.value}catch(I){return void r(I)}T.done?i(C):Promise.resolve(C).then(o,c)}let Tr=(()=>{class e{constructor(r){this.http=r,this.url=Zt.N.url_version}getIso(r,o,c,x){return function $a(e){return function(){var i=this,r=arguments;return new Promise(function(o,c){var x=e.apply(i,r);function y(C){Bs(x,o,c,y,T,"next",C)}function T(C){Bs(x,o,c,y,T,"throw",C)}y(void 0)})}}(function*(){return(yield(yield fetch(`https://api.mapbox.com/isochrone/v1/mapbox/${r}/${o},\n        ${c}?contours_minutes=${x}&polygons=true&access_token=${Zt.N.mapboxKey}`,{method:"GET"})).json()).features[0]})()}getTiendas(){const r=(new Rt.WM).set("Authorization",localStorage.getItem("token")||"");return this.http.get(`${this.url}tiendas/all`,{headers:r}).pipe((0,ki.U)(this.crearArregloTiendas))}crearArregloTiendas(r){if(null===r)return[];r=r.message.data;const o=[];return Object.keys(r).forEach(c=>{let x=r[c];delete x.horarioApertura,delete x.horarioCierre,delete x.horarioFinEntrega,delete x.horarioInicioEntrega,delete x.slogan,o.push(x)}),o}actualizarStatusTienda(r,o){let c=0;switch(r){case"Primera vez que se registra y esperando aprobaci\xf3n del administrador":c=0;break;case"En proceso de validaci\xf3n":c=1;break;case"Aceptado":c=2;break;case"Rechazado":c=3;break;default:console.log("Error no se asigno valor "+r)}const x={estatusTienda:c},y=(new Rt.WM).set("Authorization",localStorage.getItem("token")||"");return this.http.put(`${this.url}users/changestatusretailer/${o}`,x,{headers:y})}getRetailer(r){const o=(new Rt.WM).set("Authorization",localStorage.getItem("token")||"");return this.http.get(`${this.url}users/getretailer/${r}`,{headers:o})}getDatosTiendas(){return this.http.get(`${this.url}users/solicitudes`).pipe((0,ki.U)(this.crearArreglo),Rr(0))}crearArreglo(r){const o=[];return console.log(r.message),null===(r=r.message)?[]:(Object.keys(r).forEach(c=>{const x=r[c];x.id_tienda=r[c].id_tienda,o.push(x)}),o)}}return e.\u0275fac=function(r){return new(r||e)(_.LFG(Rt.eN))},e.\u0275prov=_.Yz7({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();const kn=function(e){return["/administrador/tienda/",e]};function eu(e,i){if(1&e&&(_.TgZ(0,"button",14),_._uU(1,"Nuevo"),_.qZA()),2&e){const r=_.oxw().$implicit;_.Q6J("routerLink",_.VKq(1,kn,r.id_tienda))}}function $n(e,i){if(1&e&&(_.TgZ(0,"button",15),_._uU(1,"Validando"),_.qZA()),2&e){const r=_.oxw().$implicit;_.Q6J("routerLink",_.VKq(1,kn,r.id_tienda))}}function _o(e,i){if(1&e&&(_.TgZ(0,"button",16),_._uU(1,"Aceptado"),_.qZA()),2&e){const r=_.oxw().$implicit;_.Q6J("routerLink",_.VKq(1,kn,r.id_tienda))}}function Br(e,i){if(1&e&&(_.TgZ(0,"button",17),_._uU(1,"Rechazado"),_.qZA()),2&e){const r=_.oxw().$implicit;_.Q6J("routerLink",_.VKq(1,kn,r.id_tienda))}}function Ns(e,i){if(1&e&&(_.TgZ(0,"button",16),_._uU(1,"Aceptado"),_.qZA()),2&e){const r=_.oxw().$implicit;_.Q6J("routerLink",_.VKq(1,kn,r.id_tienda))}}function go(e,i){if(1&e&&(_.TgZ(0,"button",16),_._uU(1,"Aceptado"),_.qZA()),2&e){const r=_.oxw().$implicit;_.Q6J("routerLink",_.VKq(1,kn,r.id_tienda))}}function _a(e,i){if(1&e&&(_.TgZ(0,"button",18),_._uU(1,"Baja"),_.qZA()),2&e){const r=_.oxw().$implicit;_.Q6J("routerLink",_.VKq(1,kn,r.id_tienda))}}function xo(e,i){1&e&&(_.TgZ(0,"th",5),_._uU(1,"No"),_.qZA())}function sl(e,i){1&e&&(_.TgZ(0,"th",5),_._uU(1,"No"),_.qZA())}function nc(e,i){1&e&&(_.TgZ(0,"th",5),_._uU(1,"No"),_.qZA())}function ol(e,i){1&e&&(_.TgZ(0,"th",5),_._uU(1,"No"),_.qZA())}function yo(e,i){1&e&&(_.TgZ(0,"th",5),_._uU(1,"Si"),_.qZA())}function Pa(e,i){1&e&&(_.TgZ(0,"th",5),_._uU(1,"No"),_.qZA())}function vo(e,i){if(1&e&&(_.TgZ(0,"th",5)(1,"button",18),_._uU(2,"Baja"),_.qZA()()),2&e){const r=_.oxw().$implicit;_.xp6(1),_.Q6J("routerLink",_.VKq(1,kn,r.id_tienda))}}function La(e,i){if(1&e&&(_.TgZ(0,"tr")(1,"th",7),_._uU(2),_.qZA(),_.TgZ(3,"td"),_._uU(4),_.qZA(),_.TgZ(5,"td"),_._uU(6),_.qZA(),_.TgZ(7,"td"),_.YNc(8,eu,2,3,"button",8),_.YNc(9,$n,2,3,"button",9),_.YNc(10,_o,2,3,"button",10),_.YNc(11,Br,2,3,"button",11),_.YNc(12,Ns,2,3,"button",10),_.YNc(13,go,2,3,"button",10),_.YNc(14,_a,2,3,"button",12),_.qZA(),_.YNc(15,xo,2,0,"th",13),_.YNc(16,sl,2,0,"th",13),_.YNc(17,nc,2,0,"th",13),_.YNc(18,ol,2,0,"th",13),_.YNc(19,yo,2,0,"th",13),_.YNc(20,Pa,2,0,"th",13),_.YNc(21,vo,3,3,"th",13),_.qZA()),2&e){const r=i.$implicit;_.xp6(2),_.Oqu(r.id_tienda),_.xp6(2),_.Oqu(r.nombreTienda),_.xp6(2),_.lnq("",r.nombrePropietario," ",r.apaterno," ",r.amaterno,""),_.xp6(2),_.Q6J("ngIf",0==r.estatusTienda),_.xp6(1),_.Q6J("ngIf",1==r.estatusTienda),_.xp6(1),_.Q6J("ngIf",2==r.estatusTienda),_.xp6(1),_.Q6J("ngIf",3==r.estatusTienda),_.xp6(1),_.Q6J("ngIf",4==r.estatusTienda),_.xp6(1),_.Q6J("ngIf",5==r.estatusTienda),_.xp6(1),_.Q6J("ngIf",6==r.estatusTienda),_.xp6(1),_.Q6J("ngIf",0==r.estatusTienda),_.xp6(1),_.Q6J("ngIf",1==r.estatusTienda),_.xp6(1),_.Q6J("ngIf",2==r.estatusTienda),_.xp6(1),_.Q6J("ngIf",3==r.estatusTienda),_.xp6(1),_.Q6J("ngIf",4==r.estatusTienda),_.xp6(1),_.Q6J("ngIf",5==r.estatusTienda),_.xp6(1),_.Q6J("ngIf",6==r.estatusTienda)}}function Ra(e,i){if(1&e&&(_.TgZ(0,"table",3)(1,"thead",4)(2,"tr")(3,"th",5),_._uU(4,"#"),_.qZA(),_.TgZ(5,"th",5),_._uU(6,"Nombre tienda"),_.qZA(),_.TgZ(7,"th",5),_._uU(8,"Nombre propietario"),_.qZA(),_.TgZ(9,"th",5),_._uU(10,"Estatus"),_.qZA(),_.TgZ(11,"th",5),_._uU(12,"Abierto"),_.qZA()()(),_.TgZ(13,"tbody"),_.YNc(14,La,22,19,"tr",6),_.qZA()()),2&e){const r=_.oxw();_.xp6(14),_.Q6J("ngForOf",r.tiendas)}}function Us(e,i){1&e&&(_.TgZ(0,"div",19)(1,"h4",20),_._uU(2,"No hay registros"),_.qZA(),_.TgZ(3,"p"),_._UZ(4,"i",21),_.qZA(),_._UZ(5,"p",22),_.qZA())}function ac(e,i){1&e&&(_.TgZ(0,"div",23)(1,"h4",20),_._uU(2,"Cargando"),_.qZA(),_.TgZ(3,"p"),_._UZ(4,"i",24),_.qZA(),_.TgZ(5,"p",22),_._uU(6," Espere por favor "),_.qZA()())}let wo=(()=>{class e{constructor(r){this.DatosTiendaService=r,this.tiendas=[],this.cargando=!1}ngOnInit(){this.cargando=!0,this.DatosTiendaService.getDatosTiendas().subscribe(r=>{this.tiendas=r,this.cargando=!1,console.log(this.tiendas)})}}return e.\u0275fac=function(r){return new(r||e)(_.Y36(Tr))},e.\u0275cmp=_.Xpm({type:e,selectors:[["app-tiendas"]],decls:6,vars:3,consts:[["class","table mt-3 animated fadeIn faster",4,"ngIf"],["class","alert alert-warning text-center mt-3",4,"ngIf"],["class","alert alert-info text-center mt-3 animated fadeIn faster",4,"ngIf"],[1,"table","mt-3","animated","fadeIn","faster"],[1,"table-dark"],["scope","col"],[4,"ngFor","ngForOf"],["scope","row"],["type","button","class","btn btn-info",3,"routerLink",4,"ngIf"],["type","button","class","btn btn-warning",3,"routerLink",4,"ngIf"],["type","button","class","btn btn-success",3,"routerLink",4,"ngIf"],["type","button","class","btn btn-danger",3,"routerLink",4,"ngIf"],["type","button","class","btn btn-danger","disabled","",3,"routerLink",4,"ngIf"],["scope","col",4,"ngIf"],["type","button",1,"btn","btn-info",3,"routerLink"],["type","button",1,"btn","btn-warning",3,"routerLink"],["type","button",1,"btn","btn-success",3,"routerLink"],["type","button",1,"btn","btn-danger",3,"routerLink"],["type","button","disabled","",1,"btn","btn-danger",3,"routerLink"],[1,"alert","alert-warning","text-center","mt-3"],[1,"alert-heading"],[1,"fa","fa-exclamation","fa-2x"],[1,"mb-0"],[1,"alert","alert-info","text-center","mt-3","animated","fadeIn","faster"],[1,"fa","fa-sync-alt","fa-spin","fa-2x"]],template:function(r,o){1&r&&(_.TgZ(0,"h2"),_._uU(1,"Lista de tiendas"),_.qZA(),_._UZ(2,"hr"),_.YNc(3,Ra,15,1,"table",0),_.YNc(4,Us,6,0,"div",1),_.YNc(5,ac,7,0,"div",2)),2&r&&(_.xp6(3),_.Q6J("ngIf",!o.cargando&&o.tiendas.length>0),_.xp6(1),_.Q6J("ngIf",!o.cargando&&0===o.tiendas.length),_.xp6(1),_.Q6J("ngIf",o.cargando))},directives:[Ri.O5,Ri.sg,xn.rH],styles:[""]}),e})();var ll=gi(1373),un=gi.n(ll);let sc=(()=>{class e{constructor(r){this.http=r,this.url=Zt.N.url_version}crearCategoria(r){const o=Object.assign({},r);delete o.id_categoria;const c=(new Rt.WM).set("Authorization",localStorage.getItem("token")||"");return this.http.post(`${this.url}categorias`,o,{headers:c}).pipe((0,ki.U)(x=>(r.id_categoria=x.message.id_categoria,r)))}actualizarCategoria(r){const o=Object.assign({},r);delete o.id_categoria,console.log(o);const c=(new Rt.WM).set("Authorization",localStorage.getItem("token")||"");return this.http.put(`${this.url}categorias/${r.id_categoria}`,o,{headers:c})}borrarCategoria(r){const o=(new Rt.WM).set("Authorization",localStorage.getItem("token")||"");return this.http.delete(`${this.url}categorias/${r}`,{headers:o})}getCategoria(r){const o=(new Rt.WM).set("Authorization",localStorage.getItem("token")||"");return this.http.get(`${this.url}categorias/${r}`,{headers:o})}getCategorias(){const r=(new Rt.WM).set("Authorization",localStorage.getItem("token")||"");return this.http.get(`${this.url}categorias`,{headers:r}).pipe((0,ki.U)(this.crearArreglo),Rr(0))}crearArreglo(r){const o=[];return null===(r=r.message.data)?[]:(Object.keys(r).forEach(c=>{o.push(r[c])}),o)}}return e.\u0275fac=function(r){return new(r||e)(_.LFG(Rt.eN))},e.\u0275prov=_.Yz7({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();const tu=function(e){return["/administrador/categoria/",e]};function cl(e,i){if(1&e&&(_.TgZ(0,"tr")(1,"th",9),_._uU(2),_.qZA(),_.TgZ(3,"td",9),_._uU(4),_.qZA(),_.TgZ(5,"td",9)(6,"button",11),_._UZ(7,"i",12),_.qZA()()()),2&e){const r=i.$implicit,o=i.index;_.xp6(2),_.Oqu(o+1),_.xp6(2),_.Oqu(r.nom_categoria),_.xp6(2),_.Q6J("routerLink",_.VKq(3,tu,r.id_categoria))}}function ru(e,i){if(1&e&&(_.TgZ(0,"table",7)(1,"thead",8)(2,"tr")(3,"th",9),_._uU(4,"#"),_.qZA(),_.TgZ(5,"th",9),_._uU(6,"Nombre"),_.qZA(),_.TgZ(7,"th",9),_._uU(8,"Herramientas"),_.qZA()()(),_.TgZ(9,"tbody"),_.YNc(10,cl,8,5,"tr",10),_.qZA()()),2&e){const r=_.oxw();_.xp6(10),_.Q6J("ngForOf",r.categorias)}}function bo(e,i){1&e&&(_.TgZ(0,"div",13)(1,"h4",14),_._uU(2,"No hay registros"),_.qZA(),_.TgZ(3,"p"),_._UZ(4,"i",15),_.qZA(),_._UZ(5,"p",16),_.qZA())}function iu(e,i){1&e&&(_.TgZ(0,"div",17)(1,"h4",14),_._uU(2,"Cargando"),_.qZA(),_.TgZ(3,"p"),_._UZ(4,"i",18),_.qZA(),_.TgZ(5,"p",16),_._uU(6," Espere por favor "),_.qZA()())}let Oa=(()=>{class e{constructor(r){this.CategoriasService=r,this.categorias=[],this.cargando=!1}ngOnInit(){this.cargando=!0,this.CategoriasService.getCategorias().subscribe(r=>{this.categorias=r,this.cargando=!1})}borrarCategoria(r,o){un()({title:"Seguro que deseas eliminar la categoria?",text:"Si lo borras afectaras a todos los comerciantes y clientes!",icon:"warning",buttons:["No","S\xed"],dangerMode:!0}).then(c=>{c&&(this.categorias.splice(o,1),this.CategoriasService.borrarCategoria(r.id_categoria).subscribe(),un()("La categoria a sido eliminada, el cambio afectara a comerciantes y clientes",{icon:"success"}))})}}return e.\u0275fac=function(r){return new(r||e)(_.Y36(sc))},e.\u0275cmp=_.Xpm({type:e,selectors:[["app-items"]],decls:11,vars:3,consts:[[1,"row"],[1,"col","text-right"],["routerLink","/administrador/categoria/nueva",1,"btn","btn-primary"],[1,"fa","fa-plus"],["class","table mt-3 animated fadeIn faster",4,"ngIf"],["class","alert alert-warning text-center mt-3",4,"ngIf"],["class","alert alert-info text-center mt-3 animated fadeIn faster",4,"ngIf"],[1,"table","mt-3","animated","fadeIn","faster"],[1,"table-dark"],["scope","col"],[4,"ngFor","ngForOf"],[1,"btn","btn-info","mr-1",3,"routerLink"],[1,"fa","fa-pen"],[1,"alert","alert-warning","text-center","mt-3"],[1,"alert-heading"],[1,"fa","fa-exclamation","fa-2x"],[1,"mb-0"],[1,"alert","alert-info","text-center","mt-3","animated","fadeIn","faster"],[1,"fa","fa-sync-alt","fa-spin","fa-2x"]],template:function(r,o){1&r&&(_.TgZ(0,"h1"),_._uU(1,"Lista de categor\xedas"),_.qZA(),_._UZ(2,"hr"),_.TgZ(3,"div",0)(4,"div",1)(5,"button",2)(6,"i",3),_._uU(7," Agregar "),_.qZA()()()(),_.YNc(8,ru,11,1,"table",4),_.YNc(9,bo,6,0,"div",5),_.YNc(10,iu,7,0,"div",6)),2&r&&(_.xp6(8),_.Q6J("ngIf",!o.cargando&&o.categorias.length>0),_.xp6(1),_.Q6J("ngIf",!o.cargando&&0===o.categorias.length),_.xp6(1),_.Q6J("ngIf",o.cargando))},directives:[xn.rH,Ri.O5,Ri.sg],styles:[""]}),e})();class Zs{constructor(){this.id_categoria="",this.nom_categoria=""}}let Vs=(()=>{class e{constructor(r){this.http=r,this.url=Zt.N.url_version}crearSubCategoria(r){const o=(new Rt.WM).set("Authorization",localStorage.getItem("token")||""),c=Object.assign({},r);return delete c.id_subcategoria,this.http.post(`${this.url}subcategorias/${r.id_categoria}`,c,{headers:o}).pipe((0,ki.U)(x=>(console.log(x),r.id_subcategoria=x.id_subcategoria,r)))}actualizarSubCategoria(r){return this.http.put(`${this.url}/api/subcategoria/modificar/${r.id_subcategoria}`,r)}borrarSubCategoria(r){return this.http.delete(`${this.url}/api/subcategoria/borrar/${r}`)}getSubCategoria(r,o){const c=(new Rt.WM).set("Authorization",localStorage.getItem("token")||"");return this.http.get(`${this.url}subcategorias/${r}/${o}`,{headers:c})}getSubCategorias(r){const o=(new Rt.WM).set("Authorization",localStorage.getItem("token")||"");return this.http.get(`${this.url}subcategorias/${r}`,{headers:o}).pipe((0,ki.U)(this.crearArreglo),Rr(0))}crearArreglo(r){const o=[];return null===(r=r.message.data)?[]:(Object.keys(r).forEach(c=>{o.push(r[c])}),o)}}return e.\u0275fac=function(r){return new(r||e)(_.LFG(Rt.eN))},e.\u0275prov=_.Yz7({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();function To(e,i){if(1&e&&(_.TgZ(0,"h1"),_._uU(1),_.qZA()),2&e){const r=_.oxw();_.xp6(1),_.hij('Editar categor\xeda "',r.categoria.nom_categoria,'"')}}function ul(e,i){1&e&&(_.TgZ(0,"h1"),_._uU(1,"Nueva categoria"),_.qZA())}function oc(e,i){1&e&&(_.TgZ(0,"div",13)(1,"button",14),_._UZ(2,"i",15),_._uU(3," Guardar "),_.qZA()())}const hl=function(e,i){return["/administrador/subcategoria",e,i]};function ae(e,i){if(1&e&&(_.TgZ(0,"tr")(1,"th",26),_._uU(2),_.qZA(),_.TgZ(3,"td",26),_._uU(4),_.qZA(),_.TgZ(5,"td",26)(6,"button",28),_._UZ(7,"i",29),_.qZA()()()),2&e){const r=i.$implicit,o=_.oxw(3);_.xp6(2),_.AsE("",r.id_categoria,".",r.id_subcategoria,""),_.xp6(2),_.Oqu(r.nom_subcategoria),_.xp6(2),_.Q6J("routerLink",_.WLB(4,hl,o.categoria.id_categoria,r.id_subcategoria))}}function Z(e,i){if(1&e&&(_.TgZ(0,"table",24)(1,"thead",25)(2,"tr")(3,"th",26),_._uU(4,"#"),_.qZA(),_.TgZ(5,"th",26),_._uU(6,"Nombre"),_.qZA(),_.TgZ(7,"th",26),_._uU(8,"Herramientas"),_.qZA()()(),_.TgZ(9,"tbody"),_.YNc(10,ae,8,7,"tr",27),_.qZA()()),2&e){const r=_.oxw(2);_.xp6(10),_.Q6J("ngForOf",r.subCategorias)}}function G(e,i){1&e&&(_.TgZ(0,"div",30)(1,"h4",31),_._uU(2,"No hay subcategorias"),_.qZA(),_.TgZ(3,"p"),_._UZ(4,"i",32),_.qZA(),_._UZ(5,"p",33),_.qZA())}function re(e,i){1&e&&(_.TgZ(0,"div",34)(1,"h4",31),_._uU(2,"Cargando subcategorias"),_.qZA(),_.TgZ(3,"p"),_._UZ(4,"i",35),_.qZA(),_.TgZ(5,"p",33),_._uU(6," Espere por favor "),_.qZA()())}const pe=function(e){return["/administrador/subcategoria",e,"nuevo"]};function Ee(e,i){if(1&e&&(_.TgZ(0,"div",16)(1,"h2",17),_._uU(2),_.qZA(),_.TgZ(3,"div",18)(4,"button",19)(5,"i",20),_._uU(6," Agregar "),_.qZA()(),_.TgZ(7,"div",3),_.YNc(8,Z,11,1,"table",21),_.YNc(9,G,6,0,"div",22),_.YNc(10,re,7,0,"div",23),_.qZA()()()),2&e){const r=_.oxw();_.xp6(2),_.hij("Subcategor\xedas de ",r.categoria.nom_categoria," "),_.xp6(2),_.Q6J("routerLink",_.VKq(5,pe,r.categoria.id_categoria)),_.xp6(4),_.Q6J("ngIf",!r.cargando&&r.subCategorias.length>0),_.xp6(1),_.Q6J("ngIf",!r.cargando&&0===r.subCategorias.length),_.xp6(1),_.Q6J("ngIf",r.cargando)}}let Oe=(()=>{class e{constructor(r,o,c){this.categoriaService=r,this.subCategoriaService=o,this.route=c,this.categoria=new Zs,this.subCategorias=[],this.cargando=!1}ngOnInit(){const r=this.route.snapshot.paramMap.get("id");"nueva"!==r&&(this.categoriaService.getCategoria(r).subscribe(o=>{this.categoria=o.message}),this.cargando=!0,this.subCategoriaService.getSubCategorias(r).subscribe(o=>{this.subCategorias=o,this.cargando=!1}))}guardar(r){if(r.invalid)return console.log("Formulario no valido!"),void un()({title:"Error!",text:"Faltan campos por llenar",icon:"error"});let o;o=this.categoria.id_categoria?this.categoriaService.actualizarCategoria(this.categoria):this.categoriaService.crearCategoria(this.categoria),o.subscribe(c=>{un()({title:"Exito",text:"La informaci\xf3n se guardo",icon:"success"})})}borrarSubCategoria(r,o){un()({title:"Seguro que deseas eliminar la categoria?",text:"Si lo borras afectaras a todos los comerciantes y clientes!",icon:"warning",buttons:["No","S\xed"],dangerMode:!0}).then(c=>{c&&(this.subCategorias.splice(r,1),this.subCategoriaService.borrarSubCategoria(o).subscribe(),un()("La categoria a sido eliminada, el cambio afectara a comerciantes y clientes",{icon:"success"}))})}}return e.\u0275fac=function(r){return new(r||e)(_.Y36(sc),_.Y36(Vs),_.Y36(xn.gz))},e.\u0275cmp=_.Xpm({type:e,selectors:[["app-categoria"]],decls:20,vars:5,consts:[[4,"ngIf","ngIfElse"],["nuevo",""],[1,"row","text-right"],[1,"col"],["routerLink","/administrador/categorias",1,"btn","btn-danger"],[1,"fa","fa-arrow-left"],[1,"row"],[3,"ngSubmit"],["f","ngForm"],[1,"form-group"],["type","text","placeholder","Nombre categoria","name","nombre","required","",1,"form-control",3,"ngModel","ngModelChange"],["class","form-group text-center>",4,"ngIf"],["class","row mt-3 animated fadeIn faster",4,"ngIf"],[1,"form-group","text-center>"],["type","submit",1,"btn","btn-primary","w-25"],[1,"fa","fa-save"],[1,"row","mt-3","animated","fadeIn","faster"],["animated","","fadeIn","","faster",""],[1,"col","text-right"],[1,"btn","btn-primary",3,"routerLink"],[1,"fa","fa-plus"],["class","table mt-3 animated fadeIn faster",4,"ngIf"],["class","alert alert-warning text-center mt-3",4,"ngIf"],["class","alert alert-info text-center mt-3 animated fadeIn faster",4,"ngIf"],[1,"table","mt-3","animated","fadeIn","faster"],[1,"table-dark"],["scope","col"],[4,"ngFor","ngForOf"],[1,"btn","btn-info","mr-1",3,"routerLink"],[1,"fa","fa-pen"],[1,"alert","alert-warning","text-center","mt-3"],[1,"alert-heading"],[1,"fa","fa-exclamation","fa-2x"],[1,"mb-0"],[1,"alert","alert-info","text-center","mt-3","animated","fadeIn","faster"],[1,"fa","fa-sync-alt","fa-spin","fa-2x"]],template:function(r,o){if(1&r){const c=_.EpF();_.YNc(0,To,2,1,"h1",0),_.YNc(1,ul,2,0,"ng-template",null,1,_.W1O),_._UZ(3,"hr"),_.TgZ(4,"div",2)(5,"div",3)(6,"button",4),_._UZ(7,"i",5),_._uU(8," Regresar "),_.qZA()()(),_.TgZ(9,"div",6)(10,"div",3)(11,"form",7,8),_.NdJ("ngSubmit",function(){_.CHM(c);const y=_.MAs(12);return o.guardar(y)}),_.TgZ(13,"div",9)(14,"label"),_._uU(15,"Nombre"),_.qZA(),_.TgZ(16,"input",10),_.NdJ("ngModelChange",function(y){return o.categoria.nom_categoria=y}),_.qZA()(),_._UZ(17,"hr"),_.YNc(18,oc,4,0,"div",11),_.qZA()(),_.YNc(19,Ee,11,7,"div",12),_.qZA()}if(2&r){const c=_.MAs(2);_.Q6J("ngIf",o.categoria.id_categoria)("ngIfElse",c),_.xp6(16),_.Q6J("ngModel",o.categoria.nom_categoria),_.xp6(2),_.Q6J("ngIf",!o.cargando),_.xp6(1),_.Q6J("ngIf",o.categoria.id_categoria)}},directives:[Ri.O5,xn.rH,ti._Y,ti.JL,ti.F,ti.Fj,ti.Q7,ti.JJ,ti.On,Ri.sg],styles:[""]}),e})();class Re{constructor(){this.id_categoria="",this.nom_subcategoria=""}}let Ce=(()=>{class e{constructor(r){this.http=r,this.url=Zt.N.url_version}crearVariedad(r){const o=(new Rt.WM).set("Authorization",localStorage.getItem("token")||""),c=Object.assign({},r);return delete c.id_variedad,delete c.id_categoria,delete c.id_subcategoria,this.http.post(`${this.url}variedades/nueva/${r.id_subcategoria}`,c,{headers:o}).pipe((0,ki.U)(x=>(console.log(x.message),r.id_variedad=x.message.id_variedad,r)))}actualizarVariedad(r){const o=(new Rt.WM).set("Authorization",localStorage.getItem("token")||""),c=Object.assign({},r);return delete c.id_variedad,this.http.put(`${this.url}variedades/${r.id_variedad}`,c,{headers:o})}borrarSubCategoria(r){return this.http.delete(`${this.url}/api/subcategoria/borrar/${r}`)}getVariedad(r){const o=(new Rt.WM).set("Authorization",localStorage.getItem("token")||"");return this.http.get(`${this.url}variedades/getone/${r}`,{headers:o})}getVariedades(r){const o=(new Rt.WM).set("Authorization",localStorage.getItem("token")||"");return this.http.get(`${this.url}variedades/${r}`,{headers:o}).pipe((0,ki.U)(this.crearArreglo),Rr(0))}crearArreglo(r){const o=[];return null===(r=r.message.data)?[]:(Object.keys(r).forEach(c=>{o.push(r[c])}),o)}}return e.\u0275fac=function(r){return new(r||e)(_.LFG(Rt.eN))},e.\u0275prov=_.Yz7({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();function Ne(e,i){1&e&&(_.TgZ(0,"div",11)(1,"button",12),_._UZ(2,"i",13),_._uU(3," Guardar "),_.qZA()())}const lt=function(e,i,r){return["/administrador/variedad",e,i,r]};function kt(e,i){if(1&e&&(_.TgZ(0,"tr")(1,"th",24),_._uU(2),_.qZA(),_.TgZ(3,"td",24),_._uU(4),_.qZA(),_.TgZ(5,"td",24)(6,"button",26),_._UZ(7,"i",27),_.qZA()()()),2&e){const r=i.$implicit,o=_.oxw(3);_.xp6(2),_.AsE("",o.subcategoria.id_subcategoria,".",r.id_variedad,""),_.xp6(2),_.Oqu(r.nom_variedad),_.xp6(2),_.Q6J("routerLink",_.kEZ(4,lt,o.subcategoria.id_categoria,o.subcategoria.id_subcategoria,r.id_variedad))}}function mt(e,i){if(1&e&&(_.TgZ(0,"table",22)(1,"thead",23)(2,"tr")(3,"th",24),_._uU(4,"#"),_.qZA(),_.TgZ(5,"th",24),_._uU(6,"Nombre"),_.qZA(),_.TgZ(7,"th",24),_._uU(8,"Herramientas"),_.qZA()()(),_.TgZ(9,"tbody"),_.YNc(10,kt,8,8,"tr",25),_.qZA()()),2&e){const r=_.oxw(2);_.xp6(10),_.Q6J("ngForOf",r.variedades)}}function tr(e,i){1&e&&(_.TgZ(0,"div",28)(1,"h4",29),_._uU(2,"No hay subcategorias"),_.qZA(),_.TgZ(3,"p"),_._UZ(4,"i",30),_.qZA(),_._UZ(5,"p",31),_.qZA())}function Yt(e,i){1&e&&(_.TgZ(0,"div",32)(1,"h4",29),_._uU(2,"Cargando subcategorias"),_.qZA(),_.TgZ(3,"p"),_._UZ(4,"i",33),_.qZA(),_.TgZ(5,"p",31),_._uU(6," Espere por favor "),_.qZA()())}const Kt=function(e,i){return["/administrador/variedad",e,i,"nuevo"]};function nr(e,i){if(1&e&&(_.TgZ(0,"div",14)(1,"h2",15),_._uU(2),_.qZA(),_.TgZ(3,"div",16)(4,"button",17)(5,"i",18),_._uU(6," Agregar "),_.qZA()(),_.TgZ(7,"div",1),_.YNc(8,mt,11,1,"table",19),_.YNc(9,tr,6,0,"div",20),_.YNc(10,Yt,7,0,"div",21),_.qZA()()()),2&e){const r=_.oxw();_.xp6(2),_.hij('Variedades de "',r.subcategoria.nom_subcategoria,'"'),_.xp6(2),_.Q6J("routerLink",_.WLB(5,Kt,r.subcategoria.id_categoria,r.subcategoria.id_subcategoria)),_.xp6(4),_.Q6J("ngIf",!r.cargando&&r.variedades.length>0),_.xp6(1),_.Q6J("ngIf",!r.cargando&&0===r.variedades.length),_.xp6(1),_.Q6J("ngIf",r.cargando)}}let Ze=(()=>{class e{constructor(r,o,c){this.subcategoriaService=r,this.route=o,this.variedadService=c,this.subcategoria=new Re,this.id_categoria="",this.id_subcategoria="",this.variedades=[],this.cargando=!1}ngOnInit(){this.subcategoria.id_categoria=this.route.snapshot.paramMap.get("id_categoria"),this.subcategoria.id_subcategoria=this.route.snapshot.paramMap.get("id_subcategoria"),"nuevo"!==this.subcategoria.id_subcategoria&&(this.subcategoriaService.getSubCategoria(this.subcategoria.id_categoria,this.subcategoria.id_subcategoria).subscribe(r=>{this.subcategoria=r.message}),this.cargando=!0,this.variedadService.getVariedades(this.subcategoria.id_subcategoria).subscribe(r=>{console.log(r),this.variedades=r,this.cargando=!1}))}guardar(r){if(r.invalid)return void console.log("Formulario no valido!");let o;"nuevo"!=this.subcategoria.id_subcategoria?(o=this.subcategoriaService.actualizarSubCategoria(this.subcategoria),console.log("actualizar")):(o=this.subcategoriaService.crearSubCategoria(this.subcategoria),console.log("Creando nueva subcategoria")),o.subscribe(c=>{un()({title:"Exito",text:"La informaci\xf3n se guardo",icon:"success"})})}}return e.\u0275fac=function(r){return new(r||e)(_.Y36(Vs),_.Y36(xn.gz),_.Y36(Ce))},e.\u0275cmp=_.Xpm({type:e,selectors:[["app-categoria"]],decls:19,vars:5,consts:[[1,"row","text-right"],[1,"col"],[1,"btn","btn-danger",3,"routerLink"],[1,"fa","fa-arrow-left"],[1,"row"],[3,"ngSubmit"],["f","ngForm"],[1,"form-group"],["type","text","placeholder","Nombre subcategoria","name","nombre","required","",1,"form-control",3,"ngModel","ngModelChange"],["class","form-group text-center>",4,"ngIf"],["class","row mt-3 animated fadeIn faster",4,"ngIf"],[1,"form-group","text-center>"],["type","submit",1,"btn","btn-primary","w-25"],[1,"fa","fa-save"],[1,"row","mt-3","animated","fadeIn","faster"],["animated","","fadeIn","","faster",""],[1,"col","text-right"],[1,"btn","btn-primary",3,"routerLink"],[1,"fa","fa-plus"],["class","table mt-3 animated fadeIn faster",4,"ngIf"],["class","alert alert-warning text-center mt-3",4,"ngIf"],["class","alert alert-info text-center mt-3 animated fadeIn faster",4,"ngIf"],[1,"table","mt-3","animated","fadeIn","faster"],[1,"table-dark"],["scope","col"],[4,"ngFor","ngForOf"],[1,"btn","btn-info","mr-1",3,"routerLink"],[1,"fa","fa-pen"],[1,"alert","alert-warning","text-center","mt-3"],[1,"alert-heading"],[1,"fa","fa-exclamation","fa-2x"],[1,"mb-0"],[1,"alert","alert-info","text-center","mt-3","animated","fadeIn","faster"],[1,"fa","fa-sync-alt","fa-spin","fa-2x"]],template:function(r,o){if(1&r){const c=_.EpF();_.TgZ(0,"h1"),_._uU(1),_.qZA(),_._UZ(2,"hr"),_.TgZ(3,"div",0)(4,"div",1)(5,"button",2),_._UZ(6,"i",3),_._uU(7," Regresar "),_.qZA()()(),_.TgZ(8,"div",4)(9,"div",1)(10,"form",5,6),_.NdJ("ngSubmit",function(){_.CHM(c);const y=_.MAs(11);return o.guardar(y)}),_.TgZ(12,"div",7)(13,"label"),_._uU(14,"Nombre"),_.qZA(),_.TgZ(15,"input",8),_.NdJ("ngModelChange",function(y){return o.subcategoria.nom_subcategoria=y}),_.qZA()(),_._UZ(16,"hr"),_.YNc(17,Ne,4,0,"div",9),_.qZA(),_.YNc(18,nr,11,8,"div",10),_.qZA()()}2&r&&(_.xp6(1),_.hij('Subcategoria: "',o.subcategoria.nom_subcategoria,'"'),_.xp6(4),_.MGl("routerLink","/administrador/categoria/",o.subcategoria.id_categoria,""),_.xp6(10),_.Q6J("ngModel",o.subcategoria.nom_subcategoria),_.xp6(2),_.Q6J("ngIf",!o.cargando),_.xp6(1),_.Q6J("ngIf",o.subcategoria.id_categoria))},directives:[xn.rH,ti._Y,ti.JL,ti.F,ti.Fj,ti.Q7,ti.JJ,ti.On,Ri.O5,Ri.sg],styles:[""]}),e})();class Nr{constructor(){this.id_tienda=0,this.nombreTienda="",this.x=0,this.y=0}}function Vt(e,i){if(1&e&&(_.TgZ(0,"option"),_._uU(1),_.qZA()),2&e){const r=i.$implicit;_.xp6(1),_.Oqu(r)}}let Or=(()=>{class e{constructor(r,o){this._datosTiendaProvider=r,this.route=o,this.tienda=new Nr,this.id_tienda="",this.statusTiendaAsString="",this.cargando=!1,this.estatus=["Primera vez que se registra y esperando aprobaci\xf3n","En proceso de validaci\xf3n","Aceptado","Rechazado"]}ngOnInit(){this.id_tienda=this.route.snapshot.paramMap.get("id_tienda"),this._datosTiendaProvider.getRetailer(this.id_tienda).subscribe(r=>{switch(this.tienda=r.message,this.tienda.id_tienda=r.message.id_tienda,this.tienda.genero=1==this.tienda.genero?"Masculino":2==this.tienda.genero?"Femenino":"No binario",this.tienda.estatusTienda){case 0:this.statusTiendaAsString="Primera vez que se registra y esperando aprobaci\xf3n del administrador";break;case 1:this.statusTiendaAsString="En proceso de validaci\xf3n";break;case 2:this.statusTiendaAsString="Aceptado";break;case 3:this.statusTiendaAsString="Rechazado";break;default:console.log("no se asigno valor "+this.tienda.estatusTienda)}this.tienda.horarioApertura=new Date("02 may 2018 "+this.tienda.horarioApertura),this.tienda.horarioCierre=new Date("02 may 2018 "+this.tienda.horarioCierre),this.tienda.horarioInicioEntrega=new Date("02 may 2018 "+this.tienda.horarioInicioEntrega),this.tienda.horarioFinEntrega=new Date("02 may 2018 "+this.tienda.horarioFinEntrega)})}onChange(r){let o;this.cargando=!0,o=this._datosTiendaProvider.actualizarStatusTienda(r.target.value,this.id_tienda),o.subscribe(c=>{un()({title:"Exito",text:"La informaci\xf3n se guardo",icon:"success"}),this.cargando=!1})}}return e.\u0275fac=function(r){return new(r||e)(_.Y36(Tr),_.Y36(xn.gz))},e.\u0275cmp=_.Xpm({type:e,selectors:[["app-tienda"]],decls:163,vars:34,consts:[[1,"row","text-right"],[1,"col"],["routerLink","/administrador/tiendas",1,"btn","btn-danger"],[1,"fa","fa-arrow-left"],[1,"row"],[1,"col-4"],["id","navbar-example3",1,"h-100","flex-column","align-items-stretch","pe-4","border-end"],[1,"nav","nav-pills","flex-column"],["href","#item-1",1,"nav-link"],["href","#item-1-1",1,"nav-link","ms-3","my-1"],["href","#item-1-2",1,"nav-link","ms-3","my-1"],["href","#item-1-3",1,"nav-link","ms-3","my-1"],["href","#item-1-4",1,"nav-link","ms-3","my-1"],["href","#item-1-5",1,"nav-link","ms-3","my-1"],["href","#item-1-6",1,"nav-link","ms-3","my-1"],["href","#item-1-7",1,"nav-link","ms-3","my-1"],["href","#item-1-8",1,"nav-link","ms-3","my-1"],["href","#item-1-9",1,"nav-link","ms-3","my-1"],["href","#item-1-10",1,"nav-link","ms-3","my-1"],["href","#item-1-11",1,"nav-link","ms-3","my-1"],["href","#item-3",1,"nav-link"],["href","#item-2-1",1,"nav-link","ms-3","my-1"],["href","#item-2-2",1,"nav-link","ms-3","my-1"],["href","#item-2-3",1,"nav-link","ms-3","my-1"],["href","#item-2-4",1,"nav-link","ms-3","my-1"],["href","#item-2-5",1,"nav-link","ms-3","my-1"],["href","#item-2-6",1,"nav-link","ms-3","my-1"],["href","#item-2-7",1,"nav-link","ms-3","my-1"],["href","#item-2-8",1,"nav-link","ms-3","my-1"],[1,"col-8"],["data-bs-spy","scroll","data-bs-target","#navbar-example3","data-bs-smooth-scroll","true","tabindex","0",1,"scrollspy-example-2"],["id","item-1-1"],["id","item-1-2"],["id","item-1-3"],["id","item-1-4"],["id","item-1-5"],["id","item-1-6"],["id","item-1-7"],["id","item-1-8"],["id","item-1-9"],["id","item-1-10"],["id","item-1-11"],["id","item-2-1"],["id","item-2-2"],["id","item-2-3"],["id","item-2-4"],["id","item-2-5"],["id","item-2-6"],["id","item-2-7"],["type","button",1,"btn","btn-outline-info","w-50"],[1,"fa","fa-location-arrow"],["target","_blank",3,"href"],["id","item-2-8"],["f","ngForm"],["name","status","aria-label","Default select example",1,"form-select",3,"ngModel","ngModelChange","change"],[4,"ngFor","ngForOf"]],template:function(r,o){1&r&&(_.TgZ(0,"h1"),_._uU(1),_.qZA(),_._UZ(2,"hr"),_.TgZ(3,"div",0)(4,"div",1)(5,"button",2),_._UZ(6,"i",3),_._uU(7," Regresar "),_.qZA()()(),_.TgZ(8,"div",4)(9,"div",5)(10,"nav",6)(11,"nav",7)(12,"a",8),_._uU(13,"Comercio"),_.qZA(),_.TgZ(14,"nav",7)(15,"a",9),_._uU(16,"Nombre"),_.qZA(),_.TgZ(17,"a",10),_._uU(18,"Slogan o descripci\xf3n"),_.qZA(),_.TgZ(19,"a",11),_._uU(20,"Domicilio"),_.qZA(),_.TgZ(21,"a",12),_._uU(22,"C.P."),_.qZA(),_.TgZ(23,"a",13),_._uU(24,"Tel\xe9fono"),_.qZA(),_.TgZ(25,"a",14),_._uU(26,"Referencias"),_.qZA(),_.TgZ(27,"a",15),_._uU(28,"HorarioApertura"),_.qZA(),_.TgZ(29,"a",16),_._uU(30,"HorarioCierre"),_.qZA(),_.TgZ(31,"a",17),_._uU(32,"HorarioInicioEntrega"),_.qZA(),_.TgZ(33,"a",18),_._uU(34,"HorarioFinEntrega"),_.qZA(),_.TgZ(35,"a",19),_._uU(36,"MontominimoEntrega"),_.qZA()(),_.TgZ(37,"a",20),_._uU(38,"Comerciante"),_.qZA(),_.TgZ(39,"nav",7)(40,"a",21),_._uU(41,"NombrePropietario"),_.qZA(),_.TgZ(42,"a",22),_._uU(43,"Apaterno"),_.qZA(),_.TgZ(44,"a",23),_._uU(45,"Amaterno"),_.qZA(),_.TgZ(46,"a",24),_._uU(47,"Email"),_.qZA(),_.TgZ(48,"a",25),_._uU(49,"Genero"),_.qZA(),_.TgZ(50,"a",26),_._uU(51,"RFC"),_.qZA(),_.TgZ(52,"a",27),_._uU(53,"Fecha nacimiento"),_.qZA(),_.TgZ(54,"a",28),_._uU(55,"Ubicaci\xf3n"),_.qZA(),_.TgZ(56,"a",28),_._uU(57,"Estatus"),_.qZA()()()()(),_.TgZ(58,"div",29)(59,"div",30)(60,"div",31)(61,"h4"),_._uU(62),_.qZA(),_.TgZ(63,"p"),_._uU(64,"Nombre del comercio"),_.qZA()(),_.TgZ(65,"div",32)(66,"h5"),_._uU(67),_.qZA(),_.TgZ(68,"p"),_._uU(69,"Slogan o descripci\xf3n"),_.qZA()(),_.TgZ(70,"div",33)(71,"h5"),_._uU(72),_.qZA(),_.TgZ(73,"p"),_._uU(74,"Domicilio"),_.qZA()(),_.TgZ(75,"div",34)(76,"h4"),_._uU(77),_.qZA(),_.TgZ(78,"p"),_._uU(79,"C\xf3digo postal"),_.qZA()(),_.TgZ(80,"div",35)(81,"h4"),_._uU(82),_.qZA(),_.TgZ(83,"p"),_._uU(84,"Tel\xe9fono"),_.qZA()(),_.TgZ(85,"div",36)(86,"h5"),_._uU(87),_.qZA(),_.TgZ(88,"p"),_._uU(89,"Referencias"),_.qZA()(),_.TgZ(90,"div",37)(91,"h5"),_._uU(92),_.ALo(93,"date"),_.qZA(),_.TgZ(94,"p"),_._uU(95,"Horario apertura"),_.qZA()(),_.TgZ(96,"div",38)(97,"h5"),_._uU(98),_.ALo(99,"date"),_.qZA(),_.TgZ(100,"p"),_._uU(101,"Horario cierre"),_.qZA()(),_.TgZ(102,"div",39)(103,"h5"),_._uU(104),_.ALo(105,"date"),_.qZA(),_.TgZ(106,"p"),_._uU(107,"Horario inicio entrega"),_.qZA()(),_.TgZ(108,"div",40)(109,"h5"),_._uU(110),_.ALo(111,"date"),_.qZA(),_.TgZ(112,"p"),_._uU(113,"Horario fin entrega"),_.qZA()(),_.TgZ(114,"div",41)(115,"h5"),_._uU(116),_.qZA(),_.TgZ(117,"p"),_._uU(118,"Monto minimo entrega"),_.qZA()(),_.TgZ(119,"div",42)(120,"h5"),_._uU(121),_.qZA(),_.TgZ(122,"p"),_._uU(123,"Nombre propietario"),_.qZA()(),_.TgZ(124,"div",43)(125,"h5"),_._uU(126),_.qZA(),_.TgZ(127,"p"),_._uU(128,"Apellido paterno"),_.qZA()(),_.TgZ(129,"div",44)(130,"h5"),_._uU(131),_.qZA(),_.TgZ(132,"p"),_._uU(133,"Apellido amaterno"),_.qZA()(),_.TgZ(134,"div",45)(135,"h5"),_._uU(136),_.qZA(),_.TgZ(137,"p"),_._uU(138,"Correo electr\xf3nico"),_.qZA()(),_.TgZ(139,"div",46)(140,"h5"),_._uU(141),_.qZA(),_.TgZ(142,"p"),_._uU(143,"Genero"),_.qZA()(),_.TgZ(144,"div",47)(145,"h5"),_._uU(146),_.qZA(),_.TgZ(147,"p"),_._uU(148,"Fecha nacimiento"),_.qZA()(),_.TgZ(149,"div",48)(150,"h5"),_._uU(151,"Ver ubicaci\xf3n"),_.qZA(),_.TgZ(152,"button",49),_._UZ(153,"i",50),_.TgZ(154,"a",51),_._uU(155,"Ver mapa"),_.qZA()()(),_.TgZ(156,"div",52)(157,"form",null,53)(159,"h5"),_._uU(160,"Estatus"),_.qZA(),_.TgZ(161,"select",54),_.NdJ("ngModelChange",function(x){return o.statusTiendaAsString=x})("change",function(x){return o.onChange(x)}),_.YNc(162,Vt,2,1,"option",55),_.qZA()()()()()()),2&r&&(_.xp6(1),_.hij('Datos de la tienda "',o.tienda.nombreTienda,'": '),_.xp6(61),_.Oqu(o.tienda.nombreTienda),_.xp6(5),_.Oqu(o.tienda.slogan),_.xp6(5),_.Oqu(o.tienda.direccion),_.xp6(5),_.Oqu(o.tienda.CP),_.xp6(5),_.Oqu(o.tienda.telefono),_.xp6(5),_.Oqu(o.tienda.referencias),_.xp6(5),_.Oqu(_.xi3(93,22,o.tienda.horarioApertura,"shortTime")),_.xp6(6),_.Oqu(_.xi3(99,25,o.tienda.horarioCierre,"shortTime")),_.xp6(6),_.Oqu(_.xi3(105,28,o.tienda.horarioInicioEntrega,"shortTime")),_.xp6(6),_.Oqu(_.xi3(111,31,o.tienda.horarioFinEntrega,"shortTime")),_.xp6(6),_.hij("$",o.tienda.montominimoEntrega,""),_.xp6(5),_.Oqu(o.tienda.nombrePropietario),_.xp6(5),_.Oqu(o.tienda.apaterno),_.xp6(5),_.Oqu(o.tienda.amaterno),_.xp6(5),_.Oqu(o.tienda.email),_.xp6(5),_.Oqu(o.tienda.genero),_.xp6(5),_.Oqu(o.tienda.fecha_nac),_.xp6(8),_.hYB("href","https://www.google.com/maps?q=",o.tienda.y,",",o.tienda.x,"",_.LSH),_.xp6(7),_.Q6J("ngModel",o.statusTiendaAsString),_.xp6(1),_.Q6J("ngForOf",o.estatus))},directives:[xn.rH,ti._Y,ti.JL,ti.F,ti.EJ,ti.JJ,ti.On,Ri.sg,ti.YN,ti.Kr],pipes:[Ri.uU],styles:[""]}),e})();class Ur{constructor(){this.id_subcategoria="",this.nom_variedad=""}}class Eo{constructor(){this.id=0,this.nombreArchivo="",this.base64textString=""}}let as=(()=>{class e{constructor(r){this.http=r,this.url=Zt.N.url_cdn}uploadFile(r){return this.http.post(`${this.url}sistema/subirpng/inicio`,JSON.stringify(r)).pipe((0,ki.U)(o=>o.code))}}return e.\u0275fac=function(r){return new(r||e)(_.LFG(Rt.eN))},e.\u0275prov=_.Yz7({token:e,factory:e.\u0275fac,providedIn:"root"}),e})(),Tt=(()=>{class e{constructor(r){this.http=r,this.url=Zt.N.url_version}registrarFotoVariedad(r){const o={id:r},c=(new Rt.WM).set("Authorization",localStorage.getItem("token")||"");return this.http.post(`${this.url}fotos/nuevafotovariedad`,o,{headers:c}).pipe((0,ki.U)(x=>x.message[0]))}borrarFilaFotoVariedad(r){const o=(new Rt.WM).set("Authorization",localStorage.getItem("token")||"");return this.http.delete(`${this.url}fotos/borrarfotovariedad/${r}`,{headers:o}).pipe((0,ki.U)(c=>c))}}return e.\u0275fac=function(r){return new(r||e)(_.LFG(Rt.eN))},e.\u0275prov=_.Yz7({token:e,factory:e.\u0275fac,providedIn:"root"}),e})(),Cr=(()=>{class e{constructor(r){this.http=r,this.url=Zt.N.url_cdn}deleteFile(r){return this.http.delete(`${this.url}sistema/borrarfilepng/${r}`).pipe((0,ki.U)(o=>o))}}return e.\u0275fac=function(r){return new(r||e)(_.LFG(Rt.eN))},e.\u0275prov=_.Yz7({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();function yr(e,i){1&e&&(_.TgZ(0,"div",14)(1,"button",15),_._UZ(2,"i",16),_._uU(3," Guardar "),_.qZA()())}function Wa(e,i){1&e&&(_.TgZ(0,"div",14)(1,"button",15),_._UZ(2,"i",21),_._uU(3," Subir "),_.qZA()())}function So(e,i){if(1&e){const r=_.EpF();_.TgZ(0,"form",5),_.NdJ("ngSubmit",function(){return _.CHM(r),_.oxw(2).upload()}),_.TgZ(1,"input",20),_.NdJ("change",function(c){return _.CHM(r),_.oxw(2).seleccionarArchivo(c)}),_.qZA(),_._UZ(2,"br")(3,"br"),_.YNc(4,Wa,4,0,"div",11),_.qZA()}if(2&e){const r=_.oxw(2);_.xp6(4),_.Q6J("ngIf",r.imagenLista)}}function br(e,i){1&e&&(_.TgZ(0,"div",22)(1,"h4",23),_._uU(2,"Subiendo la imagen"),_.qZA(),_.TgZ(3,"p"),_._UZ(4,"i",24),_.qZA(),_.TgZ(5,"p",25),_._uU(6," Espere por favor "),_.qZA()())}function Ao(e,i){if(1&e&&(_.TgZ(0,"div",7)(1,"div",17)(2,"label"),_._uU(3,"Galeria de imagenes"),_.qZA(),_._UZ(4,"br")(5,"hr")(6,"hr"),_.TgZ(7,"p"),_._uU(8,"Por favor elije una imagen en formato png en un tama\xf1o de 100x100 pixeles"),_.qZA(),_.YNc(9,So,5,1,"form",18),_.YNc(10,br,7,0,"div",19),_.qZA()()),2&e){const r=_.oxw();_.xp6(9),_.Q6J("ngIf",!r.subiendo),_.xp6(1),_.Q6J("ngIf",r.subiendo)}}function fl(e,i){if(1&e){const r=_.EpF();_.TgZ(0,"div",26),_._UZ(1,"img",27),_.TgZ(2,"div",28)(3,"h5",29),_._uU(4),_.qZA(),_.TgZ(5,"p",30),_._uU(6),_.qZA(),_.TgZ(7,"button",31),_.NdJ("click",function(){const c=_.CHM(r),x=c.$implicit,y=c.index;return _.oxw().deleteFoto(x,y)}),_._uU(8," Borrar "),_.qZA()()()}if(2&e){const r=i.$implicit,o=_.oxw();_.xp6(1),_.hYB("src","",o.url,"assets/png/",r,".png",_.LSH),_.MGl("alt","No se encontro la imagen ",r,".png"),_.xp6(3),_.Oqu(o.variedad.nom_variedad),_.xp6(2),_.hij("#",r,"")}}let Cn=(()=>{class e{constructor(r,o,c,x,y){this.route=r,this._variedadService=o,this.uploadService=c,this._archvivoService=x,this._fileDeleteService=y,this.variedad=new Ur,this.id_categoria="",this.id_subcategoria="",this.id_variedad="",this.cargando=!1,this.subiendo=!1,this.imagenLista=!1,this.archivo=new Eo,this.url=Zt.N.url_cdn}ngOnInit(){this.variedad.id_categoria=this.route.snapshot.paramMap.get("id_categoria"),this.variedad.id_subcategoria=this.route.snapshot.paramMap.get("id_subcategoria"),this.variedad.id_variedad=this.route.snapshot.paramMap.get("id_variedad"),"nuevo"!==this.variedad.id_variedad?(console.log("Editar"),this._variedadService.getVariedad(this.variedad.id_variedad).subscribe(r=>{this.variedad=r.message})):console.log("Nuevo")}_handleReaderLoaded(r){this.archivo.base64textString=btoa(r.target.result)}seleccionarArchivo(r){var o=r.target.files,c=o[0];if(this.archivo.nombreArchivo=c.name,o&&c){var x=new FileReader;x.onload=this._handleReaderLoaded.bind(this),x.readAsBinaryString(c)}this.imagenLista=!0}upload(){this.subiendo=!0,this._archvivoService.registrarFotoVariedad(this.variedad.id_variedad).subscribe(r=>{this.archivo.nombreNuevo=r,r>0?this.uploadService.uploadFile(this.archivo).subscribe(o=>{var c;200!=o?un()({title:"Error",text:"El archivo no se subio, contacte al administrador",icon:"warning"}):(null===(c=this.variedad.fotos)||void 0===c||c.push(r),un()({title:"Exito",text:"El archivo se subio",icon:"success"})),this.subiendo=!1}):un()({title:"Error",text:"Error de red, contacte al administrador",icon:"warning"})})}deleteFoto(r,o){this.subiendo=!0,this._fileDeleteService.deleteFile(r).subscribe(c=>{200!=c.code?un()({title:"Error",text:c.message,icon:"warning"}):this._archvivoService.borrarFilaFotoVariedad(r).subscribe(x=>{var y;200!=c.code?un()({title:"Error",text:c.message,icon:"warning"}):(null===(y=this.variedad.fotos)||void 0===y||y.splice(o,o+1),un()({title:"Exito",text:c.message,icon:"success"}),this.subiendo=!1)})})}guardar(r){if(this.cargando=!0,r.invalid)return void console.log("Formulario no valido!");let o;o="nuevo"!=this.variedad.id_variedad?this._variedadService.actualizarVariedad(this.variedad):this._variedadService.crearVariedad(this.variedad),o.subscribe(c=>{un()({title:"Exito",text:"La informaci\xf3n se guardo",icon:"success"}),this.cargando=!1})}}return e.\u0275fac=function(r){return new(r||e)(_.Y36(xn.gz),_.Y36(Ce),_.Y36(as),_.Y36(Tt),_.Y36(Cr))},e.\u0275cmp=_.Xpm({type:e,selectors:[["app-variedad"]],decls:30,vars:9,consts:[[1,"row","text-right"],[1,"col"],[1,"btn","btn-danger",3,"routerLink"],[1,"fa","fa-arrow-left"],[1,"row"],[3,"ngSubmit"],["f","ngForm"],[1,"form-group"],["type","text","placeholder","Nombre variedad","name","nom_variedad","required","",1,"form-control",3,"ngModel","ngModelChange"],["type","text","placeholder","Descripci\xf3n de la  variedad","name","descripcionVar","required","",1,"form-control",3,"ngModel","ngModelChange"],["type","text","placeholder","Clave fresco local","name","cve_FL","required","",1,"form-control",3,"ngModel","ngModelChange"],["class","form-group text-center>",4,"ngIf"],["class","form-group",4,"ngIf"],["class","card","style","width: 18rem;",4,"ngFor","ngForOf"],[1,"form-group","text-center>"],["type","submit",1,"btn","btn-primary","w-25"],[1,"fa","fa-save"],[1,"br-wrapper"],[3,"ngSubmit",4,"ngIf"],["class","alert alert-info text-center mt-3 animated fadeIn faster",4,"ngIf"],["type","file","accept","image/png",1,"btn","btn-primary",3,"change"],[1,"fa","fa-upload"],[1,"alert","alert-info","text-center","mt-3","animated","fadeIn","faster"],[1,"alert-heading"],[1,"fa","fa-sync-alt","fa-spin","fa-2x"],[1,"mb-0"],[1,"card",2,"width","18rem"],[1,"card-img-top",3,"src","alt"],[1,"card-body"],[1,"card-title"],[1,"card-text"],["type","submit",1,"btn","btn-danger",3,"click"]],template:function(r,o){if(1&r){const c=_.EpF();_.TgZ(0,"h1"),_._uU(1),_.qZA(),_._UZ(2,"hr"),_.TgZ(3,"div",0)(4,"div",1)(5,"button",2),_._UZ(6,"i",3),_._uU(7," Regresar "),_.qZA()()(),_.TgZ(8,"div",4)(9,"div",1)(10,"form",5,6),_.NdJ("ngSubmit",function(){_.CHM(c);const y=_.MAs(11);return o.guardar(y)}),_.TgZ(12,"div",7)(13,"label"),_._uU(14,"Nombre variedad"),_.qZA(),_.TgZ(15,"input",8),_.NdJ("ngModelChange",function(y){return o.variedad.nom_variedad=y}),_.qZA()(),_.TgZ(16,"div",7)(17,"label"),_._uU(18,"Descripci\xf3n de la variedad"),_.qZA(),_.TgZ(19,"input",9),_.NdJ("ngModelChange",function(y){return o.variedad.descripcionVar=y}),_.qZA()(),_.TgZ(20,"div",7)(21,"label"),_._uU(22,"Clave fresco local"),_.qZA(),_.TgZ(23,"input",10),_.NdJ("ngModelChange",function(y){return o.variedad.cve_FL=y}),_.qZA()(),_._UZ(24,"br"),_.YNc(25,yr,4,0,"div",11),_.qZA(),_._UZ(26,"br")(27,"br"),_.YNc(28,Ao,11,2,"div",12),_.YNc(29,fl,9,5,"div",13),_.qZA()()}2&r&&(_.xp6(1),_.hij("Variedad: ",o.variedad.nom_variedad,""),_.xp6(4),_.hYB("routerLink","/administrador/subcategoria/",o.variedad.id_categoria,"/",o.variedad.id_subcategoria,""),_.xp6(10),_.Q6J("ngModel",o.variedad.nom_variedad),_.xp6(4),_.Q6J("ngModel",o.variedad.descripcionVar),_.xp6(4),_.Q6J("ngModel",o.variedad.cve_FL),_.xp6(2),_.Q6J("ngIf",!o.cargando),_.xp6(3),_.Q6J("ngIf","nuevo"!=o.variedad.id_variedad),_.xp6(1),_.Q6J("ngForOf",o.variedad.fotos))},directives:[xn.rH,ti._Y,ti.JL,ti.F,ti.Fj,ti.Q7,ti.JJ,ti.On,Ri.O5,Ri.sg],styles:[""]}),e})();var yn_version="0.18.5",Lr=1200,ko=1252,lc=[874,932,936,949,950,1250,1251,1252,1253,1254,1255,1256,1257,1258,1e4],dl={0:1252,1:65001,2:65001,77:1e4,128:932,129:949,130:1361,134:936,136:950,161:1253,162:1254,163:1258,177:1255,178:1256,186:1257,204:1251,222:874,238:1250,255:1252,69:6969},ss=function(e){-1!=lc.indexOf(e)&&(ko=dl[0]=e)},Wn=function(e){Lr=e,ss(e)};var lr,In=function(i){return String.fromCharCode(i)},pl=function(i){return String.fromCharCode(i)},Xa="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";function Mn(e){for(var i="",r=0,o=0,c=0,x=0,y=0,T=0,C=0,I=0;I<e.length;)x=(r=e.charCodeAt(I++))>>2,y=(3&r)<<4|(o=e.charCodeAt(I++))>>4,T=(15&o)<<2|(c=e.charCodeAt(I++))>>6,C=63&c,isNaN(o)?T=C=64:isNaN(c)&&(C=64),i+=Xa.charAt(x)+Xa.charAt(y)+Xa.charAt(T)+Xa.charAt(C);return i}function Qi(e){var i="",x=0,y=0,T=0,C=0;e=e.replace(/[^\w\+\/\=]/g,"");for(var I=0;I<e.length;)x=Xa.indexOf(e.charAt(I++)),y=Xa.indexOf(e.charAt(I++)),i+=String.fromCharCode(x<<2|y>>4),64!==(T=Xa.indexOf(e.charAt(I++)))&&(i+=String.fromCharCode((15&y)<<4|T>>2)),64!==(C=Xa.indexOf(e.charAt(I++)))&&(i+=String.fromCharCode((3&T)<<6|C));return i}var _r=function(){return"undefined"!=typeof Buffer&&"undefined"!=typeof process&&void 0!==process.versions&&!!process.versions.node}(),ls=function(){if("undefined"!=typeof Buffer){var e=!Buffer.from;if(!e)try{Buffer.from("foo","utf8")}catch(i){e=!0}return e?function(i,r){return r?new Buffer(i,r):new Buffer(i)}:Buffer.from.bind(Buffer)}return function(){}}();function en(e){return _r?Buffer.alloc?Buffer.alloc(e):new Buffer(e):"undefined"!=typeof Uint8Array?new Uint8Array(e):new Array(e)}function ef(e){return _r?Buffer.allocUnsafe?Buffer.allocUnsafe(e):new Buffer(e):"undefined"!=typeof Uint8Array?new Uint8Array(e):new Array(e)}var Xn=function(i){return _r?ls(i,"binary"):i.split("").map(function(r){return 255&r.charCodeAt(0)})};function hn(e){if("undefined"==typeof ArrayBuffer)return Xn(e);for(var i=new ArrayBuffer(e.length),r=new Uint8Array(i),o=0;o!=e.length;++o)r[o]=255&e.charCodeAt(o);return i}function za(e){if(Array.isArray(e))return e.map(function(o){return String.fromCharCode(o)}).join("");for(var i=[],r=0;r<e.length;++r)i[r]=String.fromCharCode(e[r]);return i.join("")}var Bi=_r?function(e){return Buffer.concat(e.map(function(i){return Buffer.isBuffer(i)?i:ls(i)}))}:function(e){if("undefined"!=typeof Uint8Array){var i=0,r=0;for(i=0;i<e.length;++i)r+=e[i].length;var o=new Uint8Array(r),c=0;for(i=0,r=0;i<e.length;r+=c,++i)if(c=e[i].length,e[i]instanceof Uint8Array)o.set(e[i],r);else{if("string"==typeof e[i])throw"wtf";o.set(new Uint8Array(e[i]),r)}return o}return[].concat.apply([],e.map(function(x){return Array.isArray(x)?x:[].slice.call(x)}))},Hi=/\u0000/g,Co=/[\u0001-\u0006]/g;function ml(e){for(var i="",r=e.length-1;r>=0;)i+=e.charAt(r--);return i}function ga(e,i){var r=""+e;return r.length>=i?r:ii("0",i-r.length)+r}function Yu(e,i){var r=""+e;return r.length>=i?r:ii(" ",i-r.length)+r}function uc(e,i){var r=""+e;return r.length>=i?r:r+ii(" ",i-r.length)}var _l=Math.pow(2,32);function Io(e,i){return e>_l||e<-_l?function ad(e,i){var r=""+Math.round(e);return r.length>=i?r:ii("0",i-r.length)+r}(e,i):function au(e,i){var r=""+e;return r.length>=i?r:ii("0",i-r.length)+r}(Math.round(e),i)}function hc(e,i){return e.length>=7+(i=i||0)&&103==(32|e.charCodeAt(i))&&101==(32|e.charCodeAt(i+1))&&110==(32|e.charCodeAt(i+2))&&101==(32|e.charCodeAt(i+3))&&114==(32|e.charCodeAt(i+4))&&97==(32|e.charCodeAt(i+5))&&108==(32|e.charCodeAt(i+6))}var Ku=[["Sun","Sunday"],["Mon","Monday"],["Tue","Tuesday"],["Wed","Wednesday"],["Thu","Thursday"],["Fri","Friday"],["Sat","Saturday"]],cs=[["J","Jan","January"],["F","Feb","February"],["M","Mar","March"],["A","Apr","April"],["M","May","May"],["J","Jun","June"],["J","Jul","July"],["A","Aug","August"],["S","Sep","September"],["O","Oct","October"],["N","Nov","November"],["D","Dec","December"]],or={0:"General",1:"0",2:"0.00",3:"#,##0",4:"#,##0.00",9:"0%",10:"0.00%",11:"0.00E+00",12:"# ?/?",13:"# ??/??",14:"m/d/yy",15:"d-mmm-yy",16:"d-mmm",17:"mmm-yy",18:"h:mm AM/PM",19:"h:mm:ss AM/PM",20:"h:mm",21:"h:mm:ss",22:"m/d/yy h:mm",37:"#,##0 ;(#,##0)",38:"#,##0 ;[Red](#,##0)",39:"#,##0.00;(#,##0.00)",40:"#,##0.00;[Red](#,##0.00)",45:"mm:ss",46:"[h]:mm:ss",47:"mmss.0",48:"##0.0E+0",49:"@",56:'"\u4e0a\u5348/\u4e0b\u5348 "hh"\u6642"mm"\u5206"ss"\u79d2 "'},gl={5:37,6:38,7:39,8:40,23:0,24:0,25:0,26:0,27:14,28:14,29:14,30:14,31:14,50:14,51:14,52:14,53:14,54:14,55:14,56:14,57:14,58:14,59:1,60:2,61:3,62:4,67:9,68:10,69:12,70:13,71:14,72:14,73:15,74:16,75:17,76:20,77:21,78:22,79:45,80:46,81:47,82:0},Mo={5:'"$"#,##0_);\\("$"#,##0\\)',63:'"$"#,##0_);\\("$"#,##0\\)',6:'"$"#,##0_);[Red]\\("$"#,##0\\)',64:'"$"#,##0_);[Red]\\("$"#,##0\\)',7:'"$"#,##0.00_);\\("$"#,##0.00\\)',65:'"$"#,##0.00_);\\("$"#,##0.00\\)',8:'"$"#,##0.00_);[Red]\\("$"#,##0.00\\)',66:'"$"#,##0.00_);[Red]\\("$"#,##0.00\\)',41:'_(* #,##0_);_(* \\(#,##0\\);_(* "-"_);_(@_)',42:'_("$"* #,##0_);_("$"* \\(#,##0\\);_("$"* "-"_);_(@_)',43:'_(* #,##0.00_);_(* \\(#,##0.00\\);_(* "-"??_);_(@_)',44:'_("$"* #,##0.00_);_("$"* \\(#,##0.00\\);_("$"* "-"??_);_(@_)'};function Ba(e,i,r){for(var o=e<0?-1:1,c=e*o,x=0,y=1,T=0,C=1,I=0,F=0,N=Math.floor(c);I<i&&(T=(N=Math.floor(c))*y+x,F=N*I+C,!(c-N<5e-8));)c=1/(c-N),x=y,y=T,C=I,I=F;if(F>i&&(I>i?(F=C,T=x):(F=I,T=y)),!r)return[0,o*T,F];var U=Math.floor(o*T/F);return[U,o*T-U*F,F]}function Na(e,i,r){if(e>2958465||e<0)return null;var o=0|e,c=Math.floor(86400*(e-o)),x=0,y=[],T={D:o,T:c,u:86400*(e-o)-c,y:0,m:0,d:0,H:0,M:0,S:0,q:0};if(Math.abs(T.u)<1e-6&&(T.u=0),i&&i.date1904&&(o+=1462),T.u>.9999&&(T.u=0,86400==++c&&(T.T=c=0,++o,++T.D)),60===o)y=r?[1317,10,29]:[1900,2,29],x=3;else if(0===o)y=r?[1317,8,29]:[1900,1,0],x=6;else{o>60&&--o;var C=new Date(1900,0,1);C.setDate(C.getDate()+o-1),y=[C.getFullYear(),C.getMonth()+1,C.getDate()],x=C.getDay(),o<60&&(x=(x+6)%7),r&&(x=function nf(e,i){i[0]-=581;var r=e.getDay();return e<60&&(r=(r+6)%7),r}(C,y))}return T.y=y[0],T.m=y[1],T.d=y[2],T.S=c%60,c=Math.floor(c/60),T.M=c%60,c=Math.floor(c/60),T.H=c,T.q=x,T}var xl=new Date(1899,11,31,0,0,0),fc=xl.getTime(),Qt=new Date(1900,2,1,0,0,0);function dc(e,i){var r=e.getTime();return i?r-=1262304e5:e>=Qt&&(r+=864e5),(r-(fc+6e4*(e.getTimezoneOffset()-xl.getTimezoneOffset())))/864e5}function su(e){return-1==e.indexOf(".")?e:e.replace(/(?:\.0*|(\.\d*[1-9])0+)$/,"$1")}function Gs(e,i){switch(typeof e){case"string":return e;case"boolean":return e?"TRUE":"FALSE";case"number":return(0|e)===e?e.toString(10):function Fo(e){var r,i=Math.floor(Math.log(Math.abs(e))*Math.LOG10E);return r=i>=-4&&i<=-1?e.toPrecision(10+i):Math.abs(i)<=9?function Ju(e){var i=e<0?12:11,r=su(e.toFixed(12));return r.length<=i||(r=e.toPrecision(10)).length<=i?r:e.toExponential(5)}(e):10===i?e.toFixed(10).substr(0,12):function Qu(e){var i=su(e.toFixed(11));return i.length>(e<0?12:11)||"0"===i||"-0"===i?e.toPrecision(6):i}(e),su(function rf(e){return-1==e.indexOf("E")?e:e.replace(/(?:\.0*|(\.\d*[1-9])0+)[Ee]/,"$1E").replace(/(E[+-])(\d)$/,"$10$2")}(r.toUpperCase()))}(e);case"undefined":return"";case"object":if(null==e)return"";if(e instanceof Date)return vn(14,dc(e,i&&i.date1904),i)}throw new Error("unsupported value in General format: "+e)}function ou(e,i,r,o){var C,c="",x=0,y=0,T=r.y,I=0;switch(e){case 98:T=r.y+543;case 121:switch(i.length){case 1:case 2:C=T%100,I=2;break;default:C=T%1e4,I=4}break;case 109:switch(i.length){case 1:case 2:C=r.m,I=i.length;break;case 3:return cs[r.m-1][1];case 5:return cs[r.m-1][0];default:return cs[r.m-1][2]}break;case 100:switch(i.length){case 1:case 2:C=r.d,I=i.length;break;case 3:return Ku[r.q][0];default:return Ku[r.q][1]}break;case 104:switch(i.length){case 1:case 2:C=1+(r.H+11)%12,I=i.length;break;default:throw"bad hour format: "+i}break;case 72:switch(i.length){case 1:case 2:C=r.H,I=i.length;break;default:throw"bad hour format: "+i}break;case 77:switch(i.length){case 1:case 2:C=r.M,I=i.length;break;default:throw"bad minute format: "+i}break;case 115:if("s"!=i&&"ss"!=i&&".0"!=i&&".00"!=i&&".000"!=i)throw"bad second format: "+i;return 0!==r.u||"s"!=i&&"ss"!=i?(y=o>=2?3===o?1e3:100:1===o?10:1,(x=Math.round(y*(r.S+r.u)))>=60*y&&(x=0),"s"===i?0===x?"0":""+x/y:(c=ga(x,2+o),"ss"===i?c.substr(0,2):"."+c.substr(2,i.length-1))):ga(r.S,i.length);case 90:switch(i){case"[h]":case"[hh]":C=24*r.D+r.H;break;case"[m]":case"[mm]":C=60*(24*r.D+r.H)+r.M;break;case"[s]":case"[ss]":C=60*(60*(24*r.D+r.H)+r.M)+Math.round(r.S+r.u);break;default:throw"bad abstime format: "+i}I=3===i.length?1:2;break;case 101:C=T,I=1}return I>0?ga(C,I):""}function Fn(e){if(e.length<=3)return e;for(var r=e.length%3,o=e.substr(0,r);r!=e.length;r+=3)o+=(o.length>0?",":"")+e.substr(r,3);return o}var Do=/%/g;function cu(e,i){var r,o=e.indexOf("E")-e.indexOf(".")-1;if(e.match(/^#+0.0E\+0$/)){if(0==i)return"0.0E+0";if(i<0)return"-"+cu(e,-i);var c=e.indexOf(".");-1===c&&(c=e.indexOf("E"));var x=Math.floor(Math.log(i)*Math.LOG10E)%c;if(x<0&&(x+=c),-1===(r=(i/Math.pow(10,x)).toPrecision(o+1+(c+x)%c)).indexOf("e")){var y=Math.floor(Math.log(i)*Math.LOG10E);for(-1===r.indexOf(".")?r=r.charAt(0)+"."+r.substr(1)+"E+"+(y-r.length+x):r+="E+"+(y-x);"0."===r.substr(0,2);)r=(r=r.charAt(0)+r.substr(2,c)+"."+r.substr(2+c)).replace(/^0+([1-9])/,"$1").replace(/^0+\./,"0.");r=r.replace(/\+-/,"-")}r=r.replace(/^([+-]?)(\d*)\.(\d*)[Ee]/,function(T,C,I,F){return C+I+F.substr(0,(c+x)%c)+"."+F.substr(x)+"E"})}else r=i.toExponential(o);return e.match(/E\+00$/)&&r.match(/e[+-]\d$/)&&(r=r.substr(0,r.length-1)+"0"+r.charAt(r.length-1)),e.match(/E\-/)&&r.match(/e\+/)&&(r=r.replace(/e\+/,"e")),r.replace("e","E")}var af=/# (\?+)( ?)\/( ?)(\d+)/,uu=/^#*0*\.([0#]+)/,Yn=/\).*[0#]/,_c=/\(###\) ###\\?-####/;function Yi(e){for(var r,i="",o=0;o!=e.length;++o)switch(r=e.charCodeAt(o)){case 35:break;case 63:i+=" ";break;case 48:i+="0";break;default:i+=String.fromCharCode(r)}return i}function yl(e,i){var r=Math.pow(10,i);return""+Math.round(e*r)/r}function hu(e,i){var r=e-Math.floor(e),o=Math.pow(10,i);return i<(""+Math.round(r*o)).length?0:Math.round(r*o)}function Dn(e,i,r){if(40===e.charCodeAt(0)&&!i.match(Yn)){var o=i.replace(/\( */,"").replace(/ \)/,"").replace(/\)/,"");return r>=0?Dn("n",o,r):"("+Dn("n",o,-r)+")"}if(44===i.charCodeAt(i.length-1))return function lu(e,i,r){for(var o=i.length-1;44===i.charCodeAt(o-1);)--o;return Kn(e,i.substr(0,o),r/Math.pow(10,3*(i.length-o)))}(e,i,r);if(-1!==i.indexOf("%"))return function eh(e,i,r){var o=i.replace(Do,""),c=i.length-o.length;return Kn(e,o,r*Math.pow(10,2*c))+ii("%",c)}(e,i,r);if(-1!==i.indexOf("E"))return cu(i,r);if(36===i.charCodeAt(0))return"$"+Dn(e,i.substr(" "==i.charAt(1)?2:1),r);var c,x,y,T,C=Math.abs(r),I=r<0?"-":"";if(i.match(/^00+$/))return I+Io(C,i.length);if(i.match(/^[#?]+$/))return"0"===(c=Io(r,0))&&(c=""),c.length>i.length?c:Yi(i.substr(0,i.length-c.length))+c;if(x=i.match(af))return function pc(e,i,r){var o=parseInt(e[4],10),c=Math.round(i*o),x=Math.floor(c/o),y=c-x*o,T=o;return r+(0===x?"":""+x)+" "+(0===y?ii(" ",e[1].length+1+e[4].length):Yu(y,e[1].length)+e[2]+"/"+e[3]+ga(T,e[4].length))}(x,C,I);if(i.match(/^#+0+$/))return I+Io(C,i.length-i.indexOf("0"));if(x=i.match(uu))return c=yl(r,x[1].length).replace(/^([^\.]+)$/,"$1."+Yi(x[1])).replace(/\.$/,"."+Yi(x[1])).replace(/\.(\d*)$/,function(W,B){return"."+B+ii("0",Yi(x[1]).length-B.length)}),-1!==i.indexOf("0.")?c:c.replace(/^0\./,".");if(i=i.replace(/^#+([0.])/,"$1"),x=i.match(/^(0*)\.(#*)$/))return I+yl(C,x[2].length).replace(/\.(\d*[1-9])0*$/,".$1").replace(/^(-?\d*)$/,"$1.").replace(/^0\./,x[1].length?"0.":".");if(x=i.match(/^#{1,3},##0(\.?)$/))return I+Fn(Io(C,0));if(x=i.match(/^#,##0\.([#0]*0)$/))return r<0?"-"+Dn(e,i,-r):Fn(""+(Math.floor(r)+function fu(e,i){return i<(""+Math.round((e-Math.floor(e))*Math.pow(10,i))).length?1:0}(r,x[1].length)))+"."+ga(hu(r,x[1].length),x[1].length);if(x=i.match(/^#,#*,#0/))return Dn(e,i.replace(/^#,#*,/,""),r);if(x=i.match(/^([0#]+)(\\?-([0#]+))+$/))return c=ml(Dn(e,i.replace(/[\\-]/g,""),r)),y=0,ml(ml(i.replace(/\\/g,"")).replace(/[0#]/g,function(W){return y<c.length?c.charAt(y++):"0"===W?"0":""}));if(i.match(_c))return"("+(c=Dn(e,"##########",r)).substr(0,3)+") "+c.substr(3,3)+"-"+c.substr(6);var F="";if(x=i.match(/^([#0?]+)( ?)\/( ?)([#0?]+)/))return y=Math.min(x[4].length,7),T=Ba(C,Math.pow(10,y)-1,!1),c=""+I," "==(F=Kn("n",x[1],T[1])).charAt(F.length-1)&&(F=F.substr(0,F.length-1)+"0"),c+=F+x[2]+"/"+x[3],(F=uc(T[2],y)).length<x[4].length&&(F=Yi(x[4].substr(x[4].length-F.length))+F),c+=F;if(x=i.match(/^# ([#0?]+)( ?)\/( ?)([#0?]+)/))return y=Math.min(Math.max(x[1].length,x[4].length),7),I+((T=Ba(C,Math.pow(10,y)-1,!0))[0]||(T[1]?"":"0"))+" "+(T[1]?Yu(T[1],y)+x[2]+"/"+x[3]+uc(T[2],y):ii(" ",2*y+1+x[2].length+x[3].length));if(x=i.match(/^[#0?]+$/))return c=Io(r,0),i.length<=c.length?c:Yi(i.substr(0,i.length-c.length))+c;if(x=i.match(/^([#0?]+)\.([#0]+)$/)){c=""+r.toFixed(Math.min(x[2].length,10)).replace(/([^0])0+$/,"$1"),y=c.indexOf(".");var N=i.indexOf(".")-y,U=i.length-c.length-N;return Yi(i.substr(0,N)+c+i.substr(i.length-U))}if(x=i.match(/^00,000\.([#0]*0)$/))return y=hu(r,x[1].length),r<0?"-"+Dn(e,i,-r):Fn(function du(e){return e<2147483647&&e>-2147483648?""+(e>=0?0|e:e-1|0):""+Math.floor(e)}(r)).replace(/^\d,\d{3}$/,"0$&").replace(/^\d*$/,function(W){return"00,"+(W.length<3?ga(0,3-W.length):"")+W})+"."+ga(y,x[1].length);switch(i){case"###,##0.00":return Dn(e,"#,##0.00",r);case"###,###":case"##,###":case"#,###":var j=Fn(Io(C,0));return"0"!==j?I+j:"";case"###,###.00":return Dn(e,"###,##0.00",r).replace(/^0\./,".");case"#,###.00":return Dn(e,"#,##0.00",r).replace(/^0\./,".")}throw new Error("unsupported format |"+i+"|")}function th(e,i){var r,o=e.indexOf("E")-e.indexOf(".")-1;if(e.match(/^#+0.0E\+0$/)){if(0==i)return"0.0E+0";if(i<0)return"-"+th(e,-i);var c=e.indexOf(".");-1===c&&(c=e.indexOf("E"));var x=Math.floor(Math.log(i)*Math.LOG10E)%c;if(x<0&&(x+=c),!(r=(i/Math.pow(10,x)).toPrecision(o+1+(c+x)%c)).match(/[Ee]/)){var y=Math.floor(Math.log(i)*Math.LOG10E);-1===r.indexOf(".")?r=r.charAt(0)+"."+r.substr(1)+"E+"+(y-r.length+x):r+="E+"+(y-x),r=r.replace(/\+-/,"-")}r=r.replace(/^([+-]?)(\d*)\.(\d*)[Ee]/,function(T,C,I,F){return C+I+F.substr(0,(c+x)%c)+"."+F.substr(x)+"E"})}else r=i.toExponential(o);return e.match(/E\+00$/)&&r.match(/e[+-]\d$/)&&(r=r.substr(0,r.length-1)+"0"+r.charAt(r.length-1)),e.match(/E\-/)&&r.match(/e\+/)&&(r=r.replace(/e\+/,"e")),r.replace("e","E")}function Ua(e,i,r){if(40===e.charCodeAt(0)&&!i.match(Yn)){var o=i.replace(/\( */,"").replace(/ \)/,"").replace(/\)/,"");return r>=0?Ua("n",o,r):"("+Ua("n",o,-r)+")"}if(44===i.charCodeAt(i.length-1))return function pu(e,i,r){for(var o=i.length-1;44===i.charCodeAt(o-1);)--o;return Kn(e,i.substr(0,o),r/Math.pow(10,3*(i.length-o)))}(e,i,r);if(-1!==i.indexOf("%"))return function mu(e,i,r){var o=i.replace(Do,""),c=i.length-o.length;return Kn(e,o,r*Math.pow(10,2*c))+ii("%",c)}(e,i,r);if(-1!==i.indexOf("E"))return th(i,r);if(36===i.charCodeAt(0))return"$"+Ua(e,i.substr(" "==i.charAt(1)?2:1),r);var c,x,y,T,C=Math.abs(r),I=r<0?"-":"";if(i.match(/^00+$/))return I+ga(C,i.length);if(i.match(/^[#?]+$/))return c=""+r,0===r&&(c=""),c.length>i.length?c:Yi(i.substr(0,i.length-c.length))+c;if(x=i.match(af))return function mc(e,i,r){return r+(0===i?"":""+i)+ii(" ",e[1].length+2+e[4].length)}(x,C,I);if(i.match(/^#+0+$/))return I+ga(C,i.length-i.indexOf("0"));if(x=i.match(uu))return c=(c=(""+r).replace(/^([^\.]+)$/,"$1."+Yi(x[1])).replace(/\.$/,"."+Yi(x[1]))).replace(/\.(\d*)$/,function(W,B){return"."+B+ii("0",Yi(x[1]).length-B.length)}),-1!==i.indexOf("0.")?c:c.replace(/^0\./,".");if(i=i.replace(/^#+([0.])/,"$1"),x=i.match(/^(0*)\.(#*)$/))return I+(""+C).replace(/\.(\d*[1-9])0*$/,".$1").replace(/^(-?\d*)$/,"$1.").replace(/^0\./,x[1].length?"0.":".");if(x=i.match(/^#{1,3},##0(\.?)$/))return I+Fn(""+C);if(x=i.match(/^#,##0\.([#0]*0)$/))return r<0?"-"+Ua(e,i,-r):Fn(""+r)+"."+ii("0",x[1].length);if(x=i.match(/^#,#*,#0/))return Ua(e,i.replace(/^#,#*,/,""),r);if(x=i.match(/^([0#]+)(\\?-([0#]+))+$/))return c=ml(Ua(e,i.replace(/[\\-]/g,""),r)),y=0,ml(ml(i.replace(/\\/g,"")).replace(/[0#]/g,function(W){return y<c.length?c.charAt(y++):"0"===W?"0":""}));if(i.match(_c))return"("+(c=Ua(e,"##########",r)).substr(0,3)+") "+c.substr(3,3)+"-"+c.substr(6);var F="";if(x=i.match(/^([#0?]+)( ?)\/( ?)([#0?]+)/))return y=Math.min(x[4].length,7),T=Ba(C,Math.pow(10,y)-1,!1),c=""+I," "==(F=Kn("n",x[1],T[1])).charAt(F.length-1)&&(F=F.substr(0,F.length-1)+"0"),c+=F+x[2]+"/"+x[3],(F=uc(T[2],y)).length<x[4].length&&(F=Yi(x[4].substr(x[4].length-F.length))+F),c+=F;if(x=i.match(/^# ([#0?]+)( ?)\/( ?)([#0?]+)/))return y=Math.min(Math.max(x[1].length,x[4].length),7),I+((T=Ba(C,Math.pow(10,y)-1,!0))[0]||(T[1]?"":"0"))+" "+(T[1]?Yu(T[1],y)+x[2]+"/"+x[3]+uc(T[2],y):ii(" ",2*y+1+x[2].length+x[3].length));if(x=i.match(/^[#0?]+$/))return i.length<=(c=""+r).length?c:Yi(i.substr(0,i.length-c.length))+c;if(x=i.match(/^([#0]+)\.([#0]+)$/)){c=""+r.toFixed(Math.min(x[2].length,10)).replace(/([^0])0+$/,"$1"),y=c.indexOf(".");var N=i.indexOf(".")-y,U=i.length-c.length-N;return Yi(i.substr(0,N)+c+i.substr(i.length-U))}if(x=i.match(/^00,000\.([#0]*0)$/))return r<0?"-"+Ua(e,i,-r):Fn(""+r).replace(/^\d,\d{3}$/,"0$&").replace(/^\d*$/,function(W){return"00,"+(W.length<3?ga(0,3-W.length):"")+W})+"."+ga(0,x[1].length);switch(i){case"###,###":case"##,###":case"#,###":var j=Fn(""+C);return"0"!==j?I+j:"";default:if(i.match(/\.[0#?]*$/))return Ua(e,i.slice(0,i.lastIndexOf(".")),r)+Yi(i.slice(i.lastIndexOf(".")))}throw new Error("unsupported format |"+i+"|")}function Kn(e,i,r){return(0|r)===r?Ua(e,i,r):Dn(e,i,r)}var sf=/\[[HhMmSs\u0E0A\u0E19\u0E17]*\]/;function Po(e){for(var i=0,r="",o="";i<e.length;)switch(r=e.charAt(i)){case"G":hc(e,i)&&(i+=6),i++;break;case'"':for(;34!==e.charCodeAt(++i)&&i<e.length;);++i;break;case"\\":case"_":i+=2;break;case"@":++i;break;case"B":case"b":if("1"===e.charAt(i+1)||"2"===e.charAt(i+1))return!0;case"M":case"D":case"Y":case"H":case"S":case"E":case"m":case"d":case"y":case"h":case"s":case"e":case"g":return!0;case"A":case"a":case"\u4e0a":if("A/P"===e.substr(i,3).toUpperCase()||"AM/PM"===e.substr(i,5).toUpperCase()||"\u4e0a\u5348/\u4e0b\u5348"===e.substr(i,5).toUpperCase())return!0;++i;break;case"[":for(o=r;"]"!==e.charAt(i++)&&i<e.length;)o+=e.charAt(i);if(o.match(sf))return!0;break;case".":case"0":case"#":for(;i<e.length&&("0#?.,E+-%".indexOf(r=e.charAt(++i))>-1||"\\"==r&&"-"==e.charAt(i+1)&&"0#".indexOf(e.charAt(i+2))>-1););break;case"?":for(;e.charAt(++i)===r;);break;case"*":++i,(" "==e.charAt(i)||"*"==e.charAt(i))&&++i;break;case"(":case")":++i;break;case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":for(;i<e.length&&"0123456789".indexOf(e.charAt(++i))>-1;);break;default:++i}return!1}var of=/\[(=|>[=]?|<[>=]?)(-?\d+(?:\.\d*)?)\]/;function lf(e,i){if(null==i)return!1;var r=parseFloat(i[2]);switch(i[1]){case"=":if(e==r)return!0;break;case">":if(e>r)return!0;break;case"<":if(e<r)return!0;break;case"<>":if(e!=r)return!0;break;case">=":if(e>=r)return!0;break;case"<=":if(e<=r)return!0}return!1}function vn(e,i,r){null==r&&(r={});var o="";switch(typeof e){case"string":o="m/d/yy"==e&&r.dateNF?r.dateNF:e;break;case"number":null==(o=14==e&&r.dateNF?r.dateNF:(null!=r.table?r.table:or)[e])&&(o=r.table&&r.table[gl[e]]||or[gl[e]]),null==o&&(o=Mo[e]||"General")}if(hc(o,0))return Gs(i,r);i instanceof Date&&(i=dc(i,r.date1904));var c=function rh(e,i){var r=function sd(e){for(var i=[],r=!1,o=0,c=0;o<e.length;++o)switch(e.charCodeAt(o)){case 34:r=!r;break;case 95:case 42:case 92:++o;break;case 59:i[i.length]=e.substr(c,o-c),c=o+1}if(i[i.length]=e.substr(c),!0===r)throw new Error("Format |"+e+"| unterminated string ");return i}(e),o=r.length,c=r[o-1].indexOf("@");if(o<4&&c>-1&&--o,r.length>4)throw new Error("cannot find right format for |"+r.join("|")+"|");if("number"!=typeof i)return[4,4===r.length||c>-1?r[r.length-1]:"@"];switch(r.length){case 1:r=c>-1?["General","General","General",r[0]]:[r[0],r[0],r[0],"@"];break;case 2:r=c>-1?[r[0],r[0],r[0],r[1]]:[r[0],r[1],r[0],"@"];break;case 3:r=c>-1?[r[0],r[1],r[0],r[2]]:[r[0],r[1],r[2],"@"]}var x=i>0?r[0]:i<0?r[1]:r[2];if(-1===r[0].indexOf("[")&&-1===r[1].indexOf("["))return[o,x];if(null!=r[0].match(/\[[=<>]/)||null!=r[1].match(/\[[=<>]/)){var y=r[0].match(of),T=r[1].match(of);return lf(i,y)?[o,r[0]]:lf(i,T)?[o,r[1]]:[o,r[null!=y&&null!=T?2:1]]}return[o,x]}(o,i);if(hc(c[1]))return Gs(i,r);if(!0===i)i="TRUE";else if(!1===i)i="FALSE";else if(""===i||null==i)return"";return function od(e,i,r,o){for(var I,F,N,c=[],x="",y=0,T="",C="t",U="H";y<e.length;)switch(T=e.charAt(y)){case"G":if(!hc(e,y))throw new Error("unrecognized character "+T+" in "+e);c[c.length]={t:"G",v:"General"},y+=7;break;case'"':for(x="";34!==(N=e.charCodeAt(++y))&&y<e.length;)x+=String.fromCharCode(N);c[c.length]={t:"t",v:x},++y;break;case"\\":var j=e.charAt(++y);c[c.length]={t:"("===j||")"===j?j:"t",v:j},++y;break;case"_":c[c.length]={t:"t",v:" "},y+=2;break;case"@":c[c.length]={t:"T",v:i},++y;break;case"B":case"b":if("1"===e.charAt(y+1)||"2"===e.charAt(y+1)){if(null==I&&null==(I=Na(i,r,"2"===e.charAt(y+1))))return"";c[c.length]={t:"X",v:e.substr(y,2)},C=T,y+=2;break}case"M":case"D":case"Y":case"H":case"S":case"E":T=T.toLowerCase();case"m":case"d":case"y":case"h":case"s":case"e":case"g":if(i<0||null==I&&null==(I=Na(i,r)))return"";for(x=T;++y<e.length&&e.charAt(y).toLowerCase()===T;)x+=T;"m"===T&&"h"===C.toLowerCase()&&(T="M"),"h"===T&&(T=U),c[c.length]={t:T,v:x},C=T;break;case"A":case"a":case"\u4e0a":var B={t:T,v:T};if(null==I&&(I=Na(i,r)),"A/P"===e.substr(y,3).toUpperCase()?(null!=I&&(B.v=I.H>=12?"P":"A"),B.t="T",U="h",y+=3):"AM/PM"===e.substr(y,5).toUpperCase()?(null!=I&&(B.v=I.H>=12?"PM":"AM"),B.t="T",y+=5,U="h"):"\u4e0a\u5348/\u4e0b\u5348"===e.substr(y,5).toUpperCase()?(null!=I&&(B.v=I.H>=12?"\u4e0b\u5348":"\u4e0a\u5348"),B.t="T",y+=5,U="h"):(B.t="t",++y),null==I&&"T"===B.t)return"";c[c.length]=B,C=T;break;case"[":for(x=T;"]"!==e.charAt(y++)&&y<e.length;)x+=e.charAt(y);if("]"!==x.slice(-1))throw'unterminated "[" block: |'+x+"|";if(x.match(sf)){if(null==I&&null==(I=Na(i,r)))return"";c[c.length]={t:"Z",v:x.toLowerCase()},C=x.charAt(1)}else x.indexOf("$")>-1&&(x=(x.match(/\$([^-\[\]]*)/)||[])[1]||"$",Po(e)||(c[c.length]={t:"t",v:x}));break;case".":if(null!=I){for(x=T;++y<e.length&&"0"===(T=e.charAt(y));)x+=T;c[c.length]={t:"s",v:x};break}case"0":case"#":for(x=T;++y<e.length&&"0#?.,E+-%".indexOf(T=e.charAt(y))>-1;)x+=T;c[c.length]={t:"n",v:x};break;case"?":for(x=T;e.charAt(++y)===T;)x+=T;c[c.length]={t:T,v:x},C=T;break;case"*":++y,(" "==e.charAt(y)||"*"==e.charAt(y))&&++y;break;case"(":case")":c[c.length]={t:1===o?"t":T,v:T},++y;break;case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":for(x=T;y<e.length&&"0123456789".indexOf(e.charAt(++y))>-1;)x+=e.charAt(y);c[c.length]={t:"D",v:x};break;case" ":c[c.length]={t:T,v:T},++y;break;case"$":c[c.length]={t:"t",v:"$"},++y;break;default:if(-1===",$-+/():!^&'~{}<>=\u20acacfijklopqrtuvwxzP".indexOf(T))throw new Error("unrecognized character "+T+" in "+e);c[c.length]={t:"t",v:T},++y}var me,X=0,_e=0;for(y=c.length-1,C="t";y>=0;--y)switch(c[y].t){case"h":case"H":c[y].t=U,C="h",X<1&&(X=1);break;case"s":(me=c[y].v.match(/\.0+$/))&&(_e=Math.max(_e,me[0].length-1)),X<3&&(X=3);case"d":case"y":case"M":case"e":C=c[y].t;break;case"m":"s"===C&&(c[y].t="M",X<2&&(X=2));break;case"X":break;case"Z":X<1&&c[y].v.match(/[Hh]/)&&(X=1),X<2&&c[y].v.match(/[Mm]/)&&(X=2),X<3&&c[y].v.match(/[Ss]/)&&(X=3)}switch(X){case 0:break;case 1:I.u>=.5&&(I.u=0,++I.S),I.S>=60&&(I.S=0,++I.M),I.M>=60&&(I.M=0,++I.H);break;case 2:I.u>=.5&&(I.u=0,++I.S),I.S>=60&&(I.S=0,++I.M)}var Ue,ue="";for(y=0;y<c.length;++y)switch(c[y].t){case"t":case"T":case" ":case"D":break;case"X":c[y].v="",c[y].t=";";break;case"d":case"m":case"y":case"h":case"H":case"M":case"s":case"e":case"b":case"Z":c[y].v=ou(c[y].t.charCodeAt(0),c[y].v,I,_e),c[y].t="t";break;case"n":case"?":for(Ue=y+1;null!=c[Ue]&&("?"===(T=c[Ue].t)||"D"===T||(" "===T||"t"===T)&&null!=c[Ue+1]&&("?"===c[Ue+1].t||"t"===c[Ue+1].t&&"/"===c[Ue+1].v)||"("===c[y].t&&(" "===T||"n"===T||")"===T)||"t"===T&&("/"===c[Ue].v||" "===c[Ue].v&&null!=c[Ue+1]&&"?"==c[Ue+1].t));)c[y].v+=c[Ue].v,c[Ue]={v:"",t:";"},++Ue;ue+=c[y].v,y=Ue-1;break;case"G":c[y].t="t",c[y].v=Gs(i,r)}var nt,Se,We="";if(ue.length>0){40==ue.charCodeAt(0)?(nt=i<0&&45===ue.charCodeAt(0)?-i:i,Se=Kn("n",ue,nt)):(Se=Kn("n",ue,nt=i<0&&o>1?-i:i),nt<0&&c[0]&&"t"==c[0].t&&(Se=Se.substr(1),c[0].v="-"+c[0].v)),Ue=Se.length-1;var Ge=c.length;for(y=0;y<c.length;++y)if(null!=c[y]&&"t"!=c[y].t&&c[y].v.indexOf(".")>-1){Ge=y;break}var Ve=c.length;if(Ge===c.length&&-1===Se.indexOf("E")){for(y=c.length-1;y>=0;--y)null==c[y]||-1==="n?".indexOf(c[y].t)||(Ue>=c[y].v.length-1?c[y].v=Se.substr(1+(Ue-=c[y].v.length),c[y].v.length):Ue<0?c[y].v="":(c[y].v=Se.substr(0,Ue+1),Ue=-1),c[y].t="t",Ve=y);Ue>=0&&Ve<c.length&&(c[Ve].v=Se.substr(0,Ue+1)+c[Ve].v)}else if(Ge!==c.length&&-1===Se.indexOf("E")){for(Ue=Se.indexOf(".")-1,y=Ge;y>=0;--y)if(null!=c[y]&&-1!=="n?".indexOf(c[y].t)){for(F=c[y].v.indexOf(".")>-1&&y===Ge?c[y].v.indexOf(".")-1:c[y].v.length-1,We=c[y].v.substr(F+1);F>=0;--F)Ue>=0&&("0"===c[y].v.charAt(F)||"#"===c[y].v.charAt(F))&&(We=Se.charAt(Ue--)+We);c[y].v=We,c[y].t="t",Ve=y}for(Ue>=0&&Ve<c.length&&(c[Ve].v=Se.substr(0,Ue+1)+c[Ve].v),Ue=Se.indexOf(".")+1,y=Ge;y<c.length;++y)if(null!=c[y]&&(-1!=="n?(".indexOf(c[y].t)||y===Ge)){for(F=c[y].v.indexOf(".")>-1&&y===Ge?c[y].v.indexOf(".")+1:0,We=c[y].v.substr(0,F);F<c[y].v.length;++F)Ue<Se.length&&(We+=Se.charAt(Ue++));c[y].v=We,c[y].t="t",Ve=y}}}for(y=0;y<c.length;++y)null!=c[y]&&"n?".indexOf(c[y].t)>-1&&(c[y].v=Kn(c[y].t,c[y].v,nt=o>1&&i<0&&y>0&&"-"===c[y-1].v?-i:i),c[y].t="t");var at="";for(y=0;y!==c.length;++y)null!=c[y]&&(at+=c[y].v);return at}(c[1],i,r,c[0])}function wn(e,i){if("number"!=typeof i){i=+i||-1;for(var r=0;r<392;++r)if(null!=or[r]){if(or[r]==e){i=r;break}}else i<0&&(i=r);i<0&&(i=391)}return or[i]=e,i}function Lo(e){for(var i=0;392!=i;++i)void 0!==e[i]&&wn(e[i],i)}function Ro(){or=function Hn(e){return e||(e={}),e[0]="General",e[1]="0",e[2]="0.00",e[3]="#,##0",e[4]="#,##0.00",e[9]="0%",e[10]="0.00%",e[11]="0.00E+00",e[12]="# ?/?",e[13]="# ??/??",e[14]="m/d/yy",e[15]="d-mmm-yy",e[16]="d-mmm",e[17]="mmm-yy",e[18]="h:mm AM/PM",e[19]="h:mm:ss AM/PM",e[20]="h:mm",e[21]="h:mm:ss",e[22]="m/d/yy h:mm",e[37]="#,##0 ;(#,##0)",e[38]="#,##0 ;[Red](#,##0)",e[39]="#,##0.00;(#,##0.00)",e[40]="#,##0.00;[Red](#,##0.00)",e[45]="mm:ss",e[46]="[h]:mm:ss",e[47]="mmss.0",e[48]="##0.0E+0",e[49]="@",e[56]='"\u4e0a\u5348/\u4e0b\u5348 "hh"\u6642"mm"\u5206"ss"\u79d2 "',e}()}var _u=/[dD]+|[mM]+|[yYeE]+|[Hh]+|[Ss]+/g,cf=function(){var e={version:"1.2.0"},r=function i(){for(var Se=0,Ge=new Array(256),Ve=0;256!=Ve;++Ve)Ge[Ve]=Se=1&(Se=1&(Se=1&(Se=1&(Se=1&(Se=1&(Se=1&(Se=1&(Se=Ve)?-306674912^Se>>>1:Se>>>1)?-306674912^Se>>>1:Se>>>1)?-306674912^Se>>>1:Se>>>1)?-306674912^Se>>>1:Se>>>1)?-306674912^Se>>>1:Se>>>1)?-306674912^Se>>>1:Se>>>1)?-306674912^Se>>>1:Se>>>1)?-306674912^Se>>>1:Se>>>1;return"undefined"!=typeof Int32Array?new Int32Array(Ge):Ge}(),c=function o(Se){var Ge=0,Ve=0,at=0,ot="undefined"!=typeof Int32Array?new Int32Array(4096):new Array(4096);for(at=0;256!=at;++at)ot[at]=Se[at];for(at=0;256!=at;++at)for(Ve=Se[at],Ge=256+at;Ge<4096;Ge+=256)Ve=ot[Ge]=Ve>>>8^Se[255&Ve];var je=[];for(at=1;16!=at;++at)je[at-1]="undefined"!=typeof Int32Array?ot.subarray(256*at,256*at+256):ot.slice(256*at,256*at+256);return je}(r),x=c[0],y=c[1],T=c[2],C=c[3],I=c[4],F=c[5],N=c[6],U=c[7],j=c[8],W=c[9],B=c[10],X=c[11],_e=c[12],me=c[13],ue=c[14];return e.table=r,e.bstr=function Ue(Se,Ge){for(var Ve=-1^Ge,at=0,ot=Se.length;at<ot;)Ve=Ve>>>8^r[255&(Ve^Se.charCodeAt(at++))];return~Ve},e.buf=function We(Se,Ge){for(var Ve=-1^Ge,at=Se.length-15,ot=0;ot<at;)Ve=ue[Se[ot++]^255&Ve]^me[Se[ot++]^Ve>>8&255]^_e[Se[ot++]^Ve>>16&255]^X[Se[ot++]^Ve>>>24]^B[Se[ot++]]^W[Se[ot++]]^j[Se[ot++]]^U[Se[ot++]]^N[Se[ot++]]^F[Se[ot++]]^I[Se[ot++]]^C[Se[ot++]]^T[Se[ot++]]^y[Se[ot++]]^x[Se[ot++]]^r[Se[ot++]];for(at+=15;ot<at;)Ve=Ve>>>8^r[255&(Ve^Se[ot++])];return~Ve},e.str=function nt(Se,Ge){for(var Ve=-1^Ge,at=0,ot=Se.length,je=0,Bt=0;at<ot;)(je=Se.charCodeAt(at++))<128?Ve=Ve>>>8^r[255&(Ve^je)]:je<2048?Ve=(Ve=Ve>>>8^r[255&(Ve^(192|je>>6&31))])>>>8^r[255&(Ve^(128|63&je))]:je>=55296&&je<57344?(je=64+(1023&je),Bt=1023&Se.charCodeAt(at++),Ve=(Ve=(Ve=(Ve=Ve>>>8^r[255&(Ve^(240|je>>8&7))])>>>8^r[255&(Ve^(128|je>>2&63))])>>>8^r[255&(Ve^(128|Bt>>6&15|(3&je)<<4))])>>>8^r[255&(Ve^(128|63&Bt))]):Ve=(Ve=(Ve=Ve>>>8^r[255&(Ve^(224|je>>12&15))])>>>8^r[255&(Ve^(128|je>>6&63))])>>>8^r[255&(Ve^(128|63&je))];return~Ve},e}(),ar=function(){var C,i={};function o(Q){if("/"==Q.charAt(Q.length-1))return-1===Q.slice(0,-1).indexOf("/")?Q:o(Q.slice(0,-1));var ge=Q.lastIndexOf("/");return-1===ge?Q:Q.slice(0,ge+1)}function c(Q){if("/"==Q.charAt(Q.length-1))return c(Q.slice(0,-1));var ge=Q.lastIndexOf("/");return-1===ge?Q:Q.slice(ge+1)}function x(Q,ge){"string"==typeof ge&&(ge=new Date(ge));var oe=ge.getHours();oe=(oe=oe<<6|ge.getMinutes())<<5|ge.getSeconds()>>>1,Q.write_shift(2,oe);var fe=ge.getFullYear()-1980;fe=(fe=fe<<4|ge.getMonth()+1)<<5|ge.getDate(),Q.write_shift(2,fe)}function T(Q){b(Q,0);for(var ge={},oe=0;Q.l<=Q.length-4;){var fe=Q.read_shift(2),xe=Q.read_shift(2),ye=Q.l+xe,Ye={};21589===fe&&(1&(oe=Q.read_shift(1))&&(Ye.mtime=Q.read_shift(4)),xe>5&&(2&oe&&(Ye.atime=Q.read_shift(4)),4&oe&&(Ye.ctime=Q.read_shift(4))),Ye.mtime&&(Ye.mt=new Date(1e3*Ye.mtime))),Q.l=ye,ge[fe]=Ye}return ge}function I(){return C||(C={})}function F(Q,ge){if(80==Q[0]&&75==Q[1])return S1(Q,ge);if(109==(32|Q[0])&&105==(32|Q[1]))return function Cw(Q,ge){if("mime-version:"!=Xt(Q.slice(0,13)).toLowerCase())throw new Error("Unsupported MAD header");var oe=ge&&ge.root||"",fe=(_r&&Buffer.isBuffer(Q)?Q.toString("binary"):Xt(Q)).split("\r\n"),xe=0,ye="";for(xe=0;xe<fe.length;++xe)if(/^Content-Location:/i.test(ye=fe[xe])&&(ye=ye.slice(ye.indexOf("file")),oe||(oe=ye.slice(0,ye.lastIndexOf("/")+1)),ye.slice(0,oe.length)!=oe))for(;oe.length>0&&(oe=(oe=oe.slice(0,oe.length-1)).slice(0,oe.lastIndexOf("/")+1),ye.slice(0,oe.length)!=oe););var Ye=(fe[1]||"").match(/boundary="(.*?)"/);if(!Ye)throw new Error("MAD cannot find boundary");var ct="--"+(Ye[1]||""),it={FileIndex:[],FullPaths:[]};Se(it);var St,Nt=0;for(xe=0;xe<fe.length;++xe){var ir=fe[xe];ir!==ct&&ir!==ct+"--"||(Nt++&&kw(it,fe.slice(St,xe),oe),St=xe)}return it}(Q,ge);if(Q.length<512)throw new Error("CFB file size "+Q.length+" < 512");var oe,xe,ye,Ye,ct,Je,fe=512,Ke=[],it=Q.slice(0,512);b(it,0);var St=function N(Q){if(80==Q[Q.l]&&75==Q[Q.l+1])return[0,0];Q.chk(er,"Header Signature: "),Q.l+=16;var ge=Q.read_shift(2,"u");return[Q.read_shift(2,"u"),ge]}(it);switch(oe=St[0]){case 3:fe=512;break;case 4:fe=4096;break;case 0:if(0==St[1])return S1(Q,ge);default:throw new Error("Major Version: Expected 3 or 4 saw "+oe)}512!==fe&&b(it=Q.slice(0,fe),28);var Nt=Q.slice(0,fe);!function U(Q,ge){var oe;switch(Q.l+=2,oe=Q.read_shift(2)){case 9:if(3!=ge)throw new Error("Sector Shift: Expected 9 saw "+oe);break;case 12:if(4!=ge)throw new Error("Sector Shift: Expected 12 saw "+oe);break;default:throw new Error("Sector Shift: Expected 9 or 12 saw "+oe)}Q.chk("0600","Mini Sector Shift: "),Q.chk("000000000000","Reserved: ")}(it,oe);var ir=it.read_shift(4,"i");if(3===oe&&0!==ir)throw new Error("# Directory Sectors: Expected 0 saw "+ir);it.l+=4,Ye=it.read_shift(4,"i"),it.l+=4,it.chk("00100000","Mini Stream Cutoff Size: "),ct=it.read_shift(4,"i"),xe=it.read_shift(4,"i"),Je=it.read_shift(4,"i"),ye=it.read_shift(4,"i");for(var Ut=-1,Gt=0;Gt<109&&!((Ut=it.read_shift(4,"i"))<0);++Gt)Ke[Gt]=Ut;var Mr=function j(Q,ge){for(var oe=Math.ceil(Q.length/ge)-1,fe=[],xe=1;xe<oe;++xe)fe[xe-1]=Q.slice(xe*ge,(xe+1)*ge);return fe[oe-1]=Q.slice(oe*ge),fe}(Q,fe);X(Je,ye,Mr,fe,Ke);var qi=function me(Q,ge,oe,fe){var xe=Q.length,ye=[],Ye=[],ct=[],Je=[],Ke=fe-1,it=0,St=0,Nt=0,ir=0;for(it=0;it<xe;++it)if(ct=[],(Nt=it+ge)>=xe&&(Nt-=xe),!Ye[Nt]){Je=[];var Ut=[];for(St=Nt;St>=0;){Ut[St]=!0,Ye[St]=!0,ct[ct.length]=St,Je.push(Q[St]);var Gt=oe[Math.floor(4*St/fe)];if(fe<4+(ir=4*St&Ke))throw new Error("FAT boundary crossed: "+St+" 4 "+fe);if(!Q[Gt]||Ut[St=qr(Q[Gt],ir)])break}ye[Nt]={nodes:ct,data:fh([Je])}}return ye}(Mr,Ye,Ke,fe);qi[Ye].name="!Directory",xe>0&&ct!==Bt&&(qi[ct].name="!MiniFAT"),qi[Ke[0]].name="!FAT",qi.fat_addrs=Ke,qi.ssz=fe;var An=[],Ps=[],v0=[];(function ue(Q,ge,oe,fe,xe,ye,Ye,ct){for(var ir,Je=0,Ke=fe.length?2:0,it=ge[Q].data,St=0,Nt=0;St<it.length;St+=128){var Ut=it.slice(St,St+128);b(Ut,64),Nt=Ut.read_shift(2),ir=Sc(Ut,0,Nt-Ke),fe.push(ir);var Gt={name:ir,type:Ut.read_shift(1),color:Ut.read_shift(1),L:Ut.read_shift(4,"i"),R:Ut.read_shift(4,"i"),C:Ut.read_shift(4,"i"),clsid:Ut.read_shift(16),state:Ut.read_shift(4,"i"),start:0,size:0};0!==Ut.read_shift(2)+Ut.read_shift(2)+Ut.read_shift(2)+Ut.read_shift(2)&&(Gt.ct=Ue(Ut,Ut.l-8)),0!==Ut.read_shift(2)+Ut.read_shift(2)+Ut.read_shift(2)+Ut.read_shift(2)&&(Gt.mt=Ue(Ut,Ut.l-8)),Gt.start=Ut.read_shift(4,"i"),Gt.size=Ut.read_shift(4,"i"),Gt.size<0&&Gt.start<0&&(Gt.size=Gt.type=0,Gt.start=Bt,Gt.name=""),5===Gt.type?(Je=Gt.start,xe>0&&Je!==Bt&&(ge[Je].name="!StreamData")):Gt.size>=4096?(Gt.storage="fat",void 0===ge[Gt.start]&&(ge[Gt.start]=_e(oe,Gt.start,ge.fat_addrs,ge.ssz)),ge[Gt.start].name=Gt.name,Gt.content=ge[Gt.start].data.slice(0,Gt.size)):(Gt.storage="minifat",Gt.size<0?Gt.size=0:Je!==Bt&&Gt.start!==Bt&&ge[Je]&&(Gt.content=B(Gt,ge[Je].data,(ge[ct]||{}).data))),Gt.content&&b(Gt.content,0),ye[ir]=Gt,Ye.push(Gt)}})(Ye,qi,Mr,An,xe,{},Ps,ct),function W(Q,ge,oe){for(var fe=0,xe=0,ye=0,Ye=0,ct=0,Je=oe.length,Ke=[],it=[];fe<Je;++fe)Ke[fe]=it[fe]=fe,ge[fe]=oe[fe];for(;ct<it.length;++ct)xe=Q[fe=it[ct]].L,ye=Q[fe].R,Ye=Q[fe].C,Ke[fe]===fe&&(-1!==xe&&Ke[xe]!==xe&&(Ke[fe]=Ke[xe]),-1!==ye&&Ke[ye]!==ye&&(Ke[fe]=Ke[ye])),-1!==Ye&&(Ke[Ye]=fe),-1!==xe&&fe!=Ke[fe]&&(Ke[xe]=Ke[fe],it.lastIndexOf(xe)<ct&&it.push(xe)),-1!==ye&&fe!=Ke[fe]&&(Ke[ye]=Ke[fe],it.lastIndexOf(ye)<ct&&it.push(ye));for(fe=1;fe<Je;++fe)Ke[fe]===fe&&(-1!==ye&&Ke[ye]!==ye?Ke[fe]=Ke[ye]:-1!==xe&&Ke[xe]!==xe&&(Ke[fe]=Ke[xe]));for(fe=1;fe<Je;++fe)if(0!==Q[fe].type){if((ct=fe)!=Ke[ct])do{ge[fe]=ge[ct=Ke[ct]]+"/"+ge[fe]}while(0!==ct&&-1!==Ke[ct]&&ct!=Ke[ct]);Ke[fe]=-1}for(ge[0]+="/",fe=1;fe<Je;++fe)2!==Q[fe].type&&(ge[fe]+="/")}(Ps,v0,An),An.shift();var w0={FileIndex:Ps,FullPaths:v0};return ge&&ge.raw&&(w0.raw={header:Nt,sectors:Mr}),w0}function B(Q,ge,oe){for(var xe=Q.size,ye=[],Ye=Q.start;oe&&xe>0&&Ye>=0;)ye.push(ge.slice(Ye*je,Ye*je+je)),xe-=je,Ye=qr(oe,4*Ye);return 0===ye.length?A(0):Bi(ye).slice(0,Q.size)}function X(Q,ge,oe,fe,xe){var ye=Bt;if(Q===Bt){if(0!==ge)throw new Error("DIFAT chain shorter than expected")}else if(-1!==Q){var Ye=oe[Q],ct=(fe>>>2)-1;if(!Ye)return;for(var Je=0;Je<ct&&(ye=qr(Ye,4*Je))!==Bt;++Je)xe.push(ye);X(qr(Ye,fe-4),ge-1,oe,fe,xe)}}function _e(Q,ge,oe,fe,xe){var ye=[],Ye=[];xe||(xe=[]);var ct=fe-1,Je=0,Ke=0;for(Je=ge;Je>=0;){xe[Je]=!0,ye[ye.length]=Je,Ye.push(Q[Je]);var it=oe[Math.floor(4*Je/fe)];if(fe<4+(Ke=4*Je&ct))throw new Error("FAT boundary crossed: "+Je+" 4 "+fe);if(!Q[it])break;Je=qr(Q[it],Ke)}return{nodes:ye,data:fh([Ye])}}function Ue(Q,ge){return new Date(1e3*(ai(Q,ge+4)/1e7*Math.pow(2,32)+ai(Q,ge)/1e7-11644473600))}function Se(Q,ge){var oe=ge||{},fe=oe.root||"Root Entry";if(Q.FullPaths||(Q.FullPaths=[]),Q.FileIndex||(Q.FileIndex=[]),Q.FullPaths.length!==Q.FileIndex.length)throw new Error("inconsistent CFB structure");0===Q.FullPaths.length&&(Q.FullPaths[0]=fe+"/",Q.FileIndex[0]={name:fe,type:5}),oe.CLSID&&(Q.FileIndex[0].clsid=oe.CLSID),function Ge(Q){var ge="\x01Sh33tJ5";if(!ar.find(Q,"/"+ge)){var oe=A(4);oe[0]=55,oe[1]=oe[3]=50,oe[2]=54,Q.FileIndex.push({name:ge,type:2,content:oe,size:4,L:69,R:69,C:69}),Q.FullPaths.push(Q.FullPaths[0]+ge),Ve(Q)}}(Q)}function Ve(Q,ge){Se(Q);for(var oe=!1,fe=!1,xe=Q.FullPaths.length-1;xe>=0;--xe){var ye=Q.FileIndex[xe];switch(ye.type){case 0:fe?oe=!0:(Q.FileIndex.pop(),Q.FullPaths.pop());break;case 1:case 2:case 5:fe=!0,isNaN(ye.R*ye.L*ye.C)&&(oe=!0),ye.R>-1&&ye.L>-1&&ye.R==ye.L&&(oe=!0);break;default:oe=!0}}if(oe||ge){var Ye=new Date(1987,1,19),ct=0,Je=Object.create?Object.create(null):{},Ke=[];for(xe=0;xe<Q.FullPaths.length;++xe)Je[Q.FullPaths[xe]]=!0,0!==Q.FileIndex[xe].type&&Ke.push([Q.FullPaths[xe],Q.FileIndex[xe]]);for(xe=0;xe<Ke.length;++xe){var it=o(Ke[xe][0]);(fe=Je[it])||(Ke.push([it,{name:c(it).replace("/",""),type:1,clsid:pr,ct:Ye,mt:Ye,content:null}]),Je[it]=!0)}for(Ke.sort(function(ir,Ut){return function r(Q,ge){for(var oe=Q.split("/"),fe=ge.split("/"),xe=0,ye=0,Ye=Math.min(oe.length,fe.length);xe<Ye;++xe){if(ye=oe[xe].length-fe[xe].length)return ye;if(oe[xe]!=fe[xe])return oe[xe]<fe[xe]?-1:1}return oe.length-fe.length}(ir[0],Ut[0])}),Q.FullPaths=[],Q.FileIndex=[],xe=0;xe<Ke.length;++xe)Q.FullPaths[xe]=Ke[xe][0],Q.FileIndex[xe]=Ke[xe][1];for(xe=0;xe<Ke.length;++xe){var St=Q.FileIndex[xe],Nt=Q.FullPaths[xe];if(St.name=c(Nt).replace("/",""),St.L=St.R=St.C=-(St.color=1),St.size=St.content?St.content.length:0,St.start=0,St.clsid=St.clsid||pr,0===xe)St.C=Ke.length>1?1:-1,St.size=0,St.type=5;else if("/"==Nt.slice(-1)){for(ct=xe+1;ct<Ke.length&&o(Q.FullPaths[ct])!=Nt;++ct);for(St.C=ct>=Ke.length?-1:ct,ct=xe+1;ct<Ke.length&&o(Q.FullPaths[ct])!=o(Nt);++ct);St.R=ct>=Ke.length?-1:ct,St.type=1}else o(Q.FullPaths[xe+1]||"")==o(Nt)&&(St.R=xe+1),St.type=2}}}function at(Q,ge){var oe=ge||{};if("mad"==oe.fileType)return function Iw(Q,ge){for(var oe=ge||{},fe=oe.boundary||"SheetJS",xe=["MIME-Version: 1.0",'Content-Type: multipart/related; boundary="'+(fe="------="+fe).slice(2)+'"',"","",""],ye=Q.FullPaths[0],Ye=ye,ct=Q.FileIndex[0],Je=1;Je<Q.FullPaths.length;++Je)if(Ye=Q.FullPaths[Je].slice(ye.length),(ct=Q.FileIndex[Je]).size&&ct.content&&"\x01Sh33tJ5"!=Ye){Ye=Ye.replace(/[\x00-\x08\x0B\x0C\x0E-\x1F\x7E-\xFF]/g,function(Mr){return"_x"+Mr.charCodeAt(0).toString(16)+"_"}).replace(/[\u0080-\uFFFF]/g,function(Mr){return"_u"+Mr.charCodeAt(0).toString(16)+"_"});for(var Ke=ct.content,it=_r&&Buffer.isBuffer(Ke)?Ke.toString("binary"):Xt(Ke),St=0,Nt=Math.min(1024,it.length),ir=0,Ut=0;Ut<=Nt;++Ut)(ir=it.charCodeAt(Ut))>=32&&ir<128&&++St;var Gt=St>=4*Nt/5;xe.push(fe),xe.push("Content-Location: "+(oe.root||"file:///C:/SheetJS/")+Ye),xe.push("Content-Transfer-Encoding: "+(Gt?"quoted-printable":"base64")),xe.push("Content-Type: "+Tw(ct,Ye)),xe.push(""),xe.push(Gt?Sw(it):Ew(it))}return xe.push(fe+"--\r\n"),xe.join("\r\n")}(Q,oe);if("zip"===(Ve(Q),oe.fileType))return function bw(Q,ge){var oe=ge||{},fe=[],xe=[],ye=A(1),Ye=oe.compression?8:0,Ke=0,it=0,St=0,Nt=0,ir=Q.FullPaths[0],Ut=ir,Gt=Q.FileIndex[0],Mr=[],qi=0;for(Ke=1;Ke<Q.FullPaths.length;++Ke)if(Ut=Q.FullPaths[Ke].slice(ir.length),(Gt=Q.FileIndex[Ke]).size&&Gt.content&&"\x01Sh33tJ5"!=Ut){var ns=St,An=A(Ut.length);for(it=0;it<Ut.length;++it)An.write_shift(1,127&Ut.charCodeAt(it));An=An.slice(0,An.l),Mr[Nt]=cf.buf(Gt.content,0);var Ps=Gt.content;8==Ye&&(Ps=Fe(Ps)),(ye=A(30)).write_shift(4,67324752),ye.write_shift(2,20),ye.write_shift(2,0),ye.write_shift(2,Ye),Gt.mt?x(ye,Gt.mt):ye.write_shift(4,0),ye.write_shift(-4,Mr[Nt]),ye.write_shift(4,Ps.length),ye.write_shift(4,Gt.content.length),ye.write_shift(2,An.length),ye.write_shift(2,0),St+=ye.length,fe.push(ye),St+=An.length,fe.push(An),St+=Ps.length,fe.push(Ps),(ye=A(46)).write_shift(4,33639248),ye.write_shift(2,0),ye.write_shift(2,20),ye.write_shift(2,0),ye.write_shift(2,Ye),ye.write_shift(4,0),ye.write_shift(-4,Mr[Nt]),ye.write_shift(4,Ps.length),ye.write_shift(4,Gt.content.length),ye.write_shift(2,An.length),ye.write_shift(2,0),ye.write_shift(2,0),ye.write_shift(2,0),ye.write_shift(2,0),ye.write_shift(4,0),ye.write_shift(4,ns),qi+=ye.l,xe.push(ye),qi+=An.length,xe.push(An),++Nt}return(ye=A(22)).write_shift(4,101010256),ye.write_shift(2,0),ye.write_shift(2,0),ye.write_shift(2,Nt),ye.write_shift(2,Nt),ye.write_shift(4,qi),ye.write_shift(4,St),ye.write_shift(2,0),Bi([Bi(fe),Bi(xe),ye])}(Q,oe);var fe=function(ir){for(var Ut=0,Gt=0,Mr=0;Mr<ir.FileIndex.length;++Mr){var qi=ir.FileIndex[Mr];if(qi.content){var ns=qi.content.length;ns>0&&(ns<4096?Ut+=ns+63>>6:Gt+=ns+511>>9)}}for(var An=ir.FullPaths.length+3>>2,v0=Ut+127>>7,w0=(Ut+7>>3)+Gt+An+v0,Qh=w0+127>>7,Tg=Qh<=109?0:Math.ceil((Qh-109)/127);w0+Qh+Tg+127>>7>Qh;)Tg=++Qh<=109?0:Math.ceil((Qh-109)/127);var Hc=[1,Tg,Qh,v0,An,Gt,Ut,0];return ir.FileIndex[0].size=Ut<<6,Hc[7]=(ir.FileIndex[0].start=Hc[0]+Hc[1]+Hc[2]+Hc[3]+Hc[4]+Hc[5])+(Hc[6]+7>>3),Hc}(Q),xe=A(fe[7]<<9),ye=0,Ye=0;for(ye=0;ye<8;++ye)xe.write_shift(1,jt[ye]);for(ye=0;ye<8;++ye)xe.write_shift(2,0);for(xe.write_shift(2,62),xe.write_shift(2,3),xe.write_shift(2,65534),xe.write_shift(2,9),xe.write_shift(2,6),ye=0;ye<3;++ye)xe.write_shift(2,0);for(xe.write_shift(4,0),xe.write_shift(4,fe[2]),xe.write_shift(4,fe[0]+fe[1]+fe[2]+fe[3]-1),xe.write_shift(4,0),xe.write_shift(4,4096),xe.write_shift(4,fe[3]?fe[0]+fe[1]+fe[2]-1:Bt),xe.write_shift(4,fe[3]),xe.write_shift(-4,fe[1]?fe[0]-1:Bt),xe.write_shift(4,fe[1]),ye=0;ye<109;++ye)xe.write_shift(-4,ye<fe[2]?fe[1]+ye:-1);if(fe[1])for(Ye=0;Ye<fe[1];++Ye){for(;ye<236+127*Ye;++ye)xe.write_shift(-4,ye<fe[2]?fe[1]+ye:-1);xe.write_shift(-4,Ye===fe[1]-1?Bt:Ye+1)}var ct=function(ir){for(Ye+=ir;ye<Ye-1;++ye)xe.write_shift(-4,ye+1);ir&&(++ye,xe.write_shift(-4,Bt))};for(Ye=ye=0,Ye+=fe[1];ye<Ye;++ye)xe.write_shift(-4,sr.DIFSECT);for(Ye+=fe[2];ye<Ye;++ye)xe.write_shift(-4,sr.FATSECT);ct(fe[3]),ct(fe[4]);for(var Je=0,Ke=0,it=Q.FileIndex[0];Je<Q.FileIndex.length;++Je)(it=Q.FileIndex[Je]).content&&!((Ke=it.content.length)<4096)&&(it.start=Ye,ct(Ke+511>>9));for(ct(fe[6]+7>>3);511&xe.l;)xe.write_shift(-4,sr.ENDOFCHAIN);for(Ye=ye=0,Je=0;Je<Q.FileIndex.length;++Je)(it=Q.FileIndex[Je]).content&&(Ke=it.content.length)&&!(Ke>=4096)&&(it.start=Ye,ct(Ke+63>>6));for(;511&xe.l;)xe.write_shift(-4,sr.ENDOFCHAIN);for(ye=0;ye<fe[4]<<2;++ye){var St=Q.FullPaths[ye];if(St&&0!==St.length){it=Q.FileIndex[ye],0===ye&&(it.start=it.size?it.start-1:Bt);var Nt=0===ye&&oe.root||it.name;if(Ke=2*(Nt.length+1),xe.write_shift(64,Nt,"utf16le"),xe.write_shift(2,Ke),xe.write_shift(1,it.type),xe.write_shift(1,it.color),xe.write_shift(-4,it.L),xe.write_shift(-4,it.R),xe.write_shift(-4,it.C),it.clsid)xe.write_shift(16,it.clsid,"hex");else for(Je=0;Je<4;++Je)xe.write_shift(4,0);xe.write_shift(4,it.state||0),xe.write_shift(4,0),xe.write_shift(4,0),xe.write_shift(4,0),xe.write_shift(4,0),xe.write_shift(4,it.start),xe.write_shift(4,it.size),xe.write_shift(4,0)}else{for(Je=0;Je<17;++Je)xe.write_shift(4,0);for(Je=0;Je<3;++Je)xe.write_shift(4,-1);for(Je=0;Je<12;++Je)xe.write_shift(4,0)}}for(ye=1;ye<Q.FileIndex.length;++ye)if((it=Q.FileIndex[ye]).size>=4096)if(xe.l=it.start+1<<9,_r&&Buffer.isBuffer(it.content))it.content.copy(xe,xe.l,0,it.size),xe.l+=it.size+511&-512;else{for(Je=0;Je<it.size;++Je)xe.write_shift(1,it.content[Je]);for(;511&Je;++Je)xe.write_shift(1,0)}for(ye=1;ye<Q.FileIndex.length;++ye)if((it=Q.FileIndex[ye]).size>0&&it.size<4096)if(_r&&Buffer.isBuffer(it.content))it.content.copy(xe,xe.l,0,it.size),xe.l+=it.size+63&-64;else{for(Je=0;Je<it.size;++Je)xe.write_shift(1,it.content[Je]);for(;63&Je;++Je)xe.write_shift(1,0)}if(_r)xe.l=xe.length;else for(;xe.l<xe.length;)xe.write_shift(1,0);return xe}i.version="1.2.1";var yt,je=64,Bt=-2,er="d0cf11e0a1b11ae1",jt=[208,207,17,224,161,177,26,225],pr="00000000000000000000000000000000",sr={MAXREGSECT:-6,DIFSECT:-4,FATSECT:-3,ENDOFCHAIN:Bt,FREESECT:-1,HEADER_SIGNATURE:er,HEADER_MINOR_VERSION:"3e00",MAXREGSID:-6,NOSTREAM:-1,HEADER_CLSID:pr,EntryTypes:["unknown","storage","stream","lockbytes","property","root"]};function Xt(Q){for(var ge=new Array(Q.length),oe=0;oe<Q.length;++oe)ge[oe]=String.fromCharCode(Q[oe]);return ge.join("")}function Fe(Q){return yt?yt.deflateRawSync(Q):$r(Q)}for(var Q,ge,Ie=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],ft=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258],$t=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577],Lt="undefined"!=typeof Uint8Array,xt=Lt?new Uint8Array(256):[],zr=0;zr<256;++zr)xt[zr]=(void 0,255&((ge=139536&((Q=zr)<<1|Q<<11)|558144&(Q<<5|Q<<15))>>16|ge>>8|ge));function be(Q,ge){var oe=xt[255&Q];return ge<=8?oe>>>8-ge:(oe=oe<<8|xt[Q>>8&255],ge<=16?oe>>>16-ge:(oe=oe<<8|xt[Q>>16&255])>>>24-ge)}function bi(Q,ge){var oe=7&ge,fe=ge>>>3;return(Q[fe]|(oe<=6?0:Q[fe+1]<<8))>>>oe&3}function Hr(Q,ge){var oe=7&ge,fe=ge>>>3;return(Q[fe]|(oe<=5?0:Q[fe+1]<<8))>>>oe&7}function Yr(Q,ge){var oe=7&ge,fe=ge>>>3;return(Q[fe]|(oe<=3?0:Q[fe+1]<<8))>>>oe&31}function Wt(Q,ge){var oe=7&ge,fe=ge>>>3;return(Q[fe]|(oe<=1?0:Q[fe+1]<<8))>>>oe&127}function _n(Q,ge,oe){var fe=7&ge,xe=ge>>>3,Ye=Q[xe]>>>fe;return oe<8-fe||(Ye|=Q[xe+1]<<8-fe,oe<16-fe)||(Ye|=Q[xe+2]<<16-fe,oe<24-fe)||(Ye|=Q[xe+3]<<24-fe),Ye&(1<<oe)-1}function co(Q,ge,oe){var fe=7&ge,xe=ge>>>3;return fe<=5?Q[xe]|=(7&oe)<<fe:(Q[xe]|=oe<<fe&255,Q[xe+1]=(7&oe)>>8-fe),ge+3}function Kl(Q,ge,oe){return Q[ge>>>3]|=oe=(1&oe)<<(7&ge),ge+1}function Wc(Q,ge,oe){var xe=ge>>>3;return Q[xe]|=255&(oe<<=7&ge),Q[xe+1]=oe>>>=8,ge+8}function x0(Q,ge,oe){var xe=ge>>>3;return Q[xe]|=255&(oe<<=7&ge),Q[xe+1]=255&(oe>>>=8),Q[xe+2]=oe>>>8,ge+16}function Wu(Q,ge){var oe=Q.length,fe=2*oe>ge?2*oe:ge+5,xe=0;if(oe>=ge)return Q;if(_r){var ye=ef(fe);if(Q.copy)Q.copy(ye);else for(;xe<Q.length;++xe)ye[xe]=Q[xe];return ye}if(Lt){var Ye=new Uint8Array(fe);if(Ye.set)Ye.set(Q);else for(;xe<oe;++xe)Ye[xe]=Q[xe];return Ye}return Q.length=fe,Q}function Ds(Q){for(var ge=new Array(Q),oe=0;oe<Q;++oe)ge[oe]=0;return ge}function Xc(Q,ge,oe){var fe=1,xe=0,ye=0,Ye=0,ct=0,Je=Q.length,Ke=Lt?new Uint16Array(32):Ds(32);for(ye=0;ye<32;++ye)Ke[ye]=0;for(ye=Je;ye<oe;++ye)Q[ye]=0;Je=Q.length;var it=Lt?new Uint16Array(Je):Ds(Je);for(ye=0;ye<Je;++ye)Ke[xe=Q[ye]]++,fe<xe&&(fe=xe),it[ye]=0;for(Ke[0]=0,ye=1;ye<=fe;++ye)Ke[ye+16]=ct=ct+Ke[ye-1]<<1;for(ye=0;ye<Je;++ye)0!=(ct=Q[ye])&&(it[ye]=Ke[ct+16]++);var St=0;for(ye=0;ye<Je;++ye)if(0!=(St=Q[ye]))for(ct=be(it[ye],fe)>>fe-St,Ye=(1<<fe+4-St)-1;Ye>=0;--Ye)ge[ct|Ye<<St]=15&St|ye<<4;return fe}var Xu=Lt?new Uint16Array(512):Ds(512),y0=Lt?new Uint16Array(32):Ds(32);if(!Lt){for(var qa=0;qa<512;++qa)Xu[qa]=0;for(qa=0;qa<32;++qa)y0[qa]=0}!function(){for(var Q=[],ge=0;ge<32;ge++)Q.push(5);Xc(Q,y0,32);var oe=[];for(ge=0;ge<=143;ge++)oe.push(8);for(;ge<=255;ge++)oe.push(9);for(;ge<=279;ge++)oe.push(7);for(;ge<=287;ge++)oe.push(8);Xc(oe,Xu,288)}();var Jl=function(){for(var ge=Lt?new Uint8Array(32768):[],oe=0,fe=0;oe<$t.length-1;++oe)for(;fe<$t[oe+1];++fe)ge[fe]=oe;for(;fe<32768;++fe)ge[fe]=29;var xe=Lt?new Uint8Array(259):[];for(oe=0,fe=0;oe<ft.length-1;++oe)for(;fe<ft[oe+1];++fe)xe[fe]=oe;return function(Je,Ke){return Je.length<8?function ye(ct,Je){for(var Ke=0;Ke<ct.length;){var it=Math.min(65535,ct.length-Ke);for(Je.write_shift(1,+(Ke+it==ct.length)),Je.write_shift(2,it),Je.write_shift(2,65535&~it);it-- >0;)Je[Je.l++]=ct[Ke++]}return Je.l}(Je,Ke):function Ye(ct,Je){for(var Ke=0,it=0,St=Lt?new Uint16Array(32768):[];it<ct.length;){var Nt=Math.min(65535,ct.length-it);if(Nt<10){for(7&(Ke=co(Je,Ke,+(it+Nt==ct.length)))&&(Ke+=8-(7&Ke)),Je.l=Ke/8|0,Je.write_shift(2,Nt),Je.write_shift(2,65535&~Nt);Nt-- >0;)Je[Je.l++]=ct[it++];Ke=8*Je.l}else{Ke=co(Je,Ke,+(it+Nt==ct.length)+2);for(var ir=0;Nt-- >0;){var Ut=ct[it],Gt=-1,Mr=0;if((Gt=St[ir=32767&(ir<<5^Ut)])&&((Gt|=-32768&it)>it&&(Gt-=32768),Gt<it))for(;ct[Gt+Mr]==ct[it+Mr]&&Mr<250;)++Mr;if(Mr>2){(Ut=xe[Mr])<=22?Ke=Wc(Je,Ke,xt[Ut+1]>>1)-1:(Wc(Je,Ke,3),Wc(Je,Ke+=5,xt[Ut-23]>>5),Ke+=3);var qi=Ut<8?0:Ut-4>>2;qi>0&&(x0(Je,Ke,Mr-ft[Ut]),Ke+=qi),Ke=Wc(Je,Ke,xt[Ut=ge[it-Gt]]>>3),Ke-=3;var ns=Ut<4?0:Ut-2>>1;ns>0&&(x0(Je,Ke,it-Gt-$t[Ut]),Ke+=ns);for(var An=0;An<Mr;++An)St[ir]=32767&it,ir=32767&(ir<<5^ct[it]),++it;Nt-=Mr-1}else Ut<=143?Ut+=48:Ke=Kl(Je,Ke,1),Ke=Wc(Je,Ke,xt[Ut]),St[ir]=32767&it,++it}Ke=Wc(Je,Ke,0)-1}}return Je.l=(Ke+7)/8|0,Je.l}(Je,Ke)}}();function $r(Q){var ge=A(50+Math.floor(1.1*Q.length)),oe=Jl(Q,ge);return ge.slice(0,oe)}var gn=Lt?new Uint16Array(32768):Ds(32768),uo=Lt?new Uint16Array(32768):Ds(32768),qn=Lt?new Uint16Array(128):Ds(128),Jh=1,b1=1;function yw(Q,ge){var oe=Yr(Q,ge)+257,fe=Yr(Q,ge+=5)+1,xe=function Ti(Q,ge){var oe=7&ge,fe=ge>>>3;return(Q[fe]|(oe<=4?0:Q[fe+1]<<8))>>>oe&15}(Q,ge+=5)+4;ge+=4;for(var ye=0,Ye=Lt?new Uint8Array(19):Ds(19),ct=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],Je=1,Ke=Lt?new Uint8Array(8):Ds(8),it=Lt?new Uint8Array(8):Ds(8),St=Ye.length,Nt=0;Nt<xe;++Nt)Ye[Ie[Nt]]=ye=Hr(Q,ge),Je<ye&&(Je=ye),Ke[ye]++,ge+=3;var ir=0;for(Ke[0]=0,Nt=1;Nt<=Je;++Nt)it[Nt]=ir=ir+Ke[Nt-1]<<1;for(Nt=0;Nt<St;++Nt)0!=(ir=Ye[Nt])&&(ct[Nt]=it[ir]++);var Ut=0;for(Nt=0;Nt<St;++Nt)if(0!=(Ut=Ye[Nt])){ir=xt[ct[Nt]]>>8-Ut;for(var Gt=(1<<7-Ut)-1;Gt>=0;--Gt)qn[ir|Gt<<Ut]=7&Ut|Nt<<3}var Mr=[];for(Je=1;Mr.length<oe+fe;)switch(ir=qn[Wt(Q,ge)],ge+=7&ir,ir>>>=3){case 16:for(ye=3+bi(Q,ge),ge+=2,ir=Mr[Mr.length-1];ye-- >0;)Mr.push(ir);break;case 17:for(ye=3+Hr(Q,ge),ge+=3;ye-- >0;)Mr.push(0);break;case 18:for(ye=11+Wt(Q,ge),ge+=7;ye-- >0;)Mr.push(0);break;default:Mr.push(ir),Je<ir&&(Je=ir)}var qi=Mr.slice(0,oe),ns=Mr.slice(oe);for(Nt=oe;Nt<286;++Nt)qi[Nt]=0;for(Nt=fe;Nt<30;++Nt)ns[Nt]=0;return Jh=Xc(qi,gn,286),b1=Xc(ns,uo,30),ge}function T1(Q,ge){var fe=function vw(Q,ge){if(3==Q[0]&&!(3&Q[1]))return[en(ge),2];for(var oe=0,fe=0,xe=ef(ge||1<<18),ye=0,Ye=xe.length>>>0,ct=0,Je=0;0==(1&fe);)if(fe=Hr(Q,oe),oe+=3,fe>>>1!=0)for(fe>>1==1?(ct=9,Je=5):(oe=yw(Q,oe),ct=Jh,Je=b1);;){!ge&&Ye<ye+32767&&(Ye=(xe=Wu(xe,ye+32767)).length);var it=_n(Q,oe,ct),St=fe>>>1==1?Xu[it]:gn[it];if(oe+=15&St,0==((St>>>=4)>>>8&255))xe[ye++]=St;else{if(256==St)break;var Nt=(St-=257)<8?0:St-4>>2;Nt>5&&(Nt=0);var ir=ye+ft[St];Nt>0&&(ir+=_n(Q,oe,Nt),oe+=Nt),it=_n(Q,oe,Je),oe+=15&(St=fe>>>1==1?y0[it]:uo[it]);var Ut=(St>>>=4)<4?0:St-2>>1,Gt=$t[St];for(Ut>0&&(Gt+=_n(Q,oe,Ut),oe+=Ut),!ge&&Ye<ir&&(Ye=(xe=Wu(xe,ir+100)).length);ye<ir;)xe[ye]=xe[ye-Gt],++ye}}else{7&oe&&(oe+=8-(7&oe));var Ke=Q[oe>>>3]|Q[1+(oe>>>3)]<<8;if(oe+=32,Ke>0)for(!ge&&Ye<ye+Ke&&(Ye=(xe=Wu(xe,ye+Ke)).length);Ke-- >0;)xe[ye++]=Q[oe>>>3],oe+=8}return ge?[xe,oe+7>>>3]:[xe.slice(0,ye),oe+7>>>3]}(Q.slice(Q.l||0),ge);return Q.l+=fe[1],fe[0]}function E1(Q,ge){if(!Q)throw new Error(ge);"undefined"!=typeof console&&console.error(ge)}function S1(Q,ge){var oe=Q;b(oe,0);var ye={FileIndex:[],FullPaths:[]};Se(ye,{root:ge.root});for(var Ye=oe.length-4;(80!=oe[Ye]||75!=oe[Ye+1]||5!=oe[Ye+2]||6!=oe[Ye+3])&&Ye>=0;)--Ye;oe.l=Ye+4,oe.l+=4;var ct=oe.read_shift(2);oe.l+=6;var Je=oe.read_shift(4);for(oe.l=Je,Ye=0;Ye<ct;++Ye){oe.l+=20;var Ke=oe.read_shift(4),it=oe.read_shift(4),St=oe.read_shift(2),Nt=oe.read_shift(2),ir=oe.read_shift(2);oe.l+=8;var Ut=oe.read_shift(4),Gt=T(oe.slice(oe.l+St,oe.l+St+Nt));oe.l+=St+Nt+ir;var Mr=oe.l;oe.l=Ut+4,ww(oe,Ke,it,ye,Gt),oe.l=Mr}return ye}function ww(Q,ge,oe,fe,xe){Q.l+=2;var ye=Q.read_shift(2),Ye=Q.read_shift(2),ct=function y(Q){var ge=65535&Q.read_shift(2),oe=65535&Q.read_shift(2),fe=new Date,xe=31&oe,ye=15&(oe>>>=5);oe>>>=4,fe.setMilliseconds(0),fe.setFullYear(oe+1980),fe.setMonth(ye-1),fe.setDate(xe);var Ye=31&ge,ct=63&(ge>>>=5);return fe.setHours(ge>>>=6),fe.setMinutes(ct),fe.setSeconds(Ye<<1),fe}(Q);if(8257&ye)throw new Error("Unsupported ZIP encryption");Q.read_shift(4);for(var Ke=Q.read_shift(4),it=Q.read_shift(4),St=Q.read_shift(2),Nt=Q.read_shift(2),ir="",Ut=0;Ut<St;++Ut)ir+=String.fromCharCode(Q[Q.l++]);if(Nt){var Gt=T(Q.slice(Q.l,Q.l+Nt));(Gt[21589]||{}).mt&&(ct=Gt[21589].mt),((xe||{})[21589]||{}).mt&&(ct=xe[21589].mt)}Q.l+=Nt;var Mr=Q.slice(Q.l,Q.l+Ke);switch(Ye){case 8:Mr=function tt(Q,ge){if(!yt)return T1(Q,ge);var fe=new(0,yt.InflateRaw),xe=fe._processChunk(Q.slice(Q.l),fe._finishFlushFlag);return Q.l+=fe.bytesRead,xe}(Q,it);break;case 0:break;default:throw new Error("Unsupported ZIP Compression method "+Ye)}var qi=!1;8&ye&&(134695760==Q.read_shift(4)&&(Q.read_shift(4),qi=!0),Ke=Q.read_shift(4),it=Q.read_shift(4)),Ke!=ge&&E1(qi,"Bad compressed size: "+ge+" != "+Ke),it!=oe&&E1(qi,"Bad uncompressed size: "+oe+" != "+it),bg(fe,ir,Mr,{unsafe:!0,mt:ct})}var Tm={htm:"text/html",xml:"text/xml",gif:"image/gif",jpg:"image/jpeg",png:"image/png",mso:"application/x-mso",thmx:"application/vnd.ms-officetheme",sh33tj5:"application/octet-stream"};function Tw(Q,ge){if(Q.ctype)return Q.ctype;var oe=Q.name||"",fe=oe.match(/\.([^\.]+)$/);return fe&&Tm[fe[1]]||ge&&(fe=(oe=ge).match(/[\.\\]([^\.\\])+$/))&&Tm[fe[1]]?Tm[fe[1]]:"application/octet-stream"}function Ew(Q){for(var ge=Mn(Q),oe=[],fe=0;fe<ge.length;fe+=76)oe.push(ge.slice(fe,fe+76));return oe.join("\r\n")+"\r\n"}function Sw(Q){var ge=Q.replace(/[\x00-\x08\x0B\x0C\x0E-\x1F\x7E-\xFF=]/g,function(Ke){var it=Ke.charCodeAt(0).toString(16).toUpperCase();return"="+(1==it.length?"0"+it:it)});"\n"==(ge=ge.replace(/ $/gm,"=20").replace(/\t$/gm,"=09")).charAt(0)&&(ge="=0D"+ge.slice(1));for(var oe=[],fe=(ge=ge.replace(/\r(?!\n)/gm,"=0D").replace(/\n\n/gm,"\n=0A").replace(/([^\r\n])\n/gm,"$1=0A")).split("\r\n"),xe=0;xe<fe.length;++xe){var ye=fe[xe];if(0!=ye.length)for(var Ye=0;Ye<ye.length;){var ct=76,Je=ye.slice(Ye,Ye+ct);"="==Je.charAt(ct-1)?ct--:"="==Je.charAt(ct-2)?ct-=2:"="==Je.charAt(ct-3)&&(ct-=3),Je=ye.slice(Ye,Ye+ct),(Ye+=ct)<ye.length&&(Je+="="),oe.push(Je)}else oe.push("")}return oe.join("\r\n")}function kw(Q,ge,oe){for(var Ye,fe="",xe="",ye="",ct=0;ct<10;++ct){var Je=ge[ct];if(!Je||Je.match(/^\s*$/))break;var Ke=Je.match(/^(.*?):\s*([^\s].*)$/);if(Ke)switch(Ke[1].toLowerCase()){case"content-location":fe=Ke[2].trim();break;case"content-type":ye=Ke[2].trim();break;case"content-transfer-encoding":xe=Ke[2].trim()}}switch(++ct,xe.toLowerCase()){case"base64":Ye=Xn(Qi(ge.slice(ct).join("")));break;case"quoted-printable":Ye=function Aw(Q){for(var ge=[],oe=0;oe<Q.length;++oe){for(var fe=Q[oe];oe<=Q.length&&"="==fe.charAt(fe.length-1);)fe=fe.slice(0,fe.length-1)+Q[++oe];ge.push(fe)}for(var xe=0;xe<ge.length;++xe)ge[xe]=ge[xe].replace(/[=][0-9A-Fa-f]{2}/g,function(ye){return String.fromCharCode(parseInt(ye.slice(1),16))});return Xn(ge.join("\r\n"))}(ge.slice(ct));break;default:throw new Error("Unsupported Content-Transfer-Encoding "+xe)}var it=bg(Q,fe.slice(oe.length),Ye,{unsafe:!0});ye&&(it.ctype=ye)}function bg(Q,ge,oe,fe){var xe=fe&&fe.unsafe;xe||Se(Q);var ye=!xe&&ar.find(Q,ge);if(!ye){var Ye=Q.FullPaths[0];ge.slice(0,Ye.length)==Ye?Ye=ge:("/"!=Ye.slice(-1)&&(Ye+="/"),Ye=(Ye+ge).replace("//","/")),ye={name:c(ge),type:2},Q.FileIndex.push(ye),Q.FullPaths.push(Ye),xe||ar.utils.cfb_gc(Q)}return ye.content=oe,ye.size=oe?oe.length:0,fe&&(fe.CLSID&&(ye.clsid=fe.CLSID),fe.mt&&(ye.mt=fe.mt),fe.ct&&(ye.ct=fe.ct)),ye}return i.find=function ot(Q,ge){var oe=Q.FullPaths.map(function(Je){return Je.toUpperCase()}),fe=oe.map(function(Je){var Ke=Je.split("/");return Ke[Ke.length-("/"==Je.slice(-1)?2:1)]}),xe=!1;47===ge.charCodeAt(0)?(xe=!0,ge=oe[0].slice(0,-1)+ge):xe=-1!==ge.indexOf("/");var ye=ge.toUpperCase(),Ye=!0===xe?oe.indexOf(ye):fe.indexOf(ye);if(-1!==Ye)return Q.FileIndex[Ye];var ct=!ye.match(Co);for(ye=ye.replace(Hi,""),ct&&(ye=ye.replace(Co,"!")),Ye=0;Ye<oe.length;++Ye)if((ct?oe[Ye].replace(Co,"!"):oe[Ye]).replace(Hi,"")==ye||(ct?fe[Ye].replace(Co,"!"):fe[Ye]).replace(Hi,"")==ye)return Q.FileIndex[Ye];return null},i.read=function nt(Q,ge){var oe=ge&&ge.type;switch(oe||_r&&Buffer.isBuffer(Q)&&(oe="buffer"),oe||"base64"){case"file":return function We(Q,ge){return I(),F(C.readFileSync(Q),ge)}(Q,ge);case"base64":return F(Xn(Qi(Q)),ge);case"binary":return F(Xn(Q),ge)}return F(Q,ge)},i.parse=F,i.write=function xr(Q,ge){var oe=at(Q,ge);switch(ge&&ge.type||"buffer"){case"file":return I(),C.writeFileSync(ge.filename,oe),oe;case"binary":return"string"==typeof oe?oe:Xt(oe);case"base64":return Mn("string"==typeof oe?oe:Xt(oe));case"buffer":if(_r)return Buffer.isBuffer(oe)?oe:ls(oe);case"array":return"string"==typeof oe?Xn(oe):oe}return oe},i.writeFile=function Xr(Q,ge,oe){I();var fe=at(Q,oe);C.writeFileSync(ge,fe)},i.utils={cfb_new:function Mw(Q){var ge={};return Se(ge,Q),ge},cfb_add:bg,cfb_del:function Fw(Q,ge){Se(Q);var oe=ar.find(Q,ge);if(oe)for(var fe=0;fe<Q.FileIndex.length;++fe)if(Q.FileIndex[fe]==oe)return Q.FileIndex.splice(fe,1),Q.FullPaths.splice(fe,1),!0;return!1},cfb_mov:function Dw(Q,ge,oe){Se(Q);var fe=ar.find(Q,ge);if(fe)for(var xe=0;xe<Q.FileIndex.length;++xe)if(Q.FileIndex[xe]==fe)return Q.FileIndex[xe].name=c(oe),Q.FullPaths[xe]=oe,!0;return!1},cfb_gc:function Pw(Q){Ve(Q,!0)},ReadShift:Ja,CheckField:w,prep_blob:b,bconcat:Bi,use_zlib:function Te(Q){try{var oe=new(0,Q.InflateRaw);if(oe._processChunk(new Uint8Array([3,0]),oe._finishFlushFlag),!oe.bytesRead)throw new Error("zlib does not expose bytesRead");yt=Q}catch(fe){console.error("cannot use native zlib: "+(fe.message||fe))}},_deflateRaw:$r,_inflateRaw:T1,consts:sr},i}();function uf(e){return"string"==typeof e?hn(e):Array.isArray(e)?function qs(e){if("undefined"==typeof Uint8Array)throw new Error("Unsupported");return new Uint8Array(e)}(e):e}function zo(e,i,r){if("undefined"!=typeof Deno){if(r&&"string"==typeof i)switch(r){case"utf8":i=new TextEncoder(r).encode(i);break;case"binary":i=hn(i);break;default:throw new Error("Unsupported encoding "+r)}return Deno.writeFileSync(e,i)}var o="utf8"==r?ca(i):i;if("undefined"!=typeof IE_SaveFile)return IE_SaveFile(o,e);if("undefined"!=typeof Blob){var c=new Blob([uf(o)],{type:"application/octet-stream"});if("undefined"!=typeof navigator&&navigator.msSaveBlob)return navigator.msSaveBlob(c,e);if("undefined"!=typeof saveAs)return saveAs(c,e);if("undefined"!=typeof URL&&"undefined"!=typeof document&&document.createElement&&URL.createObjectURL){var x=URL.createObjectURL(c);if("object"==typeof chrome&&"function"==typeof(chrome.downloads||{}).download)return URL.revokeObjectURL&&"undefined"!=typeof setTimeout&&setTimeout(function(){URL.revokeObjectURL(x)},6e4),chrome.downloads.download({url:x,filename:e,saveAs:!0});var y=document.createElement("a");if(null!=y.download)return y.download=e,y.href=x,document.body.appendChild(y),y.click(),document.body.removeChild(y),URL.revokeObjectURL&&"undefined"!=typeof setTimeout&&setTimeout(function(){URL.revokeObjectURL(x)},6e4),x}}if("undefined"!=typeof $&&"undefined"!=typeof File&&"undefined"!=typeof Folder)try{var T=File(e);return T.open("w"),T.encoding="binary",Array.isArray(i)&&(i=za(i)),T.write(i),T.close(),i}catch(C){if(!C.message||!C.message.match(/onstruct/))throw C}throw new Error("cannot save file "+e)}function Fi(e){for(var i=Object.keys(e),r=[],o=0;o<i.length;++o)Object.prototype.hasOwnProperty.call(e,i[o])&&r.push(i[o]);return r}function hf(e,i){for(var r=[],o=Fi(e),c=0;c!==o.length;++c)null==r[e[o[c]][i]]&&(r[e[o[c]][i]]=o[c]);return r}function bl(e){for(var i=[],r=Fi(e),o=0;o!==r.length;++o)i[e[r[o]]]=r[o];return i}function xc(e){for(var i=[],r=Fi(e),o=0;o!==r.length;++o)i[e[r[o]]]=parseInt(r[o],10);return i}var us=new Date(1899,11,30,0,0,0);function Di(e,i){var r=e.getTime();return i&&(r-=1263168e5),(r-(us.getTime()+6e4*(e.getTimezoneOffset()-us.getTimezoneOffset())))/864e5}var xu=new Date,nh=us.getTime()+6e4*(xu.getTimezoneOffset()-us.getTimezoneOffset()),ah=xu.getTimezoneOffset();function Tl(e){var i=new Date;return i.setTime(24*e*60*60*1e3+nh),i.getTimezoneOffset()!==ah&&i.setTime(i.getTime()+6e4*(i.getTimezoneOffset()-ah)),i}var Ct=new Date("2017-02-19T19:06:09.000Z"),oa=isNaN(Ct.getFullYear())?new Date("2/19/17"):Ct,yc=2017==oa.getFullYear();function Ei(e,i){var r=new Date(e);if(yc)return i>0?r.setTime(r.getTime()+60*r.getTimezoneOffset()*1e3):i<0&&r.setTime(r.getTime()-60*r.getTimezoneOffset()*1e3),r;if(e instanceof Date)return e;if(1917==oa.getFullYear()&&!isNaN(r.getFullYear())){var o=r.getFullYear();return e.indexOf(""+o)>-1||r.setFullYear(r.getFullYear()+100),r}var c=e.match(/\d+/g)||["2017","2","19","0","0","0"],x=new Date(+c[0],+c[1]-1,+c[2],+c[3]||0,+c[4]||0,+c[5]||0);return e.indexOf("Z")>-1&&(x=new Date(x.getTime()-60*x.getTimezoneOffset()*1e3)),x}function Ws(e,i){if(_r&&Buffer.isBuffer(e)){if(i){if(255==e[0]&&254==e[1])return ca(e.slice(2).toString("utf16le"));if(254==e[1]&&255==e[2])return ca(function Oi(e){for(var i=[],r=0;r<e.length>>1;++r)i[r]=String.fromCharCode(e.charCodeAt(2*r+1)+(e.charCodeAt(2*r)<<8));return i.join("")}(e.slice(2).toString("binary")))}return e.toString("binary")}if("undefined"!=typeof TextDecoder)try{if(i){if(255==e[0]&&254==e[1])return ca(new TextDecoder("utf-16le").decode(e.slice(2)));if(254==e[0]&&255==e[1])return ca(new TextDecoder("utf-16be").decode(e.slice(2)))}var r={"\u20ac":"\x80","\u201a":"\x82",\u0192:"\x83","\u201e":"\x84","\u2026":"\x85","\u2020":"\x86","\u2021":"\x87",\u02c6:"\x88","\u2030":"\x89",\u0160:"\x8a","\u2039":"\x8b",\u0152:"\x8c",\u017d:"\x8e","\u2018":"\x91","\u2019":"\x92","\u201c":"\x93","\u201d":"\x94","\u2022":"\x95","\u2013":"\x96","\u2014":"\x97","\u02dc":"\x98","\u2122":"\x99",\u0161:"\x9a","\u203a":"\x9b",\u0153:"\x9c",\u017e:"\x9e",\u0178:"\x9f"};return Array.isArray(e)&&(e=new Uint8Array(e)),new TextDecoder("latin1").decode(e).replace(/[\u20ac\u201a\u0192\u201e\u2026\u2020\u2021\u02c6\u2030\u0160\u2039\u0152\u017d\u2018\u2019\u201c\u201d\u2022\u2013\u2014\u02dc\u2122\u0161\u203a\u0153\u017e\u0178]/g,function(x){return r[x]||x})}catch(x){}for(var o=[],c=0;c!=e.length;++c)o.push(String.fromCharCode(e[c]));return o.join("")}function Kr(e){if("undefined"!=typeof JSON&&!Array.isArray(e))return JSON.parse(JSON.stringify(e));if("object"!=typeof e||null==e)return e;if(e instanceof Date)return new Date(e.getTime());var i={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(i[r]=Kr(e[r]));return i}function ii(e,i){for(var r="";r.length<i;)r+=e;return r}function Pn(e){var i=Number(e);if(!isNaN(i))return isFinite(i)?i:NaN;if(!/\d/.test(e))return i;var r=1,o=e.replace(/([\d]),([\d])/g,"$1$2").replace(/[$]/g,"").replace(/[%]/g,function(){return r*=100,""});return isNaN(i=Number(o))&&(o=o.replace(/[(](.*)[)]/,function(c,x){return r=-r,x}),isNaN(i=Number(o)))?i:i/r}var Xs=["january","february","march","april","may","june","july","august","september","october","november","december"];function la(e){var i=new Date(e),r=new Date(NaN),o=i.getYear(),c=i.getMonth(),x=i.getDate();if(isNaN(x))return r;var y=e.toLowerCase();if(y.match(/jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec/)){if((y=y.replace(/[^a-z]/g,"").replace(/([^a-z]|^)[ap]m?([^a-z]|$)/,"")).length>3&&-1==Xs.indexOf(y))return r}else if(y.match(/[a-z]/))return r;return o<0||o>8099?r:(c>0||x>1)&&101!=o?i:e.match(/[^-0-9:,\/\\]/)?r:i}function mr(e,i,r){if(e.FullPaths){var o;if("string"==typeof r)return o=_r?ls(r):function tf(e){for(var i=[],r=0,o=e.length+250,c=en(e.length+255),x=0;x<e.length;++x){var y=e.charCodeAt(x);if(y<128)c[r++]=y;else if(y<2048)c[r++]=192|y>>6&31,c[r++]=128|63&y;else if(y>=55296&&y<57344){y=64+(1023&y);var T=1023&e.charCodeAt(++x);c[r++]=240|y>>8&7,c[r++]=128|y>>2&63,c[r++]=128|T>>6&15|(3&y)<<4,c[r++]=128|63&T}else c[r++]=224|y>>12&15,c[r++]=128|y>>6&63,c[r++]=128|63&y;r>o&&(i.push(c.slice(0,r)),r=0,c=en(65535),o=65530)}return i.push(c.slice(0,r)),Bi(i)}(r),ar.utils.cfb_add(e,i,o);ar.utils.cfb_add(e,i,r)}else e.file(i,r)}function Ha(){return ar.utils.cfb_new()}var xi='<?xml version="1.0" encoding="UTF-8" standalone="yes"?>\r\n',Ni=bl({"&quot;":'"',"&apos;":"'","&gt;":">","&lt;":"<","&amp;":"&"}),No=/[&<>'"]/g,ld=/[\u0000-\u0008\u000b-\u001f]/g;function ni(e){return(e+"").replace(No,function(r){return Ni[r]}).replace(ld,function(r){return"_x"+("000"+r.charCodeAt(0).toString(16)).slice(-4)+"_"})}function Ya(e){return ni(e).replace(/ /g,"_x0020_")}var uh=/[\u0000-\u001f]/g;function ds(e){return(e+"").replace(No,function(r){return Ni[r]}).replace(/\n/g,"<br/>").replace(uh,function(r){return"&#x"+("000"+r.charCodeAt(0).toString(16)).slice(-4)+";"})}function Sl(e){for(var i="",r=0,o=0,c=0,x=0,y=0,T=0;r<e.length;)(o=e.charCodeAt(r++))<128?i+=String.fromCharCode(o):(c=e.charCodeAt(r++),o>191&&o<224?(y=(31&o)<<6,y|=63&c,i+=String.fromCharCode(y)):(x=e.charCodeAt(r++),o<240?i+=String.fromCharCode((15&o)<<12|(63&c)<<6|63&x):(T=((7&o)<<18|(63&c)<<12|(63&x)<<6|63&(y=e.charCodeAt(r++)))-65536,i+=String.fromCharCode(55296+(T>>>10&1023)),i+=String.fromCharCode(56320+(1023&T)))));return i}function Al(e){var r,o,T,i=en(2*e.length),c=1,x=0,y=0;for(o=0;o<e.length;o+=c)c=1,(T=e.charCodeAt(o))<128?r=T:T<224?(r=64*(31&T)+(63&e.charCodeAt(o+1)),c=2):T<240?(r=4096*(15&T)+64*(63&e.charCodeAt(o+1))+(63&e.charCodeAt(o+2)),c=3):(c=4,r=262144*(7&T)+4096*(63&e.charCodeAt(o+1))+64*(63&e.charCodeAt(o+2))+(63&e.charCodeAt(o+3)),y=55296+((r-=65536)>>>10&1023),r=56320+(1023&r)),0!==y&&(i[x++]=255&y,i[x++]=y>>>8,y=0),i[x++]=r%256,i[x++]=r>>>8;return i.slice(0,x).toString("ucs2")}function Zo(e){return ls(e,"binary").toString("utf8")}var kl="foo bar baz\xe2\x98\x83\xf0\x9f\x8d\xa3",di=_r&&(Zo(kl)==Sl(kl)&&Zo||Al(kl)==Sl(kl)&&Al)||Sl,ca=_r?function(e){return ls(e,"utf8").toString("binary")}:function(e){for(var i=[],r=0,o=0,c=0;r<e.length;)switch(o=e.charCodeAt(r++),!0){case o<128:i.push(String.fromCharCode(o));break;case o<2048:i.push(String.fromCharCode(192+(o>>6))),i.push(String.fromCharCode(128+(63&o)));break;case o>=55296&&o<57344:o-=55296,c=e.charCodeAt(r++)-56320+(o<<10),i.push(String.fromCharCode(240+(c>>18&7))),i.push(String.fromCharCode(144+(c>>12&63))),i.push(String.fromCharCode(128+(c>>6&63))),i.push(String.fromCharCode(128+(63&c)));break;default:i.push(String.fromCharCode(224+(o>>12))),i.push(String.fromCharCode(128+(o>>6&63))),i.push(String.fromCharCode(128+(63&o)))}return i.join("")},Tu=function(){var e=[["nbsp"," "],["middot","\xb7"],["quot",'"'],["apos","'"],["gt",">"],["lt","<"],["amp","&"]].map(function(i){return[new RegExp("&"+i[0]+";","ig"),i[1]]});return function(r){for(var o=r.replace(/^[\t\n\r ]+/,"").replace(/[\t\n\r ]+$/,"").replace(/>\s+/g,">").replace(/\s+</g,"<").replace(/[\t\n\r ]+/g," ").replace(/<\s*[bB][rR]\s*\/?>/g,"\n").replace(/<[^>]*>/g,""),c=0;c<e.length;++c)o=o.replace(e[c][0],e[c][1]);return o}}(),bc=/(^\s|\s$|\n)/;function tn(e,i){return"<"+e+(i.match(bc)?' xml:space="preserve"':"")+">"+i+"</"+e+">"}function Il(e){return Fi(e).map(function(i){return" "+i+'="'+e[i]+'"'}).join("")}function At(e,i,r){return"<"+e+(null!=r?Il(r):"")+(null!=i?(i.match(bc)?' xml:space="preserve"':"")+">"+i+"</"+e:"/")+">"}function Tc(e,i){try{return e.toISOString().replace(/\.\d*/,"")}catch(r){if(i)throw r}return""}var Pi_TCMNT="http://schemas.microsoft.com/office/spreadsheetml/2018/threadedcomments",Pi_r="http://schemas.openxmlformats.org/officeDocument/2006/relationships",Pi_vt="http://schemas.openxmlformats.org/officeDocument/2006/docPropsVTypes",Pi_xsi="http://www.w3.org/2001/XMLSchema-instance",ps=["http://schemas.openxmlformats.org/spreadsheetml/2006/main","http://purl.oclc.org/ooxml/spreadsheetml/main","http://schemas.microsoft.com/office/excel/2006/main","http://schemas.microsoft.com/office/excel/2006/2"],Qn_o="urn:schemas-microsoft-com:office:office",Qn_x="urn:schemas-microsoft-com:office:excel",Qn_ss="urn:schemas-microsoft-com:office:spreadsheet",Au=function(e){for(var i=[],o=0;o<e[0].length;++o)if(e[0][o])for(var c=0,x=e[0][o].length;c<x;c+=10240)i.push.apply(i,e[0][o].slice(c,c+10240));return i},fh=_r?function(e){return e[0].length>0&&Buffer.isBuffer(e[0][0])?Buffer.concat(e[0].map(function(i){return Buffer.isBuffer(i)?i:ls(i)})):Au(e)}:Au,Vo=function(e,i,r){for(var o=[],c=i;c<r;c+=2)o.push(String.fromCharCode(xa(e,c)));return o.join("").replace(Hi,"")},Sc=_r?function(e,i,r){return Buffer.isBuffer(e)?e.toString("utf16le",i,r).replace(Hi,""):Vo(e,i,r)}:Vo,Ac=function(e,i,r){for(var o=[],c=i;c<i+r;++c)o.push(("0"+e[c].toString(16)).slice(-2));return o.join("")},ku=_r?function(e,i,r){return Buffer.isBuffer(e)?e.toString("hex",i,i+r):Ac(e,i,r)}:Ac,kc=function(e,i,r){for(var o=[],c=i;c<r;c++)o.push(String.fromCharCode(Ys(e,c)));return o.join("")},jo=_r?function(i,r,o){return Buffer.isBuffer(i)?i.toString("utf8",r,o):kc(i,r,o)}:kc,dh=function(e,i){var r=ai(e,i);return r>0?jo(e,i+4,i+4+r-1):""},Fl=dh,Cc=function(e,i){var r=ai(e,i);return r>0?jo(e,i+4,i+4+r-1):""},Dl=Cc,xf=function(e,i){var r=2*ai(e,i);return r>0?jo(e,i+4,i+4+r-1):""},ph=xf,Cu=function(i,r){var o=ai(i,r);return o>0?Sc(i,r+4,r+4+o):""},qo=Cu,Iu=function(e,i){var r=ai(e,i);return r>0?jo(e,i+4,i+4+r):""},Ic=Iu,Ln=function(e,i){return function gf(e,i){for(var r=1-2*(e[i+7]>>>7),o=((127&e[i+7])<<4)+(e[i+6]>>>4&15),c=15&e[i+6],x=5;x>=0;--x)c=256*c+e[i+x];return 2047==o?0==c?r*(1/0):NaN:(0==o?o=-1022:(o-=1023,c+=Math.pow(2,52)),r*Math.pow(2,o-52)*c)}(e,i)},bn=Ln,Go=function(i){return Array.isArray(i)||"undefined"!=typeof Uint8Array&&i instanceof Uint8Array};_r&&(Fl=function(i,r){if(!Buffer.isBuffer(i))return dh(i,r);var o=i.readUInt32LE(r);return o>0?i.toString("utf8",r+4,r+4+o-1):""},Dl=function(i,r){if(!Buffer.isBuffer(i))return Cc(i,r);var o=i.readUInt32LE(r);return o>0?i.toString("utf8",r+4,r+4+o-1):""},ph=function(i,r){if(!Buffer.isBuffer(i))return xf(i,r);var o=2*i.readUInt32LE(r);return i.toString("utf16le",r+4,r+4+o-1)},qo=function(i,r){if(!Buffer.isBuffer(i))return Cu(i,r);var o=i.readUInt32LE(r);return i.toString("utf16le",r+4,r+4+o)},Ic=function(i,r){if(!Buffer.isBuffer(i))return Iu(i,r);var o=i.readUInt32LE(r);return i.toString("utf8",r+4,r+4+o)},bn=function(i,r){return Buffer.isBuffer(i)?i.readDoubleLE(r):Ln(i,r)},Go=function(i){return Buffer.isBuffer(i)||Array.isArray(i)||"undefined"!=typeof Uint8Array&&i instanceof Uint8Array});var Ys=function(e,i){return e[i]},xa=function(e,i){return 256*e[i+1]+e[i]},Pl=function(e,i){var r=256*e[i+1]+e[i];return r<32768?r:-1*(65535-r+1)},ai=function(e,i){return e[i+3]*(1<<24)+(e[i+2]<<16)+(e[i+1]<<8)+e[i]},qr=function(e,i){return e[i+3]<<24|e[i+2]<<16|e[i+1]<<8|e[i]},Mc=function(e,i){return e[i]<<24|e[i+1]<<16|e[i+2]<<8|e[i+3]};function Ja(e,i){var o,c,y,T,C,I,r="",x=[];switch(i){case"dbcs":if(I=this.l,_r&&Buffer.isBuffer(this))r=this.slice(this.l,this.l+2*e).toString("utf16le");else for(C=0;C<e;++C)r+=String.fromCharCode(xa(this,I)),I+=2;e*=2;break;case"utf8":r=jo(this,this.l,this.l+e);break;case"utf16le":r=Sc(this,this.l,this.l+(e*=2));break;case"wstr":return Ja.call(this,e,"dbcs");case"lpstr-ansi":r=Fl(this,this.l),e=4+ai(this,this.l);break;case"lpstr-cp":r=Dl(this,this.l),e=4+ai(this,this.l);break;case"lpwstr":r=ph(this,this.l),e=4+2*ai(this,this.l);break;case"lpp4":e=4+ai(this,this.l),r=qo(this,this.l),2&e&&(e+=2);break;case"8lpp4":e=4+ai(this,this.l),r=Ic(this,this.l),3&e&&(e+=4-(3&e));break;case"cstr":for(e=0,r="";0!==(y=Ys(this,this.l+e++));)x.push(In(y));r=x.join("");break;case"_wstr":for(e=0,r="";0!==(y=xa(this,this.l+e));)x.push(In(y)),e+=2;e+=2,r=x.join("");break;case"dbcs-cont":for(r="",I=this.l,C=0;C<e;++C){if(this.lens&&-1!==this.lens.indexOf(I))return y=Ys(this,I),this.l=I+1,T=Ja.call(this,e-C,y?"dbcs-cont":"sbcs-cont"),x.join("")+T;x.push(In(xa(this,I))),I+=2}r=x.join(""),e*=2;break;case"cpstr":0;case"sbcs-cont":for(r="",I=this.l,C=0;C!=e;++C){if(this.lens&&-1!==this.lens.indexOf(I))return y=Ys(this,I),this.l=I+1,T=Ja.call(this,e-C,y?"dbcs-cont":"sbcs-cont"),x.join("")+T;x.push(In(Ys(this,I))),I+=1}r=x.join("");break;default:switch(e){case 1:return o=Ys(this,this.l),this.l++,o;case 2:return o=("i"===i?Pl:xa)(this,this.l),this.l+=2,o;case 4:case-4:return"i"===i||0==(128&this[this.l+3])?(o=(e>0?qr:Mc)(this,this.l),this.l+=4,o):(c=ai(this,this.l),this.l+=4,c);case 8:case-8:if("f"===i)return c=8==e?bn(this,this.l):bn([this[this.l+7],this[this.l+6],this[this.l+5],this[this.l+4],this[this.l+3],this[this.l+2],this[this.l+1],this[this.l+0]],0),this.l+=8,c;e=8;case 16:r=ku(this,this.l,e)}}return this.l+=e,r}var u=function(e,i,r){e[r]=255&i,e[r+1]=i>>>8&255};function m(e,i,r){var o=0,c=0;if("dbcs"===r){for(c=0;c!=i.length;++c)u(this,i.charCodeAt(c),this.l+2*c);o=2*i.length}else if("sbcs"===r){for(i=i.replace(/[^\x00-\x7F]/g,"_"),c=0;c!=i.length;++c)this[this.l+c]=255&i.charCodeAt(c);o=i.length}else{if("hex"===r){for(;c<e;++c)this[this.l++]=parseInt(i.slice(2*c,2*c+2),16)||0;return this}if("utf16le"===r){var y=Math.min(this.l+e,this.length);for(c=0;c<Math.min(i.length,e);++c){var T=i.charCodeAt(c);this[this.l++]=255&T,this[this.l++]=T>>8}for(;this.l<y;)this[this.l++]=0;return this}switch(e){case 1:o=1,this[this.l]=255&i;break;case 2:o=2,this[this.l]=255&i,this[this.l+1]=255&(i>>>=8);break;case 3:o=3,this[this.l]=255&i,this[this.l+1]=255&(i>>>=8),this[this.l+2]=255&(i>>>=8);break;case 4:o=4,function(e,i,r){e[r]=255&i,e[r+1]=i>>>8&255,e[r+2]=i>>>16&255,e[r+3]=i>>>24&255}(this,i,this.l);break;case 8:if(o=8,"f"===r){!function Ec(e,i,r){var o=(i<0||1/i==-1/0?1:0)<<7,c=0,x=0,y=o?-i:i;isFinite(y)?0==y?c=x=0:(c=Math.floor(Math.log(y)/Math.LN2),x=y*Math.pow(2,52-c),c<=-1023&&(!isFinite(x)||x<Math.pow(2,52))?c=-1022:(x-=Math.pow(2,52),c+=1023)):(c=2047,x=isNaN(i)?26985:0);for(var T=0;T<=5;++T,x/=256)e[r+T]=255&x;e[r+6]=(15&c)<<4|15&x,e[r+7]=c>>4|o}(this,i,this.l);break}case 16:break;case-4:o=4,function(e,i,r){e[r]=255&i,e[r+1]=i>>8&255,e[r+2]=i>>16&255,e[r+3]=i>>24&255}(this,i,this.l)}}return this.l+=o,this}function w(e,i){var r=ku(this,this.l,e.length>>1);if(r!==e)throw new Error(i+"Expected "+e+" saw "+r);this.l+=e.length>>1}function b(e,i){e.l=i,e.read_shift=Ja,e.chk=w,e.write_shift=m}function S(e,i){e.l+=i}function A(e){var i=en(e);return b(i,0),i}function O(){var e=[],i=_r?256:2048,r=function(I){var F=A(I);return b(F,0),F},o=r(i),c=function(){!o||(o.length>o.l&&((o=o.slice(0,o.l)).l=o.length),o.length>0&&e.push(o),o=null)},x=function(I){return o&&I<o.length-o.l?o:(c(),o=r(Math.max(I+1,i)))};return{next:x,push:function(I){c(),null==(o=I).l&&(o.l=o.length),x(i)},end:function(){return c(),Bi(e)},_bufs:e}}function L(e,i,r,o){var x,c=+i;if(!isNaN(c)){o||(o=d0[c].p||(r||[]).length||0),x=1+(c>=128?1:0)+1,o>=128&&++x,o>=16384&&++x,o>=2097152&&++x;var y=e.next(x);c<=127?y.write_shift(1,c):(y.write_shift(1,128+(127&c)),y.write_shift(1,c>>7));for(var T=0;4!=T;++T){if(!(o>=128)){y.write_shift(1,o);break}y.write_shift(1,128+(127&o)),o>>=7}o>0&&Go(r)&&e.push(r)}}function V(e,i,r){var o=Kr(e);if(i.s?(o.cRel&&(o.c+=i.s.c),o.rRel&&(o.r+=i.s.r)):(o.cRel&&(o.c+=i.c),o.rRel&&(o.r+=i.r)),!r||r.biff<12){for(;o.c>=256;)o.c-=256;for(;o.r>=65536;)o.r-=65536}return o}function Y(e,i,r){var o=Kr(e);return o.s=V(o.s,i.s,r),o.e=V(o.e,i.s,r),o}function te(e,i){if(e.cRel&&e.c<0)for(e=Kr(e);e.c<0;)e.c+=i>8?16384:256;if(e.rRel&&e.r<0)for(e=Kr(e);e.r<0;)e.r+=i>8?1048576:i>5?65536:16384;var r=Le(e);return!e.cRel&&null!=e.cRel&&(r=function le(e){return e.replace(/^([A-Z])/,"$$$1")}(r)),!e.rRel&&null!=e.rRel&&(r=function ie(e){return e.replace(/([A-Z]|^)(\d+)$/,"$1$$$2")}(r)),r}function J(e,i){return 0!=e.s.r||e.s.rRel||e.e.r!=(i.biff>=12?1048575:i.biff>=8?65536:16384)||e.e.rRel?0!=e.s.c||e.s.cRel||e.e.c!=(i.biff>=12?16383:255)||e.e.cRel?te(e.s,i.biff)+":"+te(e.e,i.biff):(e.s.rRel?"":"$")+se(e.s.r)+":"+(e.e.rRel?"":"$")+se(e.e.r):(e.s.cRel?"":"$")+ce(e.s.c)+":"+(e.e.cRel?"":"$")+ce(e.e.c)}function H(e){return parseInt(function he(e){return e.replace(/\$(\d+)$/,"$1")}(e),10)-1}function se(e){return""+(e+1)}function de(e){for(var i=function we(e){return e.replace(/^\$([A-Z])/,"$1")}(e),r=0,o=0;o!==i.length;++o)r=26*r+i.charCodeAt(o)-64;return r-1}function ce(e){if(e<0)throw new Error("invalid column "+e);var i="";for(++e;e;e=Math.floor((e-1)/26))i=String.fromCharCode((e-1)%26+65)+i;return i}function Be(e){for(var i=0,r=0,o=0;o<e.length;++o){var c=e.charCodeAt(o);c>=48&&c<=57?i=10*i+(c-48):c>=65&&c<=90&&(r=26*r+(c-64))}return{c:r-1,r:i-1}}function Le(e){for(var i=e.c+1,r="";i;i=(i-1)/26|0)r=String.fromCharCode((i-1)%26+65)+r;return r+(e.r+1)}function qe(e){var i=e.indexOf(":");return-1==i?{s:Be(e),e:Be(e)}:{s:Be(e.slice(0,i)),e:Be(e.slice(i+1))}}function Qe(e,i){return void 0===i||"number"==typeof i?Qe(e.s,e.e):("string"!=typeof e&&(e=Le(e)),"string"!=typeof i&&(i=Le(i)),e==i?e:e+":"+i)}function ke(e){var i={s:{c:0,r:0},e:{c:0,r:0}},r=0,o=0,c=0,x=e.length;for(r=0;o<x&&!((c=e.charCodeAt(o)-64)<1||c>26);++o)r=26*r+c;for(i.s.c=--r,r=0;o<x&&!((c=e.charCodeAt(o)-48)<0||c>9);++o)r=10*r+c;if(i.s.r=--r,o===x||10!=c)return i.e.c=i.s.c,i.e.r=i.s.r,i;for(++o,r=0;o!=x&&!((c=e.charCodeAt(o)-64)<1||c>26);++o)r=26*r+c;for(i.e.c=--r,r=0;o!=x&&!((c=e.charCodeAt(o)-48)<0||c>9);++o)r=10*r+c;return i.e.r=--r,i}function dt(e,i,r){return null==e||null==e.t||"z"==e.t?"":void 0!==e.w?e.w:("d"==e.t&&!e.z&&r&&r.dateNF&&(e.z=r.dateNF),"e"==e.t?Ho[e.v]||e.v:function gt(e,i){var r="d"==e.t&&i instanceof Date;if(null!=e.z)try{return e.w=vn(e.z,r?Di(i):i)}catch(o){}try{return e.w=vn((e.XF||{}).numFmtId||(r?14:0),r?Di(i):i)}catch(o){return""+i}}(e,null==i?e.v:i))}function It(e,i){var r=i&&i.sheet?i.sheet:"Sheet1",o={};return o[r]=e,{SheetNames:[r],Sheets:o}}function et(e,i,r){var o=r||{},c=e?Array.isArray(e):o.dense,x=e||(c?[]:{}),y=0,T=0;if(x&&null!=o.origin){if("number"==typeof o.origin)y=o.origin;else{var C="string"==typeof o.origin?Be(o.origin):o.origin;y=C.r,T=C.c}x["!ref"]||(x["!ref"]="A1:A1")}var I={s:{c:1e7,r:1e7},e:{c:0,r:0}};if(x["!ref"]){var F=ke(x["!ref"]);I.s.c=F.s.c,I.s.r=F.s.r,I.e.c=Math.max(I.e.c,F.e.c),I.e.r=Math.max(I.e.r,F.e.r),-1==y&&(I.e.r=y=F.e.r+1)}for(var N=0;N!=i.length;++N)if(i[N]){if(!Array.isArray(i[N]))throw new Error("aoa_to_sheet expects an array of arrays");for(var U=0;U!=i[N].length;++U)if(void 0!==i[N][U]){var j={v:i[N][U]},W=y+N,B=T+U;if(I.s.r>W&&(I.s.r=W),I.s.c>B&&(I.s.c=B),I.e.r<W&&(I.e.r=W),I.e.c<B&&(I.e.c=B),!i[N][U]||"object"!=typeof i[N][U]||Array.isArray(i[N][U])||i[N][U]instanceof Date)if(Array.isArray(j.v)&&(j.f=i[N][U][1],j.v=j.v[0]),null===j.v)if(j.f)j.t="n";else if(o.nullError)j.t="e",j.v=0;else{if(!o.sheetStubs)continue;j.t="z"}else"number"==typeof j.v?j.t="n":"boolean"==typeof j.v?j.t="b":j.v instanceof Date?(j.z=o.dateNF||or[14],o.cellDates?(j.t="d",j.w=vn(j.z,Di(j.v))):(j.t="n",j.v=Di(j.v),j.w=vn(j.z,j.v))):j.t="s";else j=i[N][U];if(c)x[W]||(x[W]=[]),x[W][B]&&x[W][B].z&&(j.z=x[W][B].z),x[W][B]=j;else{var X=Le({c:B,r:W});x[X]&&x[X].z&&(j.z=x[X].z),x[X]=j}}}return I.s.c<1e7&&(x["!ref"]=Qe(I)),x}function Mt(e,i){return et(null,e,i)}function Et(e,i){return i||(i=A(4)),i.write_shift(4,e),i}function bt(e){var i=e.read_shift(4);return 0===i?"":e.read_shift(i,"dbcs")}function Ot(e,i){var r=!1;return null==i&&(r=!0,i=A(4+2*e.length)),i.write_shift(4,e.length),e.length>0&&i.write_shift(0,e,"dbcs"),r?i.slice(0,i.l):i}function fr(e){return{ich:e.read_shift(2),ifnt:e.read_shift(2)}}function rr(e,i){var r=e.l,o=e.read_shift(1),c=bt(e),x=[],y={t:c,h:c};if(0!=(1&o)){for(var T=e.read_shift(4),C=0;C!=T;++C)x.push(fr(e));y.r=x}else y.r=[{ich:0,ifnt:0}];return e.l=r+i,y}var vi=rr;function ui(e){var i=e.read_shift(4),r=e.read_shift(2);return r+=e.read_shift(1)<<16,e.l++,{c:i,iStyleRef:r}}function Ki(e,i){return null==i&&(i=A(8)),i.write_shift(-4,e.c),i.write_shift(3,e.iStyleRef||e.s),i.write_shift(1,0),i}function pn(e){var i=e.read_shift(2);return i+=e.read_shift(1)<<16,e.l++,{c:-1,iStyleRef:i}}function Rn(e,i){return null==i&&(i=A(4)),i.write_shift(3,e.iStyleRef||e.s),i.write_shift(1,0),i}var Ks=bt,Qa=Ot;function pi(e){var i=e.read_shift(4);return 0===i||4294967295===i?"":e.read_shift(i,"dbcs")}function mi(e,i){var r=!1;return null==i&&(r=!0,i=A(127)),i.write_shift(4,e.length>0?e.length:4294967295),e.length>0&&i.write_shift(0,e,"dbcs"),r?i.slice(0,i.l):i}var Zr=bt,Ci=pi,On=mi;function hi(e){var i=e.slice(e.l,e.l+4),r=1&i[0],o=2&i[0];e.l+=4;var c=0===o?bn([0,0,0,0,252&i[0],i[1],i[2],i[3]],0):qr(i,0)>>2;return r?c/100:c}function ua(e,i){null==i&&(i=A(4));var r=0,o=0,c=100*e;if(e==(0|e)&&e>=-(1<<29)&&e<1<<29?o=1:c==(0|c)&&c>=-(1<<29)&&c<1<<29&&(o=1,r=1),!o)throw new Error("unsupported RkNumber "+e);i.write_shift(-4,((r?c:e)<<2)+(r+2))}function Ll(e){var i={s:{},e:{}};return i.s.r=e.read_shift(4),i.e.r=e.read_shift(4),i.s.c=e.read_shift(4),i.e.c=e.read_shift(4),i}var fa=Ll,$o=function ha(e,i){return i||(i=A(16)),i.write_shift(4,e.s.r),i.write_shift(4,e.e.r),i.write_shift(4,e.s.c),i.write_shift(4,e.e.c),i};function rn(e){if(e.length-e.l<8)throw"XLS Xnum Buffer underflow";return e.read_shift(8,"f")}function ya(e,i){return(i||A(8)).write_shift(8,e,"f")}function Va(e,i){if(i||(i=A(8)),!e||e.auto)return i.write_shift(4,0),i.write_shift(4,0),i;null!=e.index?(i.write_shift(1,2),i.write_shift(1,e.index)):null!=e.theme?(i.write_shift(1,6),i.write_shift(1,e.theme)):(i.write_shift(1,5),i.write_shift(1,0));var r=e.tint||0;if(r>0?r*=32767:r<0&&(r*=32768),i.write_shift(2,r),e.rgb&&null==e.theme){var o=e.rgb||"FFFFFF";"number"==typeof o&&(o=("000000"+o.toString(16)).slice(-6)),i.write_shift(1,parseInt(o.slice(0,2),16)),i.write_shift(1,parseInt(o.slice(2,4),16)),i.write_shift(1,parseInt(o.slice(4,6),16)),i.write_shift(1,255)}else i.write_shift(2,0),i.write_shift(1,0),i.write_shift(1,0);return i}var pd={1:{n:"CodePage",t:2},2:{n:"Category",t:80},3:{n:"PresentationFormat",t:80},4:{n:"ByteCount",t:3},5:{n:"LineCount",t:3},6:{n:"ParagraphCount",t:3},7:{n:"SlideCount",t:3},8:{n:"NoteCount",t:3},9:{n:"HiddenCount",t:3},10:{n:"MultimediaClipCount",t:3},11:{n:"ScaleCrop",t:11},12:{n:"HeadingPairs",t:4108},13:{n:"TitlesOfParts",t:4126},14:{n:"Manager",t:80},15:{n:"Company",t:80},16:{n:"LinksUpToDate",t:11},17:{n:"CharacterCount",t:3},19:{n:"SharedDoc",t:11},22:{n:"HyperlinksChanged",t:11},23:{n:"AppVersion",t:3,p:"version"},24:{n:"DigSig",t:65},26:{n:"ContentType",t:80},27:{n:"ContentStatus",t:80},28:{n:"Language",t:80},29:{n:"Version",t:80},255:{},2147483648:{n:"Locale",t:19},2147483651:{n:"Behavior",t:19},1919054434:{}},md={1:{n:"CodePage",t:2},2:{n:"Title",t:80},3:{n:"Subject",t:80},4:{n:"Author",t:80},5:{n:"Keywords",t:80},6:{n:"Comments",t:80},7:{n:"Template",t:80},8:{n:"LastAuthor",t:80},9:{n:"RevNumber",t:80},10:{n:"EditTime",t:64},11:{n:"LastPrinted",t:64},12:{n:"CreatedDate",t:64},13:{n:"ModifiedDate",t:64},14:{n:"PageCount",t:3},15:{n:"WordCount",t:3},16:{n:"CharCount",t:3},17:{n:"Thumbnail",t:71},18:{n:"Application",t:80},19:{n:"DocSecurity",t:3},255:{},2147483648:{n:"Locale",t:19},2147483651:{n:"Behavior",t:19},1919054434:{}};function T0(e){return e.map(function(i){return[i>>16&255,i>>8&255,255&i]})}var Bn=Kr(T0([0,16777215,16711680,65280,255,16776960,16711935,65535,0,16777215,16711680,65280,255,16776960,16711935,65535,8388608,32768,128,8421376,8388736,32896,12632256,8421504,10066431,10040166,16777164,13434879,6684774,16744576,26316,13421823,128,16711935,16776960,65535,8388736,8388608,32896,255,52479,13434879,13434828,16777113,10079487,16751052,13408767,16764057,3368703,3394764,10079232,16763904,16750848,16737792,6710937,9868950,13158,3381606,13056,3355392,10040064,10040166,3355545,3355443,16777215,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0])),Ho={0:"#NULL!",7:"#DIV/0!",15:"#VALUE!",23:"#REF!",29:"#NAME?",36:"#NUM!",42:"#N/A",43:"#GETTING_DATA",255:"#WTF?"},wi={"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet.main+xml":"workbooks","application/vnd.ms-excel.sheet.macroEnabled.main+xml":"workbooks","application/vnd.ms-excel.sheet.binary.macroEnabled.main":"workbooks","application/vnd.ms-excel.addin.macroEnabled.main+xml":"workbooks","application/vnd.openxmlformats-officedocument.spreadsheetml.template.main+xml":"workbooks","application/vnd.openxmlformats-officedocument.spreadsheetml.worksheet+xml":"sheets","application/vnd.ms-excel.worksheet":"sheets","application/vnd.ms-excel.binIndexWs":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.chartsheet+xml":"charts","application/vnd.ms-excel.chartsheet":"charts","application/vnd.ms-excel.macrosheet+xml":"macros","application/vnd.ms-excel.macrosheet":"macros","application/vnd.ms-excel.intlmacrosheet":"TODO","application/vnd.ms-excel.binIndexMs":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.dialogsheet+xml":"dialogs","application/vnd.ms-excel.dialogsheet":"dialogs","application/vnd.openxmlformats-officedocument.spreadsheetml.sharedStrings+xml":"strs","application/vnd.ms-excel.sharedStrings":"strs","application/vnd.openxmlformats-officedocument.spreadsheetml.styles+xml":"styles","application/vnd.ms-excel.styles":"styles","application/vnd.openxmlformats-package.core-properties+xml":"coreprops","application/vnd.openxmlformats-officedocument.custom-properties+xml":"custprops","application/vnd.openxmlformats-officedocument.extended-properties+xml":"extprops","application/vnd.openxmlformats-officedocument.customXmlProperties+xml":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.customProperty":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.comments+xml":"comments","application/vnd.ms-excel.comments":"comments","application/vnd.ms-excel.threadedcomments+xml":"threadedcomments","application/vnd.ms-excel.person+xml":"people","application/vnd.openxmlformats-officedocument.spreadsheetml.sheetMetadata+xml":"metadata","application/vnd.ms-excel.sheetMetadata":"metadata","application/vnd.ms-excel.pivotTable":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.pivotTable+xml":"TODO","application/vnd.openxmlformats-officedocument.drawingml.chart+xml":"TODO","application/vnd.ms-office.chartcolorstyle+xml":"TODO","application/vnd.ms-office.chartstyle+xml":"TODO","application/vnd.ms-office.chartex+xml":"TODO","application/vnd.ms-excel.calcChain":"calcchains","application/vnd.openxmlformats-officedocument.spreadsheetml.calcChain+xml":"calcchains","application/vnd.openxmlformats-officedocument.spreadsheetml.printerSettings":"TODO","application/vnd.ms-office.activeX":"TODO","application/vnd.ms-office.activeX+xml":"TODO","application/vnd.ms-excel.attachedToolbars":"TODO","application/vnd.ms-excel.connections":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.connections+xml":"TODO","application/vnd.ms-excel.externalLink":"links","application/vnd.openxmlformats-officedocument.spreadsheetml.externalLink+xml":"links","application/vnd.ms-excel.pivotCacheDefinition":"TODO","application/vnd.ms-excel.pivotCacheRecords":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.pivotCacheDefinition+xml":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.pivotCacheRecords+xml":"TODO","application/vnd.ms-excel.queryTable":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.queryTable+xml":"TODO","application/vnd.ms-excel.userNames":"TODO","application/vnd.ms-excel.revisionHeaders":"TODO","application/vnd.ms-excel.revisionLog":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.revisionHeaders+xml":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.revisionLog+xml":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.userNames+xml":"TODO","application/vnd.ms-excel.tableSingleCells":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.tableSingleCells+xml":"TODO","application/vnd.ms-excel.slicer":"TODO","application/vnd.ms-excel.slicerCache":"TODO","application/vnd.ms-excel.slicer+xml":"TODO","application/vnd.ms-excel.slicerCache+xml":"TODO","application/vnd.ms-excel.wsSortMap":"TODO","application/vnd.ms-excel.table":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.table+xml":"TODO","application/vnd.openxmlformats-officedocument.theme+xml":"themes","application/vnd.openxmlformats-officedocument.themeOverride+xml":"TODO","application/vnd.ms-excel.Timeline+xml":"TODO","application/vnd.ms-excel.TimelineCache+xml":"TODO","application/vnd.ms-office.vbaProject":"vba","application/vnd.ms-office.vbaProjectSignature":"TODO","application/vnd.ms-office.volatileDependencies":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.volatileDependencies+xml":"TODO","application/vnd.ms-excel.controlproperties+xml":"TODO","application/vnd.openxmlformats-officedocument.model+data":"TODO","application/vnd.ms-excel.Survey+xml":"TODO","application/vnd.openxmlformats-officedocument.drawing+xml":"drawings","application/vnd.openxmlformats-officedocument.drawingml.chartshapes+xml":"TODO","application/vnd.openxmlformats-officedocument.drawingml.diagramColors+xml":"TODO","application/vnd.openxmlformats-officedocument.drawingml.diagramData+xml":"TODO","application/vnd.openxmlformats-officedocument.drawingml.diagramLayout+xml":"TODO","application/vnd.openxmlformats-officedocument.drawingml.diagramStyle+xml":"TODO","application/vnd.openxmlformats-officedocument.vmlDrawing":"TODO","application/vnd.openxmlformats-package.relationships+xml":"rels","application/vnd.openxmlformats-officedocument.oleObject":"TODO","image/png":"TODO",sheet:"js"},hr={workbooks:{xlsx:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet.main+xml",xlsm:"application/vnd.ms-excel.sheet.macroEnabled.main+xml",xlsb:"application/vnd.ms-excel.sheet.binary.macroEnabled.main",xlam:"application/vnd.ms-excel.addin.macroEnabled.main+xml",xltx:"application/vnd.openxmlformats-officedocument.spreadsheetml.template.main+xml"},strs:{xlsx:"application/vnd.openxmlformats-officedocument.spreadsheetml.sharedStrings+xml",xlsb:"application/vnd.ms-excel.sharedStrings"},comments:{xlsx:"application/vnd.openxmlformats-officedocument.spreadsheetml.comments+xml",xlsb:"application/vnd.ms-excel.comments"},sheets:{xlsx:"application/vnd.openxmlformats-officedocument.spreadsheetml.worksheet+xml",xlsb:"application/vnd.ms-excel.worksheet"},charts:{xlsx:"application/vnd.openxmlformats-officedocument.spreadsheetml.chartsheet+xml",xlsb:"application/vnd.ms-excel.chartsheet"},dialogs:{xlsx:"application/vnd.openxmlformats-officedocument.spreadsheetml.dialogsheet+xml",xlsb:"application/vnd.ms-excel.dialogsheet"},macros:{xlsx:"application/vnd.ms-excel.macrosheet+xml",xlsb:"application/vnd.ms-excel.macrosheet"},metadata:{xlsx:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheetMetadata+xml",xlsb:"application/vnd.ms-excel.sheetMetadata"},styles:{xlsx:"application/vnd.openxmlformats-officedocument.spreadsheetml.styles+xml",xlsb:"application/vnd.ms-excel.styles"}};function Jr(e,i){var c,r=function gu(e){for(var i=[],r=Fi(e),o=0;o!==r.length;++o)null==i[e[r[o]]]&&(i[e[r[o]]]=[]),i[e[r[o]]].push(r[o]);return i}(wi),o=[];o[o.length]=xi,o[o.length]=At("Types",null,{xmlns:"http://schemas.openxmlformats.org/package/2006/content-types","xmlns:xsd":"http://www.w3.org/2001/XMLSchema","xmlns:xsi":Pi_xsi}),o=o.concat([["xml","application/xml"],["bin","application/vnd.ms-excel.sheet.binary.macroEnabled.main"],["vml","application/vnd.openxmlformats-officedocument.vmlDrawing"],["data","application/vnd.openxmlformats-officedocument.model+data"],["bmp","image/bmp"],["png","image/png"],["gif","image/gif"],["emf","image/x-emf"],["wmf","image/x-wmf"],["jpg","image/jpeg"],["jpeg","image/jpeg"],["tif","image/tiff"],["tiff","image/tiff"],["pdf","application/pdf"],["rels","application/vnd.openxmlformats-package.relationships+xml"]].map(function(C){return At("Default",null,{Extension:C[0],ContentType:C[1]})}));var x=function(C){e[C]&&e[C].length>0&&(o[o.length]=At("Override",null,{PartName:("/"==(c=e[C][0])[0]?"":"/")+c,ContentType:hr[C][i.bookType]||hr[C].xlsx}))},y=function(C){(e[C]||[]).forEach(function(I){o[o.length]=At("Override",null,{PartName:("/"==I[0]?"":"/")+I,ContentType:hr[C][i.bookType]||hr[C].xlsx})})},T=function(C){(e[C]||[]).forEach(function(I){o[o.length]=At("Override",null,{PartName:("/"==I[0]?"":"/")+I,ContentType:r[C][0]})})};return x("workbooks"),y("sheets"),y("charts"),T("themes"),["strs","styles"].forEach(x),["coreprops","extprops","custprops"].forEach(T),T("vba"),T("comments"),T("threadedcomments"),T("drawings"),y("metadata"),T("people"),o.length>2&&(o[o.length]="</Types>",o[1]=o[1].replace("/>",">")),o.join("")}var Ar={WB:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/officeDocument",SHEET:"http://sheetjs.openxmlformats.org/officeDocument/2006/relationships/officeDocument",HLINK:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/hyperlink",VML:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/vmlDrawing",XPATH:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/externalLinkPath",XMISS:"http://schemas.microsoft.com/office/2006/relationships/xlExternalLinkPath/xlPathMissing",XLINK:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/externalLink",CXML:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/customXml",CXMLP:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/customXmlProps",CMNT:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/comments",CORE_PROPS:"http://schemas.openxmlformats.org/package/2006/relationships/metadata/core-properties",EXT_PROPS:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/extended-properties",CUST_PROPS:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/custom-properties",SST:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/sharedStrings",STY:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/styles",THEME:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/theme",CHART:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/chart",CHARTEX:"http://schemas.microsoft.com/office/2014/relationships/chartEx",CS:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/chartsheet",WS:["http://schemas.openxmlformats.org/officeDocument/2006/relationships/worksheet","http://purl.oclc.org/ooxml/officeDocument/relationships/worksheet"],DS:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/dialogsheet",MS:"http://schemas.microsoft.com/office/2006/relationships/xlMacrosheet",IMG:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/image",DRAW:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/drawing",XLMETA:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/sheetMetadata",TCMNT:"http://schemas.microsoft.com/office/2017/10/relationships/threadedComment",PEOPLE:"http://schemas.microsoft.com/office/2017/10/relationships/person",VBA:"http://schemas.microsoft.com/office/2006/relationships/vbaProject"};function Dc(e){var i=e.lastIndexOf("/");return e.slice(0,i+1)+"_rels/"+e.slice(i+1)+".rels"}function gs(e){var i=[xi,At("Relationships",null,{xmlns:"http://schemas.openxmlformats.org/package/2006/relationships"})];return Fi(e["!id"]).forEach(function(r){i[i.length]=At("Relationship",null,e["!id"][r])}),i.length>2&&(i[i.length]="</Relationships>",i[1]=i[1].replace("/>",">")),i.join("")}function Wr(e,i,r,o,c,x){if(c||(c={}),e["!id"]||(e["!id"]={}),e["!idx"]||(e["!idx"]=1),i<0)for(i=e["!idx"];e["!id"]["rId"+i];++i);if(e["!idx"]=i+1,c.Id="rId"+i,c.Type=o,c.Target=r,x?c.TargetMode=x:[Ar.HLINK,Ar.XPATH,Ar.XMISS].indexOf(c.Type)>-1&&(c.TargetMode="External"),e["!id"][c.Id])throw new Error("Cannot rewrite rId "+i);return e["!id"][c.Id]=c,e[("/"+c.Target).replace("//","/")]=c,i}function xs(e,i,r){return['  <rdf:Description rdf:about="'+e+'">\n','    <rdf:type rdf:resource="http://docs.oasis-open.org/ns/office/1.2/meta/'+(r||"odf")+"#"+i+'"/>\n',"  </rdf:Description>\n"].join("")}function Ef(e,i){return['  <rdf:Description rdf:about="'+e+'">\n','    <ns0:hasPart xmlns:ns0="http://docs.oasis-open.org/ns/office/1.2/meta/pkg#" rdf:resource="'+i+'"/>\n',"  </rdf:Description>\n"].join("")}function S0(){return'<office:document-meta xmlns:office="urn:oasis:names:tc:opendocument:xmlns:office:1.0" xmlns:meta="urn:oasis:names:tc:opendocument:xmlns:meta:1.0" xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:xlink="http://www.w3.org/1999/xlink" office:version="1.2"><office:meta><meta:generator>SheetJS '+yn_version+"</meta:generator></office:meta></office:document-meta>"}var ys=[["cp:category","Category"],["cp:contentStatus","ContentStatus"],["cp:keywords","Keywords"],["cp:lastModifiedBy","LastAuthor"],["cp:lastPrinted","LastPrinted"],["cp:revision","RevNumber"],["cp:version","Version"],["dc:creator","Author"],["dc:description","Comments"],["dc:identifier","Identifier"],["dc:language","Language"],["dc:subject","Subject"],["dc:title","Title"],["dcterms:created","CreatedDate","date"],["dcterms:modified","ModifiedDate","date"]];function vs(e,i,r,o,c){null!=c[e]||null==i||""===i||(c[e]=i,i=ni(i),o[o.length]=r?At(e,i,r):tn(e,i))}function Rl(e,i){var r=i||{},o=[xi,At("cp:coreProperties",null,{"xmlns:cp":"http://schemas.openxmlformats.org/package/2006/metadata/core-properties","xmlns:dc":"http://purl.org/dc/elements/1.1/","xmlns:dcterms":"http://purl.org/dc/terms/","xmlns:dcmitype":"http://purl.org/dc/dcmitype/","xmlns:xsi":Pi_xsi})],c={};if(!e&&!r.Props)return o.join("");e&&(null!=e.CreatedDate&&vs("dcterms:created","string"==typeof e.CreatedDate?e.CreatedDate:Tc(e.CreatedDate,r.WTF),{"xsi:type":"dcterms:W3CDTF"},o,c),null!=e.ModifiedDate&&vs("dcterms:modified","string"==typeof e.ModifiedDate?e.ModifiedDate:Tc(e.ModifiedDate,r.WTF),{"xsi:type":"dcterms:W3CDTF"},o,c));for(var x=0;x!=ys.length;++x){var y=ys[x],T=r.Props&&null!=r.Props[y[1]]?r.Props[y[1]]:e?e[y[1]]:null;!0===T?T="1":!1===T?T="0":"number"==typeof T&&(T=String(T)),null!=T&&vs(y[0],T,null,o,c)}return o.length>2&&(o[o.length]="</cp:coreProperties>",o[1]=o[1].replace("/>",">")),o.join("")}var Qs=[["Application","Application","string"],["AppVersion","AppVersion","string"],["Company","Company","string"],["DocSecurity","DocSecurity","string"],["Manager","Manager","string"],["HyperlinksChanged","HyperlinksChanged","bool"],["SharedDoc","SharedDoc","bool"],["LinksUpToDate","LinksUpToDate","bool"],["ScaleCrop","ScaleCrop","bool"],["HeadingPairs","HeadingPairs","raw"],["TitlesOfParts","TitlesOfParts","raw"]],yh=["Worksheets","SheetNames","NamedRanges","DefinedNames","Chartsheets","ChartNames"];function I0(e){var i=[],r=At;return e||(e={}),e.Application="SheetJS",i[i.length]=xi,i[i.length]=At("Properties",null,{xmlns:"http://schemas.openxmlformats.org/officeDocument/2006/extended-properties","xmlns:vt":Pi_vt}),Qs.forEach(function(o){if(void 0!==e[o[1]]){var c;switch(o[2]){case"string":c=ni(String(e[o[1]]));break;case"bool":c=e[o[1]]?"true":"false"}void 0!==c&&(i[i.length]=r(o[0],c))}}),i[i.length]=r("HeadingPairs",r("vt:vector",r("vt:variant","<vt:lpstr>Worksheets</vt:lpstr>")+r("vt:variant",r("vt:i4",String(e.Worksheets))),{size:2,baseType:"variant"})),i[i.length]=r("TitlesOfParts",r("vt:vector",e.SheetNames.map(function(o){return"<vt:lpstr>"+ni(o)+"</vt:lpstr>"}).join(""),{size:e.Worksheets,baseType:"lpstr"})),i.length>2&&(i[i.length]="</Properties>",i[1]=i[1].replace("/>",">")),i.join("")}function Af(e){var i=[xi,At("Properties",null,{xmlns:"http://schemas.openxmlformats.org/officeDocument/2006/custom-properties","xmlns:vt":Pi_vt})];if(!e)return i.join("");var r=1;return Fi(e).forEach(function(c){++r,i[i.length]=At("property",function _f(e,i){switch(typeof e){case"string":var r=At("vt:lpwstr",ni(e));return i&&(r=r.replace(/&quot;/g,"_x0022_")),r;case"number":return At((0|e)==e?"vt:i4":"vt:r8",ni(String(e)));case"boolean":return At("vt:bool",e?"true":"false")}if(e instanceof Date)return At("vt:filetime",Tc(e));throw new Error("Unable to serialize "+e)}(e[c],!0),{fmtid:"{D5CDD505-2E9C-101B-9397-08002B2CF9AE}",pid:r,name:ni(c)})}),i.length>2&&(i[i.length]="</Properties>",i[1]=i[1].replace("/>",">")),i.join("")}var xd={Title:"Title",Subject:"Subject",Author:"Author",Keywords:"Keywords",Comments:"Description",LastAuthor:"LastAuthor",RevNumber:"Revision",Application:"AppName",LastPrinted:"LastPrinted",CreatedDate:"Created",ModifiedDate:"LastSaved",Category:"Category",Manager:"Manager",Company:"Company",AppVersion:"Version",ContentStatus:"ContentStatus",Identifier:"Identifier",Language:"Language"};function Mf(e,i){var r=A(4),o=A(4);switch(r.write_shift(4,80==e?31:e),e){case 3:o.write_shift(-4,i);break;case 5:(o=A(8)).write_shift(8,i,"f");break;case 11:o.write_shift(4,i?1:0);break;case 64:o=function km(e){var r=("string"==typeof e?new Date(Date.parse(e)):e).getTime()/1e3+11644473600,o=r%Math.pow(2,32),c=(r-o)/Math.pow(2,32);c*=1e7;var x=(o*=1e7)/Math.pow(2,32)|0;x>0&&(o%=Math.pow(2,32),c+=x);var y=A(8);return y.write_shift(4,o),y.write_shift(4,c),y}(i);break;case 31:case 80:for((o=A(4+2*(i.length+1)+(i.length%2?0:2))).write_shift(4,i.length+1),o.write_shift(0,i,"dbcs");o.l!=o.length;)o.write_shift(1,0);break;default:throw new Error("TypedPropertyValue unrecognized type "+e+" "+i)}return Bi([r,o])}var L0=["CodePage","Thumbnail","_PID_LINKBASE","_PID_HLINKS","SystemIdentifier","FMTID"];function wd(e){switch(typeof e){case"boolean":return 11;case"number":return(0|e)==e?3:5;case"string":return 31;case"object":if(e instanceof Date)return 64}return-1}function bd(e,i,r){var o=A(8),c=[],x=[],y=8,T=0,C=A(8),I=A(8);if(C.write_shift(4,2),C.write_shift(4,1200),I.write_shift(4,1),x.push(C),c.push(I),y+=8+C.length,!i){(I=A(8)).write_shift(4,0),c.unshift(I);var F=[A(4)];for(F[0].write_shift(4,e.length),T=0;T<e.length;++T){var N=e[T][0];for((C=A(8+2*(N.length+1)+(N.length%2?0:2))).write_shift(4,T+2),C.write_shift(4,N.length+1),C.write_shift(0,N,"dbcs");C.l!=C.length;)C.write_shift(1,0);F.push(C)}C=Bi(F),x.unshift(C),y+=8+C.length}for(T=0;T<e.length;++T)if((!i||i[e[T][0]])&&!(L0.indexOf(e[T][0])>-1||yh.indexOf(e[T][0])>-1)&&null!=e[T][1]){var U=e[T][1],j=0;if(i){var W=r[j=+i[e[T][0]]];if("version"==W.p&&"string"==typeof U){var B=U.split(".");U=(+B[0]<<16)+(+B[1]||0)}C=Mf(W.t,U)}else{var X=wd(U);-1==X&&(X=31,U=String(U)),C=Mf(X,U)}x.push(C),(I=A(8)).write_shift(4,i?j:2+T),c.push(I),y+=8+C.length}var _e=8*(x.length+1);for(T=0;T<x.length;++T)c[T].write_shift(4,_e),_e+=x[T].length;return o.write_shift(4,y),o.write_shift(4,x.length),Bi([o].concat(c).concat(x))}function Fu(e,i,r,o,c,x){var y=A(c?68:48),T=[y];y.write_shift(2,65534),y.write_shift(2,0),y.write_shift(4,842412599),y.write_shift(16,ar.utils.consts.HEADER_CLSID,"hex"),y.write_shift(4,c?2:1),y.write_shift(16,i,"hex"),y.write_shift(4,c?68:48);var C=bd(e,r,o);if(T.push(C),c){var I=bd(c,null,null);y.write_shift(16,x,"hex"),y.write_shift(4,68+C.length),T.push(I)}return Bi(T)}function Nn(e,i){return i||(i=A(2)),i.write_shift(2,+!!e),i}function Li(e){return e.read_shift(2,"u")}function wa(e,i){return i||(i=A(2)),i.write_shift(2,e),i}function Ed(e,i,r){return r||(r=A(2)),r.write_shift(1,"e"==i?+e:+!!e),r.write_shift(1,"e"==i?1:0),r}function Ts(e,i,r){var o=e.read_shift(r&&r.biff>=12?2:1),c="sbcs-cont",x=Lr;r&&r.biff>=8&&(Lr=1200),r&&8!=r.biff?12==r.biff&&(c="wstr"):e.read_shift(1)&&(c="dbcs-cont"),r.biff>=2&&r.biff<=5&&(c="cpstr");var T=o?e.read_shift(o,c):"";return Lr=x,T}function Th(e){var i=e.t||"",o=A(3);o.write_shift(2,i.length),o.write_shift(1,1);var c=A(2*i.length);return c.write_shift(2*i.length,i,"utf16le"),Bi([o,c])}function Oc(e,i,r){return r||(r=A(3+2*e.length)),r.write_shift(2,e.length),r.write_shift(1,1),r.write_shift(31,e,"utf16le"),r}function Ad(e,i){i||(i=A(6+2*e.length)),i.write_shift(4,1+e.length);for(var r=0;r<e.length;++r)i.write_shift(2,e.charCodeAt(r));return i.write_shift(2,0),i}function Z0(e){var i=A(512),r=0,o=e.Target;"file://"==o.slice(0,7)&&(o=o.slice(7));var c=o.indexOf("#"),x=c>-1?31:23;switch(o.charAt(0)){case"#":x=28;break;case".":x&=-3}i.write_shift(4,2),i.write_shift(4,x);var y=[8,6815827,6619237,4849780,83];for(r=0;r<y.length;++r)i.write_shift(4,y[r]);if(28==x)Ad(o=o.slice(1),i);else if(2&x){for(y="e0 c9 ea 79 f9 ba ce 11 8c 82 00 aa 00 4b a9 0b".split(" "),r=0;r<y.length;++r)i.write_shift(1,parseInt(y[r],16));var T=c>-1?o.slice(0,c):o;for(i.write_shift(4,2*(T.length+1)),r=0;r<T.length;++r)i.write_shift(2,T.charCodeAt(r));i.write_shift(2,0),8&x&&Ad(c>-1?o.slice(c+1):"",i)}else{for(y="03 03 00 00 00 00 00 00 c0 00 00 00 00 00 00 46".split(" "),r=0;r<y.length;++r)i.write_shift(1,parseInt(y[r],16));for(var C=0;"../"==o.slice(3*C,3*C+3)||"..\\"==o.slice(3*C,3*C+3);)++C;for(i.write_shift(2,C),i.write_shift(4,o.length-3*C+1),r=0;r<o.length-3*C;++r)i.write_shift(1,255&o.charCodeAt(r+3*C));for(i.write_shift(1,0),i.write_shift(2,65535),i.write_shift(2,57005),r=0;r<6;++r)i.write_shift(4,0)}return i.slice(0,i.l)}function Ol(e,i,r,o){return o||(o=A(6)),o.write_shift(2,e),o.write_shift(2,i),o.write_shift(2,r||0),o}function Jo(e,i,r){var o=r.biff>8?4:2;return[e.read_shift(o),e.read_shift(o,"i"),e.read_shift(o,"i")]}function Pu(e){var i=e.read_shift(2),r=e.read_shift(2);return{s:{c:e.read_shift(2),r:i},e:{c:e.read_shift(2),r}}}function G0(e,i){return i||(i=A(8)),i.write_shift(2,e.s.r),i.write_shift(2,e.e.r),i.write_shift(2,e.s.c),i.write_shift(2,e.e.c),i}function Cd(e,i,r){var o=1536,c=16;switch(r.bookType){case"biff8":case"xla":break;case"biff5":o=1280,c=8;break;case"biff4":o=4,c=6;break;case"biff3":o=3,c=6;break;case"biff2":o=2,c=4;break;default:throw new Error("unsupported BIFF version")}var x=A(c);return x.write_shift(2,o),x.write_shift(2,i),c>4&&x.write_shift(2,29282),c>6&&x.write_shift(2,1997),c>8&&(x.write_shift(2,49161),x.write_shift(2,1),x.write_shift(2,1798),x.write_shift(2,0)),x}function Id(e,i){var r=!i||i.biff>=8?2:1,o=A(8+r*e.name.length);o.write_shift(4,e.pos),o.write_shift(1,e.hs||0),o.write_shift(1,e.dt),o.write_shift(1,e.name.length),i.biff>=8&&o.write_shift(1,1),o.write_shift(r*e.name.length,e.name,i.biff<8?"sbcs":"utf16le");var c=o.slice(0,o.l);return c.l=o.l,c}function jm(e,i,r,o){var c=r&&5==r.biff;o||(o=A(c?3+i.length:5+2*i.length)),o.write_shift(2,e),o.write_shift(c?1:2,i.length),c||o.write_shift(1,1),o.write_shift((c?1:2)*i.length,i,c?"sbcs":"utf16le");var x=o.length>o.l?o.slice(0,o.l):o;return null==x.l&&(x.l=x.length),x}function K0(e,i,r,o){var c=r&&5==r.biff;o||(o=A(c?16:20)),o.write_shift(2,0),e.style?(o.write_shift(2,e.numFmtId||0),o.write_shift(2,65524)):(o.write_shift(2,e.numFmtId||0),o.write_shift(2,i<<4));var x=0;return e.numFmtId>0&&c&&(x|=1024),o.write_shift(4,x),o.write_shift(4,0),c||o.write_shift(4,0),o.write_shift(2,0),o}function n_(e){var i=A(24),r=Be(e[0]);i.write_shift(2,r.r),i.write_shift(2,r.r),i.write_shift(2,r.c),i.write_shift(2,r.c);for(var o="d0 c9 ea 79 f9 ba ce 11 8c 82 00 aa 00 4b a9 0b".split(" "),c=0;c<16;++c)i.write_shift(1,parseInt(o[c],16));return Bi([i,Z0(e[1])])}function Nf(e){var i=e[1].Tooltip,r=A(10+2*(i.length+1));r.write_shift(2,2048);var o=Be(e[0]);r.write_shift(2,o.r),r.write_shift(2,o.r),r.write_shift(2,o.c),r.write_shift(2,o.c);for(var c=0;c<i.length;++c)r.write_shift(2,i.charCodeAt(c));return r.write_shift(2,0),r}var Qr=function(){var e={1:437,2:850,3:1252,4:1e4,100:852,101:866,102:865,103:861,104:895,105:620,106:737,107:857,120:950,121:949,122:936,123:932,124:874,125:1255,126:1256,150:10007,151:10029,152:10006,200:1250,201:1251,202:1254,203:1253,0:20127,8:865,9:437,10:850,11:437,13:437,14:850,15:437,16:850,17:437,18:850,19:932,20:850,21:437,22:850,23:865,24:437,25:437,26:850,27:437,28:863,29:850,31:852,34:852,35:852,36:860,37:850,38:866,55:850,64:852,77:936,78:949,79:950,80:874,87:1252,88:1252,89:1252,108:863,134:737,135:852,136:857,204:1257,255:16969},i=bl({1:437,2:850,3:1252,4:1e4,100:852,101:866,102:865,103:861,104:895,105:620,106:737,107:857,120:950,121:949,122:936,123:932,124:874,125:1255,126:1256,150:10007,151:10029,152:10006,200:1250,201:1251,202:1254,203:1253,0:20127});function o(T,C){var I=C||{};I.dateNF||(I.dateNF="yyyymmdd");var F=Mt(function r(T,C){var I=[],F=en(1);switch(C.type){case"base64":F=Xn(Qi(T));break;case"binary":F=Xn(T);break;case"buffer":case"array":F=T}b(F,0);var N=F.read_shift(1),U=!!(136&N),j=!1,W=!1;switch(N){case 2:case 3:case 131:case 139:case 245:break;case 48:case 49:j=!0,U=!0;break;case 140:W=!0;break;default:throw new Error("DBF Unsupported Version: "+N.toString(16))}var B=0,X=521;2==N&&(B=F.read_shift(2)),F.l+=3,2!=N&&(B=F.read_shift(4)),B>1048576&&(B=1e6),2!=N&&(X=F.read_shift(2));var _e=F.read_shift(2),me=C.codepage||1252;2!=N&&(F.l+=16,F.read_shift(1),0!==F[F.l]&&(me=e[F[F.l]]),F.l+=1,F.l+=2),W&&(F.l+=36);for(var ue=[],Ue={},We=Math.min(F.length,2==N?521:X-10-(j?264:0)),nt=W?32:11;F.l<We&&13!=F[F.l];)switch(Ue={},Ue.name=lr.utils.decode(me,F.slice(F.l,F.l+nt)).replace(/[\u0000\r\n].*$/g,""),F.l+=nt,Ue.type=String.fromCharCode(F.read_shift(1)),2!=N&&!W&&(Ue.offset=F.read_shift(4)),Ue.len=F.read_shift(1),2==N&&(Ue.offset=F.read_shift(2)),Ue.dec=F.read_shift(1),Ue.name.length&&ue.push(Ue),2!=N&&(F.l+=W?13:14),Ue.type){case"B":(!j||8!=Ue.len)&&C.WTF&&console.log("Skipping "+Ue.name+":"+Ue.type);break;case"G":case"P":C.WTF&&console.log("Skipping "+Ue.name+":"+Ue.type);break;case"+":case"0":case"@":case"C":case"D":case"F":case"I":case"L":case"M":case"N":case"O":case"T":case"Y":break;default:throw new Error("Unknown Field Type: "+Ue.type)}if(13!==F[F.l]&&(F.l=X-1),13!==F.read_shift(1))throw new Error("DBF Terminator not found "+F.l+" "+F[F.l]);F.l=X;var Se=0,Ge=0;for(I[0]=[],Ge=0;Ge!=ue.length;++Ge)I[0][Ge]=ue[Ge].name;for(;B-- >0;)if(42!==F[F.l])for(++F.l,I[++Se]=[],Ge=0,Ge=0;Ge!=ue.length;++Ge){var Ve=F.slice(F.l,F.l+ue[Ge].len);F.l+=ue[Ge].len,b(Ve,0);var at=lr.utils.decode(me,Ve);switch(ue[Ge].type){case"C":at.trim().length&&(I[Se][Ge]=at.replace(/\s+$/,""));break;case"D":I[Se][Ge]=8===at.length?new Date(+at.slice(0,4),+at.slice(4,6)-1,+at.slice(6,8)):at;break;case"F":I[Se][Ge]=parseFloat(at.trim());break;case"+":case"I":I[Se][Ge]=W?2147483648^Ve.read_shift(-4,"i"):Ve.read_shift(4,"i");break;case"L":switch(at.trim().toUpperCase()){case"Y":case"T":I[Se][Ge]=!0;break;case"N":case"F":I[Se][Ge]=!1;break;case"":case"?":break;default:throw new Error("DBF Unrecognized L:|"+at+"|")}break;case"M":if(!U)throw new Error("DBF Unexpected MEMO for type "+N.toString(16));I[Se][Ge]="##MEMO##"+(W?parseInt(at.trim(),10):Ve.read_shift(4));break;case"N":(at=at.replace(/\u0000/g,"").trim())&&"."!=at&&(I[Se][Ge]=+at||0);break;case"@":I[Se][Ge]=new Date(Ve.read_shift(-8,"f")-621356832e5);break;case"T":I[Se][Ge]=new Date(864e5*(Ve.read_shift(4)-2440588)+Ve.read_shift(4));break;case"Y":I[Se][Ge]=Ve.read_shift(4,"i")/1e4+Ve.read_shift(4,"i")/1e4*Math.pow(2,32);break;case"O":I[Se][Ge]=-Ve.read_shift(-8,"f");break;case"B":if(j&&8==ue[Ge].len){I[Se][Ge]=Ve.read_shift(8,"f");break}case"G":case"P":Ve.l+=ue[Ge].len;break;case"0":if("_NullFlags"===ue[Ge].name)break;default:throw new Error("DBF Unsupported data type "+ue[Ge].type)}}else F.l+=_e;if(2!=N&&F.l<F.length&&26!=F[F.l++])throw new Error("DBF EOF Marker missing "+(F.l-1)+" of "+F.length+" "+F[F.l-1].toString(16));return C&&C.sheetRows&&(I=I.slice(0,C.sheetRows)),C.DBF=ue,I}(T,I),I);return F["!cols"]=I.DBF.map(function(N){return{wch:N.len,DBF:N}}),delete I.DBF,F}var x={B:8,C:250,L:1,D:8,"?":0,"":0};return{to_workbook:function c(T,C){try{return It(o(T,C),C)}catch(I){if(C&&C.WTF)throw I}return{SheetNames:[],Sheets:{}}},to_sheet:o,from_sheet:function y(T,C){var I=C||{};if(+I.codepage>=0&&Wn(+I.codepage),"string"==I.type)throw new Error("Cannot write DBF to JS string");var F=O(),N=wm(T,{header:1,raw:!0,cellDates:!0}),U=N[0],j=N.slice(1),W=T["!cols"]||[],B=0,X=0,_e=0,me=1;for(B=0;B<U.length;++B)if(((W[B]||{}).DBF||{}).name)U[B]=W[B].DBF.name,++_e;else if(null!=U[B]){if(++_e,"number"==typeof U[B]&&(U[B]=U[B].toString(10)),"string"!=typeof U[B])throw new Error("DBF Invalid column name "+U[B]+" |"+typeof U[B]+"|");if(U.indexOf(U[B])!==B)for(X=0;X<1024;++X)if(-1==U.indexOf(U[B]+"_"+X)){U[B]+="_"+X;break}}var ue=ke(T["!ref"]),Ue=[],We=[],nt=[];for(B=0;B<=ue.e.c-ue.s.c;++B){var Se="",Ge="",Ve=0,at=[];for(X=0;X<j.length;++X)null!=j[X][B]&&at.push(j[X][B]);if(0!=at.length&&null!=U[B]){for(X=0;X<at.length;++X){switch(typeof at[X]){case"number":Ge="B";break;case"string":default:Ge="C";break;case"boolean":Ge="L";break;case"object":Ge=at[X]instanceof Date?"D":"C"}Ve=Math.max(Ve,String(at[X]).length),Se=Se&&Se!=Ge?"C":Ge}Ve>250&&(Ve=250),"C"==(Ge=((W[B]||{}).DBF||{}).type)&&W[B].DBF.len>Ve&&(Ve=W[B].DBF.len),"B"==Se&&"N"==Ge&&(Se="N",nt[B]=W[B].DBF.dec,Ve=W[B].DBF.len),We[B]="C"==Se||"N"==Ge?Ve:x[Se]||0,me+=We[B],Ue[B]=Se}else Ue[B]="?"}var ot=F.next(32);for(ot.write_shift(4,318902576),ot.write_shift(4,j.length),ot.write_shift(2,296+32*_e),ot.write_shift(2,me),B=0;B<4;++B)ot.write_shift(4,0);for(ot.write_shift(4,0|(+i[ko]||3)<<8),B=0,X=0;B<U.length;++B)if(null!=U[B]){var je=F.next(32),Bt=(U[B].slice(-10)+"\0\0\0\0\0\0\0\0\0\0\0").slice(0,11);je.write_shift(1,Bt,"sbcs"),je.write_shift(1,"?"==Ue[B]?"C":Ue[B],"sbcs"),je.write_shift(4,X),je.write_shift(1,We[B]||x[Ue[B]]||0),je.write_shift(1,nt[B]||0),je.write_shift(1,2),je.write_shift(4,0),je.write_shift(1,0),je.write_shift(4,0),je.write_shift(4,0),X+=We[B]||x[Ue[B]]||0}var er=F.next(264);for(er.write_shift(4,13),B=0;B<65;++B)er.write_shift(4,0);for(B=0;B<j.length;++B){var jt=F.next(me);for(jt.write_shift(1,0),X=0;X<U.length;++X)if(null!=U[X])switch(Ue[X]){case"L":jt.write_shift(1,null==j[B][X]?63:j[B][X]?84:70);break;case"B":jt.write_shift(8,j[B][X]||0,"f");break;case"N":var pr="0";for("number"==typeof j[B][X]&&(pr=j[B][X].toFixed(nt[X]||0)),_e=0;_e<We[X]-pr.length;++_e)jt.write_shift(1,32);jt.write_shift(1,pr,"sbcs");break;case"D":j[B][X]?(jt.write_shift(4,("0000"+j[B][X].getFullYear()).slice(-4),"sbcs"),jt.write_shift(2,("00"+(j[B][X].getMonth()+1)).slice(-2),"sbcs"),jt.write_shift(2,("00"+j[B][X].getDate()).slice(-2),"sbcs")):jt.write_shift(8,"00000000","sbcs");break;case"C":var sr=String(null!=j[B][X]?j[B][X]:"").slice(0,We[X]);for(jt.write_shift(1,sr,"sbcs"),_e=0;_e<We[X]-sr.length;++_e)jt.write_shift(1,32)}}return F.next(1).write_shift(1,26),F.end()}}}(),Zf=function(){var e={AA:"\xc0",BA:"\xc1",CA:"\xc2",DA:195,HA:"\xc4",JA:197,AE:"\xc8",BE:"\xc9",CE:"\xca",HE:"\xcb",AI:"\xcc",BI:"\xcd",CI:"\xce",HI:"\xcf",AO:"\xd2",BO:"\xd3",CO:"\xd4",DO:213,HO:"\xd6",AU:"\xd9",BU:"\xda",CU:"\xdb",HU:"\xdc",Aa:"\xe0",Ba:"\xe1",Ca:"\xe2",Da:227,Ha:"\xe4",Ja:229,Ae:"\xe8",Be:"\xe9",Ce:"\xea",He:"\xeb",Ai:"\xec",Bi:"\xed",Ci:"\xee",Hi:"\xef",Ao:"\xf2",Bo:"\xf3",Co:"\xf4",Do:245,Ho:"\xf6",Au:"\xf9",Bu:"\xfa",Cu:"\xfb",Hu:"\xfc",KC:"\xc7",Kc:"\xe7",q:"\xe6",z:"\u0153",a:"\xc6",j:"\u0152",DN:209,Dn:241,Hy:255,S:169,c:170,R:174,"B ":180,0:176,1:177,2:178,3:179,5:181,6:182,7:183,Q:185,k:186,b:208,i:216,l:222,s:240,y:248,"!":161,'"':162,"#":163,"(":164,"%":165,"'":167,"H ":168,"+":171,";":187,"<":188,"=":189,">":190,"?":191,"{":223},i=new RegExp("\x1bN("+Fi(e).join("|").replace(/\|\|\|/,"|\\||").replace(/([?()+])/g,"\\$1")+"|\\|)","gm"),r=function(U,j){var W=e[j];return"number"==typeof W?pl(W):W},o=function(U,j,W){var B=j.charCodeAt(0)-32<<4|W.charCodeAt(0)-48;return 59==B?U:pl(B)};function x(U,j){var ot,W=U.split(/[\n\r]+/),B=-1,X=-1,_e=0,me=0,ue=[],Ue=[],We=null,nt={},Se=[],Ge=[],Ve=[],at=0;for(+j.codepage>=0&&Wn(+j.codepage);_e!==W.length;++_e){at=0;var jt,je=W[_e].trim().replace(/\x1B([\x20-\x2F])([\x30-\x3F])/g,o).replace(i,r),Bt=je.replace(/;;/g,"\0").split(";").map(function(Ie){return Ie.replace(/\u0000/g,";")});if(je.length>0)switch(Bt[0]){case"ID":case"E":case"B":case"O":case"W":break;case"P":"P"==Bt[1].charAt(0)&&Ue.push(je.slice(3).replace(/;;/g,";"));break;case"C":var pr=!1,sr=!1,Xr=!1,Xt=!1,xr=-1,yt=-1;for(me=1;me<Bt.length;++me)switch(Bt[me].charAt(0)){case"A":case"G":break;case"X":X=parseInt(Bt[me].slice(1))-1,sr=!0;break;case"Y":for(B=parseInt(Bt[me].slice(1))-1,sr||(X=0),ot=ue.length;ot<=B;++ot)ue[ot]=[];break;case"K":'"'===(jt=Bt[me].slice(1)).charAt(0)?jt=jt.slice(1,jt.length-1):"TRUE"===jt?jt=!0:"FALSE"===jt?jt=!1:isNaN(Pn(jt))?isNaN(la(jt).getDate())||(jt=Ei(jt)):(jt=Pn(jt),null!==We&&Po(We)&&(jt=Tl(jt))),pr=!0;break;case"E":Xt=!0;var Te=Gc(Bt[me].slice(1),{r:B,c:X});ue[B][X]=[ue[B][X],Te];break;case"S":Xr=!0,ue[B][X]=[ue[B][X],"S5S"];break;case"R":xr=parseInt(Bt[me].slice(1))-1;break;case"C":yt=parseInt(Bt[me].slice(1))-1;break;default:if(j&&j.WTF)throw new Error("SYLK bad record "+je)}if(pr&&(ue[B][X]&&2==ue[B][X].length?ue[B][X][0]=jt:ue[B][X]=jt,We=null),Xr){if(Xt)throw new Error("SYLK shared formula cannot have own formula");var tt=xr>-1&&ue[xr][yt];if(!tt||!tt[1])throw new Error("SYLK shared formula cannot find base");ue[B][X][1]=o0(tt[1],{r:B-xr,c:X-yt})}break;case"F":var Fe=0;for(me=1;me<Bt.length;++me)switch(Bt[me].charAt(0)){case"X":X=parseInt(Bt[me].slice(1))-1,++Fe;break;case"Y":for(B=parseInt(Bt[me].slice(1))-1,ot=ue.length;ot<=B;++ot)ue[ot]=[];break;case"M":at=parseInt(Bt[me].slice(1))/20;break;case"F":case"G":case"S":case"D":case"N":break;case"P":We=Ue[parseInt(Bt[me].slice(1))];break;case"W":for(Ve=Bt[me].slice(1).split(" "),ot=parseInt(Ve[0],10);ot<=parseInt(Ve[1],10);++ot)at=parseInt(Ve[2],10),Ge[ot-1]=0===at?{hidden:!0}:{wch:at},Vl(Ge[ot-1]);break;case"C":Ge[X=parseInt(Bt[me].slice(1))-1]||(Ge[X]={});break;case"R":Se[B=parseInt(Bt[me].slice(1))-1]||(Se[B]={}),at>0?(Se[B].hpt=at,Se[B].hpx=$f(at)):0===at&&(Se[B].hidden=!0);break;default:if(j&&j.WTF)throw new Error("SYLK bad record "+je)}Fe<1&&(We=null);break;default:if(j&&j.WTF)throw new Error("SYLK bad record "+je)}}return Se.length>0&&(nt["!rows"]=Se),Ge.length>0&&(nt["!cols"]=Ge),j&&j.sheetRows&&(ue=ue.slice(0,j.sheetRows)),[ue,nt]}function y(U,j){var W=function c(U,j){switch(j.type){case"base64":return x(Qi(U),j);case"binary":return x(U,j);case"buffer":return x(_r&&Buffer.isBuffer(U)?U.toString("binary"):za(U),j);case"array":return x(Ws(U),j)}throw new Error("Unrecognized type "+j.type)}(U,j),X=W[1],_e=Mt(W[0],j);return Fi(X).forEach(function(me){_e[me]=X[me]}),_e}function C(U,j,W,B){var X="C;Y"+(W+1)+";X"+(B+1)+";K";switch(U.t){case"n":X+=U.v||0,U.f&&!U.F&&(X+=";E"+Qf(U.f,{r:W,c:B}));break;case"b":X+=U.v?"TRUE":"FALSE";break;case"e":X+=U.w||U.v;break;case"d":X+='"'+(U.w||U.v)+'"';break;case"s":X+='"'+U.v.replace(/"/g,"").replace(/;/g,";;")+'"'}return X}return e["|"]=254,{to_workbook:function T(U,j){return It(y(U,j),j)},to_sheet:y,from_sheet:function N(U,j){var _e,W=["ID;PWXL;N;E"],B=[],X=ke(U["!ref"]),me=Array.isArray(U),ue="\r\n";W.push("P;PGeneral"),W.push("F;P0;DG0G8;M255"),U["!cols"]&&function I(U,j){j.forEach(function(W,B){var X="F;W"+(B+1)+" "+(B+1)+" ";W.hidden?X+="0":("number"==typeof W.width&&!W.wpx&&(W.wpx=Ul(W.width)),"number"==typeof W.wpx&&!W.wch&&(W.wch=Zl(W.wpx)),"number"==typeof W.wch&&(X+=Math.round(W.wch)))," "!=X.charAt(X.length-1)&&U.push(X)})}(W,U["!cols"]),U["!rows"]&&function F(U,j){j.forEach(function(W,B){var X="F;";W.hidden?X+="M0;":W.hpt?X+="M"+20*W.hpt+";":W.hpx&&(X+="M"+20*Nc(W.hpx)+";"),X.length>2&&U.push(X+"R"+(B+1))})}(W,U["!rows"]),W.push("B;Y"+(X.e.r-X.s.r+1)+";X"+(X.e.c-X.s.c+1)+";D"+[X.s.c,X.s.r,X.e.c,X.e.r].join(" "));for(var Ue=X.s.r;Ue<=X.e.r;++Ue)for(var We=X.s.c;We<=X.e.c;++We){var nt=Le({r:Ue,c:We});(_e=me?(U[Ue]||[])[We]:U[nt])&&(null!=_e.v||_e.f&&!_e.F)&&B.push(C(_e,0,Ue,We))}return W.join(ue)+ue+B.join(ue)+ue+"E"+ue}}}(),Rd=function(){function i(x,y){for(var T=x.split("\n"),C=-1,I=-1,F=0,N=[];F!==T.length;++F)if("BOT"!==T[F].trim()){if(!(C<0)){for(var U=T[F].trim().split(","),j=U[0],W=U[1],B=T[++F]||"";1&(B.match(/["]/g)||[]).length&&F<T.length-1;)B+="\n"+T[++F];switch(B=B.trim(),+j){case-1:if("BOT"===B){N[++C]=[],I=0;continue}if("EOD"!==B)throw new Error("Unrecognized DIF special command "+B);break;case 0:N[C][I]="TRUE"===B||"FALSE"!==B&&(isNaN(Pn(W))?isNaN(la(W).getDate())?W:Ei(W):Pn(W)),++I;break;case 1:(B=(B=B.slice(1,B.length-1)).replace(/""/g,'"'))&&B.match(/^=".*"$/)&&(B=B.slice(2,-1)),N[C][I++]=""!==B?B:null}if("EOD"===B)break}}else N[++C]=[],I=0;return y&&y.sheetRows&&(N=N.slice(0,y.sheetRows)),N}function r(x,y){return Mt(function e(x,y){switch(y.type){case"base64":return i(Qi(x),y);case"binary":return i(x,y);case"buffer":return i(_r&&Buffer.isBuffer(x)?x.toString("binary"):za(x),y);case"array":return i(Ws(x),y)}throw new Error("Unrecognized type "+y.type)}(x,y),y)}return{to_workbook:function o(x,y){return It(r(x,y),y)},to_sheet:r,from_sheet:function(){var x=function(C,I,F,N,U){C.push(I),C.push(F+","+N),C.push('"'+U.replace(/"/g,'""')+'"')},y=function(C,I,F,N){C.push(I+","+F),C.push(1==I?'"'+N.replace(/"/g,'""')+'"':N)};return function(C){var N,I=[],F=ke(C["!ref"]),U=Array.isArray(C);x(I,"TABLE",0,1,"sheetjs"),x(I,"VECTORS",0,F.e.r-F.s.r+1,""),x(I,"TUPLES",0,F.e.c-F.s.c+1,""),x(I,"DATA",0,0,"");for(var j=F.s.r;j<=F.e.r;++j){y(I,-1,0,"BOT");for(var W=F.s.c;W<=F.e.c;++W){var B=Le({r:j,c:W});if(N=U?(C[j]||[])[W]:C[B])switch(N.t){case"n":var X=N.w;!X&&null!=N.v&&(X=N.v),null==X?y(I,1,0,N.f&&!N.F?"="+N.f:""):y(I,0,X,"V");break;case"b":y(I,0,N.v?1:0,N.v?"TRUE":"FALSE");break;case"s":y(I,1,0,isNaN(N.v)?N.v:'="'+N.v+'"');break;case"d":N.w||(N.w=vn(N.z||or[14],Di(Ei(N.v)))),y(I,0,N.w,"V");break;default:y(I,1,0,"")}else y(I,1,0,"")}}return y(I,-1,0,"EOD"),I.join("\r\n")}}()}}(),Od=function(){function e(N){return N.replace(/\\b/g,"\\").replace(/\\c/g,":").replace(/\\n/g,"\n")}function i(N){return N.replace(/\\/g,"\\b").replace(/:/g,"\\c").replace(/\n/g,"\\n")}function o(N,U){return Mt(function r(N,U){for(var j=N.split("\n"),W=-1,B=-1,X=0,_e=[];X!==j.length;++X){var me=j[X].trim().split(":");if("cell"===me[0]){var ue=Be(me[1]);if(_e.length<=ue.r)for(W=_e.length;W<=ue.r;++W)_e[W]||(_e[W]=[]);switch(W=ue.r,B=ue.c,me[2]){case"t":_e[W][B]=e(me[3]);break;case"v":_e[W][B]=+me[3];break;case"vtf":var Ue=me[me.length-1];case"vtc":_e[W][B]="nl"===me[3]?!!+me[4]:+me[4],"vtf"==me[2]&&(_e[W][B]=[_e[W][B],Ue])}}}return U&&U.sheetRows&&(_e=_e.slice(0,U.sheetRows)),_e}(N,U),U)}var x=["socialcalc:version:1.5","MIME-Version: 1.0","Content-Type: multipart/mixed; boundary=SocialCalcSpreadsheetControlSave"].join("\n"),y=["--SocialCalcSpreadsheetControlSave","Content-type: text/plain; charset=UTF-8"].join("\n")+"\n",T=["# SocialCalc Spreadsheet Control Save","part:sheet"].join("\n"),C="--SocialCalcSpreadsheetControlSave--";function I(N){if(!N||!N["!ref"])return"";for(var W,U=[],j=[],B="",X=qe(N["!ref"]),_e=Array.isArray(N),me=X.s.r;me<=X.e.r;++me)for(var ue=X.s.c;ue<=X.e.c;++ue)if(B=Le({r:me,c:ue}),(W=_e?(N[me]||[])[ue]:N[B])&&null!=W.v&&"z"!==W.t){switch(j=["cell",B,"t"],W.t){case"s":case"str":j.push(i(W.v));break;case"n":W.f?(j[2]="vtf",j[3]="n",j[4]=W.v,j[5]=i(W.f)):(j[2]="v",j[3]=W.v);break;case"b":j[2]="vt"+(W.f?"f":"c"),j[3]="nl",j[4]=W.v?"1":"0",j[5]=i(W.f||(W.v?"TRUE":"FALSE"));break;case"d":var Ue=Di(Ei(W.v));j[2]="vtc",j[3]="nd",j[4]=""+Ue,j[5]=W.w||vn(W.z||or[14],Ue);break;case"e":continue}U.push(j.join(":"))}return U.push("sheet:c:"+(X.e.c-X.s.c+1)+":r:"+(X.e.r-X.s.r+1)+":tvf:1"),U.push("valueformat:1:text-wiki"),U.join("\n")}return{to_workbook:function c(N,U){return It(o(N,U),U)},to_sheet:o,from_sheet:function F(N){return[x,y,T,y,I(N),C].join("\n")}}}(),ba=function(){function e(F,N,U,j,W){W.raw?N[U][j]=F:""===F||(N[U][j]="TRUE"===F||"FALSE"!==F&&(isNaN(Pn(F))?isNaN(la(F).getDate())?F:Ei(F):Pn(F)))}var r={44:",",9:"\t",59:";",124:"|"},o={44:3,9:2,59:1,124:0};function c(F){for(var N={},U=!1,j=0,W=0;j<F.length;++j)34==(W=F.charCodeAt(j))?U=!U:!U&&W in r&&(N[W]=(N[W]||0)+1);for(j in W=[],N)Object.prototype.hasOwnProperty.call(N,j)&&W.push([N[j],j]);if(!W.length)for(j in N=o)Object.prototype.hasOwnProperty.call(N,j)&&W.push([N[j],j]);return W.sort(function(B,X){return B[0]-X[0]||o[B[1]]-o[X[1]]}),r[W.pop()[1]]||44}function y(F,N){return!N||!N.PRN||N.FS||"sep="==F.slice(0,4)||F.indexOf("\t")>=0||F.indexOf(",")>=0||F.indexOf(";")>=0?function x(F,N){var U=N||{},j="",W=U.dense?[]:{},B={s:{c:0,r:0},e:{c:0,r:0}};"sep="==F.slice(0,4)?13==F.charCodeAt(5)&&10==F.charCodeAt(6)?(j=F.charAt(4),F=F.slice(7)):13==F.charCodeAt(5)||10==F.charCodeAt(5)?(j=F.charAt(4),F=F.slice(6)):j=c(F.slice(0,1024)):j=U&&U.FS?U.FS:c(F.slice(0,1024));var X=0,_e=0,me=0,ue=0,Ue=0,We=j.charCodeAt(0),nt=!1,Se=0,Ge=F.charCodeAt(0);F=F.replace(/\r\n/gm,"\n");var Ve=null!=U.dateNF?function Oo(e){var i="number"==typeof e?or[e]:e;return i=i.replace(_u,"(\\d+)"),new RegExp("^"+i+"$")}(U.dateNF):null;function at(){var ot=F.slice(ue,Ue),je={};if('"'==ot.charAt(0)&&'"'==ot.charAt(ot.length-1)&&(ot=ot.slice(1,-1).replace(/""/g,'"')),0===ot.length)je.t="z";else if(U.raw)je.t="s",je.v=ot;else if(0===ot.trim().length)je.t="s",je.v=ot;else if(61==ot.charCodeAt(0))34==ot.charCodeAt(1)&&34==ot.charCodeAt(ot.length-1)?(je.t="s",je.v=ot.slice(2,-1).replace(/""/g,'"')):function sm(e){return 1!=e.length}(ot)?(je.t="n",je.f=ot.slice(1)):(je.t="s",je.v=ot);else if("TRUE"==ot)je.t="b",je.v=!0;else if("FALSE"==ot)je.t="b",je.v=!1;else if(isNaN(me=Pn(ot)))if(!isNaN(la(ot).getDate())||Ve&&ot.match(Ve)){je.z=U.dateNF||or[14];var Bt=0;Ve&&ot.match(Ve)&&(ot=function vl(e,i,r){var o=-1,c=-1,x=-1,y=-1,T=-1,C=-1;(i.match(_u)||[]).forEach(function(N,U){var j=parseInt(r[U+1],10);switch(N.toLowerCase().charAt(0)){case"y":o=j;break;case"d":x=j;break;case"h":y=j;break;case"s":C=j;break;case"m":y>=0?T=j:c=j}}),C>=0&&-1==T&&c>=0&&(T=c,c=-1);var I=(""+(o>=0?o:(new Date).getFullYear())).slice(-4)+"-"+("00"+(c>=1?c:1)).slice(-2)+"-"+("00"+(x>=1?x:1)).slice(-2);7==I.length&&(I="0"+I),8==I.length&&(I="20"+I);var F=("00"+(y>=0?y:0)).slice(-2)+":"+("00"+(T>=0?T:0)).slice(-2)+":"+("00"+(C>=0?C:0)).slice(-2);return-1==y&&-1==T&&-1==C?I:-1==o&&-1==c&&-1==x?F:I+"T"+F}(0,U.dateNF,ot.match(Ve)||[]),Bt=1),U.cellDates?(je.t="d",je.v=Ei(ot,Bt)):(je.t="n",je.v=Di(Ei(ot,Bt))),!1!==U.cellText&&(je.w=vn(je.z,je.v instanceof Date?Di(je.v):je.v)),U.cellNF||delete je.z}else je.t="s",je.v=ot;else je.t="n",!1!==U.cellText&&(je.w=ot),je.v=me;if("z"==je.t||(U.dense?(W[X]||(W[X]=[]),W[X][_e]=je):W[Le({c:_e,r:X})]=je),Ge=F.charCodeAt(ue=Ue+1),B.e.c<_e&&(B.e.c=_e),B.e.r<X&&(B.e.r=X),Se==We)++_e;else if(_e=0,++X,U.sheetRows&&U.sheetRows<=X)return!0}e:for(;Ue<F.length;++Ue)switch(Se=F.charCodeAt(Ue)){case 34:34===Ge&&(nt=!nt);break;case We:case 10:case 13:if(!nt&&at())break e}return Ue-ue>0&&at(),W["!ref"]=Qe(B),W}(F,N):Mt(function i(F,N){var U=N||{},j=[];if(!F||0===F.length)return j;for(var W=F.split(/[\r\n]/),B=W.length-1;B>=0&&0===W[B].length;)--B;for(var X=10,_e=0,me=0;me<=B;++me)-1==(_e=W[me].indexOf(" "))?_e=W[me].length:_e++,X=Math.max(X,_e);for(me=0;me<=B;++me){j[me]=[];var ue=0;for(e(W[me].slice(0,X).trim(),j,me,ue,U),ue=1;ue<=(W[me].length-X)/10+1;++ue)e(W[me].slice(X+10*(ue-1),X+10*ue).trim(),j,me,ue,U)}return U.sheetRows&&(j=j.slice(0,U.sheetRows)),j}(F,N),N)}function T(F,N){var U="",j="string"==N.type?[0,0,0,0]:function dg(e,i){var r="";switch((i||{}).type||"base64"){case"buffer":case"array":return[e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7]];case"base64":r=Qi(e.slice(0,12));break;case"binary":r=e;break;default:throw new Error("Unrecognized type "+(i&&i.type||"undefined"))}return[r.charCodeAt(0),r.charCodeAt(1),r.charCodeAt(2),r.charCodeAt(3),r.charCodeAt(4),r.charCodeAt(5),r.charCodeAt(6),r.charCodeAt(7)]}(F,N);switch(N.type){case"base64":U=Qi(F);break;case"binary":case"string":U=F;break;case"buffer":U=65001==N.codepage?F.toString("utf8"):_r&&Buffer.isBuffer(F)?F.toString("binary"):za(F);break;case"array":U=Ws(F);break;default:throw new Error("Unrecognized type "+N.type)}return 239==j[0]&&187==j[1]&&191==j[2]?U=di(U.slice(3)):"string"!=N.type&&"buffer"!=N.type&&65001==N.codepage&&(U=di(U)),"socialcalc:version:"==U.slice(0,19)?Od.to_sheet("string"==N.type?U:di(U),N):y(U,N)}return{to_workbook:function C(F,N){return It(T(F,N),N)},to_sheet:T,from_sheet:function I(F){for(var j,N=[],U=ke(F["!ref"]),W=Array.isArray(F),B=U.s.r;B<=U.e.r;++B){for(var X=[],_e=U.s.c;_e<=U.e.c;++_e){var me=Le({r:B,c:_e});if((j=W?(F[B]||[])[_e]:F[me])&&null!=j.v){for(var ue=(j.w||(dt(j),j.w)||"").slice(0,10);ue.length<10;)ue+=" ";X.push(ue+(0===_e?" ":""))}else X.push("          ")}N.push(X.join(""))}return N.join("\n")}}}(),Nl=function(){function e(Te,tt,Fe){if(Te){b(Te,Te.l||0);for(var Ie=Fe.Enum||xr;Te.l<Te.length;){var ft=Te.read_shift(2),$t=Ie[ft]||Ie[65535],Pt=Te.read_shift(2),Lt=Te.l+Pt,xt=$t.f&&$t.f(Te,Pt,Fe);if(Te.l=Lt,tt(xt,$t,ft))return}}}function r(Te,tt){if(!Te)return Te;var Fe=tt||{},Ie=Fe.dense?[]:{},ft="Sheet1",$t="",Pt=0,Lt={},xt=[],zr=[],be={s:{r:0,c:0},e:{r:0,c:0}},bi=Fe.sheetRows||0;if(0==Te[2]&&(8==Te[3]||9==Te[3])&&Te.length>=16&&5==Te[14]&&108===Te[15])throw new Error("Unsupported Works 3 for Mac file");if(2==Te[2])Fe.Enum=xr,e(Te,function(Wt,_n,co){switch(co){case 0:Fe.vers=Wt,Wt>=4096&&(Fe.qpro=!0);break;case 6:be=Wt;break;case 204:Wt&&($t=Wt);break;case 222:$t=Wt;break;case 15:case 51:Fe.qpro||(Wt[1].v=Wt[1].v.slice(1));case 13:case 14:case 16:14==co&&112==(112&Wt[2])&&(15&Wt[2])>1&&(15&Wt[2])<15&&(Wt[1].z=Fe.dateNF||or[14],Fe.cellDates&&(Wt[1].t="d",Wt[1].v=Tl(Wt[1].v))),Fe.qpro&&Wt[3]>Pt&&(Ie["!ref"]=Qe(be),Lt[ft]=Ie,xt.push(ft),Ie=Fe.dense?[]:{},be={s:{r:0,c:0},e:{r:0,c:0}},Pt=Wt[3],ft=$t||"Sheet"+(Pt+1),$t="");var Kl=Fe.dense?(Ie[Wt[0].r]||[])[Wt[0].c]:Ie[Le(Wt[0])];if(Kl){Kl.t=Wt[1].t,Kl.v=Wt[1].v,null!=Wt[1].z&&(Kl.z=Wt[1].z),null!=Wt[1].f&&(Kl.f=Wt[1].f);break}Fe.dense?(Ie[Wt[0].r]||(Ie[Wt[0].r]=[]),Ie[Wt[0].r][Wt[0].c]=Wt[1]):Ie[Le(Wt[0])]=Wt[1]}},Fe);else{if(26!=Te[2]&&14!=Te[2])throw new Error("Unrecognized LOTUS BOF "+Te[2]);Fe.Enum=yt,14==Te[2]&&(Fe.qpro=!0,Te.l=0),e(Te,function(Wt,_n,co){switch(co){case 204:ft=Wt;break;case 22:Wt[1].v=Wt[1].v.slice(1);case 23:case 24:case 25:case 37:case 39:case 40:if(Wt[3]>Pt&&(Ie["!ref"]=Qe(be),Lt[ft]=Ie,xt.push(ft),Ie=Fe.dense?[]:{},be={s:{r:0,c:0},e:{r:0,c:0}},ft="Sheet"+((Pt=Wt[3])+1)),bi>0&&Wt[0].r>=bi)break;Fe.dense?(Ie[Wt[0].r]||(Ie[Wt[0].r]=[]),Ie[Wt[0].r][Wt[0].c]=Wt[1]):Ie[Le(Wt[0])]=Wt[1],be.e.c<Wt[0].c&&(be.e.c=Wt[0].c),be.e.r<Wt[0].r&&(be.e.r=Wt[0].r);break;case 27:Wt[14e3]&&(zr[Wt[14e3][0]]=Wt[14e3][1]);break;case 1537:zr[Wt[0]]=Wt[1],Wt[0]==Pt&&(ft=Wt[1])}},Fe)}if(Ie["!ref"]=Qe(be),Lt[$t||ft]=Ie,xt.push($t||ft),!zr.length)return{SheetNames:xt,Sheets:Lt};for(var Hr={},Ti=[],Yr=0;Yr<zr.length;++Yr)Lt[xt[Yr]]?(Ti.push(zr[Yr]||xt[Yr]),Hr[zr[Yr]]=Lt[zr[Yr]]||Lt[xt[Yr]]):(Ti.push(zr[Yr]),Hr[zr[Yr]]={"!ref":"A1"});return{SheetNames:Ti,Sheets:Hr}}function I(Te,tt,Fe){var Ie=[{c:0,r:0},{t:"n",v:0},0,0];return Fe.qpro&&20768!=Fe.vers?(Ie[0].c=Te.read_shift(1),Ie[3]=Te.read_shift(1),Ie[0].r=Te.read_shift(2),Te.l+=2):(Ie[2]=Te.read_shift(1),Ie[0].c=Te.read_shift(2),Ie[0].r=Te.read_shift(2)),Ie}function F(Te,tt,Fe){var Ie=Te.l+tt,ft=I(Te,0,Fe);if(ft[1].t="s",20768==Fe.vers){Te.l++;var $t=Te.read_shift(1);return ft[1].v=Te.read_shift($t,"utf8"),ft}return Fe.qpro&&Te.l++,ft[1].v=Te.read_shift(Ie-Te.l,"cstr"),ft}function N(Te,tt,Fe){var Ie=A(7+Fe.length);Ie.write_shift(1,255),Ie.write_shift(2,tt),Ie.write_shift(2,Te),Ie.write_shift(1,39);for(var ft=0;ft<Ie.length;++ft){var $t=Fe.charCodeAt(ft);Ie.write_shift(1,$t>=128?95:$t)}return Ie.write_shift(1,0),Ie}function j(Te,tt,Fe){var Ie=A(7);return Ie.write_shift(1,255),Ie.write_shift(2,tt),Ie.write_shift(2,Te),Ie.write_shift(2,Fe,"i"),Ie}function B(Te,tt,Fe){var Ie=A(13);return Ie.write_shift(1,255),Ie.write_shift(2,tt),Ie.write_shift(2,Te),Ie.write_shift(8,Fe,"f"),Ie}function _e(Te,tt,Fe){var Ie=32768&tt;return tt=(Ie?Te:0)+((tt&=-32769)>=8192?tt-16384:tt),(Ie?"":"$")+(Fe?ce(tt):se(tt))}var me={51:["FALSE",0],52:["TRUE",0],70:["LEN",1],80:["SUM",69],81:["AVERAGEA",69],82:["COUNTA",69],83:["MINA",69],84:["MAXA",69],111:["T",1]},ue=["","","","","","","","","","+","-","*","/","^","=","<>","<=",">=","<",">","","","","","&","","","","","","",""];function We(Te){var tt=[{c:0,r:0},{t:"n",v:0},0];return tt[0].r=Te.read_shift(2),tt[3]=Te[Te.l++],tt[0].c=Te[Te.l++],tt}function Se(Te,tt,Fe,Ie){var ft=A(6+Ie.length);ft.write_shift(2,Te),ft.write_shift(1,Fe),ft.write_shift(1,tt),ft.write_shift(1,39);for(var $t=0;$t<Ie.length;++$t){var Pt=Ie.charCodeAt($t);ft.write_shift(1,Pt>=128?95:Pt)}return ft.write_shift(1,0),ft}function Ve(Te,tt){var Fe=We(Te),Ie=Te.read_shift(4),ft=Te.read_shift(4),$t=Te.read_shift(2);if(65535==$t)return 0===Ie&&3221225472===ft?(Fe[1].t="e",Fe[1].v=15):0===Ie&&3489660928===ft?(Fe[1].t="e",Fe[1].v=42):Fe[1].v=0,Fe;var Pt=32768&$t;return $t=(32767&$t)-16446,Fe[1].v=(1-2*Pt)*(ft*Math.pow(2,$t+32)+Ie*Math.pow(2,$t)),Fe}function at(Te,tt,Fe,Ie){var ft=A(14);if(ft.write_shift(2,Te),ft.write_shift(1,Fe),ft.write_shift(1,tt),0==Ie)return ft.write_shift(4,0),ft.write_shift(4,0),ft.write_shift(2,65535),ft;var $t=0,Pt=0,xt=0;return Ie<0&&($t=1,Ie=-Ie),Pt=0|Math.log2(Ie),0==(2147483648&(xt=(Ie/=Math.pow(2,Pt-31))>>>0))&&(++Pt,xt=(Ie/=2)>>>0),Ie-=xt,xt|=2147483648,xt>>>=0,Ie*=Math.pow(2,32),ft.write_shift(4,Ie>>>0),ft.write_shift(4,xt),ft.write_shift(2,Pt+=16383+($t?32768:0)),ft}function Bt(Te,tt){var Fe=We(Te),Ie=Te.read_shift(8,"f");return Fe[1].v=Ie,Fe}function jt(Te,tt){return 0==Te[Te.l+tt-1]?Te.read_shift(tt,"cstr"):""}function Xt(Te,tt){var Fe=A(5+Te.length);Fe.write_shift(2,14e3),Fe.write_shift(2,tt);for(var Ie=0;Ie<Te.length;++Ie){var ft=Te.charCodeAt(Ie);Fe[Fe.l++]=ft>127?95:ft}return Fe[Fe.l++]=0,Fe}var xr={0:{n:"BOF",f:Li},1:{n:"EOF"},2:{n:"CALCMODE"},3:{n:"CALCORDER"},4:{n:"SPLIT"},5:{n:"SYNC"},6:{n:"RANGE",f:function T(Te,tt,Fe){var Ie={s:{c:0,r:0},e:{c:0,r:0}};return 8==tt&&Fe.qpro?(Ie.s.c=Te.read_shift(1),Te.l++,Ie.s.r=Te.read_shift(2),Ie.e.c=Te.read_shift(1),Te.l++,Ie.e.r=Te.read_shift(2),Ie):(Ie.s.c=Te.read_shift(2),Ie.s.r=Te.read_shift(2),12==tt&&Fe.qpro&&(Te.l+=2),Ie.e.c=Te.read_shift(2),Ie.e.r=Te.read_shift(2),12==tt&&Fe.qpro&&(Te.l+=2),65535==Ie.s.c&&(Ie.s.c=Ie.e.c=Ie.s.r=Ie.e.r=0),Ie)}},7:{n:"WINDOW1"},8:{n:"COLW1"},9:{n:"WINTWO"},10:{n:"COLW2"},11:{n:"NAME"},12:{n:"BLANK"},13:{n:"INTEGER",f:function U(Te,tt,Fe){var Ie=I(Te,0,Fe);return Ie[1].v=Te.read_shift(2,"i"),Ie}},14:{n:"NUMBER",f:function W(Te,tt,Fe){var Ie=I(Te,0,Fe);return Ie[1].v=Te.read_shift(8,"f"),Ie}},15:{n:"LABEL",f:F},16:{n:"FORMULA",f:function X(Te,tt,Fe){var Ie=Te.l+tt,ft=I(Te,0,Fe);if(ft[1].v=Te.read_shift(8,"f"),Fe.qpro)Te.l=Ie;else{var $t=Te.read_shift(2);(function Ue(Te,tt){b(Te,0);for(var Fe=[],Ie=0,ft="",$t="",Pt="",Lt="";Te.l<Te.length;){var xt=Te[Te.l++];switch(xt){case 0:Fe.push(Te.read_shift(8,"f"));break;case 1:$t=_e(tt[0].c,Te.read_shift(2),!0),ft=_e(tt[0].r,Te.read_shift(2),!1),Fe.push($t+ft);break;case 2:var zr=_e(tt[0].c,Te.read_shift(2),!0),be=_e(tt[0].r,Te.read_shift(2),!1);$t=_e(tt[0].c,Te.read_shift(2),!0),ft=_e(tt[0].r,Te.read_shift(2),!1),Fe.push(zr+be+":"+$t+ft);break;case 3:if(Te.l<Te.length)return void console.error("WK1 premature formula end");break;case 4:Fe.push("("+Fe.pop()+")");break;case 5:Fe.push(Te.read_shift(2));break;case 6:for(var bi="";xt=Te[Te.l++];)bi+=String.fromCharCode(xt);Fe.push('"'+bi.replace(/"/g,'""')+'"');break;case 8:Fe.push("-"+Fe.pop());break;case 23:Fe.push("+"+Fe.pop());break;case 22:Fe.push("NOT("+Fe.pop()+")");break;case 20:case 21:Lt=Fe.pop(),Pt=Fe.pop(),Fe.push(["AND","OR"][xt-20]+"("+Pt+","+Lt+")");break;default:if(xt<32&&ue[xt])Lt=Fe.pop(),Pt=Fe.pop(),Fe.push(Pt+ue[xt]+Lt);else{if(!me[xt])return xt<=7?console.error("WK1 invalid opcode "+xt.toString(16)):xt<=24?console.error("WK1 unsupported op "+xt.toString(16)):xt<=30?console.error("WK1 invalid opcode "+xt.toString(16)):xt<=115?console.error("WK1 unsupported function opcode "+xt.toString(16)):console.error("WK1 unrecognized opcode "+xt.toString(16));if(69==(Ie=me[xt][1])&&(Ie=Te[Te.l++]),Ie>Fe.length)return void console.error("WK1 bad formula parse 0x"+xt.toString(16)+":|"+Fe.join("|")+"|");var Hr=Fe.slice(-Ie);Fe.length-=Ie,Fe.push(me[xt][0]+"("+Hr.join(",")+")")}}}1==Fe.length?tt[1].f=""+Fe[0]:console.error("WK1 bad formula parse |"+Fe.join("|")+"|")})(Te.slice(Te.l,Te.l+$t),ft),Te.l+=$t}return ft}},24:{n:"TABLE"},25:{n:"ORANGE"},26:{n:"PRANGE"},27:{n:"SRANGE"},28:{n:"FRANGE"},29:{n:"KRANGE1"},32:{n:"HRANGE"},35:{n:"KRANGE2"},36:{n:"PROTEC"},37:{n:"FOOTER"},38:{n:"HEADER"},39:{n:"SETUP"},40:{n:"MARGINS"},41:{n:"LABELFMT"},42:{n:"TITLES"},43:{n:"SHEETJS"},45:{n:"GRAPH"},46:{n:"NGRAPH"},47:{n:"CALCCOUNT"},48:{n:"UNFORMATTED"},49:{n:"CURSORW12"},50:{n:"WINDOW"},51:{n:"STRING",f:F},55:{n:"PASSWORD"},56:{n:"LOCKED"},60:{n:"QUERY"},61:{n:"QUERYNAME"},62:{n:"PRINT"},63:{n:"PRINTNAME"},64:{n:"GRAPH2"},65:{n:"GRAPHNAME"},66:{n:"ZOOM"},67:{n:"SYMSPLIT"},68:{n:"NSROWS"},69:{n:"NSCOLS"},70:{n:"RULER"},71:{n:"NNAME"},72:{n:"ACOMM"},73:{n:"AMACRO"},74:{n:"PARSE"},102:{n:"PRANGES??"},103:{n:"RRANGES??"},104:{n:"FNAME??"},105:{n:"MRANGES??"},204:{n:"SHEETNAMECS",f:jt},222:{n:"SHEETNAMELP",f:function pr(Te,tt){var Fe=Te[Te.l++];Fe>tt-1&&(Fe=tt-1);for(var Ie="";Ie.length<Fe;)Ie+=String.fromCharCode(Te[Te.l++]);return Ie}},65535:{n:""}},yt={0:{n:"BOF"},1:{n:"EOF"},2:{n:"PASSWORD"},3:{n:"CALCSET"},4:{n:"WINDOWSET"},5:{n:"SHEETCELLPTR"},6:{n:"SHEETLAYOUT"},7:{n:"COLUMNWIDTH"},8:{n:"HIDDENCOLUMN"},9:{n:"USERRANGE"},10:{n:"SYSTEMRANGE"},11:{n:"ZEROFORCE"},12:{n:"SORTKEYDIR"},13:{n:"FILESEAL"},14:{n:"DATAFILLNUMS"},15:{n:"PRINTMAIN"},16:{n:"PRINTSTRING"},17:{n:"GRAPHMAIN"},18:{n:"GRAPHSTRING"},19:{n:"??"},20:{n:"ERRCELL"},21:{n:"NACELL"},22:{n:"LABEL16",f:function nt(Te,tt){var Fe=We(Te);return Fe[1].t="s",Fe[1].v=Te.read_shift(tt-4,"cstr"),Fe}},23:{n:"NUMBER17",f:Ve},24:{n:"NUMBER18",f:function Ge(Te,tt){var Fe=We(Te);Fe[1].v=Te.read_shift(2);var Ie=Fe[1].v>>1;if(1&Fe[1].v)switch(7&Ie){case 0:Ie=5e3*(Ie>>3);break;case 1:Ie=500*(Ie>>3);break;case 2:Ie=(Ie>>3)/20;break;case 3:Ie=(Ie>>3)/200;break;case 4:Ie=(Ie>>3)/2e3;break;case 5:Ie=(Ie>>3)/2e4;break;case 6:Ie=(Ie>>3)/16;break;case 7:Ie=(Ie>>3)/64}return Fe[1].v=Ie,Fe}},25:{n:"FORMULA19",f:function ot(Te,tt){var Fe=Ve(Te);return Te.l+=tt-14,Fe}},26:{n:"FORMULA1A"},27:{n:"XFORMAT",f:function Xr(Te,tt){for(var Fe={},Ie=Te.l+tt;Te.l<Ie;){var ft=Te.read_shift(2);if(14e3==ft){for(Fe[ft]=[0,""],Fe[ft][0]=Te.read_shift(2);Te[Te.l];)Fe[ft][1]+=String.fromCharCode(Te[Te.l]),Te.l++;Te.l++}}return Fe}},28:{n:"DTLABELMISC"},29:{n:"DTLABELCELL"},30:{n:"GRAPHWINDOW"},31:{n:"CPA"},32:{n:"LPLAUTO"},33:{n:"QUERY"},34:{n:"HIDDENSHEET"},35:{n:"??"},37:{n:"NUMBER25",f:function je(Te,tt){var Fe=We(Te),Ie=Te.read_shift(4);return Fe[1].v=Ie>>6,Fe}},38:{n:"??"},39:{n:"NUMBER27",f:Bt},40:{n:"FORMULA28",f:function er(Te,tt){var Fe=Bt(Te);return Te.l+=tt-10,Fe}},142:{n:"??"},147:{n:"??"},150:{n:"??"},151:{n:"??"},152:{n:"??"},153:{n:"??"},154:{n:"??"},155:{n:"??"},156:{n:"??"},163:{n:"??"},174:{n:"??"},175:{n:"??"},176:{n:"??"},177:{n:"??"},184:{n:"??"},185:{n:"??"},186:{n:"??"},187:{n:"??"},188:{n:"??"},195:{n:"??"},201:{n:"??"},204:{n:"SHEETNAMECS",f:jt},205:{n:"??"},206:{n:"??"},207:{n:"??"},208:{n:"??"},256:{n:"??"},259:{n:"??"},260:{n:"??"},261:{n:"??"},262:{n:"??"},263:{n:"??"},265:{n:"??"},266:{n:"??"},267:{n:"??"},268:{n:"??"},270:{n:"??"},271:{n:"??"},384:{n:"??"},389:{n:"??"},390:{n:"??"},393:{n:"??"},396:{n:"??"},512:{n:"??"},514:{n:"??"},513:{n:"??"},516:{n:"??"},517:{n:"??"},640:{n:"??"},641:{n:"??"},642:{n:"??"},643:{n:"??"},644:{n:"??"},645:{n:"??"},646:{n:"??"},647:{n:"??"},648:{n:"??"},658:{n:"??"},659:{n:"??"},660:{n:"??"},661:{n:"??"},662:{n:"??"},665:{n:"??"},666:{n:"??"},768:{n:"??"},772:{n:"??"},1537:{n:"SHEETINFOQP",f:function sr(Te,tt,Fe){if(Fe.qpro&&!(tt<21)){var Ie=Te.read_shift(1);return Te.l+=17,Te.l+=1,Te.l+=2,[Ie,Te.read_shift(tt-21,"cstr")]}}},1600:{n:"??"},1602:{n:"??"},1793:{n:"??"},1794:{n:"??"},1795:{n:"??"},1796:{n:"??"},1920:{n:"??"},2048:{n:"??"},2049:{n:"??"},2052:{n:"??"},2688:{n:"??"},10998:{n:"??"},12849:{n:"??"},28233:{n:"??"},28484:{n:"??"},65535:{n:""}};return{sheet_to_wk1:function o(Te,tt){var Fe=tt||{};if(+Fe.codepage>=0&&Wn(+Fe.codepage),"string"==Fe.type)throw new Error("Cannot write WK1 to JS string");var Ie=O(),ft=ke(Te["!ref"]),$t=Array.isArray(Te),Pt=[];zt(Ie,0,function x(Te){var tt=A(2);return tt.write_shift(2,Te),tt}(1030)),zt(Ie,6,function C(Te){var tt=A(8);return tt.write_shift(2,Te.s.c),tt.write_shift(2,Te.s.r),tt.write_shift(2,Te.e.c),tt.write_shift(2,Te.e.r),tt}(ft));for(var Lt=Math.min(ft.e.r,8191),xt=ft.s.r;xt<=Lt;++xt)for(var zr=se(xt),be=ft.s.c;be<=ft.e.c;++be){xt===ft.s.r&&(Pt[be]=ce(be));var Hr=$t?(Te[xt]||[])[be]:Te[Pt[be]+zr];Hr&&"z"!=Hr.t&&("n"==Hr.t?(0|Hr.v)==Hr.v&&Hr.v>=-32768&&Hr.v<=32767?zt(Ie,13,j(xt,be,Hr.v)):zt(Ie,14,B(xt,be,Hr.v)):zt(Ie,15,N(xt,be,dt(Hr).slice(0,239))))}return zt(Ie,1),Ie.end()},book_to_wk3:function c(Te,tt){var Fe=tt||{};if(+Fe.codepage>=0&&Wn(+Fe.codepage),"string"==Fe.type)throw new Error("Cannot write WK3 to JS string");var Ie=O();zt(Ie,0,function y(Te){var tt=A(26);tt.write_shift(2,4096),tt.write_shift(2,4),tt.write_shift(4,0);for(var Fe=0,Ie=0,ft=0,$t=0;$t<Te.SheetNames.length;++$t){var Lt=Te.Sheets[Te.SheetNames[$t]];if(Lt&&Lt["!ref"]){++ft;var xt=qe(Lt["!ref"]);Fe<xt.e.r&&(Fe=xt.e.r),Ie<xt.e.c&&(Ie=xt.e.c)}}return Fe>8191&&(Fe=8191),tt.write_shift(2,Fe),tt.write_shift(1,ft),tt.write_shift(1,Ie),tt.write_shift(2,0),tt.write_shift(2,0),tt.write_shift(1,1),tt.write_shift(1,2),tt.write_shift(4,0),tt.write_shift(4,0),tt}(Te));for(var ft=0,$t=0;ft<Te.SheetNames.length;++ft)(Te.Sheets[Te.SheetNames[ft]]||{})["!ref"]&&zt(Ie,27,Xt(Te.SheetNames[ft],$t++));var Pt=0;for(ft=0;ft<Te.SheetNames.length;++ft){var Lt=Te.Sheets[Te.SheetNames[ft]];if(Lt&&Lt["!ref"]){for(var xt=ke(Lt["!ref"]),zr=Array.isArray(Lt),be=[],bi=Math.min(xt.e.r,8191),Hr=xt.s.r;Hr<=bi;++Hr)for(var Ti=se(Hr),Yr=xt.s.c;Yr<=xt.e.c;++Yr){Hr===xt.s.r&&(be[Yr]=ce(Yr));var _n=zr?(Lt[Hr]||[])[Yr]:Lt[be[Yr]+Ti];_n&&"z"!=_n.t&&("n"==_n.t?zt(Ie,23,at(Hr,Yr,Pt,_n.v)):zt(Ie,22,Se(Hr,Yr,Pt,dt(_n).slice(0,239))))}++Pt}}return zt(Ie,1),Ie.end()},to_workbook:function i(Te,tt){switch(tt.type){case"base64":return r(Xn(Qi(Te)),tt);case"binary":return r(Xn(Te),tt);case"buffer":case"array":return r(Te,tt)}throw"Unsupported type "+tt.type}}}(),_p=/^\s|\s$|[\t\n\r]/;function gp(e,i){if(!i.bookSST)return"";var r=[xi];r[r.length]=At("sst",null,{xmlns:ps[0],count:e.Count,uniqueCount:e.Unique});for(var o=0;o!=e.length;++o)if(null!=e[o]){var c=e[o],x="<si>";c.r?x+=c.r:(x+="<t",c.t||(c.t=""),c.t.match(_p)&&(x+=' xml:space="preserve"'),x+=">"+ni(c.t)+"</t>"),r[r.length]=x+="</si>"}return r.length>2&&(r[r.length]="</sst>",r[1]=r[1].replace("/>",">")),r.join("")}var Bd=function Dr(e,i){var r=!1;return null==i&&(r=!0,i=A(15+4*e.t.length)),i.write_shift(1,0),Ot(e.t,i),r?i.slice(0,i.l):i};function xp(e){var i=O();L(i,159,function zd(e,i){return i||(i=A(8)),i.write_shift(4,e.Count),i.write_shift(4,e.Unique),i}(e));for(var r=0;r<e.length;++r)L(i,19,Bd(e[r]));return L(i,160),i.end()}function Ss(e){var r,x,i=0,o=function Ta(e){for(var i=[],r=e.split(""),o=0;o<r.length;++o)i[o]=r[o].charCodeAt(0);return i}(e),c=o.length+1;for((r=en(c))[0]=o.length,x=1;x!=c;++x)r[x]=o[x-1];for(x=c-1;x>=0;--x)i=((0==(16384&i)?0:1)|i<<1&32767)^r[x];return 52811^i}var qd=function(){function e(c,x){switch(x.type){case"base64":return i(Qi(c),x);case"binary":return i(c,x);case"buffer":return i(_r&&Buffer.isBuffer(c)?c.toString("binary"):za(c),x);case"array":return i(Ws(c),x)}throw new Error("Unrecognized type "+x.type)}function i(c,x){var T=(x||{}).dense?[]:{},C=c.match(/\\trowd.*?\\row\b/g);if(!C.length)throw new Error("RTF missing table");var I={s:{c:0,r:0},e:{c:0,r:C.length-1}};return C.forEach(function(F,N){Array.isArray(T)&&(T[N]=[]);for(var W,U=/\\\w+\b/g,j=0,B=-1;W=U.exec(F);){if("\\cell"===W[0]){var X=F.slice(j,U.lastIndex-W[0].length);if(" "==X[0]&&(X=X.slice(1)),++B,X.length){var _e={v:X,t:"s"};Array.isArray(T)?T[N][B]=_e:T[Le({r:N,c:B})]=_e}}j=U.lastIndex}B>I.e.c&&(I.e.c=B)}),T["!ref"]=Qe(I),T}return{to_workbook:function r(c,x){return It(e(c,x),x)},to_sheet:e,from_sheet:function o(c){for(var T,x=["{\\rtf1\\ansi"],y=ke(c["!ref"]),C=Array.isArray(c),I=y.s.r;I<=y.e.r;++I){x.push("\\trowd\\trautofit1");for(var F=y.s.c;F<=y.e.c;++F)x.push("\\cellx"+(F+1));for(x.push("\\pard\\intbl"),F=y.s.c;F<=y.e.c;++F){var N=Le({r:I,c:F});(T=C?(c[I]||[])[F]:c[N])&&(null!=T.v||T.f&&!T.F)&&(x.push(" "+(T.w||(dt(T),T.w))),x.push("\\cell"))}x.push("\\pard\\intbl\\row")}return x.join("")+"}"}}}();function Qo(e){for(var i=0,r=1;3!=i;++i)r=256*r+(e[i]>255?255:e[i]<0?0:e[i]);return r.toString(16).toUpperCase().slice(1)}var Zn=6;function Ul(e){return Math.floor((e+Math.round(128/Zn)/256)*Zn)}function Zl(e){return Math.floor((e-5)/Zn*100+.5)/100}function Gf(e){return Math.round((e*Zn+5)/Zn*256)/256}function Vl(e){e.width?(e.wpx=Ul(e.width),e.wch=Zl(e.wpx),e.MDW=Zn):e.wpx?(e.wch=Zl(e.wpx),e.width=Gf(e.wch),e.MDW=Zn):"number"==typeof e.wch&&(e.width=Gf(e.wch),e.wpx=Ul(e.width),e.MDW=Zn),e.customWidth&&delete e.customWidth}function Nc(e){return 96*e/96}function $f(e){return 96*e/96}function Op(e,i){var o,r=[xi,At("styleSheet",null,{xmlns:ps[0],"xmlns:vt":Pi_vt})];return e.SSF&&null!=(o=function Lp(e){var i=["<numFmts>"];return[[5,8],[23,26],[41,44],[50,392]].forEach(function(r){for(var o=r[0];o<=r[1];++o)null!=e[o]&&(i[i.length]=At("numFmt",null,{numFmtId:o,formatCode:ni(e[o])}))}),1===i.length?"":(i[i.length]="</numFmts>",i[0]=At("numFmts",null,{count:i.length-2}).replace("/>",">"),i.join(""))}(e.SSF))&&(r[r.length]=o),r[r.length]='<fonts count="1"><font><sz val="12"/><color theme="1"/><name val="Calibri"/><family val="2"/><scheme val="minor"/></font></fonts>',r[r.length]='<fills count="2"><fill><patternFill patternType="none"/></fill><fill><patternFill patternType="gray125"/></fill></fills>',r[r.length]='<borders count="1"><border><left/><right/><top/><bottom/><diagonal/></border></borders>',r[r.length]='<cellStyleXfs count="1"><xf numFmtId="0" fontId="0" fillId="0" borderId="0"/></cellStyleXfs>',(o=function I_(e){var i=[];return i[i.length]=At("cellXfs",null),e.forEach(function(r){i[i.length]=At("xf",null,r)}),i[i.length]="</cellXfs>",2===i.length?"":(i[0]=At("cellXfs",null,{count:i.length-2}).replace("/>",">"),i.join(""))}(i.cellXfs))&&(r[r.length]=o),r[r.length]='<cellStyles count="1"><cellStyle name="Normal" xfId="0" builtinId="0"/></cellStyles>',r[r.length]='<dxfs count="0"/>',r[r.length]='<tableStyles count="0" defaultTableStyle="TableStyleMedium9" defaultPivotStyle="PivotStyleMedium4"/>',r.length>2&&(r[r.length]="</styleSheet>",r[1]=r[1].replace("/>",">")),r.join("")}function Wd(e,i,r){r||(r=A(6+4*i.length)),r.write_shift(2,e),Ot(i,r);var o=r.length>r.l?r.slice(0,r.l):r;return null==r.l&&(r.l=r.length),o}var to,Hd=["none","solid","mediumGray","darkGray","lightGray","darkHorizontal","darkVertical","darkDown","darkUp","darkGrid","darkTrellis","lightHorizontal","lightVertical","lightDown","lightUp","lightGrid","lightTrellis","gray125","gray0625"],D_=S;function Xf(e,i){i||(i=A(84)),to||(to=bl(Hd));var r=to[e.patternType];null==r&&(r=40),i.write_shift(4,r);var o=0;if(40!=r)for(Va({auto:1},i),Va({auto:1},i);o<12;++o)i.write_shift(4,0);else{for(;o<4;++o)i.write_shift(4,0);for(;o<12;++o)i.write_shift(4,0)}return i.length>i.l?i.slice(0,i.l):i}function zh(e,i,r){return r||(r=A(16)),r.write_shift(2,i||0),r.write_shift(2,e.numFmtId||0),r.write_shift(2,0),r.write_shift(2,0),r.write_shift(2,0),r.write_shift(1,0),r.write_shift(1,0),r.write_shift(1,0),r.write_shift(1,0),r.write_shift(1,0),r.write_shift(1,0),r}function Bh(e,i){return i||(i=A(10)),i.write_shift(1,0),i.write_shift(1,0),i.write_shift(4,0),i.write_shift(4,0),i}var P_=S;function Uh(e,i){var r=O();return L(r,278),function Nh(e,i){if(i){var r=0;[[5,8],[23,26],[41,44],[50,392]].forEach(function(o){for(var c=o[0];c<=o[1];++c)null!=i[c]&&++r}),0!=r&&(L(e,615,Et(r)),[[5,8],[23,26],[41,44],[50,392]].forEach(function(o){for(var c=o[0];c<=o[1];++c)null!=i[c]&&L(e,44,Wd(c,i[c]))}),L(e,616))}}(r,e.SSF),function Kd(e){L(e,611,Et(1)),L(e,43,function Xd(e,i){i||(i=A(153)),i.write_shift(2,20*e.sz),function yf(e,i){i||(i=A(2)),i.write_shift(1,(e.italic?2:0)|(e.strike?8:0)|(e.outline?16:0)|(e.shadow?32:0)|(e.condense?64:0)|(e.extend?128:0)),i.write_shift(1,0)}(e,i),i.write_shift(2,e.bold?700:400);var r=0;"superscript"==e.vertAlign?r=1:"subscript"==e.vertAlign&&(r=2),i.write_shift(2,r),i.write_shift(1,e.underline||0),i.write_shift(1,e.family||0),i.write_shift(1,e.charset||0),i.write_shift(1,0),Va(e.color,i);var o=0;return"major"==e.scheme&&(o=1),"minor"==e.scheme&&(o=2),i.write_shift(1,o),Ot(e.name,i),i.length>i.l?i.slice(0,i.l):i}({sz:12,color:{theme:1},name:"Calibri",family:2,scheme:"minor"})),L(e,612)}(r),function z_(e){L(e,603,Et(2)),L(e,45,Xf({patternType:"none"})),L(e,45,Xf({patternType:"gray125"})),L(e,604)}(r),function B_(e){L(e,613,Et(1)),L(e,46,function L_(e,i){return i||(i=A(51)),i.write_shift(1,0),Bh(0,i),Bh(0,i),Bh(0,i),Bh(0,i),Bh(0,i),i.length>i.l?i.slice(0,i.l):i}()),L(e,614)}(r),function Bp(e){L(e,626,Et(1)),L(e,47,zh({numFmtId:0,fontId:0,fillId:0,borderId:0},65535)),L(e,627)}(r),function N_(e,i){L(e,617,Et(i.length)),i.forEach(function(r){L(e,47,zh(r,0))}),L(e,618)}(r,i.cellXfs),function U_(e){L(e,619,Et(1)),L(e,48,function R_(e,i){return i||(i=A(52)),i.write_shift(4,e.xfId),i.write_shift(2,1),i.write_shift(1,+e.builtinId),i.write_shift(1,0),mi(e.name||"",i),i.length>i.l?i.slice(0,i.l):i}({xfId:0,builtinId:0,name:"Normal"})),L(e,620)}(r),function Z_(e){L(e,505,Et(0)),L(e,506)}(r),function Np(e){L(e,508,function Yd(e,i,r){var o=A(2052);return o.write_shift(4,e),mi(i,o),mi(r,o),o.length>o.l?o.slice(0,o.l):o}(0,"TableStyleMedium9","PivotStyleMedium4")),L(e,509)}(r),L(r,279),r.end()}function As(e,i){if(i&&i.themeXLSX)return i.themeXLSX;if(e&&"string"==typeof e.raw)return e.raw;var r=[xi];return r[r.length]='<a:theme xmlns:a="http://schemas.openxmlformats.org/drawingml/2006/main" name="Office Theme">',r[r.length]="<a:themeElements>",r[r.length]='<a:clrScheme name="Office">',r[r.length]='<a:dk1><a:sysClr val="windowText" lastClr="000000"/></a:dk1>',r[r.length]='<a:lt1><a:sysClr val="window" lastClr="FFFFFF"/></a:lt1>',r[r.length]='<a:dk2><a:srgbClr val="1F497D"/></a:dk2>',r[r.length]='<a:lt2><a:srgbClr val="EEECE1"/></a:lt2>',r[r.length]='<a:accent1><a:srgbClr val="4F81BD"/></a:accent1>',r[r.length]='<a:accent2><a:srgbClr val="C0504D"/></a:accent2>',r[r.length]='<a:accent3><a:srgbClr val="9BBB59"/></a:accent3>',r[r.length]='<a:accent4><a:srgbClr val="8064A2"/></a:accent4>',r[r.length]='<a:accent5><a:srgbClr val="4BACC6"/></a:accent5>',r[r.length]='<a:accent6><a:srgbClr val="F79646"/></a:accent6>',r[r.length]='<a:hlink><a:srgbClr val="0000FF"/></a:hlink>',r[r.length]='<a:folHlink><a:srgbClr val="800080"/></a:folHlink>',r[r.length]="</a:clrScheme>",r[r.length]='<a:fontScheme name="Office">',r[r.length]="<a:majorFont>",r[r.length]='<a:latin typeface="Cambria"/>',r[r.length]='<a:ea typeface=""/>',r[r.length]='<a:cs typeface=""/>',r[r.length]='<a:font script="Jpan" typeface="\uff2d\uff33 \uff30\u30b4\u30b7\u30c3\u30af"/>',r[r.length]='<a:font script="Hang" typeface="\ub9d1\uc740 \uace0\ub515"/>',r[r.length]='<a:font script="Hans" typeface="\u5b8b\u4f53"/>',r[r.length]='<a:font script="Hant" typeface="\u65b0\u7d30\u660e\u9ad4"/>',r[r.length]='<a:font script="Arab" typeface="Times New Roman"/>',r[r.length]='<a:font script="Hebr" typeface="Times New Roman"/>',r[r.length]='<a:font script="Thai" typeface="Tahoma"/>',r[r.length]='<a:font script="Ethi" typeface="Nyala"/>',r[r.length]='<a:font script="Beng" typeface="Vrinda"/>',r[r.length]='<a:font script="Gujr" typeface="Shruti"/>',r[r.length]='<a:font script="Khmr" typeface="MoolBoran"/>',r[r.length]='<a:font script="Knda" typeface="Tunga"/>',r[r.length]='<a:font script="Guru" typeface="Raavi"/>',r[r.length]='<a:font script="Cans" typeface="Euphemia"/>',r[r.length]='<a:font script="Cher" typeface="Plantagenet Cherokee"/>',r[r.length]='<a:font script="Yiii" typeface="Microsoft Yi Baiti"/>',r[r.length]='<a:font script="Tibt" typeface="Microsoft Himalaya"/>',r[r.length]='<a:font script="Thaa" typeface="MV Boli"/>',r[r.length]='<a:font script="Deva" typeface="Mangal"/>',r[r.length]='<a:font script="Telu" typeface="Gautami"/>',r[r.length]='<a:font script="Taml" typeface="Latha"/>',r[r.length]='<a:font script="Syrc" typeface="Estrangelo Edessa"/>',r[r.length]='<a:font script="Orya" typeface="Kalinga"/>',r[r.length]='<a:font script="Mlym" typeface="Kartika"/>',r[r.length]='<a:font script="Laoo" typeface="DokChampa"/>',r[r.length]='<a:font script="Sinh" typeface="Iskoola Pota"/>',r[r.length]='<a:font script="Mong" typeface="Mongolian Baiti"/>',r[r.length]='<a:font script="Viet" typeface="Times New Roman"/>',r[r.length]='<a:font script="Uigh" typeface="Microsoft Uighur"/>',r[r.length]='<a:font script="Geor" typeface="Sylfaen"/>',r[r.length]="</a:majorFont>",r[r.length]="<a:minorFont>",r[r.length]='<a:latin typeface="Calibri"/>',r[r.length]='<a:ea typeface=""/>',r[r.length]='<a:cs typeface=""/>',r[r.length]='<a:font script="Jpan" typeface="\uff2d\uff33 \uff30\u30b4\u30b7\u30c3\u30af"/>',r[r.length]='<a:font script="Hang" typeface="\ub9d1\uc740 \uace0\ub515"/>',r[r.length]='<a:font script="Hans" typeface="\u5b8b\u4f53"/>',r[r.length]='<a:font script="Hant" typeface="\u65b0\u7d30\u660e\u9ad4"/>',r[r.length]='<a:font script="Arab" typeface="Arial"/>',r[r.length]='<a:font script="Hebr" typeface="Arial"/>',r[r.length]='<a:font script="Thai" typeface="Tahoma"/>',r[r.length]='<a:font script="Ethi" typeface="Nyala"/>',r[r.length]='<a:font script="Beng" typeface="Vrinda"/>',r[r.length]='<a:font script="Gujr" typeface="Shruti"/>',r[r.length]='<a:font script="Khmr" typeface="DaunPenh"/>',r[r.length]='<a:font script="Knda" typeface="Tunga"/>',r[r.length]='<a:font script="Guru" typeface="Raavi"/>',r[r.length]='<a:font script="Cans" typeface="Euphemia"/>',r[r.length]='<a:font script="Cher" typeface="Plantagenet Cherokee"/>',r[r.length]='<a:font script="Yiii" typeface="Microsoft Yi Baiti"/>',r[r.length]='<a:font script="Tibt" typeface="Microsoft Himalaya"/>',r[r.length]='<a:font script="Thaa" typeface="MV Boli"/>',r[r.length]='<a:font script="Deva" typeface="Mangal"/>',r[r.length]='<a:font script="Telu" typeface="Gautami"/>',r[r.length]='<a:font script="Taml" typeface="Latha"/>',r[r.length]='<a:font script="Syrc" typeface="Estrangelo Edessa"/>',r[r.length]='<a:font script="Orya" typeface="Kalinga"/>',r[r.length]='<a:font script="Mlym" typeface="Kartika"/>',r[r.length]='<a:font script="Laoo" typeface="DokChampa"/>',r[r.length]='<a:font script="Sinh" typeface="Iskoola Pota"/>',r[r.length]='<a:font script="Mong" typeface="Mongolian Baiti"/>',r[r.length]='<a:font script="Viet" typeface="Arial"/>',r[r.length]='<a:font script="Uigh" typeface="Microsoft Uighur"/>',r[r.length]='<a:font script="Geor" typeface="Sylfaen"/>',r[r.length]="</a:minorFont>",r[r.length]="</a:fontScheme>",r[r.length]='<a:fmtScheme name="Office">',r[r.length]="<a:fillStyleLst>",r[r.length]='<a:solidFill><a:schemeClr val="phClr"/></a:solidFill>',r[r.length]='<a:gradFill rotWithShape="1">',r[r.length]="<a:gsLst>",r[r.length]='<a:gs pos="0"><a:schemeClr val="phClr"><a:tint val="50000"/><a:satMod val="300000"/></a:schemeClr></a:gs>',r[r.length]='<a:gs pos="35000"><a:schemeClr val="phClr"><a:tint val="37000"/><a:satMod val="300000"/></a:schemeClr></a:gs>',r[r.length]='<a:gs pos="100000"><a:schemeClr val="phClr"><a:tint val="15000"/><a:satMod val="350000"/></a:schemeClr></a:gs>',r[r.length]="</a:gsLst>",r[r.length]='<a:lin ang="16200000" scaled="1"/>',r[r.length]="</a:gradFill>",r[r.length]='<a:gradFill rotWithShape="1">',r[r.length]="<a:gsLst>",r[r.length]='<a:gs pos="0"><a:schemeClr val="phClr"><a:tint val="100000"/><a:shade val="100000"/><a:satMod val="130000"/></a:schemeClr></a:gs>',r[r.length]='<a:gs pos="100000"><a:schemeClr val="phClr"><a:tint val="50000"/><a:shade val="100000"/><a:satMod val="350000"/></a:schemeClr></a:gs>',r[r.length]="</a:gsLst>",r[r.length]='<a:lin ang="16200000" scaled="0"/>',r[r.length]="</a:gradFill>",r[r.length]="</a:fillStyleLst>",r[r.length]="<a:lnStyleLst>",r[r.length]='<a:ln w="9525" cap="flat" cmpd="sng" algn="ctr"><a:solidFill><a:schemeClr val="phClr"><a:shade val="95000"/><a:satMod val="105000"/></a:schemeClr></a:solidFill><a:prstDash val="solid"/></a:ln>',r[r.length]='<a:ln w="25400" cap="flat" cmpd="sng" algn="ctr"><a:solidFill><a:schemeClr val="phClr"/></a:solidFill><a:prstDash val="solid"/></a:ln>',r[r.length]='<a:ln w="38100" cap="flat" cmpd="sng" algn="ctr"><a:solidFill><a:schemeClr val="phClr"/></a:solidFill><a:prstDash val="solid"/></a:ln>',r[r.length]="</a:lnStyleLst>",r[r.length]="<a:effectStyleLst>",r[r.length]="<a:effectStyle>",r[r.length]="<a:effectLst>",r[r.length]='<a:outerShdw blurRad="40000" dist="20000" dir="5400000" rotWithShape="0"><a:srgbClr val="000000"><a:alpha val="38000"/></a:srgbClr></a:outerShdw>',r[r.length]="</a:effectLst>",r[r.length]="</a:effectStyle>",r[r.length]="<a:effectStyle>",r[r.length]="<a:effectLst>",r[r.length]='<a:outerShdw blurRad="40000" dist="23000" dir="5400000" rotWithShape="0"><a:srgbClr val="000000"><a:alpha val="35000"/></a:srgbClr></a:outerShdw>',r[r.length]="</a:effectLst>",r[r.length]="</a:effectStyle>",r[r.length]="<a:effectStyle>",r[r.length]="<a:effectLst>",r[r.length]='<a:outerShdw blurRad="40000" dist="23000" dir="5400000" rotWithShape="0"><a:srgbClr val="000000"><a:alpha val="35000"/></a:srgbClr></a:outerShdw>',r[r.length]="</a:effectLst>",r[r.length]='<a:scene3d><a:camera prst="orthographicFront"><a:rot lat="0" lon="0" rev="0"/></a:camera><a:lightRig rig="threePt" dir="t"><a:rot lat="0" lon="0" rev="1200000"/></a:lightRig></a:scene3d>',r[r.length]='<a:sp3d><a:bevelT w="63500" h="25400"/></a:sp3d>',r[r.length]="</a:effectStyle>",r[r.length]="</a:effectStyleLst>",r[r.length]="<a:bgFillStyleLst>",r[r.length]='<a:solidFill><a:schemeClr val="phClr"/></a:solidFill>',r[r.length]='<a:gradFill rotWithShape="1">',r[r.length]="<a:gsLst>",r[r.length]='<a:gs pos="0"><a:schemeClr val="phClr"><a:tint val="40000"/><a:satMod val="350000"/></a:schemeClr></a:gs>',r[r.length]='<a:gs pos="40000"><a:schemeClr val="phClr"><a:tint val="45000"/><a:shade val="99000"/><a:satMod val="350000"/></a:schemeClr></a:gs>',r[r.length]='<a:gs pos="100000"><a:schemeClr val="phClr"><a:shade val="20000"/><a:satMod val="255000"/></a:schemeClr></a:gs>',r[r.length]="</a:gsLst>",r[r.length]='<a:path path="circle"><a:fillToRect l="50000" t="-80000" r="50000" b="180000"/></a:path>',r[r.length]="</a:gradFill>",r[r.length]='<a:gradFill rotWithShape="1">',r[r.length]="<a:gsLst>",r[r.length]='<a:gs pos="0"><a:schemeClr val="phClr"><a:tint val="80000"/><a:satMod val="300000"/></a:schemeClr></a:gs>',r[r.length]='<a:gs pos="100000"><a:schemeClr val="phClr"><a:shade val="30000"/><a:satMod val="200000"/></a:schemeClr></a:gs>',r[r.length]="</a:gsLst>",r[r.length]='<a:path path="circle"><a:fillToRect l="50000" t="50000" r="50000" b="50000"/></a:path>',r[r.length]="</a:gradFill>",r[r.length]="</a:bgFillStyleLst>",r[r.length]="</a:fmtScheme>",r[r.length]="</a:themeElements>",r[r.length]="<a:objectDefaults>",r[r.length]="<a:spDef>",r[r.length]='<a:spPr/><a:bodyPr/><a:lstStyle/><a:style><a:lnRef idx="1"><a:schemeClr val="accent1"/></a:lnRef><a:fillRef idx="3"><a:schemeClr val="accent1"/></a:fillRef><a:effectRef idx="2"><a:schemeClr val="accent1"/></a:effectRef><a:fontRef idx="minor"><a:schemeClr val="lt1"/></a:fontRef></a:style>',r[r.length]="</a:spDef>",r[r.length]="<a:lnDef>",r[r.length]='<a:spPr/><a:bodyPr/><a:lstStyle/><a:style><a:lnRef idx="2"><a:schemeClr val="accent1"/></a:lnRef><a:fillRef idx="0"><a:schemeClr val="accent1"/></a:fillRef><a:effectRef idx="1"><a:schemeClr val="accent1"/></a:effectRef><a:fontRef idx="minor"><a:schemeClr val="tx1"/></a:fontRef></a:style>',r[r.length]="</a:lnDef>",r[r.length]="</a:objectDefaults>",r[r.length]="<a:extraClrSchemeLst/>",r[r.length]="</a:theme>",r.join("")}function Xp(){var e=O();return L(e,332),L(e,334,Et(1)),L(e,335,function Hf(e){var i=A(12+2*e.name.length);return i.write_shift(4,e.flags),i.write_shift(4,e.version),Ot(e.name,i),i.slice(0,i.l)}({name:"XLDAPR",version:12e4,flags:3496657072})),L(e,336),L(e,339,function Vh(e,i){var r=A(8+2*i.length);return r.write_shift(4,e),Ot(i,r),r.slice(0,r.l)}(1,"XLDAPR")),L(e,52),L(e,35,Et(514)),L(e,4096,Et(0)),L(e,4097,wa(1)),L(e,36),L(e,53),L(e,340),L(e,337,function Wp(e,i){var r=A(8);return r.write_shift(4,e),r.write_shift(4,i?1:0),r}(1,!0)),L(e,51,function ta(e){var i=A(4+8*e.length);i.write_shift(4,e.length);for(var r=0;r<e.length;++r)i.write_shift(4,e[r][0]),i.write_shift(4,e[r][1]);return i}([[1,0]])),L(e,338),L(e,333),e.end()}function ks(){var e=[xi];return e.push('<metadata xmlns="http://schemas.openxmlformats.org/spreadsheetml/2006/main" xmlns:xlrd="http://schemas.microsoft.com/office/spreadsheetml/2017/richdata" xmlns:xda="http://schemas.microsoft.com/office/spreadsheetml/2017/dynamicarray">\n  <metadataTypes count="1">\n    <metadataType name="XLDAPR" minSupportedVersion="120000" copy="1" pasteAll="1" pasteValues="1" merge="1" splitFirst="1" rowColShift="1" clearFormats="1" clearComments="1" assign="1" coerce="1" cellMeta="1"/>\n  </metadataTypes>\n  <futureMetadata name="XLDAPR" count="1">\n    <bk>\n      <extLst>\n        <ext uri="{bdbb8cdc-fa1e-496e-a857-3c3f30c029c3}">\n          <xda:dynamicArrayProperties fDynamic="1" fCollapsed="0"/>\n        </ext>\n      </extLst>\n    </bk>\n  </futureMetadata>\n  <cellMetadata count="1">\n    <bk>\n      <rc t="1" v="0"/>\n    </bk>\n  </cellMetadata>\n</metadata>'),e.join("")}var jc=1024;function Yf(e,i){for(var r=[21600,21600],o=["m0,0l0",r[1],r[0],r[1],r[0],"0xe"].join(","),c=[At("xml",null,{"xmlns:v":"urn:schemas-microsoft-com:vml","xmlns:o":Qn_o,"xmlns:x":Qn_x,"xmlns:mv":"http://macVmlSchemaUri"}).replace(/\/>/,">"),At("o:shapelayout",At("o:idmap",null,{"v:ext":"edit",data:e}),{"v:ext":"edit"}),At("v:shapetype",[At("v:stroke",null,{joinstyle:"miter"}),At("v:path",null,{gradientshapeok:"t","o:connecttype":"rect"})].join(""),{id:"_x0000_t202","o:spt":202,coordsize:r.join(","),path:o})];jc<1e3*e;)jc+=1e3;return i.forEach(function(x){var y=Be(x[0]),T={color2:"#BEFF82",type:"gradient"};"gradient"==T.type&&(T.angle="-180");var C="gradient"==T.type?At("o:fill",null,{type:"gradientUnscaled","v:ext":"view"}):null,I=At("v:fill",C,T);++jc,c=c.concat(["<v:shape"+Il({id:"_x0000_s"+jc,type:"#_x0000_t202",style:"position:absolute; margin-left:80pt;margin-top:5pt;width:104pt;height:64pt;z-index:10"+(x[1].hidden?";visibility:hidden":""),fillcolor:"#ECFAD4",strokecolor:"#edeaa1"})+">",I,At("v:shadow",null,{on:"t",obscured:"t"}),At("v:path",null,{"o:connecttype":"none"}),'<v:textbox><div style="text-align:left"></div></v:textbox>','<x:ClientData ObjectType="Note">',"<x:MoveWithCells/>","<x:SizeWithCells/>",tn("x:Anchor",[y.c+1,0,y.r+1,0,y.c+3,20,y.r+5,20].join(",")),tn("x:AutoFill","False"),tn("x:Row",String(y.r)),tn("x:Column",String(y.c)),x[1].hidden?"":"<x:Visible/>","</x:ClientData>","</v:shape>"])}),c.push("</xml>"),c.join("")}function i0(e){var i=[xi,At("comments",null,{xmlns:ps[0]})],r=[];return i.push("<authors>"),e.forEach(function(o){o[1].forEach(function(c){var x=ni(c.a);-1==r.indexOf(x)&&(r.push(x),i.push("<author>"+x+"</author>")),c.T&&c.ID&&-1==r.indexOf("tc="+c.ID)&&(r.push("tc="+c.ID),i.push("<author>tc="+c.ID+"</author>"))})}),0==r.length&&(r.push("SheetJ5"),i.push("<author>SheetJ5</author>")),i.push("</authors>"),i.push("<commentList>"),e.forEach(function(o){var c=0,x=[];if(o[1][0]&&o[1][0].T&&o[1][0].ID?c=r.indexOf("tc="+o[1][0].ID):o[1].forEach(function(C){C.a&&(c=r.indexOf(ni(C.a))),x.push(C.t||"")}),i.push('<comment ref="'+o[0]+'" authorId="'+c+'"><text>'),x.length<=1)i.push(tn("t",ni(x[0]||"")));else{for(var y="Comment:\n    "+x[0]+"\n",T=1;T<x.length;++T)y+="Reply:\n    "+x[T]+"\n";i.push(tn("t",ni(y)))}i.push("</text></comment>")}),i.push("</commentList>"),i.length>2&&(i[i.length]="</comments>",i[1]=i[1].replace("/>",">")),i.join("")}function em(e,i,r){var o=[xi,At("ThreadedComments",null,{xmlns:Pi_TCMNT}).replace(/[\/]>/,">")];return e.forEach(function(c){var x="";(c[1]||[]).forEach(function(y,T){if(y.T){y.a&&-1==i.indexOf(y.a)&&i.push(y.a);var C={ref:c[0],id:"{54EE7951-7262-4200-6969-"+("000000000000"+r.tcid++).slice(-12)+"}"};0==T?x=C.id:C.parentId=x,y.ID=C.id,y.a&&(C.personId="{54EE7950-7262-4200-6969-"+("000000000000"+i.indexOf(y.a)).slice(-12)+"}"),o.push(At("threadedComment",tn("text",y.t||""),C))}else delete y.ID})}),o.push("</ThreadedComments>"),o.join("")}var nm=bt;function ju(e){var i=O(),r=[];return L(i,628),L(i,630),e.forEach(function(o){o[1].forEach(function(c){r.indexOf(c.a)>-1||(r.push(c.a.slice(0,54)),L(i,632,function Kf(e){return Ot(e.slice(0,54))}(c.a)))})}),L(i,631),L(i,633),e.forEach(function(o){o[1].forEach(function(c){c.iauthor=r.indexOf(c.a);var x={s:Be(o[0]),e:Be(o[0])};L(i,635,function Gl(e,i){return null==i&&(i=A(36)),i.write_shift(4,e[1].iauthor),$o(e[0],i),i.write_shift(4,0),i.write_shift(4,0),i.write_shift(4,0),i.write_shift(4,0),i}([x,c])),c.t&&c.t.length>0&&L(i,637,function Tn(e,i){var r=!1;return null==i&&(r=!0,i=A(23+4*e.t.length)),i.write_shift(1,1),Ot(e.t,i),i.write_shift(4,1),function Ht(e,i){i||(i=A(4)),i.write_shift(2,e.ich||0),i.write_shift(2,e.ifnt||0)}({ich:0,ifnt:0},i),r?i.slice(0,i.l):i}(c)),L(i,636),delete c.iauthor})}),L(i,634),L(i,629),i.end()}var Jf=["xlsb","xlsm","xlam","biff8","xla"],Gc=function(){var e=/(^|[^A-Za-z_])R(\[?-?\d+\]|[1-9]\d*|)C(\[?-?\d+\]|[1-9]\d*|)(?![A-Za-z0-9_])/g,i={r:0,c:0};function r(o,c,x,y){var T=!1,C=!1;0==x.length?C=!0:"["==x.charAt(0)&&(C=!0,x=x.slice(1,-1)),0==y.length?T=!0:"["==y.charAt(0)&&(T=!0,y=y.slice(1,-1));var I=x.length>0?0|parseInt(x,10):0,F=y.length>0?0|parseInt(y,10):0;return T?F+=i.c:--F,C?I+=i.r:--I,c+(T?"":"$")+ce(F)+(C?"":"$")+se(I)}return function(c,x){return i=x,c.replace(e,r)}}(),qu=/(^|[^._A-Z0-9])([$]?)([A-Z]{1,2}|[A-W][A-Z]{2}|X[A-E][A-Z]|XF[A-D])([$]?)(10[0-3]\d{4}|104[0-7]\d{3}|1048[0-4]\d{2}|10485[0-6]\d|104857[0-6]|[1-9]\d{0,5})(?![_.\(A-Za-z0-9])/g,Qf=function(){return function(i,r){return i.replace(qu,function(o,c,x,y,T,C){var I=de(y)-(x?0:r.c),F=H(C)-(T?0:r.r);return c+"R"+(0==F?"":T?F+1:"["+F+"]")+"C"+(0==I?"":x?I+1:"["+I+"]")})}}();function o0(e,i){return e.replace(qu,function(r,o,c,x,y,T){return o+("$"==c?c+x:ce(de(x)+i.c))+("$"==y?y+T:se(H(T)+i.r))})}function $i(e){e.l+=1}function el(e,i){var r=e.read_shift(1==i?1:2);return[16383&r,r>>14&1,r>>15&1]}function l0(e,i,r){var o=2;if(r){if(r.biff>=2&&r.biff<=5)return om(e);12==r.biff&&(o=4)}var c=e.read_shift(o),x=e.read_shift(o),y=el(e,2),T=el(e,2);return{s:{r:c,c:y[0],cRel:y[1],rRel:y[2]},e:{r:x,c:T[0],cRel:T[1],rRel:T[2]}}}function om(e){var i=el(e,2),r=el(e,2),o=e.read_shift(1),c=e.read_shift(1);return{s:{r:i[0],c:o,cRel:i[1],rRel:i[2]},e:{r:r[0],c,cRel:r[1],rRel:r[2]}}}function lm(e,i,r){if(r&&r.biff>=2&&r.biff<=5)return function Y_(e){var i=el(e,2),r=e.read_shift(1);return{r:i[0],c:r,cRel:i[1],rRel:i[2]}}(e);var o=e.read_shift(r&&12==r.biff?4:2),c=el(e,2);return{r:o,c:c[0],cRel:c[1],rRel:c[2]}}function jh(e){var i=e.read_shift(2),r=e.read_shift(2);return{r:i,c:255&r,fQuoted:!!(16384&r),cRel:r>>15,rRel:r>>15}}function cm(e){var i=1&e[e.l+1];return e.l+=4,[i,1]}function a(e){return[e.read_shift(1),e.read_shift(1)]}function ee(e,i){var r=[e.read_shift(1)];if(12==i)switch(r[0]){case 2:r[0]=4;break;case 4:r[0]=16;break;case 0:r[0]=1;break;case 1:r[0]=2}switch(r[0]){case 4:r[1]=function Ui(e,i){return 1===e.read_shift(i)}(e,1)?"TRUE":"FALSE",12!=i&&(e.l+=7);break;case 37:case 16:r[1]=Ho[e[e.l]],e.l+=12==i?4:8;break;case 0:e.l+=8;break;case 1:r[1]=rn(e);break;case 2:r[1]=function Rc(e,i,r){if(r.biff>5)return function Eh(e,i,r){var o=e.read_shift(r&&2==r.biff?1:2);return 0===o?(e.l++,""):function ts(e,i,r){if(r){if(r.biff>=2&&r.biff<=5)return e.read_shift(i,"cpstr");if(r.biff>=12)return e.read_shift(i,"dbcs-cont")}var c=e.read_shift(1);return e.read_shift(i,0===c?"sbcs-cont":"dbcs-cont")}(e,o,r)}(e,0,r);var o=e.read_shift(1);return 0===o?(e.l++,""):e.read_shift(o,r.biff<=4||!e.lens?"cpstr":"sbcs-cont")}(e,0,{biff:i>0&&i<8?2:i});break;default:throw new Error("Bad SerAr: "+r[0])}return r}function ne(e,i,r){for(var o=e.read_shift(12==r.biff?4:2),c=[],x=0;x!=o;++x)c.push((12==r.biff?fa:Pu)(e,8));return c}function ve(e,i,r){var o=0,c=0;12==r.biff?(o=e.read_shift(4),c=e.read_shift(4)):(c=1+e.read_shift(1),o=1+e.read_shift(2)),r.biff>=2&&r.biff<8&&(--o,0==--c&&(c=256));for(var x=0,y=[];x!=o&&(y[x]=[]);++x)for(var T=0;T!=c;++T)y[x][T]=ee(e,r.biff);return y}function pt(e,i,r){return e.l+=2,[jh(e)]}function vt(e){return e.l+=6,[]}function ur(e){return e.l+=2,[Li(e),1&e.read_shift(2)]}var Wi=["Data","All","Headers","??","?Data2","??","?DataHeaders","??","Totals","??","??","??","?DataTotals","??","??","??","?Current"],Vi={1:{n:"PtgExp",f:function M(e,i,r){return e.l++,r&&12==r.biff?[e.read_shift(4,"i"),0]:[e.read_shift(2),e.read_shift(r&&2==r.biff?1:2)]}},2:{n:"PtgTbl",f:S},3:{n:"PtgAdd",f:$i},4:{n:"PtgSub",f:$i},5:{n:"PtgMul",f:$i},6:{n:"PtgDiv",f:$i},7:{n:"PtgPower",f:$i},8:{n:"PtgConcat",f:$i},9:{n:"PtgLt",f:$i},10:{n:"PtgLe",f:$i},11:{n:"PtgEq",f:$i},12:{n:"PtgGe",f:$i},13:{n:"PtgGt",f:$i},14:{n:"PtgNe",f:$i},15:{n:"PtgIsect",f:$i},16:{n:"PtgUnion",f:$i},17:{n:"PtgRange",f:$i},18:{n:"PtgUplus",f:$i},19:{n:"PtgUminus",f:$i},20:{n:"PtgPercent",f:$i},21:{n:"PtgParen",f:$i},22:{n:"PtgMissArg",f:$i},23:{n:"PtgStr",f:function K(e,i,r){return e.l++,Ts(e,0,r)}},26:{n:"PtgSheet",f:function jr(e,i,r){return e.l+=5,e.l+=2,e.l+=2==r.biff?1:4,["PTGSHEET"]}},27:{n:"PtgEndSheet",f:function Ir(e,i,r){return e.l+=2==r.biff?4:5,["PTGENDSHEET"]}},28:{n:"PtgErr",f:function D(e){return e.l++,Ho[e.read_shift(1)]}},29:{n:"PtgBool",f:function z(e){return e.l++,0!==e.read_shift(1)}},30:{n:"PtgInt",f:function R(e){return e.l++,e.read_shift(2)}},31:{n:"PtgNum",f:function q(e){return e.l++,rn(e)}},32:{n:"PtgArray",f:function td(e,i,r){var o=(96&e[e.l++])>>5;return e.l+=2==r.biff?6:12==r.biff?14:7,[o]}},33:{n:"PtgFunc",f:function g(e,i,r){var o=(96&e[e.l])>>5;e.l+=1;var c=e.read_shift(r&&r.biff<=3?1:2);return[c0[c],rd[c],o]}},34:{n:"PtgFuncVar",f:function v(e,i,r){var o=e[e.l++],c=e.read_shift(1),x=r&&r.biff<=3?[88==o?-1:0,e.read_shift(1)]:function E(e){return[e[e.l+1]>>7,32767&e.read_shift(2)]}(e);return[c,(0===x[0]?rd:_m)[x[1]]]}},35:{n:"PtgName",f:function Ae(e,i,r){var o=e.read_shift(1)>>>5&3,x=e.read_shift(!r||r.biff>=8?4:2);switch(r.biff){case 2:e.l+=5;break;case 3:case 4:e.l+=8;break;case 5:e.l+=12}return[o,0,x]}},36:{n:"PtgRef",f:function l(e,i,r){var o=(96&e[e.l])>>5;return e.l+=1,[o,lm(e,0,r)]}},37:{n:"PtgArea",f:function $h(e,i,r){return[(96&e[e.l++])>>5,l0(e,0,r)]}},38:{n:"PtgMemArea",f:function Pe(e,i,r){var o=e.read_shift(1)>>>5&3;return e.l+=r&&2==r.biff?3:4,[o,e.read_shift(r&&2==r.biff?1:2)]}},39:{n:"PtgMemErr",f:S},40:{n:"PtgMemNoMem",f:S},41:{n:"PtgMemFunc",f:function Xe(e,i,r){return[e.read_shift(1)>>>5&3,e.read_shift(r&&2==r.biff?1:2)]}},42:{n:"PtgRefErr",f:function He(e,i,r){var o=e.read_shift(1)>>>5&3;return e.l+=4,r.biff<8&&e.l--,12==r.biff&&(e.l+=2),[o]}},43:{n:"PtgAreaErr",f:function K_(e,i,r){var o=(96&e[e.l++])>>5;return e.l+=r&&r.biff>8?12:r.biff<8?6:8,[o]}},44:{n:"PtgRefN",f:function h(e,i,r){var o=(96&e[e.l])>>5;e.l+=1;var c=function qh(e,i,r){var o=r&&r.biff?r.biff:8;if(o>=2&&o<=5)return function Gh(e){var i=e.read_shift(2),r=e.read_shift(1),o=(32768&i)>>15,c=(16384&i)>>14;return i&=16383,1==o&&i>=8192&&(i-=16384),1==c&&r>=128&&(r-=256),{r:i,c:r,cRel:c,rRel:o}}(e);var c=e.read_shift(o>=12?4:2),x=e.read_shift(2),y=(16384&x)>>14,T=(32768&x)>>15;if(x&=16383,1==T)for(;c>524287;)c-=1048576;if(1==y)for(;x>8191;)x-=16384;return{r:c,c:x,cRel:y,rRel:T}}(e,0,r);return[o,c]}},45:{n:"PtgAreaN",f:function Gu(e,i,r){var o=(96&e[e.l++])>>5,c=function $l(e,i,r){if(r.biff<8)return om(e);var o=e.read_shift(12==r.biff?4:2),c=e.read_shift(12==r.biff?4:2),x=el(e,2),y=el(e,2);return{s:{r:o,c:x[0],cRel:x[1],rRel:x[2]},e:{r:c,c:y[0],cRel:y[1],rRel:y[2]}}}(e,0,r);return[o,c]}},46:{n:"PtgMemAreaN",f:function ei(e){return[e.read_shift(1)>>>5&3,e.read_shift(2)]}},47:{n:"PtgMemNoMemN",f:function Ai(e){return[e.read_shift(1)>>>5&3,e.read_shift(2)]}},57:{n:"PtgNameX",f:function Me(e,i,r){return 5==r.biff?function De(e){var i=e.read_shift(1)>>>5&3,r=e.read_shift(2,"i");e.l+=8;var o=e.read_shift(2);return e.l+=12,[i,r,o]}(e):[e.read_shift(1)>>>5&3,e.read_shift(2),e.read_shift(4)]}},58:{n:"PtgRef3d",f:function p(e,i,r){var o=(96&e[e.l])>>5;e.l+=1;var c=e.read_shift(2);return r&&5==r.biff&&(e.l+=12),[o,c,lm(e,0,r)]}},59:{n:"PtgArea3d",f:function ed(e,i,r){var o=(96&e[e.l++])>>5,c=e.read_shift(2,"i");if(r&&5===r.biff)e.l+=12;return[o,c,l0(e,0,r)]}},60:{n:"PtgRefErr3d",f:function st(e,i,r){var o=(96&e[e.l++])>>5,c=e.read_shift(2),x=4;if(r)switch(r.biff){case 5:x=15;break;case 12:x=6}return e.l+=x,[o,c]}},61:{n:"PtgAreaErr3d",f:function J_(e,i,r){var o=(96&e[e.l++])>>5,c=e.read_shift(2),x=8;if(r)switch(r.biff){case 5:e.l+=12,x=6;break;case 12:x=12}return e.l+=x,[o,c]}},255:{}},nn={64:32,96:32,65:33,97:33,66:34,98:34,67:35,99:35,68:36,100:36,69:37,101:37,70:38,102:38,71:39,103:39,72:40,104:40,73:41,105:41,74:42,106:42,75:43,107:43,76:44,108:44,77:45,109:45,78:46,110:46,79:47,111:47,88:34,120:34,89:57,121:57,90:58,122:58,91:59,123:59,92:60,124:60,93:61,125:61},Aa={1:{n:"PtgElfLel",f:ur},2:{n:"PtgElfRw",f:pt},3:{n:"PtgElfCol",f:pt},6:{n:"PtgElfRwV",f:pt},7:{n:"PtgElfColV",f:pt},10:{n:"PtgElfRadical",f:pt},11:{n:"PtgElfRadicalS",f:vt},13:{n:"PtgElfColS",f:vt},15:{n:"PtgElfColSV",f:vt},16:{n:"PtgElfRadicalLel",f:ur},25:{n:"PtgList",f:function oi(e){e.l+=2;var i=e.read_shift(2),r=e.read_shift(2),o=e.read_shift(4),c=e.read_shift(2),x=e.read_shift(2);return{ixti:i,coltype:3&r,rt:Wi[r>>2&31],idx:o,c,C:x}}},29:{n:"PtgSxName",f:function Xi(e){return e.l+=2,[e.read_shift(4)]}},255:{}},pa={0:{n:"PtgAttrNoop",f:function Mi(e){return e.l+=4,[0,0]}},1:{n:"PtgAttrSemi",f:function fm(e,i,r){var o=255&e[e.l+1]?1:0;return e.l+=r&&2==r.biff?3:4,[o]}},2:{n:"PtgAttrIf",f:function hm(e,i,r){var o=255&e[e.l+1]?1:0;return e.l+=2,[o,e.read_shift(r&&2==r.biff?1:2)]}},4:{n:"PtgAttrChoose",f:function um(e,i,r){e.l+=2;for(var o=e.read_shift(r&&2==r.biff?1:2),c=[],x=0;x<=o;++x)c.push(e.read_shift(r&&2==r.biff?1:2));return c}},8:{n:"PtgAttrGoto",f:function Q_(e,i,r){var o=255&e[e.l+1]?1:0;return e.l+=2,[o,e.read_shift(r&&2==r.biff?1:2)]}},16:{n:"PtgAttrSum",f:function k(e,i,r){e.l+=r&&2==r.biff?3:4}},32:{n:"PtgAttrBaxcel",f:cm},33:{n:"PtgAttrBaxcel",f:cm},64:{n:"PtgAttrSpace",f:function t(e){return e.read_shift(2),a(e)}},65:{n:"PtgAttrSpaceSemi",f:function s(e){return e.read_shift(2),a(e)}},128:{n:"PtgAttrIfError",f:function eg(e){var i=255&e[e.l+1]?1:0;return e.l+=2,[i,e.read_shift(2)]}},255:{}};function Gr(e,i,r,o){if(o.biff<8)return S(e,i);for(var c=e.l+i,x=[],y=0;y!==r.length;++y)switch(r[y][0]){case"PtgArray":r[y][1]=ve(e,0,o),x.push(r[y][1]);break;case"PtgMemArea":r[y][2]=ne(e,0,o),x.push(r[y][2]);break;case"PtgExp":o&&12==o.biff&&(r[y][1][1]=e.read_shift(4),x.push(r[y][1]));break;case"PtgList":case"PtgElfRadicalS":case"PtgElfColS":case"PtgElfColSV":throw"Unsupported "+r[y][0]}return 0!=(i=c-e.l)&&x.push(S(e,i)),x}function ka(e){for(var i=[],r=0;r<e.length;++r){for(var o=e[r],c=[],x=0;x<o.length;++x){var y=o[x];c.push(y?2===y[0]?'"'+y[1].replace(/"/g,'""')+'"':y[1]:"")}i.push(c.join(","))}return i.join(";")}var mn={PtgAdd:"+",PtgConcat:"&",PtgDiv:"/",PtgEq:"=",PtgGe:">=",PtgGt:">",PtgLe:"<=",PtgLt:"<",PtgMul:"*",PtgNe:"<>",PtgPower:"^",PtgSub:"-"};function fi(e,i,r){if(!e)return"SH33TJSERR0";if(r.biff>8&&(!e.XTI||!e.XTI[i]))return e.SheetNames[i];if(!e.XTI)return"SH33TJSERR6";var o=e.XTI[i];if(r.biff<8)return i>1e4&&(i-=65536),i<0&&(i=-i),0==i?"":e.XTI[i-1];if(!o)return"SH33TJSERR1";var c="";if(r.biff>8)switch(e[o[0]][0]){case 357:return c=-1==o[1]?"#REF":e.SheetNames[o[1]],o[1]==o[2]?c:c+":"+e.SheetNames[o[2]];case 358:return null!=r.SID?e.SheetNames[r.SID]:"SH33TJSSAME"+e[o[0]][0];default:return"SH33TJSSRC"+e[o[0]][0]}switch(e[o[0]][0][0]){case 1025:return c=-1==o[1]?"#REF":e.SheetNames[o[1]]||"SH33TJSERR3",o[1]==o[2]?c:c+":"+e.SheetNames[o[2]];case 14849:return e[o[0]].slice(1).map(function(x){return x.Name}).join(";;");default:return e[o[0]][0][3]?(c=-1==o[1]?"#REF":e[o[0]][0][3][o[1]]||"SH33TJSERR4",o[1]==o[2]?c:c+":"+e[o[0]][0][3][o[2]]):"SH33TJSERR2"}}function si(e,i,r){var o=fi(e,i,r);return"#REF"==o?o:function sn(e,i){if(!(e||i&&i.biff<=5&&i.biff>=2))throw new Error("empty sheet name");return/[^\w\u4E00-\u9FFF\u3040-\u30FF]/.test(e)?"'"+e+"'":e}(o,r)}function li(e,i,r,o,c){var C,I,F,j,x=c&&c.biff||8,y={s:{c:0,r:0},e:{c:0,r:0}},T=[],N=0,U=0,W="";if(!e[0]||!e[0][0])return"";for(var B=-1,X="",_e=0,me=e[0].length;_e<me;++_e){var ue=e[0][_e];switch(ue[0]){case"PtgUminus":T.push("-"+T.pop());break;case"PtgUplus":T.push("+"+T.pop());break;case"PtgPercent":T.push(T.pop()+"%");break;case"PtgAdd":case"PtgConcat":case"PtgDiv":case"PtgEq":case"PtgGe":case"PtgGt":case"PtgLe":case"PtgLt":case"PtgMul":case"PtgNe":case"PtgPower":case"PtgSub":if(C=T.pop(),I=T.pop(),B>=0){switch(e[0][B][1][0]){case 0:X=ii(" ",e[0][B][1][1]);break;case 1:X=ii("\r",e[0][B][1][1]);break;default:if(X="",c.WTF)throw new Error("Unexpected PtgAttrSpaceType "+e[0][B][1][0])}I+=X,B=-1}T.push(I+mn[ue[0]]+C);break;case"PtgIsect":C=T.pop(),I=T.pop(),T.push(I+" "+C);break;case"PtgUnion":C=T.pop(),I=T.pop(),T.push(I+","+C);break;case"PtgRange":C=T.pop(),I=T.pop(),T.push(I+":"+C);break;case"PtgAttrChoose":case"PtgAttrGoto":case"PtgAttrIf":case"PtgAttrIfError":case"PtgAttrBaxcel":case"PtgAttrSemi":case"PtgMemArea":case"PtgTbl":case"PtgMemErr":case"PtgMemAreaN":case"PtgMemNoMemN":case"PtgAttrNoop":case"PtgSheet":case"PtgEndSheet":case"PtgMemFunc":case"PtgMemNoMem":break;case"PtgRef":F=V(ue[1][1],y,c),T.push(te(F,x));break;case"PtgRefN":F=r?V(ue[1][1],r,c):ue[1][1],T.push(te(F,x));break;case"PtgRef3d":N=ue[1][1],F=V(ue[1][2],y,c),W=si(o,N,c),T.push(W+"!"+te(F,x));break;case"PtgFunc":case"PtgFuncVar":var We=ue[1][0],nt=ue[1][1];We||(We=0);var Se=0==(We&=127)?[]:T.slice(-We);T.length-=We,"User"===nt&&(nt=Se.shift()),T.push(nt+"("+Se.join(",")+")");break;case"PtgBool":T.push(ue[1]?"TRUE":"FALSE");break;case"PtgInt":case"PtgErr":T.push(ue[1]);break;case"PtgNum":T.push(String(ue[1]));break;case"PtgStr":T.push('"'+ue[1].replace(/"/g,'""')+'"');break;case"PtgAreaN":j=Y(ue[1][1],r?{s:r}:y,c),T.push(J(j,c));break;case"PtgArea":j=Y(ue[1][1],y,c),T.push(J(j,c));break;case"PtgArea3d":j=ue[1][2],W=si(o,N=ue[1][1],c),T.push(W+"!"+J(j,c));break;case"PtgAttrSum":T.push("SUM("+T.pop()+")");break;case"PtgName":var Ge=(o.names||[])[(U=ue[1][2])-1]||(o[0]||[])[U],Ve=Ge?Ge.Name:"SH33TJSNAME"+String(U);Ve&&"_xlfn."==Ve.slice(0,6)&&!c.xlfn&&(Ve=Ve.slice(6)),T.push(Ve);break;case"PtgNameX":var ot,at=ue[1][1];if(U=ue[1][2],!(c.biff<=5)){var je="";if(14849==((o[at]||[])[0]||[])[0]||(1025==((o[at]||[])[0]||[])[0]?o[at][U]&&o[at][U].itab>0&&(je=o.SheetNames[o[at][U].itab-1]+"!"):je=o.SheetNames[U-1]+"!"),o[at]&&o[at][U])je+=o[at][U].Name;else if(o[0]&&o[0][U])je+=o[0][U].Name;else{var Bt=(fi(o,at,c)||"").split(";;");Bt[U-1]?je=Bt[U-1]:je+="SH33TJSERRX"}T.push(je);break}at<0&&(at=-at),o[at]&&(ot=o[at][U]),ot||(ot={Name:"SH33TJSERRY"}),T.push(ot.Name);break;case"PtgParen":var er="(",jt=")";if(B>=0){switch(X="",e[0][B][1][0]){case 2:er=ii(" ",e[0][B][1][1])+er;break;case 3:er=ii("\r",e[0][B][1][1])+er;break;case 4:jt=ii(" ",e[0][B][1][1])+jt;break;case 5:jt=ii("\r",e[0][B][1][1])+jt;break;default:if(c.WTF)throw new Error("Unexpected PtgAttrSpaceType "+e[0][B][1][0])}B=-1}T.push(er+T.pop()+jt);break;case"PtgRefErr":case"PtgRefErr3d":case"PtgAreaErr":case"PtgAreaErr3d":T.push("#REF!");break;case"PtgExp":var pr={c:r.c,r:r.r};if(o.sharedf[Le(F={c:ue[1][1],r:ue[1][0]})]){var sr=o.sharedf[Le(F)];T.push(li(sr,0,pr,o,c))}else{var Xr=!1;for(C=0;C!=o.arrayf.length;++C)if(!(F.c<(I=o.arrayf[C])[0].s.c||F.c>I[0].e.c||F.r<I[0].s.r||F.r>I[0].e.r)){T.push(li(I[1],0,pr,o,c)),Xr=!0;break}Xr||T.push(ue[1])}break;case"PtgArray":T.push("{"+ka(ue[1])+"}");break;case"PtgAttrSpace":case"PtgAttrSpaceSemi":B=_e;break;case"PtgMissArg":T.push("");break;case"PtgList":T.push("Table"+ue[1].idx+"[#"+ue[1].rt+"]");break;case"PtgElfCol":case"PtgElfColS":case"PtgElfColSV":case"PtgElfColV":case"PtgElfLel":case"PtgElfRadical":case"PtgElfRadicalLel":case"PtgElfRadicalS":case"PtgElfRw":case"PtgElfRwV":throw new Error("Unsupported ELFs");default:throw new Error("Unrecognized Formula Token: "+String(ue))}if(3!=c.biff&&B>=0&&-1==["PtgAttrSpace","PtgAttrSpaceSemi","PtgAttrGoto"].indexOf(e[0][_e][0])){var xr=!0;switch((ue=e[0][B])[1][0]){case 4:xr=!1;case 0:X=ii(" ",ue[1][1]);break;case 5:xr=!1;case 1:X=ii("\r",ue[1][1]);break;default:if(X="",c.WTF)throw new Error("Unexpected PtgAttrSpaceType "+ue[1][0])}T.push((xr?X:"")+T.pop()+(xr?"":X)),B=-1}}if(T.length>1&&c.WTF)throw new Error("bad formula stack");return T[0]}function Wl(e,i,r){var o=e.read_shift(4),c=function an(e,i,r){for(var c,x,o=e.l+i,y=[];o!=e.l;)i=o-e.l,c=Vi[x=e[e.l]]||Vi[nn[x]],(24===x||25===x)&&(c=(24===x?Aa:pa)[e[e.l+1]]),c&&c.f?y.push([c.n,c.f(e,i,r)]):S(e,i);return y}(e,o,r),x=e.read_shift(4);return[c,x>0?Gr(e,x,c,r):null]}var dm=Wl,Xh=Wl,pm=Wl,mm=Wl,_m={0:"BEEP",1:"OPEN",2:"OPEN.LINKS",3:"CLOSE.ALL",4:"SAVE",5:"SAVE.AS",6:"FILE.DELETE",7:"PAGE.SETUP",8:"PRINT",9:"PRINTER.SETUP",10:"QUIT",11:"NEW.WINDOW",12:"ARRANGE.ALL",13:"WINDOW.SIZE",14:"WINDOW.MOVE",15:"FULL",16:"CLOSE",17:"RUN",22:"SET.PRINT.AREA",23:"SET.PRINT.TITLES",24:"SET.PAGE.BREAK",25:"REMOVE.PAGE.BREAK",26:"FONT",27:"DISPLAY",28:"PROTECT.DOCUMENT",29:"PRECISION",30:"A1.R1C1",31:"CALCULATE.NOW",32:"CALCULATION",34:"DATA.FIND",35:"EXTRACT",36:"DATA.DELETE",37:"SET.DATABASE",38:"SET.CRITERIA",39:"SORT",40:"DATA.SERIES",41:"TABLE",42:"FORMAT.NUMBER",43:"ALIGNMENT",44:"STYLE",45:"BORDER",46:"CELL.PROTECTION",47:"COLUMN.WIDTH",48:"UNDO",49:"CUT",50:"COPY",51:"PASTE",52:"CLEAR",53:"PASTE.SPECIAL",54:"EDIT.DELETE",55:"INSERT",56:"FILL.RIGHT",57:"FILL.DOWN",61:"DEFINE.NAME",62:"CREATE.NAMES",63:"FORMULA.GOTO",64:"FORMULA.FIND",65:"SELECT.LAST.CELL",66:"SHOW.ACTIVE.CELL",67:"GALLERY.AREA",68:"GALLERY.BAR",69:"GALLERY.COLUMN",70:"GALLERY.LINE",71:"GALLERY.PIE",72:"GALLERY.SCATTER",73:"COMBINATION",74:"PREFERRED",75:"ADD.OVERLAY",76:"GRIDLINES",77:"SET.PREFERRED",78:"AXES",79:"LEGEND",80:"ATTACH.TEXT",81:"ADD.ARROW",82:"SELECT.CHART",83:"SELECT.PLOT.AREA",84:"PATTERNS",85:"MAIN.CHART",86:"OVERLAY",87:"SCALE",88:"FORMAT.LEGEND",89:"FORMAT.TEXT",90:"EDIT.REPEAT",91:"PARSE",92:"JUSTIFY",93:"HIDE",94:"UNHIDE",95:"WORKSPACE",96:"FORMULA",97:"FORMULA.FILL",98:"FORMULA.ARRAY",99:"DATA.FIND.NEXT",100:"DATA.FIND.PREV",101:"FORMULA.FIND.NEXT",102:"FORMULA.FIND.PREV",103:"ACTIVATE",104:"ACTIVATE.NEXT",105:"ACTIVATE.PREV",106:"UNLOCKED.NEXT",107:"UNLOCKED.PREV",108:"COPY.PICTURE",109:"SELECT",110:"DELETE.NAME",111:"DELETE.FORMAT",112:"VLINE",113:"HLINE",114:"VPAGE",115:"HPAGE",116:"VSCROLL",117:"HSCROLL",118:"ALERT",119:"NEW",120:"CANCEL.COPY",121:"SHOW.CLIPBOARD",122:"MESSAGE",124:"PASTE.LINK",125:"APP.ACTIVATE",126:"DELETE.ARROW",127:"ROW.HEIGHT",128:"FORMAT.MOVE",129:"FORMAT.SIZE",130:"FORMULA.REPLACE",131:"SEND.KEYS",132:"SELECT.SPECIAL",133:"APPLY.NAMES",134:"REPLACE.FONT",135:"FREEZE.PANES",136:"SHOW.INFO",137:"SPLIT",138:"ON.WINDOW",139:"ON.DATA",140:"DISABLE.INPUT",142:"OUTLINE",143:"LIST.NAMES",144:"FILE.CLOSE",145:"SAVE.WORKBOOK",146:"DATA.FORM",147:"COPY.CHART",148:"ON.TIME",149:"WAIT",150:"FORMAT.FONT",151:"FILL.UP",152:"FILL.LEFT",153:"DELETE.OVERLAY",155:"SHORT.MENUS",159:"SET.UPDATE.STATUS",161:"COLOR.PALETTE",162:"DELETE.STYLE",163:"WINDOW.RESTORE",164:"WINDOW.MAXIMIZE",166:"CHANGE.LINK",167:"CALCULATE.DOCUMENT",168:"ON.KEY",169:"APP.RESTORE",170:"APP.MOVE",171:"APP.SIZE",172:"APP.MINIMIZE",173:"APP.MAXIMIZE",174:"BRING.TO.FRONT",175:"SEND.TO.BACK",185:"MAIN.CHART.TYPE",186:"OVERLAY.CHART.TYPE",187:"SELECT.END",188:"OPEN.MAIL",189:"SEND.MAIL",190:"STANDARD.FONT",191:"CONSOLIDATE",192:"SORT.SPECIAL",193:"GALLERY.3D.AREA",194:"GALLERY.3D.COLUMN",195:"GALLERY.3D.LINE",196:"GALLERY.3D.PIE",197:"VIEW.3D",198:"GOAL.SEEK",199:"WORKGROUP",200:"FILL.GROUP",201:"UPDATE.LINK",202:"PROMOTE",203:"DEMOTE",204:"SHOW.DETAIL",206:"UNGROUP",207:"OBJECT.PROPERTIES",208:"SAVE.NEW.OBJECT",209:"SHARE",210:"SHARE.NAME",211:"DUPLICATE",212:"APPLY.STYLE",213:"ASSIGN.TO.OBJECT",214:"OBJECT.PROTECTION",215:"HIDE.OBJECT",216:"SET.EXTRACT",217:"CREATE.PUBLISHER",218:"SUBSCRIBE.TO",219:"ATTRIBUTES",220:"SHOW.TOOLBAR",222:"PRINT.PREVIEW",223:"EDIT.COLOR",224:"SHOW.LEVELS",225:"FORMAT.MAIN",226:"FORMAT.OVERLAY",227:"ON.RECALC",228:"EDIT.SERIES",229:"DEFINE.STYLE",240:"LINE.PRINT",243:"ENTER.DATA",249:"GALLERY.RADAR",250:"MERGE.STYLES",251:"EDITION.OPTIONS",252:"PASTE.PICTURE",253:"PASTE.PICTURE.LINK",254:"SPELLING",256:"ZOOM",259:"INSERT.OBJECT",260:"WINDOW.MINIMIZE",265:"SOUND.NOTE",266:"SOUND.PLAY",267:"FORMAT.SHAPE",268:"EXTEND.POLYGON",269:"FORMAT.AUTO",272:"GALLERY.3D.BAR",273:"GALLERY.3D.SURFACE",274:"FILL.AUTO",276:"CUSTOMIZE.TOOLBAR",277:"ADD.TOOL",278:"EDIT.OBJECT",279:"ON.DOUBLECLICK",280:"ON.ENTRY",281:"WORKBOOK.ADD",282:"WORKBOOK.MOVE",283:"WORKBOOK.COPY",284:"WORKBOOK.OPTIONS",285:"SAVE.WORKSPACE",288:"CHART.WIZARD",289:"DELETE.TOOL",290:"MOVE.TOOL",291:"WORKBOOK.SELECT",292:"WORKBOOK.ACTIVATE",293:"ASSIGN.TO.TOOL",295:"COPY.TOOL",296:"RESET.TOOL",297:"CONSTRAIN.NUMERIC",298:"PASTE.TOOL",302:"WORKBOOK.NEW",305:"SCENARIO.CELLS",306:"SCENARIO.DELETE",307:"SCENARIO.ADD",308:"SCENARIO.EDIT",309:"SCENARIO.SHOW",310:"SCENARIO.SHOW.NEXT",311:"SCENARIO.SUMMARY",312:"PIVOT.TABLE.WIZARD",313:"PIVOT.FIELD.PROPERTIES",314:"PIVOT.FIELD",315:"PIVOT.ITEM",316:"PIVOT.ADD.FIELDS",318:"OPTIONS.CALCULATION",319:"OPTIONS.EDIT",320:"OPTIONS.VIEW",321:"ADDIN.MANAGER",322:"MENU.EDITOR",323:"ATTACH.TOOLBARS",324:"VBAActivate",325:"OPTIONS.CHART",328:"VBA.INSERT.FILE",330:"VBA.PROCEDURE.DEFINITION",336:"ROUTING.SLIP",338:"ROUTE.DOCUMENT",339:"MAIL.LOGON",342:"INSERT.PICTURE",343:"EDIT.TOOL",344:"GALLERY.DOUGHNUT",350:"CHART.TREND",352:"PIVOT.ITEM.PROPERTIES",354:"WORKBOOK.INSERT",355:"OPTIONS.TRANSITION",356:"OPTIONS.GENERAL",370:"FILTER.ADVANCED",373:"MAIL.ADD.MAILER",374:"MAIL.DELETE.MAILER",375:"MAIL.REPLY",376:"MAIL.REPLY.ALL",377:"MAIL.FORWARD",378:"MAIL.NEXT.LETTER",379:"DATA.LABEL",380:"INSERT.TITLE",381:"FONT.PROPERTIES",382:"MACRO.OPTIONS",383:"WORKBOOK.HIDE",384:"WORKBOOK.UNHIDE",385:"WORKBOOK.DELETE",386:"WORKBOOK.NAME",388:"GALLERY.CUSTOM",390:"ADD.CHART.AUTOFORMAT",391:"DELETE.CHART.AUTOFORMAT",392:"CHART.ADD.DATA",393:"AUTO.OUTLINE",394:"TAB.ORDER",395:"SHOW.DIALOG",396:"SELECT.ALL",397:"UNGROUP.SHEETS",398:"SUBTOTAL.CREATE",399:"SUBTOTAL.REMOVE",400:"RENAME.OBJECT",412:"WORKBOOK.SCROLL",413:"WORKBOOK.NEXT",414:"WORKBOOK.PREV",415:"WORKBOOK.TAB.SPLIT",416:"FULL.SCREEN",417:"WORKBOOK.PROTECT",420:"SCROLLBAR.PROPERTIES",421:"PIVOT.SHOW.PAGES",422:"TEXT.TO.COLUMNS",423:"FORMAT.CHARTTYPE",424:"LINK.FORMAT",425:"TRACER.DISPLAY",430:"TRACER.NAVIGATE",431:"TRACER.CLEAR",432:"TRACER.ERROR",433:"PIVOT.FIELD.GROUP",434:"PIVOT.FIELD.UNGROUP",435:"CHECKBOX.PROPERTIES",436:"LABEL.PROPERTIES",437:"LISTBOX.PROPERTIES",438:"EDITBOX.PROPERTIES",439:"PIVOT.REFRESH",440:"LINK.COMBO",441:"OPEN.TEXT",442:"HIDE.DIALOG",443:"SET.DIALOG.FOCUS",444:"ENABLE.OBJECT",445:"PUSHBUTTON.PROPERTIES",446:"SET.DIALOG.DEFAULT",447:"FILTER",448:"FILTER.SHOW.ALL",449:"CLEAR.OUTLINE",450:"FUNCTION.WIZARD",451:"ADD.LIST.ITEM",452:"SET.LIST.ITEM",453:"REMOVE.LIST.ITEM",454:"SELECT.LIST.ITEM",455:"SET.CONTROL.VALUE",456:"SAVE.COPY.AS",458:"OPTIONS.LISTS.ADD",459:"OPTIONS.LISTS.DELETE",460:"SERIES.AXES",461:"SERIES.X",462:"SERIES.Y",463:"ERRORBAR.X",464:"ERRORBAR.Y",465:"FORMAT.CHART",466:"SERIES.ORDER",467:"MAIL.LOGOFF",468:"CLEAR.ROUTING.SLIP",469:"APP.ACTIVATE.MICROSOFT",470:"MAIL.EDIT.MAILER",471:"ON.SHEET",472:"STANDARD.WIDTH",473:"SCENARIO.MERGE",474:"SUMMARY.INFO",475:"FIND.FILE",476:"ACTIVE.CELL.FONT",477:"ENABLE.TIPWIZARD",478:"VBA.MAKE.ADDIN",480:"INSERTDATATABLE",481:"WORKGROUP.OPTIONS",482:"MAIL.SEND.MAILER",485:"AUTOCORRECT",489:"POST.DOCUMENT",491:"PICKLIST",493:"VIEW.SHOW",494:"VIEW.DEFINE",495:"VIEW.DELETE",509:"SHEET.BACKGROUND",510:"INSERT.MAP.OBJECT",511:"OPTIONS.MENONO",517:"MSOCHECKS",518:"NORMAL",519:"LAYOUT",520:"RM.PRINT.AREA",521:"CLEAR.PRINT.AREA",522:"ADD.PRINT.AREA",523:"MOVE.BRK",545:"HIDECURR.NOTE",546:"HIDEALL.NOTES",547:"DELETE.NOTE",548:"TRAVERSE.NOTES",549:"ACTIVATE.NOTES",620:"PROTECT.REVISIONS",621:"UNPROTECT.REVISIONS",647:"OPTIONS.ME",653:"WEB.PUBLISH",667:"NEWWEBQUERY",673:"PIVOT.TABLE.CHART",753:"OPTIONS.SAVE",755:"OPTIONS.SPELL",808:"HIDEALL.INKANNOTS"},rd={0:"COUNT",1:"IF",2:"ISNA",3:"ISERROR",4:"SUM",5:"AVERAGE",6:"MIN",7:"MAX",8:"ROW",9:"COLUMN",10:"NA",11:"NPV",12:"STDEV",13:"DOLLAR",14:"FIXED",15:"SIN",16:"COS",17:"TAN",18:"ATAN",19:"PI",20:"SQRT",21:"EXP",22:"LN",23:"LOG10",24:"ABS",25:"INT",26:"SIGN",27:"ROUND",28:"LOOKUP",29:"INDEX",30:"REPT",31:"MID",32:"LEN",33:"VALUE",34:"TRUE",35:"FALSE",36:"AND",37:"OR",38:"NOT",39:"MOD",40:"DCOUNT",41:"DSUM",42:"DAVERAGE",43:"DMIN",44:"DMAX",45:"DSTDEV",46:"VAR",47:"DVAR",48:"TEXT",49:"LINEST",50:"TREND",51:"LOGEST",52:"GROWTH",53:"GOTO",54:"HALT",55:"RETURN",56:"PV",57:"FV",58:"NPER",59:"PMT",60:"RATE",61:"MIRR",62:"IRR",63:"RAND",64:"MATCH",65:"DATE",66:"TIME",67:"DAY",68:"MONTH",69:"YEAR",70:"WEEKDAY",71:"HOUR",72:"MINUTE",73:"SECOND",74:"NOW",75:"AREAS",76:"ROWS",77:"COLUMNS",78:"OFFSET",79:"ABSREF",80:"RELREF",81:"ARGUMENT",82:"SEARCH",83:"TRANSPOSE",84:"ERROR",85:"STEP",86:"TYPE",87:"ECHO",88:"SET.NAME",89:"CALLER",90:"DEREF",91:"WINDOWS",92:"SERIES",93:"DOCUMENTS",94:"ACTIVE.CELL",95:"SELECTION",96:"RESULT",97:"ATAN2",98:"ASIN",99:"ACOS",100:"CHOOSE",101:"HLOOKUP",102:"VLOOKUP",103:"LINKS",104:"INPUT",105:"ISREF",106:"GET.FORMULA",107:"GET.NAME",108:"SET.VALUE",109:"LOG",110:"EXEC",111:"CHAR",112:"LOWER",113:"UPPER",114:"PROPER",115:"LEFT",116:"RIGHT",117:"EXACT",118:"TRIM",119:"REPLACE",120:"SUBSTITUTE",121:"CODE",122:"NAMES",123:"DIRECTORY",124:"FIND",125:"CELL",126:"ISERR",127:"ISTEXT",128:"ISNUMBER",129:"ISBLANK",130:"T",131:"N",132:"FOPEN",133:"FCLOSE",134:"FSIZE",135:"FREADLN",136:"FREAD",137:"FWRITELN",138:"FWRITE",139:"FPOS",140:"DATEVALUE",141:"TIMEVALUE",142:"SLN",143:"SYD",144:"DDB",145:"GET.DEF",146:"REFTEXT",147:"TEXTREF",148:"INDIRECT",149:"REGISTER",150:"CALL",151:"ADD.BAR",152:"ADD.MENU",153:"ADD.COMMAND",154:"ENABLE.COMMAND",155:"CHECK.COMMAND",156:"RENAME.COMMAND",157:"SHOW.BAR",158:"DELETE.MENU",159:"DELETE.COMMAND",160:"GET.CHART.ITEM",161:"DIALOG.BOX",162:"CLEAN",163:"MDETERM",164:"MINVERSE",165:"MMULT",166:"FILES",167:"IPMT",168:"PPMT",169:"COUNTA",170:"CANCEL.KEY",171:"FOR",172:"WHILE",173:"BREAK",174:"NEXT",175:"INITIATE",176:"REQUEST",177:"POKE",178:"EXECUTE",179:"TERMINATE",180:"RESTART",181:"HELP",182:"GET.BAR",183:"PRODUCT",184:"FACT",185:"GET.CELL",186:"GET.WORKSPACE",187:"GET.WINDOW",188:"GET.DOCUMENT",189:"DPRODUCT",190:"ISNONTEXT",191:"GET.NOTE",192:"NOTE",193:"STDEVP",194:"VARP",195:"DSTDEVP",196:"DVARP",197:"TRUNC",198:"ISLOGICAL",199:"DCOUNTA",200:"DELETE.BAR",201:"UNREGISTER",204:"USDOLLAR",205:"FINDB",206:"SEARCHB",207:"REPLACEB",208:"LEFTB",209:"RIGHTB",210:"MIDB",211:"LENB",212:"ROUNDUP",213:"ROUNDDOWN",214:"ASC",215:"DBCS",216:"RANK",219:"ADDRESS",220:"DAYS360",221:"TODAY",222:"VDB",223:"ELSE",224:"ELSE.IF",225:"END.IF",226:"FOR.CELL",227:"MEDIAN",228:"SUMPRODUCT",229:"SINH",230:"COSH",231:"TANH",232:"ASINH",233:"ACOSH",234:"ATANH",235:"DGET",236:"CREATE.OBJECT",237:"VOLATILE",238:"LAST.ERROR",239:"CUSTOM.UNDO",240:"CUSTOM.REPEAT",241:"FORMULA.CONVERT",242:"GET.LINK.INFO",243:"TEXT.BOX",244:"INFO",245:"GROUP",246:"GET.OBJECT",247:"DB",248:"PAUSE",251:"RESUME",252:"FREQUENCY",253:"ADD.TOOLBAR",254:"DELETE.TOOLBAR",255:"User",256:"RESET.TOOLBAR",257:"EVALUATE",258:"GET.TOOLBAR",259:"GET.TOOL",260:"SPELLING.CHECK",261:"ERROR.TYPE",262:"APP.TITLE",263:"WINDOW.TITLE",264:"SAVE.TOOLBAR",265:"ENABLE.TOOL",266:"PRESS.TOOL",267:"REGISTER.ID",268:"GET.WORKBOOK",269:"AVEDEV",270:"BETADIST",271:"GAMMALN",272:"BETAINV",273:"BINOMDIST",274:"CHIDIST",275:"CHIINV",276:"COMBIN",277:"CONFIDENCE",278:"CRITBINOM",279:"EVEN",280:"EXPONDIST",281:"FDIST",282:"FINV",283:"FISHER",284:"FISHERINV",285:"FLOOR",286:"GAMMADIST",287:"GAMMAINV",288:"CEILING",289:"HYPGEOMDIST",290:"LOGNORMDIST",291:"LOGINV",292:"NEGBINOMDIST",293:"NORMDIST",294:"NORMSDIST",295:"NORMINV",296:"NORMSINV",297:"STANDARDIZE",298:"ODD",299:"PERMUT",300:"POISSON",301:"TDIST",302:"WEIBULL",303:"SUMXMY2",304:"SUMX2MY2",305:"SUMX2PY2",306:"CHITEST",307:"CORREL",308:"COVAR",309:"FORECAST",310:"FTEST",311:"INTERCEPT",312:"PEARSON",313:"RSQ",314:"STEYX",315:"SLOPE",316:"TTEST",317:"PROB",318:"DEVSQ",319:"GEOMEAN",320:"HARMEAN",321:"SUMSQ",322:"KURT",323:"SKEW",324:"ZTEST",325:"LARGE",326:"SMALL",327:"QUARTILE",328:"PERCENTILE",329:"PERCENTRANK",330:"MODE",331:"TRIMMEAN",332:"TINV",334:"MOVIE.COMMAND",335:"GET.MOVIE",336:"CONCATENATE",337:"POWER",338:"PIVOT.ADD.DATA",339:"GET.PIVOT.TABLE",340:"GET.PIVOT.FIELD",341:"GET.PIVOT.ITEM",342:"RADIANS",343:"DEGREES",344:"SUBTOTAL",345:"SUMIF",346:"COUNTIF",347:"COUNTBLANK",348:"SCENARIO.GET",349:"OPTIONS.LISTS.GET",350:"ISPMT",351:"DATEDIF",352:"DATESTRING",353:"NUMBERSTRING",354:"ROMAN",355:"OPEN.DIALOG",356:"SAVE.DIALOG",357:"VIEW.GET",358:"GETPIVOTDATA",359:"HYPERLINK",360:"PHONETIC",361:"AVERAGEA",362:"MAXA",363:"MINA",364:"STDEVPA",365:"VARPA",366:"STDEVA",367:"VARA",368:"BAHTTEXT",369:"THAIDAYOFWEEK",370:"THAIDIGIT",371:"THAIMONTHOFYEAR",372:"THAINUMSOUND",373:"THAINUMSTRING",374:"THAISTRINGLENGTH",375:"ISTHAIDIGIT",376:"ROUNDBAHTDOWN",377:"ROUNDBAHTUP",378:"THAIYEAR",379:"RTD",380:"CUBEVALUE",381:"CUBEMEMBER",382:"CUBEMEMBERPROPERTY",383:"CUBERANKEDMEMBER",384:"HEX2BIN",385:"HEX2DEC",386:"HEX2OCT",387:"DEC2BIN",388:"DEC2HEX",389:"DEC2OCT",390:"OCT2BIN",391:"OCT2HEX",392:"OCT2DEC",393:"BIN2DEC",394:"BIN2OCT",395:"BIN2HEX",396:"IMSUB",397:"IMDIV",398:"IMPOWER",399:"IMABS",400:"IMSQRT",401:"IMLN",402:"IMLOG2",403:"IMLOG10",404:"IMSIN",405:"IMCOS",406:"IMEXP",407:"IMARGUMENT",408:"IMCONJUGATE",409:"IMAGINARY",410:"IMREAL",411:"COMPLEX",412:"IMSUM",413:"IMPRODUCT",414:"SERIESSUM",415:"FACTDOUBLE",416:"SQRTPI",417:"QUOTIENT",418:"DELTA",419:"GESTEP",420:"ISEVEN",421:"ISODD",422:"MROUND",423:"ERF",424:"ERFC",425:"BESSELJ",426:"BESSELK",427:"BESSELY",428:"BESSELI",429:"XIRR",430:"XNPV",431:"PRICEMAT",432:"YIELDMAT",433:"INTRATE",434:"RECEIVED",435:"DISC",436:"PRICEDISC",437:"YIELDDISC",438:"TBILLEQ",439:"TBILLPRICE",440:"TBILLYIELD",441:"PRICE",442:"YIELD",443:"DOLLARDE",444:"DOLLARFR",445:"NOMINAL",446:"EFFECT",447:"CUMPRINC",448:"CUMIPMT",449:"EDATE",450:"EOMONTH",451:"YEARFRAC",452:"COUPDAYBS",453:"COUPDAYS",454:"COUPDAYSNC",455:"COUPNCD",456:"COUPNUM",457:"COUPPCD",458:"DURATION",459:"MDURATION",460:"ODDLPRICE",461:"ODDLYIELD",462:"ODDFPRICE",463:"ODDFYIELD",464:"RANDBETWEEN",465:"WEEKNUM",466:"AMORDEGRC",467:"AMORLINC",468:"CONVERT",724:"SHEETJS",469:"ACCRINT",470:"ACCRINTM",471:"WORKDAY",472:"NETWORKDAYS",473:"GCD",474:"MULTINOMIAL",475:"LCM",476:"FVSCHEDULE",477:"CUBEKPIMEMBER",478:"CUBESET",479:"CUBESETCOUNT",480:"IFERROR",481:"COUNTIFS",482:"SUMIFS",483:"AVERAGEIF",484:"AVERAGEIFS"},c0={2:1,3:1,10:0,15:1,16:1,17:1,18:1,19:0,20:1,21:1,22:1,23:1,24:1,25:1,26:1,27:2,30:2,31:3,32:1,33:1,34:0,35:0,38:1,39:2,40:3,41:3,42:3,43:3,44:3,45:3,47:3,48:2,53:1,61:3,63:0,65:3,66:3,67:1,68:1,69:1,70:1,71:1,72:1,73:1,74:0,75:1,76:1,77:1,79:2,80:2,83:1,85:0,86:1,89:0,90:1,94:0,95:0,97:2,98:1,99:1,101:3,102:3,105:1,106:1,108:2,111:1,112:1,113:1,114:1,117:2,118:1,119:4,121:1,126:1,127:1,128:1,129:1,130:1,131:1,133:1,134:1,135:1,136:2,137:2,138:2,140:1,141:1,142:3,143:4,144:4,161:1,162:1,163:1,164:1,165:2,172:1,175:2,176:2,177:3,178:2,179:1,184:1,186:1,189:3,190:1,195:3,196:3,197:1,198:1,199:3,201:1,207:4,210:3,211:1,212:2,213:2,214:1,215:1,225:0,229:1,230:1,231:1,232:1,233:1,234:1,235:3,244:1,247:4,252:2,257:1,261:1,271:1,273:4,274:2,275:2,276:2,277:3,278:3,279:1,280:3,281:3,282:3,283:1,284:1,285:2,286:4,287:3,288:2,289:4,290:3,291:3,292:3,293:4,294:1,295:3,296:1,297:3,298:1,299:2,300:3,301:3,302:4,303:2,304:2,305:2,306:2,307:2,308:2,309:3,310:2,311:2,312:2,313:2,314:2,315:2,316:4,325:2,326:2,327:2,328:2,331:2,332:2,337:2,342:1,343:1,346:2,347:1,350:4,351:3,352:1,353:2,360:1,368:1,369:1,370:1,371:1,372:1,373:1,374:1,375:1,376:1,377:1,378:1,382:3,385:1,392:1,393:1,396:2,397:2,398:2,399:1,400:1,401:1,402:1,403:1,404:1,405:1,406:1,407:1,408:1,409:1,410:1,414:4,415:1,416:1,417:2,420:1,421:1,422:2,424:1,425:2,426:2,427:2,428:2,430:3,438:3,439:3,440:3,443:2,444:2,445:2,446:2,447:6,448:6,449:2,450:2,464:2,468:3,476:2,479:1,480:2,65535:0};function gm(e){return("of:="+e.replace(qu,"$1[.$2$3$4$5]").replace(/\]:\[/g,":")).replace(/;/g,"|").replace(/,/g,";")}function u0(e){return e.replace(/\./,"!")}var Yh="undefined"!=typeof Map;function na(e,i,r){var o=0,c=e.length;if(r){if(Yh?r.has(i):Object.prototype.hasOwnProperty.call(r,i))for(var x=Yh?r.get(i):r[i];o<x.length;++o)if(e[x[o]].t===i)return e.Count++,x[o]}else for(;o<c;++o)if(e[o].t===i)return e.Count++,o;return e[c]={t:i},e.Count++,e.Unique++,r&&(Yh?(r.has(i)||r.set(i,[]),r.get(i).push(c)):(Object.prototype.hasOwnProperty.call(r,i)||(r[i]=[]),r[i].push(c))),c}function jn(e,i){var r={min:e+1,max:e+1},o=-1;return i.MDW&&(Zn=i.MDW),null!=i.width?r.customWidth=1:null!=i.wpx?o=Zl(i.wpx):null!=i.wch&&(o=i.wch),o>-1?(r.width=Gf(o),r.customWidth=1):null!=i.width&&(r.width=i.width),i.hidden&&(r.hidden=!0),null!=i.level&&(r.outlineLevel=r.level=i.level),r}function Fs(e,i){if(e){var r=[.7,.7,.75,.75,.3,.3];"xlml"==i&&(r=[1,1,1,1,.5,.5]),null==e.left&&(e.left=r[0]),null==e.right&&(e.right=r[1]),null==e.top&&(e.top=r[2]),null==e.bottom&&(e.bottom=r[3]),null==e.header&&(e.header=r[4]),null==e.footer&&(e.footer=r[5])}}function ao(e,i,r){var o=r.revssf[null!=i.z?i.z:"General"],c=60,x=e.length;if(null==o&&r.ssf)for(;c<392;++c)if(null==r.ssf[c]){wn(i.z,c),r.ssf[c]=i.z,r.revssf[i.z]=o=c;break}for(c=0;c!=x;++c)if(e[c].numFmtId===o)return c;return e[x]={numFmtId:o,fontId:0,fillId:0,borderId:0,xfId:0,applyNumberFormat:1},x}function $c(e,i,r){if(e&&e["!ref"]){var o=ke(e["!ref"]);if(o.e.c<o.s.c||o.e.r<o.s.r)throw new Error("Bad range ("+r+"): "+e["!ref"])}}var Z1=["objects","scenarios","selectLockedCells","selectUnlockedCells"],V1=["formatColumns","formatRows","formatCells","insertColumns","insertRows","insertHyperlinks","deleteColumns","deleteRows","sort","autoFilter","pivotTables"];function ex(e,i,r,o){if(e.c&&r["!comments"].push([i,e.c]),void 0===e.v&&"string"!=typeof e.f||"z"===e.t&&!e.f)return"";var c="",x=e.t,y=e.v;if("z"!==e.t)switch(e.t){case"b":c=e.v?"1":"0";break;case"n":c=""+e.v;break;case"e":c=Ho[e.v];break;case"d":o&&o.cellDates?c=Ei(e.v,-1).toISOString():((e=Kr(e)).t="n",c=""+(e.v=Di(Ei(e.v)))),void 0===e.z&&(e.z=or[14]);break;default:c=e.v}var T=tn("v",ni(c)),C={r:i},I=ao(o.cellXfs,e,o);switch(0!==I&&(C.s=I),e.t){case"n":case"z":break;case"d":C.t="d";break;case"b":C.t="b";break;case"e":C.t="e";break;default:if(null==e.v){delete e.t;break}if(e.v.length>32767)throw new Error("Text length must not exceed 32767 characters");if(o&&o.bookSST){T=tn("v",""+na(o.Strings,e.v,o.revStrings)),C.t="s";break}C.t="str"}if(e.t!=x&&(e.t=x,e.v=y),"string"==typeof e.f&&e.f){var F=e.F&&e.F.slice(0,i.length)==i?{t:"array",ref:e.F}:null;T=At("f",ni(e.f),F)+(null!=e.v?T:"")}return e.l&&r["!links"].push([i,e.l]),e.D&&(C.cm=1),At("c",T,C)}function Dg(e,i,r,o){var y,c=[xi,At("worksheet",null,{xmlns:ps[0],"xmlns:r":Pi_r})],T="",C=r.Sheets[r.SheetNames[e]];null==C&&(C={});var I=C["!ref"]||"A1",F=ke(I);if(F.e.c>16383||F.e.r>1048575){if(i.WTF)throw new Error("Range "+I+" exceeds format limit A1:XFD1048576");F.e.c=Math.min(F.e.c,16383),F.e.r=Math.min(F.e.c,1048575),I=Qe(F)}o||(o={}),C["!comments"]=[];var N=[];(function U1(e,i,r,o,c){var x=!1,y={},T=null;if("xlsx"!==o.bookType&&i.vbaraw){var C=i.SheetNames[r];try{i.Workbook&&(C=i.Workbook.Sheets[r].CodeName||C)}catch(F){}x=!0,y.codeName=ca(ni(C))}if(e&&e["!outline"]){var I={summaryBelow:1,summaryRight:1};e["!outline"].above&&(I.summaryBelow=0),e["!outline"].left&&(I.summaryRight=0),T=(T||"")+At("outlinePr",null,I)}!x&&!T||(c[c.length]=At("sheetPr",T,y))})(C,r,e,i,c),c[c.length]=At("dimension",null,{ref:I}),c[c.length]=function Q1(e,i,r,o){var c={workbookViewId:"0"};return(((o||{}).Workbook||{}).Views||[])[0]&&(c.rightToLeft=o.Workbook.Views[0].RTL?"1":"0"),At("sheetViews",At("sheetView",null,c),{})}(0,0,0,r),i.sheetFormat&&(c[c.length]=At("sheetFormatPr",null,{defaultRowHeight:i.sheetFormat.defaultRowHeight||"16",baseColWidth:i.sheetFormat.baseColWidth||"10",outlineLevelRow:i.sheetFormat.outlineLevelRow||"7"})),null!=C["!cols"]&&C["!cols"].length>0&&(c[c.length]=function X1(e,i){for(var o,r=["<cols>"],c=0;c!=i.length;++c)!(o=i[c])||(r[r.length]=At("col",null,jn(c,o)));return r[r.length]="</cols>",r.join("")}(0,C["!cols"])),c[y=c.length]="<sheetData/>",C["!links"]=[],null!=C["!ref"]&&(T=function rx(e,i,r,o){var C,X,c=[],x=[],y=ke(e["!ref"]),T="",I="",F=[],N=0,U=0,j=e["!rows"],W=Array.isArray(e),B={r:I},_e=-1;for(U=y.s.c;U<=y.e.c;++U)F[U]=ce(U);for(N=y.s.r;N<=y.e.r;++N){for(x=[],I=se(N),U=y.s.c;U<=y.e.c;++U){C=F[U]+I;var me=W?(e[N]||[])[U]:e[C];void 0!==me&&null!=(T=ex(me,C,e,i))&&x.push(T)}(x.length>0||j&&j[N])&&(B={r:I},j&&j[N]&&((X=j[N]).hidden&&(B.hidden=1),_e=-1,X.hpx?_e=Nc(X.hpx):X.hpt&&(_e=X.hpt),_e>-1&&(B.ht=_e,B.customHeight=1),X.level&&(B.outlineLevel=X.level)),c[c.length]=At("row",x.join(""),B))}if(j)for(;N<j.length;++N)j&&j[N]&&(B={r:N+1},(X=j[N]).hidden&&(B.hidden=1),_e=-1,X.hpx?_e=Nc(X.hpx):X.hpt&&(_e=X.hpt),_e>-1&&(B.ht=_e,B.customHeight=1),X.level&&(B.outlineLevel=X.level),c[c.length]=At("row","",B));return c.join("")}(C,i),T.length>0&&(c[c.length]=T)),c.length>y+1&&(c[c.length]="</sheetData>",c[y]=c[y].replace("/>",">")),C["!protect"]&&(c[c.length]=function j1(e){var i={sheet:1};return Z1.forEach(function(r){null!=e[r]&&e[r]&&(i[r]="1")}),V1.forEach(function(r){null!=e[r]&&!e[r]&&(i[r]="0")}),e.password&&(i.password=Ss(e.password).toString(16).toUpperCase()),At("sheetProtection",null,i)}(C["!protect"])),null!=C["!autofilter"]&&(c[c.length]=function Y1(e,i,r,o){var c="string"==typeof e.ref?e.ref:Qe(e.ref);r.Workbook||(r.Workbook={Sheets:[]}),r.Workbook.Names||(r.Workbook.Names=[]);var x=r.Workbook.Names,y=qe(c);y.s.r==y.e.r&&(y.e.r=qe(i["!ref"]).e.r,c=Qe(y));for(var T=0;T<x.length;++T){var C=x[T];if("_xlnm._FilterDatabase"==C.Name&&C.Sheet==o){C.Ref="'"+r.SheetNames[o]+"'!"+c;break}}return T==x.length&&x.push({Name:"_xlnm._FilterDatabase",Sheet:o,Ref:"'"+r.SheetNames[o]+"'!"+c}),At("autoFilter",null,{ref:c})}(C["!autofilter"],C,r,e)),null!=C["!merges"]&&C["!merges"].length>0&&(c[c.length]=function B1(e){if(0===e.length)return"";for(var i='<mergeCells count="'+e.length+'">',r=0;r!=e.length;++r)i+='<mergeCell ref="'+Qe(e[r])+'"/>';return i+"</mergeCells>"}(C["!merges"]));var j,U=-1,W=-1;return C["!links"].length>0&&(c[c.length]="<hyperlinks>",C["!links"].forEach(function(B){!B[1].Target||(j={ref:B[0]},"#"!=B[1].Target.charAt(0)&&(W=Wr(o,-1,ni(B[1].Target).replace(/#.*$/,""),Ar.HLINK),j["r:id"]="rId"+W),(U=B[1].Target.indexOf("#"))>-1&&(j.location=ni(B[1].Target.slice(U+1))),B[1].Tooltip&&(j.tooltip=ni(B[1].Tooltip)),c[c.length]=At("hyperlink",null,j))}),c[c.length]="</hyperlinks>"),delete C["!links"],null!=C["!margins"]&&(c[c.length]=function $1(e){return Fs(e),At("pageMargins",null,e)}(C["!margins"])),(!i||i.ignoreEC||null==i.ignoreEC)&&(c[c.length]=tn("ignoredErrors",At("ignoredError",null,{numberStoredAsText:1,sqref:I}))),N.length>0&&(W=Wr(o,-1,"../drawings/drawing"+(e+1)+".xml",Ar.DRAW),c[c.length]=At("drawing",null,{"r:id":"rId"+W}),C["!drawing"]=N),C["!comments"].length>0&&(W=Wr(o,-1,"../drawings/vmlDrawing"+(e+1)+".vml",Ar.VML),c[c.length]=At("legacyDrawing",null,{"r:id":"rId"+W}),C["!legacy"]=W),c.length>1&&(c[c.length]="</worksheet>",c[1]=c[1].replace("/>",">")),c.join("")}function ax(e,i,r,o){var c=function nx(e,i,r){var o=A(145),c=(r["!rows"]||[])[e]||{};o.write_shift(4,e),o.write_shift(4,0);var x=320;c.hpx?x=20*Nc(c.hpx):c.hpt&&(x=20*c.hpt),o.write_shift(2,x),o.write_shift(1,0);var y=0;c.level&&(y|=c.level),c.hidden&&(y|=16),(c.hpx||c.hpt)&&(y|=32),o.write_shift(1,y),o.write_shift(1,0);var T=0,C=o.l;o.l+=4;for(var I={r:e,c:0},F=0;F<16;++F)if(!(i.s.c>F+1<<10||i.e.c<F<<10)){for(var N=-1,U=-1,j=F<<10;j<F+1<<10;++j)I.c=j,(Array.isArray(r)?(r[I.r]||[])[I.c]:r[Le(I)])&&(N<0&&(N=j),U=j);N<0||(++T,o.write_shift(4,N),o.write_shift(4,U))}var B=o.l;return o.l=C,o.write_shift(4,T),o.l=B,o.length>o.l?o.slice(0,o.l):o}(o,r,i);(c.length>17||(i["!rows"]||[])[o])&&L(e,0,c)}var sx=fa,ox=$o;var jx=fa,qx=$o,Lg=["left","right","top","bottom","header","footer"];function oy(e,i,r,o,c,x,y){if(void 0===i.v)return!1;var T="";switch(i.t){case"b":T=i.v?"1":"0";break;case"d":(i=Kr(i)).z=i.z||or[14],i.v=Di(Ei(i.v)),i.t="n";break;case"n":case"e":T=""+i.v;break;default:T=i.v}var C={r,c:o};switch(C.s=ao(c.cellXfs,i,c),i.l&&x["!links"].push([Le(C),i.l]),i.c&&x["!comments"].push([Le(C),i.c]),i.t){case"s":case"str":return c.bookSST?(T=na(c.Strings,i.v,c.revStrings),C.t="s",C.v=T,y?L(e,18,function Ax(e,i,r){return null==r&&(r=A(8)),Rn(i,r),r.write_shift(4,i.v),r}(0,C)):L(e,7,function Ex(e,i,r){return null==r&&(r=A(12)),Ki(i,r),r.write_shift(4,i.v),r}(0,C))):(C.t="str",y?L(e,17,function Bx(e,i,r){return null==r&&(r=A(8+4*e.v.length)),Rn(i,r),Ot(e.v,r),r.length>r.l?r.slice(0,r.l):r}(i,C)):L(e,6,function Ox(e,i,r){return null==r&&(r=A(12+4*e.v.length)),Ki(i,r),Ot(e.v,r),r.length>r.l?r.slice(0,r.l):r}(i,C))),!0;case"n":return i.v==(0|i.v)&&i.v>-1e3&&i.v<1e3?y?L(e,13,function Px(e,i,r){return null==r&&(r=A(8)),Rn(i,r),ua(e.v,r),r}(i,C)):L(e,2,function Fx(e,i,r){return null==r&&(r=A(12)),Ki(i,r),ua(e.v,r),r}(i,C)):y?L(e,16,function Ix(e,i,r){return null==r&&(r=A(12)),Rn(i,r),ya(e.v,r),r}(i,C)):L(e,5,function Cx(e,i,r){return null==r&&(r=A(16)),Ki(i,r),ya(e.v,r),r}(i,C)),!0;case"b":return C.t="b",y?L(e,15,function xx(e,i,r){return null==r&&(r=A(5)),Rn(i,r),r.write_shift(1,e.v?1:0),r}(i,C)):L(e,4,function _x(e,i,r){return null==r&&(r=A(9)),Ki(i,r),r.write_shift(1,e.v?1:0),r}(i,C)),!0;case"e":return C.t="e",y?L(e,14,function bx(e,i,r){return null==r&&(r=A(8)),Rn(i,r),r.write_shift(1,e.v),r.write_shift(2,0),r.write_shift(1,0),r}(i,C)):L(e,3,function vx(e,i,r){return null==r&&(r=A(9)),Ki(i,r),r.write_shift(1,e.v),r}(i,C)),!0}return y?L(e,12,function px(e,i,r){return null==r&&(r=A(4)),Rn(i,r)}(0,C)):L(e,1,function fx(e,i,r){return null==r&&(r=A(8)),Ki(i,r)}(0,C)),!0}function gy(e,i,r,o){var c=O(),x=r.SheetNames[e],y=r.Sheets[x]||{},T=x;try{r&&r.Workbook&&(T=r.Workbook.Sheets[e].CodeName||T)}catch(I){}var C=ke(y["!ref"]||"A1");if(C.e.c>16383||C.e.r>1048575){if(i.WTF)throw new Error("Range "+(y["!ref"]||"A1")+" exceeds format limit A1:XFD1048576");C.e.c=Math.min(C.e.c,16383),C.e.r=Math.min(C.e.c,1048575)}return y["!links"]=[],y["!comments"]=[],L(c,129),(r.vbaraw||y["!outline"])&&L(c,147,function ux(e,i,r){null==r&&(r=A(84+4*e.length));var o=192;i&&(i.above&&(o&=-65),i.left&&(o&=-129)),r.write_shift(1,o);for(var c=1;c<3;++c)r.write_shift(1,0);return Va({auto:1},r),r.write_shift(-4,-1),r.write_shift(-4,-1),Qa(e,r),r.slice(0,r.l)}(T,y["!outline"])),L(c,148,ox(C)),function my(e,i,r){L(e,133),L(e,137,function ty(e,i,r){null==r&&(r=A(30));var o=924;return(((i||{}).Views||[])[0]||{}).RTL&&(o|=32),r.write_shift(2,o),r.write_shift(4,0),r.write_shift(4,0),r.write_shift(4,0),r.write_shift(1,0),r.write_shift(1,0),r.write_shift(2,0),r.write_shift(2,100),r.write_shift(2,0),r.write_shift(2,0),r.write_shift(2,0),r.write_shift(4,0),r}(0,r)),L(e,138),L(e,134)}(c,0,r.Workbook),function uy(e,i){!i||!i["!cols"]||(L(e,390),i["!cols"].forEach(function(r,o){r&&L(e,60,function Kx(e,i,r){null==r&&(r=A(18));var o=jn(e,i);r.write_shift(-4,e),r.write_shift(-4,e),r.write_shift(4,256*(o.width||10)),r.write_shift(4,0);var c=0;return i.hidden&&(c|=1),"number"==typeof o.width&&(c|=2),i.level&&(c|=i.level<<8),r.write_shift(2,c),r}(o,r))}),L(e,391))}(c,y),function ly(e,i,r,o){var c=ke(i["!ref"]||"A1"),y="",T=[];L(e,145);var C=Array.isArray(i),I=c.e.r;i["!rows"]&&(I=Math.max(c.e.r,i["!rows"].length-1));for(var F=c.s.r;F<=I;++F){y=se(F),ax(e,i,c,F);var N=!1;if(F<=c.e.r)for(var U=c.s.c;U<=c.e.c;++U){F===c.s.r&&(T[U]=ce(U));var j=C?(i[F]||[])[U]:i[T[U]+y];N=!!j&&oy(e,j,F,U,o,i,N)}}L(e,146)}(c,y,0,i),function _y(e,i){!i["!protect"]||L(e,535,function iy(e,i){return null==i&&(i=A(66)),i.write_shift(2,e.password?Ss(e.password):0),i.write_shift(4,1),[["objects",!1],["scenarios",!1],["formatCells",!0],["formatColumns",!0],["formatRows",!0],["insertColumns",!0],["insertRows",!0],["insertHyperlinks",!0],["deleteColumns",!0],["deleteRows",!0],["selectLockedCells",!1],["sort",!0],["autoFilter",!0],["pivotTables",!0],["selectUnlockedCells",!1]].forEach(function(r){i.write_shift(4,r[1]?null==e[r[0]]||e[r[0]]?0:1:null!=e[r[0]]&&e[r[0]]?0:1)}),i}(i["!protect"]))}(c,y),function py(e,i,r,o){if(i["!autofilter"]){var c=i["!autofilter"],x="string"==typeof c.ref?c.ref:Qe(c.ref);r.Workbook||(r.Workbook={Sheets:[]}),r.Workbook.Names||(r.Workbook.Names=[]);var y=r.Workbook.Names,T=qe(x);T.s.r==T.e.r&&(T.e.r=qe(i["!ref"]).e.r,x=Qe(T));for(var C=0;C<y.length;++C){var I=y[C];if("_xlnm._FilterDatabase"==I.Name&&I.Sheet==o){I.Ref="'"+r.SheetNames[o]+"'!"+x;break}}C==y.length&&y.push({Name:"_xlnm._FilterDatabase",Sheet:o,Ref:"'"+r.SheetNames[o]+"'!"+x}),L(e,161,$o(ke(x))),L(e,162)}}(c,y,r,e),function cy(e,i){!i||!i["!merges"]||(L(e,177,function Gx(e,i){return null==i&&(i=A(4)),i.write_shift(4,e),i}(i["!merges"].length)),i["!merges"].forEach(function(r){L(e,176,qx(r))}),L(e,178))}(c,y),function fy(e,i,r){i["!links"].forEach(function(o){if(o[1].Target){var c=Wr(r,-1,o[1].Target.replace(/#.*$/,""),Ar.HLINK);L(e,494,function Wx(e,i){var r=A(50+4*(e[1].Target.length+(e[1].Tooltip||"").length));$o({s:Be(e[0]),e:Be(e[0])},r),On("rId"+i,r);var o=e[1].Target.indexOf("#");return Ot((-1==o?"":e[1].Target.slice(o+1))||"",r),Ot(e[1].Tooltip||"",r),Ot("",r),r.slice(0,r.l)}(o,c))}}),delete i["!links"]}(c,y,o),y["!margins"]&&L(c,476,function Qx(e,i){return null==i&&(i=A(48)),Fs(e),Lg.forEach(function(r){ya(e[r],i)}),i}(y["!margins"])),(!i||i.ignoreEC||null==i.ignoreEC)&&function hy(e,i){!i||!i["!ref"]||(L(e,648),L(e,649,function ry(e){var i=A(24);return i.write_shift(4,4),i.write_shift(4,1),$o(e,i),i}(ke(i["!ref"]))),L(e,650))}(c,y),function dy(e,i,r,o){if(i["!comments"].length>0){var c=Wr(o,-1,"../drawings/vmlDrawing"+(r+1)+".vml",Ar.VML);L(e,551,On("rId"+c)),i["!legacy"]=c}}(c,y,e,o),L(c,130),c.end()}var rg=[["allowRefreshQuery",!1,"bool"],["autoCompressPictures",!0,"bool"],["backupFile",!1,"bool"],["checkCompatibility",!1,"bool"],["CodeName",""],["date1904",!1,"bool"],["defaultThemeVersion",0,"int"],["filterPrivacy",!1,"bool"],["hidePivotFieldList",!1,"bool"],["promptedSolutions",!1,"bool"],["publishItems",!1,"bool"],["refreshAllConnections",!1,"bool"],["saveExternalLinkValues",!0,"bool"],["showBorderUnselectedTables",!0,"bool"],["showInkAnnotation",!0,"bool"],["showObjects","all"],["showPivotChartFilter",!1,"bool"],["updateLinks","userSet"]],Iy="][*?/\\".split("");function Bg(e,i){if(e.length>31){if(i)return!1;throw new Error("Sheet names cannot exceed 31 chars")}var r=!0;return Iy.forEach(function(o){if(-1!=e.indexOf(o)){if(!i)throw new Error("Sheet name cannot contain : \\ / ? * [ ]");r=!1}}),r}function Ug(e){var i=[xi];i[i.length]=At("workbook",null,{xmlns:ps[0],"xmlns:r":Pi_r});var r=e.Workbook&&(e.Workbook.Names||[]).length>0,o={codeName:"ThisWorkbook"};e.Workbook&&e.Workbook.WBProps&&(rg.forEach(function(T){null!=e.Workbook.WBProps[T[0]]&&e.Workbook.WBProps[T[0]]!=T[1]&&(o[T[0]]=e.Workbook.WBProps[T[0]])}),e.Workbook.WBProps.CodeName&&(o.codeName=e.Workbook.WBProps.CodeName,delete o.CodeName)),i[i.length]=At("workbookPr",null,o);var c=e.Workbook&&e.Workbook.Sheets||[],x=0;if(c&&c[0]&&c[0].Hidden){for(i[i.length]="<bookViews>",x=0;x!=e.SheetNames.length&&c[x]&&c[x].Hidden;++x);x==e.SheetNames.length&&(x=0),i[i.length]='<workbookView firstSheet="'+x+'" activeTab="'+x+'"/>',i[i.length]="</bookViews>"}for(i[i.length]="<sheets>",x=0;x!=e.SheetNames.length;++x){var y={name:ni(e.SheetNames[x].slice(0,31))};if(y.sheetId=""+(x+1),y["r:id"]="rId"+(x+1),c[x])switch(c[x].Hidden){case 1:y.state="hidden";break;case 2:y.state="veryHidden"}i[i.length]=At("sheet",null,y)}return i[i.length]="</sheets>",r&&(i[i.length]="<definedNames>",e.Workbook&&e.Workbook.Names&&e.Workbook.Names.forEach(function(T){var C={name:T.Name};T.Comment&&(C.comment=T.Comment),null!=T.Sheet&&(C.localSheetId=""+T.Sheet),T.Hidden&&(C.hidden="1"),T.Ref&&(i[i.length]=At("definedName",ni(T.Ref),C))}),i[i.length]="</definedNames>"),i.length>2&&(i[i.length]="</workbook>",i[1]=i[1].replace("/>",">")),i.join("")}function Ly(e,i){return i||(i=A(127)),i.write_shift(4,e.Hidden),i.write_shift(4,e.iTabID),On(e.strRelID,i),Ot(e.name.slice(0,31),i),i.length>i.l?i.slice(0,i.l):i}function qy(e,i){var r=O();return L(r,131),L(r,128,function Zy(e,i){i||(i=A(127));for(var r=0;4!=r;++r)i.write_shift(4,0);return Ot("SheetJS",i),Ot(yn_version,i),Ot(yn_version,i),Ot("7262",i),i.length>i.l?i.slice(0,i.l):i}()),L(r,153,function Oy(e,i){i||(i=A(72));var r=0;return e&&e.filterPrivacy&&(r|=8),i.write_shift(4,r),i.write_shift(4,0),Qa(e&&e.CodeName||"ThisWorkbook",i),i.slice(0,i.l)}(e.Workbook&&e.Workbook.WBProps||null)),function jy(e,i){if(i.Workbook&&i.Workbook.Sheets){for(var r=i.Workbook.Sheets,o=0,c=-1,x=-1;o<r.length;++o)!r[o]||!r[o].Hidden&&-1==c?c=o:1==r[o].Hidden&&-1==x&&(x=o);x>c||(L(e,135),L(e,158,function Vy(e,i){return i||(i=A(29)),i.write_shift(-4,0),i.write_shift(-4,460),i.write_shift(4,28800),i.write_shift(4,17600),i.write_shift(4,500),i.write_shift(4,e),i.write_shift(4,e),i.write_shift(1,120),i.length>i.l?i.slice(0,i.l):i}(c)),L(e,136))}}(r,e),function Uy(e,i){L(e,143);for(var r=0;r!=i.SheetNames.length;++r)L(e,156,Ly({Hidden:i.Workbook&&i.Workbook.Sheets&&i.Workbook.Sheets[r]&&i.Workbook.Sheets[r].Hidden||0,iTabID:r+1,strRelID:"rId"+(r+1),name:i.SheetNames[r]}));L(e,144)}(r,e),L(r,132),r.end()}function nv(e,i,r,o,c){return(".bin"===i.slice(-4)?gy:Dg)(e,r,o,c)}function ov(e,i,r){return(".bin"===i.slice(-4)?ju:i0)(e,r)}function jg(e){return At("NamedRange",null,{"ss:Name":e.Name,"ss:RefersTo":"="+Qf(e.Ref,{r:0,c:0})})}function Tv(e,i,r,o,c,x,y){if(!e||null==e.v&&null==e.f)return"";var T={};if(e.f&&(T["ss:Formula"]="="+ni(Qf(e.f,y))),e.F&&e.F.slice(0,i.length)==i){var C=Be(e.F.slice(i.length+1));T["ss:ArrayRange"]="RC:R"+(C.r==y.r?"":"["+(C.r-y.r)+"]")+"C"+(C.c==y.c?"":"["+(C.c-y.c)+"]")}if(e.l&&e.l.Target&&(T["ss:HRef"]=ni(e.l.Target),e.l.Tooltip&&(T["x:HRefScreenTip"]=ni(e.l.Tooltip))),r["!merges"])for(var I=r["!merges"],F=0;F!=I.length;++F)I[F].s.c!=y.c||I[F].s.r!=y.r||(I[F].e.c>I[F].s.c&&(T["ss:MergeAcross"]=I[F].e.c-I[F].s.c),I[F].e.r>I[F].s.r&&(T["ss:MergeDown"]=I[F].e.r-I[F].s.r));var N="",U="";switch(e.t){case"z":if(!o.sheetStubs)return"";break;case"n":N="Number",U=String(e.v);break;case"b":N="Boolean",U=e.v?"1":"0";break;case"e":N="Error",U=Ho[e.v];break;case"d":N="DateTime",U=new Date(e.v).toISOString(),null==e.z&&(e.z=e.z||or[14]);break;case"s":N="String",U=function Ka(e){return(e+"").replace(No,function(r){return Ni[r]}).replace(uh,function(r){return"&#x"+r.charCodeAt(0).toString(16).toUpperCase()+";"})}(e.v||"")}var j=ao(o.cellXfs,e,o);T["ss:StyleID"]="s"+(21+j),T["ss:Index"]=y.c+1;var B="z"==e.t?"":'<Data ss:Type="'+N+'">'+(null!=e.v?U:"")+"</Data>";return(e.c||[]).length>0&&(B+=function bv(e){return e.map(function(i){var r=function Dt(e){return e.replace(/(\r\n|[\r\n])/g,"&#10;")}(i.t||""),o=At("ss:Data",r,{xmlns:"http://www.w3.org/TR/REC-html40"});return At("Comment",o,{"ss:Author":i.a})}).join("")}(e.c)),At("Cell",B,T)}function Ev(e,i){var r='<Row ss:Index="'+(e+1)+'"';return i&&(i.hpt&&!i.hpx&&(i.hpx=$f(i.hpt)),i.hpx&&(r+=' ss:AutoFitHeight="0" ss:Height="'+i.hpx+'"'),i.hidden&&(r+=' ss:Hidden="1"')),r+">"}function Av(e,i,r){var o=[],x=r.Sheets[r.SheetNames[e]],y=x?function vv(e,i,r,o){if(!e||!((o||{}).Workbook||{}).Names)return"";for(var c=o.Workbook.Names,x=[],y=0;y<c.length;++y){var T=c[y];T.Sheet==r&&(T.Name.match(/^_xlfn\./)||x.push(jg(T)))}return x.join("")}(x,0,e,r):"";return y.length>0&&o.push("<Names>"+y+"</Names>"),y=x?function Sv(e,i,r,o){if(!e["!ref"])return"";var c=ke(e["!ref"]),x=e["!merges"]||[],y=0,T=[];e["!cols"]&&e["!cols"].forEach(function(X,_e){Vl(X);var me=!!X.width,ue=jn(_e,X),Ue={"ss:Index":_e+1};me&&(Ue["ss:Width"]=Ul(ue.width)),X.hidden&&(Ue["ss:Hidden"]="1"),T.push(At("Column",null,Ue))});for(var C=Array.isArray(e),I=c.s.r;I<=c.e.r;++I){for(var F=[Ev(I,(e["!rows"]||[])[I])],N=c.s.c;N<=c.e.c;++N){var U=!1;for(y=0;y!=x.length;++y)if(!(x[y].s.c>N||x[y].s.r>I||x[y].e.c<N||x[y].e.r<I)){(x[y].s.c!=N||x[y].s.r!=I)&&(U=!0);break}if(!U){var j={r:I,c:N},W=Le(j);F.push(Tv(C?(e[I]||[])[N]:e[W],W,e,i,0,0,j))}}F.push("</Row>"),F.length>2&&T.push(F.join(""))}return T.join("")}(x,i):"",y.length>0&&o.push("<Table>"+y+"</Table>"),o.push(function wv(e,i,r,o){if(!e)return"";var c=[];if(e["!margins"]&&(c.push("<PageSetup>"),e["!margins"].header&&c.push(At("Header",null,{"x:Margin":e["!margins"].header})),e["!margins"].footer&&c.push(At("Footer",null,{"x:Margin":e["!margins"].footer})),c.push(At("PageMargins",null,{"x:Bottom":e["!margins"].bottom||"0.75","x:Left":e["!margins"].left||"0.7","x:Right":e["!margins"].right||"0.7","x:Top":e["!margins"].top||"0.75"})),c.push("</PageSetup>")),o&&o.Workbook&&o.Workbook.Sheets&&o.Workbook.Sheets[r])if(o.Workbook.Sheets[r].Hidden)c.push(At("Visible",1==o.Workbook.Sheets[r].Hidden?"SheetHidden":"SheetVeryHidden",{}));else{for(var x=0;x<r&&(!o.Workbook.Sheets[x]||o.Workbook.Sheets[x].Hidden);++x);x==r&&c.push("<Selected/>")}return((((o||{}).Workbook||{}).Views||[])[0]||{}).RTL&&c.push("<DisplayRightToLeft/>"),e["!protect"]&&(c.push(tn("ProtectContents","True")),e["!protect"].objects&&c.push(tn("ProtectObjects","True")),e["!protect"].scenarios&&c.push(tn("ProtectScenarios","True")),null==e["!protect"].selectLockedCells||e["!protect"].selectLockedCells?null!=e["!protect"].selectUnlockedCells&&!e["!protect"].selectUnlockedCells&&c.push(tn("EnableSelection","UnlockedCells")):c.push(tn("EnableSelection","NoSelection")),[["formatCells","AllowFormatCells"],["formatColumns","AllowSizeCols"],["formatRows","AllowSizeRows"],["insertColumns","AllowInsertCols"],["insertRows","AllowInsertRows"],["insertHyperlinks","AllowInsertHyperlinks"],["deleteColumns","AllowDeleteCols"],["deleteRows","AllowDeleteRows"],["sort","AllowSort"],["autoFilter","AllowFilter"],["pivotTables","AllowUsePivotTables"]].forEach(function(y){e["!protect"][y[0]]&&c.push("<"+y[1]+"/>")})),0==c.length?"":At("WorksheetOptions",c.join(""),{xmlns:Qn_x})}(x,0,e,r)),o.join("")}function kv(e,i){i||(i={}),e.SSF||(e.SSF=Kr(or)),e.SSF&&(Ro(),Lo(e.SSF),i.revssf=xc(e.SSF),i.revssf[e.SSF[65535]]=0,i.ssf=e.SSF,i.cellXfs=[],ao(i.cellXfs,{},{revssf:{General:0}}));var r=[];r.push(function _v(e,i){var r=[];return e.Props&&r.push(function D0(e,i){var r=[];return Fi(xd).map(function(o){for(var c=0;c<ys.length;++c)if(ys[c][1]==o)return ys[c];for(c=0;c<Qs.length;++c)if(Qs[c][1]==o)return Qs[c];throw o}).forEach(function(o){if(null!=e[o[1]]){var c=i&&i.Props&&null!=i.Props[o[1]]?i.Props[o[1]]:e[o[1]];"date"===o[2]&&(c=new Date(c).toISOString().replace(/\.\d*Z/,"Z")),"number"==typeof c?c=String(c):!0===c||!1===c?c=c?"1":"0":c instanceof Date&&(c=new Date(c).toISOString().replace(/\.\d*Z/,"")),r.push(tn(xd[o[1]]||o[1],c))}}),At("DocumentProperties",r.join(""),{xmlns:Qn_o})}(e.Props,i)),e.Custprops&&r.push(function Mu(e,i){var r=["Worksheets","SheetNames"],o="CustomDocumentProperties",c=[];return e&&Fi(e).forEach(function(x){if(Object.prototype.hasOwnProperty.call(e,x)){for(var y=0;y<ys.length;++y)if(x==ys[y][1])return;for(y=0;y<Qs.length;++y)if(x==Qs[y][1])return;for(y=0;y<r.length;++y)if(x==r[y])return;var T=e[x],C="string";"number"==typeof T?(C="float",T=String(T)):!0===T||!1===T?(C="boolean",T=T?"1":"0"):T=String(T),c.push(At(Ya(x),T,{"dt:dt":C}))}}),i&&Fi(i).forEach(function(x){if(Object.prototype.hasOwnProperty.call(i,x)&&(!e||!Object.prototype.hasOwnProperty.call(e,x))){var y=i[x],T="string";"number"==typeof y?(T="float",y=String(y)):!0===y||!1===y?(T="boolean",y=y?"1":"0"):y instanceof Date?(T="dateTime.tz",y=y.toISOString()):y=String(y),c.push(At(Ya(x),y,{"dt:dt":T}))}}),"<"+o+' xmlns="'+Qn_o+'">'+c.join("")+"</"+o+">"}(e.Props,e.Custprops)),r.join("")}(e,i)),r.push(""),r.push(""),r.push("");for(var o=0;o<e.SheetNames.length;++o)r.push(At("Worksheet",Av(o,i,e),{"ss:Name":ni(e.SheetNames[o])}));return r[2]=function xv(e,i){var r=['<Style ss:ID="Default" ss:Name="Normal"><NumberFormat/></Style>'];return i.cellXfs.forEach(function(o,c){var x=[];x.push(At("NumberFormat",null,{"ss:Format":ni(or[o.numFmtId])}));var y={"ss:ID":"s"+(21+c)};r.push(At("Style",x.join(""),y))}),At("Styles",r.join(""))}(0,i),r[3]=function yv(e){if(!((e||{}).Workbook||{}).Names)return"";for(var i=e.Workbook.Names,r=[],o=0;o<i.length;++o){var c=i[o];null==c.Sheet&&(c.Name.match(/^_xlfn\./)||r.push(jg(c)))}return At("Names",r.join(""))}(e),xi+At("Workbook",r.join(""),{xmlns:Qn_ss,"xmlns:o":Qn_o,"xmlns:x":Qn_x,"xmlns:ss":Qn_ss,"xmlns:dt":"uuid:C2F41010-65B3-11d1-A29F-00AA00C14882","xmlns:html":"http://www.w3.org/TR/REC-html40"})}var d0={0:{f:function ix(e,i){var r={},o=e.l+i;r.r=e.read_shift(4),e.l+=4;var c=e.read_shift(2);e.l+=1;var x=e.read_shift(1);return e.l=o,7&x&&(r.level=7&x),16&x&&(r.hidden=!0),32&x&&(r.hpt=c/20),r}},1:{f:function hx(e){return[ui(e)]}},2:{f:function Mx(e){return[ui(e),hi(e),"n"]}},3:{f:function yx(e){return[ui(e),e.read_shift(1),"e"]}},4:{f:function mx(e){return[ui(e),e.read_shift(1),"b"]}},5:{f:function kx(e){return[ui(e),rn(e),"n"]}},6:{f:function Rx(e){return[ui(e),bt(e),"str"]}},7:{f:function Tx(e){return[ui(e),e.read_shift(4),"s"]}},8:{f:function Vx(e,i,r){var o=e.l+i,c=ui(e);c.r=r["!row"];var y=[c,bt(e),"str"];if(r.cellFormula){e.l+=2;var T=Xh(e,o-e.l,r);y[3]=li(T,0,c,r.supbooks,r)}else e.l=o;return y}},9:{f:function Zx(e,i,r){var o=e.l+i,c=ui(e);c.r=r["!row"];var y=[c,rn(e),"n"];if(r.cellFormula){e.l+=2;var T=Xh(e,o-e.l,r);y[3]=li(T,0,c,r.supbooks,r)}else e.l=o;return y}},10:{f:function Nx(e,i,r){var o=e.l+i,c=ui(e);c.r=r["!row"];var y=[c,e.read_shift(1),"b"];if(r.cellFormula){e.l+=2;var T=Xh(e,o-e.l,r);y[3]=li(T,0,c,r.supbooks,r)}else e.l=o;return y}},11:{f:function Ux(e,i,r){var o=e.l+i,c=ui(e);c.r=r["!row"];var y=[c,e.read_shift(1),"e"];if(r.cellFormula){e.l+=2;var T=Xh(e,o-e.l,r);y[3]=li(T,0,c,r.supbooks,r)}else e.l=o;return y}},12:{f:function dx(e){return[pn(e)]}},13:{f:function Dx(e){return[pn(e),hi(e),"n"]}},14:{f:function wx(e){return[pn(e),e.read_shift(1),"e"]}},15:{f:function gx(e){return[pn(e),e.read_shift(1),"b"]}},16:{f:function Pg(e){return[pn(e),rn(e),"n"]}},17:{f:function zx(e){return[pn(e),bt(e),"str"]}},18:{f:function Sx(e){return[pn(e),e.read_shift(4),"s"]}},19:{f:rr},20:{},21:{},22:{},23:{},24:{},25:{},26:{},27:{},28:{},29:{},30:{},31:{},32:{},33:{},34:{},35:{T:1},36:{T:-1},37:{T:1},38:{T:-1},39:{f:function By(e,i,r){var o=e.l+i;e.l+=4,e.l+=1;var c=e.read_shift(4),x=Zr(e),y=pm(e,0,r),T=pi(e);e.l=o;var C={Name:x,Ptg:y};return c<268435455&&(C.Sheet=c),T&&(C.Comment=T),C}},40:{},42:{},43:{f:function F_(e,i,r){var o={};o.sz=e.read_shift(2)/20;var c=function mh(e){var i=e.read_shift(1);return e.l++,{fBold:1&i,fItalic:2&i,fUnderline:4&i,fStrikeout:8&i,fOutline:16&i,fShadow:32&i,fCondense:64&i,fExtend:128&i}}(e);switch(c.fItalic&&(o.italic=1),c.fCondense&&(o.condense=1),c.fExtend&&(o.extend=1),c.fShadow&&(o.shadow=1),c.fOutline&&(o.outline=1),c.fStrikeout&&(o.strike=1),700===e.read_shift(2)&&(o.bold=1),e.read_shift(2)){case 1:o.vertAlign="superscript";break;case 2:o.vertAlign="subscript"}var y=e.read_shift(1);0!=y&&(o.underline=y);var T=e.read_shift(1);T>0&&(o.family=T);var C=e.read_shift(1);switch(C>0&&(o.charset=C),e.l++,o.color=function cd(e){var i={},o=e.read_shift(1)>>>1,c=e.read_shift(1),x=e.read_shift(2,"i"),y=e.read_shift(1),T=e.read_shift(1),C=e.read_shift(1);switch(e.l++,o){case 0:i.auto=1;break;case 1:i.index=c;var I=Bn[c];I&&(i.rgb=Qo(I));break;case 2:i.rgb=Qo([y,T,C]);break;case 3:i.theme=c}return 0!=x&&(i.tint=x>0?x/32767:x/32768),i}(e),e.read_shift(1)){case 1:o.scheme="major";break;case 2:o.scheme="minor"}return o.name=bt(e),o}},44:{f:function Wf(e,i){return[e.read_shift(2),bt(e)]}},45:{f:D_},46:{f:P_},47:{f:function zp(e,i){var r=e.l+i,o=e.read_shift(2),c=e.read_shift(2);return e.l=r,{ixfe:o,numFmtId:c}}},48:{},49:{f:function Jt(e){return e.read_shift(4,"i")}},50:{},51:{f:function $p(e){for(var i=[],r=e.read_shift(4);r-- >0;)i.push([e.read_shift(4),e.read_shift(4)]);return i}},52:{T:1},53:{T:-1},54:{T:1},55:{T:-1},56:{T:1},57:{T:-1},58:{},59:{},60:{f:function hp(e,i,r){if(!r.cellStyles)return S(e,i);var o=r&&r.biff>=12?4:2,c=e.read_shift(o),x=e.read_shift(o),y=e.read_shift(o),T=e.read_shift(o),C=e.read_shift(2);2==o&&(e.l+=2);var I={s:c,e:x,w:y,ixfe:T,flags:C};return(r.biff>=5||!r.biff)&&(I.level=C>>8&7),I}},62:{f:function Lx(e){return[ui(e),rr(e),"is"]}},63:{f:function ro(e){var i={};i.i=e.read_shift(4);var r={};r.r=e.read_shift(4),r.c=e.read_shift(4),i.r=Le(r);var o=e.read_shift(1);return 2&o&&(i.l="1"),8&o&&(i.a="1"),i}},64:{f:function ny(){}},65:{},66:{},67:{},68:{},69:{},70:{},128:{},129:{T:1},130:{T:-1},131:{T:1,f:S,p:0},132:{T:-1},133:{T:1},134:{T:-1},135:{T:1},136:{T:-1},137:{T:1,f:function ey(e){var i=e.read_shift(2);return e.l+=28,{RTL:32&i}}},138:{T:-1},139:{T:1},140:{T:-1},141:{T:1},142:{T:-1},143:{T:1},144:{T:-1},145:{T:1},146:{T:-1},147:{f:function cx(e,i){var r={},o=e[e.l];return++e.l,r.above=!(64&o),r.left=!(128&o),e.l+=18,r.name=Ks(e,i-19),r}},148:{f:sx,p:16},151:{f:function Xx(){}},152:{},153:{f:function Ry(e,i){var r={},o=e.read_shift(4);r.defaultThemeVersion=e.read_shift(4);var c=i>8?bt(e):"";return c.length>0&&(r.CodeName=c),r.autoCompressPictures=!!(65536&o),r.backupFile=!!(64&o),r.checkCompatibility=!!(4096&o),r.date1904=!!(1&o),r.filterPrivacy=!!(8&o),r.hidePivotFieldList=!!(1024&o),r.promptedSolutions=!!(16&o),r.publishItems=!!(2048&o),r.refreshAllConnections=!!(262144&o),r.saveExternalLinkValues=!!(128&o),r.showBorderUnselectedTables=!!(4&o),r.showInkAnnotation=!!(32&o),r.showObjects=["all","placeholders","none"][o>>13&3],r.showPivotChartFilter=!!(32768&o),r.updateLinks=["userSet","never","always"][o>>8&3],r}},154:{},155:{},156:{f:function Py(e,i){var r={};return r.Hidden=e.read_shift(4),r.iTabID=e.read_shift(4),r.strRelID=Ci(e,i-8),r.name=bt(e),r}},157:{},158:{},159:{T:1,f:function b_(e){return[e.read_shift(4),e.read_shift(4)]}},160:{T:-1},161:{T:1,f:fa},162:{T:-1},163:{T:1},164:{T:-1},165:{T:1},166:{T:-1},167:{},168:{},169:{},170:{},171:{},172:{T:1},173:{T:-1},174:{},175:{},176:{f:jx},177:{T:1},178:{T:-1},179:{T:1},180:{T:-1},181:{T:1},182:{T:-1},183:{T:1},184:{T:-1},185:{T:1},186:{T:-1},187:{T:1},188:{T:-1},189:{T:1},190:{T:-1},191:{T:1},192:{T:-1},193:{T:1},194:{T:-1},195:{T:1},196:{T:-1},197:{T:1},198:{T:-1},199:{T:1},200:{T:-1},201:{T:1},202:{T:-1},203:{T:1},204:{T:-1},205:{T:1},206:{T:-1},207:{T:1},208:{T:-1},209:{T:1},210:{T:-1},211:{T:1},212:{T:-1},213:{T:1},214:{T:-1},215:{T:1},216:{T:-1},217:{T:1},218:{T:-1},219:{T:1},220:{T:-1},221:{T:1},222:{T:-1},223:{T:1},224:{T:-1},225:{T:1},226:{T:-1},227:{T:1},228:{T:-1},229:{T:1},230:{T:-1},231:{T:1},232:{T:-1},233:{T:1},234:{T:-1},235:{T:1},236:{T:-1},237:{T:1},238:{T:-1},239:{T:1},240:{T:-1},241:{T:1},242:{T:-1},243:{T:1},244:{T:-1},245:{T:1},246:{T:-1},247:{T:1},248:{T:-1},249:{T:1},250:{T:-1},251:{T:1},252:{T:-1},253:{T:1},254:{T:-1},255:{T:1},256:{T:-1},257:{T:1},258:{T:-1},259:{T:1},260:{T:-1},261:{T:1},262:{T:-1},263:{T:1},264:{T:-1},265:{T:1},266:{T:-1},267:{T:1},268:{T:-1},269:{T:1},270:{T:-1},271:{T:1},272:{T:-1},273:{T:1},274:{T:-1},275:{T:1},276:{T:-1},277:{},278:{T:1},279:{T:-1},280:{T:1},281:{T:-1},282:{T:1},283:{T:1},284:{T:-1},285:{T:1},286:{T:-1},287:{T:1},288:{T:-1},289:{T:1},290:{T:-1},291:{T:1},292:{T:-1},293:{T:1},294:{T:-1},295:{T:1},296:{T:-1},297:{T:1},298:{T:-1},299:{T:1},300:{T:-1},301:{T:1},302:{T:-1},303:{T:1},304:{T:-1},305:{T:1},306:{T:-1},307:{T:1},308:{T:-1},309:{T:1},310:{T:-1},311:{T:1},312:{T:-1},313:{T:-1},314:{T:1},315:{T:-1},316:{T:1},317:{T:-1},318:{T:1},319:{T:-1},320:{T:1},321:{T:-1},322:{T:1},323:{T:-1},324:{T:1},325:{T:-1},326:{T:1},327:{T:-1},328:{T:1},329:{T:-1},330:{T:1},331:{T:-1},332:{T:1},333:{T:-1},334:{T:1},335:{f:function Gp(e,i){return{flags:e.read_shift(4),version:e.read_shift(4),name:bt(e)}}},336:{T:-1},337:{f:function Vc(e){return e.l+=4,0!=e.read_shift(4)},T:1},338:{T:-1},339:{T:1},340:{T:-1},341:{T:1},342:{T:-1},343:{T:1},344:{T:-1},345:{T:1},346:{T:-1},347:{T:1},348:{T:-1},349:{T:1},350:{T:-1},351:{},352:{},353:{T:1},354:{T:-1},355:{f:Ci},357:{},358:{},359:{},360:{T:1},361:{},362:{f:function np(e,i,r){if(r.biff<8)return function Fh(e,i,r){3==e[e.l+1]&&e[e.l]++;var o=Ts(e,0,r);return 3==o.charCodeAt(0)?o.slice(1):o}(e,0,r);for(var o=[],c=e.l+i,x=e.read_shift(r.biff>8?4:2);0!=x--;)o.push(Jo(e,0,r));if(e.l!=c)throw new Error("Bad ExternSheet: "+e.l+" != "+c);return o}},363:{},364:{},366:{},367:{},368:{},369:{},370:{},371:{},372:{T:1},373:{T:-1},374:{T:1},375:{T:-1},376:{T:1},377:{T:-1},378:{T:1},379:{T:-1},380:{T:1},381:{T:-1},382:{T:1},383:{T:-1},384:{T:1},385:{T:-1},386:{T:1},387:{T:-1},388:{T:1},389:{T:-1},390:{T:1},391:{T:-1},392:{T:1},393:{T:-1},394:{T:1},395:{T:-1},396:{},397:{},398:{},399:{},400:{},401:{T:1},403:{},404:{},405:{},406:{},407:{},408:{},409:{},410:{},411:{},412:{},413:{},414:{},415:{},416:{},417:{},418:{},419:{},420:{},421:{},422:{T:1},423:{T:1},424:{T:-1},425:{T:-1},426:{f:function Hx(e,i,r){var o=e.l+i,c=Ll(e),x=e.read_shift(1),y=[c];if(y[2]=x,r.cellFormula){var T=dm(e,o-e.l,r);y[1]=T}else e.l=o;return y}},427:{f:function Yx(e,i,r){var o=e.l+i,x=[fa(e,16)];if(r.cellFormula){var y=mm(e,o-e.l,r);x[1]=y,e.l=o}else e.l=o;return x}},428:{},429:{T:1},430:{T:-1},431:{T:1},432:{T:-1},433:{T:1},434:{T:-1},435:{T:1},436:{T:-1},437:{T:1},438:{T:-1},439:{T:1},440:{T:-1},441:{T:1},442:{T:-1},443:{T:1},444:{T:-1},445:{T:1},446:{T:-1},447:{T:1},448:{T:-1},449:{T:1},450:{T:-1},451:{T:1},452:{T:-1},453:{T:1},454:{T:-1},455:{T:1},456:{T:-1},457:{T:1},458:{T:-1},459:{T:1},460:{T:-1},461:{T:1},462:{T:-1},463:{T:1},464:{T:-1},465:{T:1},466:{T:-1},467:{T:1},468:{T:-1},469:{T:1},470:{T:-1},471:{},472:{},473:{T:1},474:{T:-1},475:{},476:{f:function Jx(e){var i={};return Lg.forEach(function(r){i[r]=rn(e)}),i}},477:{},478:{},479:{T:1},480:{T:-1},481:{T:1},482:{T:-1},483:{T:1},484:{T:-1},485:{f:function lx(){}},486:{T:1},487:{T:-1},488:{T:1},489:{T:-1},490:{T:1},491:{T:-1},492:{T:1},493:{T:-1},494:{f:function $x(e,i){var r=e.l+i,o=fa(e,16),c=pi(e),x=bt(e),y=bt(e),T=bt(e);e.l=r;var C={rfx:o,relId:c,loc:x,display:T};return y&&(C.Tooltip=y),C}},495:{T:1},496:{T:-1},497:{T:1},498:{T:-1},499:{},500:{T:1},501:{T:-1},502:{T:1},503:{T:-1},504:{},505:{T:1},506:{T:-1},507:{},508:{T:1},509:{T:-1},510:{T:1},511:{T:-1},512:{},513:{},514:{T:1},515:{T:-1},516:{T:1},517:{T:-1},518:{T:1},519:{T:-1},520:{T:1},521:{T:-1},522:{},523:{},524:{},525:{},526:{},527:{},528:{T:1},529:{T:-1},530:{T:1},531:{T:-1},532:{T:1},533:{T:-1},534:{},535:{},536:{},537:{},538:{T:1},539:{T:-1},540:{T:1},541:{T:-1},542:{T:1},548:{},549:{},550:{f:Ci},551:{},552:{},553:{},554:{T:1},555:{T:-1},556:{T:1},557:{T:-1},558:{T:1},559:{T:-1},560:{T:1},561:{T:-1},562:{},564:{},565:{T:1},566:{T:-1},569:{T:1},570:{T:-1},572:{},573:{T:1},574:{T:-1},577:{},578:{},579:{},580:{},581:{},582:{},583:{},584:{},585:{},586:{},587:{},588:{T:-1},589:{},590:{T:1},591:{T:-1},592:{T:1},593:{T:-1},594:{T:1},595:{T:-1},596:{},597:{T:1},598:{T:-1},599:{T:1},600:{T:-1},601:{T:1},602:{T:-1},603:{T:1},604:{T:-1},605:{T:1},606:{T:-1},607:{},608:{T:1},609:{T:-1},610:{},611:{T:1},612:{T:-1},613:{T:1},614:{T:-1},615:{T:1},616:{T:-1},617:{T:1},618:{T:-1},619:{T:1},620:{T:-1},625:{},626:{T:1},627:{T:-1},628:{T:1},629:{T:-1},630:{T:1},631:{T:-1},632:{f:nm},633:{T:1},634:{T:-1},635:{T:1,f:function im(e){var i={};i.iauthor=e.read_shift(4);var r=fa(e,16);return i.rfx=r.s,i.ref=Le(r.s),e.l+=16,i}},636:{T:-1},637:{f:vi},638:{T:1},639:{},640:{T:-1},641:{T:1},642:{T:-1},643:{T:1},644:{},645:{T:-1},646:{T:1},648:{T:1},649:{},650:{T:-1},651:{f:function by(e,i){return e.l+=10,{name:bt(e)}}},652:{},653:{T:1},654:{T:-1},655:{T:1},656:{T:-1},657:{T:1},658:{T:-1},659:{},660:{T:1},661:{},662:{T:-1},663:{},664:{T:1},665:{},666:{T:-1},667:{},668:{},669:{},671:{T:1},672:{T:-1},673:{T:1},674:{T:-1},675:{},676:{},677:{},678:{},679:{},680:{},681:{},1024:{},1025:{},1026:{T:1},1027:{T:-1},1028:{T:1},1029:{T:-1},1030:{},1031:{T:1},1032:{T:-1},1033:{T:1},1034:{T:-1},1035:{},1036:{},1037:{},1038:{T:1},1039:{T:-1},1040:{},1041:{T:1},1042:{T:-1},1043:{},1044:{},1045:{},1046:{T:1},1047:{T:-1},1048:{T:1},1049:{T:-1},1050:{},1051:{T:1},1052:{T:1},1053:{f:function ay(){}},1054:{T:1},1055:{},1056:{T:1},1057:{T:-1},1058:{T:1},1059:{T:-1},1061:{},1062:{T:1},1063:{T:-1},1064:{T:1},1065:{T:-1},1066:{T:1},1067:{T:-1},1068:{T:1},1069:{T:-1},1070:{T:1},1071:{T:-1},1072:{T:1},1073:{T:-1},1075:{T:1},1076:{T:-1},1077:{T:1},1078:{T:-1},1079:{T:1},1080:{T:-1},1081:{T:1},1082:{T:-1},1083:{T:1},1084:{T:-1},1085:{},1086:{T:1},1087:{T:-1},1088:{T:1},1089:{T:-1},1090:{T:1},1091:{T:-1},1092:{T:1},1093:{T:-1},1094:{T:1},1095:{T:-1},1096:{},1097:{T:1},1098:{},1099:{T:-1},1100:{T:1},1101:{T:-1},1102:{},1103:{},1104:{},1105:{},1111:{},1112:{},1113:{T:1},1114:{T:-1},1115:{T:1},1116:{T:-1},1117:{},1118:{T:1},1119:{T:-1},1120:{T:1},1121:{T:-1},1122:{T:1},1123:{T:-1},1124:{T:1},1125:{T:-1},1126:{},1128:{T:1},1129:{T:-1},1130:{},1131:{T:1},1132:{T:-1},1133:{T:1},1134:{T:-1},1135:{T:1},1136:{T:-1},1137:{T:1},1138:{T:-1},1139:{T:1},1140:{T:-1},1141:{},1142:{T:1},1143:{T:-1},1144:{T:1},1145:{T:-1},1146:{},1147:{T:1},1148:{T:-1},1149:{T:1},1150:{T:-1},1152:{T:1},1153:{T:-1},1154:{T:-1},1155:{T:-1},1156:{T:-1},1157:{T:1},1158:{T:-1},1159:{T:1},1160:{T:-1},1161:{T:1},1162:{T:-1},1163:{T:1},1164:{T:-1},1165:{T:1},1166:{T:-1},1167:{T:1},1168:{T:-1},1169:{T:1},1170:{T:-1},1171:{},1172:{T:1},1173:{T:-1},1177:{},1178:{T:1},1180:{},1181:{},1182:{},2048:{T:1},2049:{T:-1},2050:{},2051:{T:1},2052:{T:-1},2053:{},2054:{},2055:{T:1},2056:{T:-1},2057:{T:1},2058:{T:-1},2060:{},2067:{},2068:{T:1},2069:{T:-1},2070:{},2071:{},2072:{T:1},2073:{T:-1},2075:{},2076:{},2077:{T:1},2078:{T:-1},2079:{},2080:{T:1},2081:{T:-1},2082:{},2083:{T:1},2084:{T:-1},2085:{T:1},2086:{T:-1},2087:{T:1},2088:{T:-1},2089:{T:1},2090:{T:-1},2091:{},2092:{},2093:{T:1},2094:{T:-1},2095:{},2096:{T:1},2097:{T:-1},2098:{T:1},2099:{T:-1},2100:{T:1},2101:{T:-1},2102:{},2103:{T:1},2104:{T:-1},2105:{},2106:{T:1},2107:{T:-1},2108:{},2109:{T:1},2110:{T:-1},2111:{T:1},2112:{T:-1},2113:{T:1},2114:{T:-1},2115:{},2116:{},2117:{},2118:{T:1},2119:{T:-1},2120:{},2121:{T:1},2122:{T:-1},2123:{T:1},2124:{T:-1},2125:{},2126:{T:1},2127:{T:-1},2128:{},2129:{T:1},2130:{T:-1},2131:{T:1},2132:{T:-1},2133:{T:1},2134:{},2135:{},2136:{},2137:{T:1},2138:{T:-1},2139:{T:1},2140:{T:-1},2141:{},3072:{},3073:{},4096:{T:1},4097:{T:-1},5002:{T:1},5003:{T:-1},5081:{T:1},5082:{T:-1},5083:{},5084:{T:1},5085:{T:-1},5086:{T:1},5087:{T:-1},5088:{},5089:{},5090:{},5092:{T:1},5093:{T:-1},5094:{},5095:{T:1},5096:{T:-1},5097:{},5099:{},65535:{n:""}};function zt(e,i,r,o){var c=i;if(!isNaN(c)){var x=o||(r||[]).length||0,y=e.next(4);y.write_shift(2,c),y.write_shift(2,x),x>0&&Go(r)&&e.push(r)}}function p0(e,i,r){return e||(e=A(7)),e.write_shift(2,i),e.write_shift(2,r),e.write_shift(2,0),e.write_shift(1,0),e}function Bv(e,i,r,o){if(null!=i.v)switch(i.t){case"d":case"n":var c="d"==i.t?Di(Ei(i.v)):i.v;return void(c==(0|c)&&c>=0&&c<65536?zt(e,2,function d_(e,i,r){var o=A(9);return p0(o,e,i),o.write_shift(2,r),o}(r,o,c)):zt(e,3,function f_(e,i,r){var o=A(15);return p0(o,e,i),o.write_shift(8,r,"f"),o}(r,o,c)));case"b":case"e":return void zt(e,5,function Ov(e,i,r,o){var c=A(9);return p0(c,e,i),Ed(r,o||"b",c),c}(r,o,i.v,i.t));case"s":case"str":return void zt(e,4,function zv(e,i,r){var o=A(8+2*r.length);return p0(o,e,i),o.write_shift(1,r.length),o.write_shift(r.length,r,"sbcs"),o.l<o.length?o.slice(0,o.l):o}(r,o,(i.v||"").slice(0,255)))}zt(e,1,p0(null,r,o))}function Wv(e,i,r,o,c){var x=16+ao(c.cellXfs,i,c);if(null!=i.v||i.bf)if(i.bf)zt(e,6,function Wh(e,i,r,o,c){var x=Ol(i,r,c),y=function is(e){if(null==e){var i=A(8);return i.write_shift(1,3),i.write_shift(1,0),i.write_shift(2,0),i.write_shift(2,0),i.write_shift(2,65535),i}return ya("number"==typeof e?e:0)}(e.v),T=A(6);T.write_shift(2,33),T.write_shift(4,0);for(var I=A(e.bf.length),F=0;F<e.bf.length;++F)I[F]=e.bf[F];return Bi([x,y,T,I])}(i,r,o,0,x));else switch(i.t){case"d":case"n":zt(e,515,function tp(e,i,r,o){var c=A(14);return Ol(e,i,o,c),ya(r,c),c}(r,o,"d"==i.t?Di(Ei(i.v)):i.v,x));break;case"b":case"e":zt(e,517,function Hm(e,i,r,o,c,x){var y=A(8);return Ol(e,i,o,y),Ed(r,x,y),y}(r,o,i.v,x,0,i.t));break;case"s":case"str":c.bookSST?zt(e,253,function Y0(e,i,r,o){var c=A(10);return Ol(e,i,o,c),c.write_shift(4,r),c}(r,o,na(c.Strings,i.v,c.revStrings),x)):zt(e,516,function Vm(e,i,r,o,c){var x=!c||8==c.biff,y=A(+x+8+(1+x)*r.length);return Ol(e,i,o,y),y.write_shift(2,r.length),x&&y.write_shift(1,1),y.write_shift((1+x)*r.length,r,x?"utf16le":"sbcs"),y}(r,o,(i.v||"").slice(0,255),x,c));break;default:zt(e,513,Ol(r,o,x))}else zt(e,513,Ol(r,o,x))}function Xv(e,i,r){var F,o=O(),c=r.SheetNames[e],x=r.Sheets[c]||{},y=(r||{}).Workbook||{},T=(y.Sheets||[])[e]||{},C=Array.isArray(x),I=8==i.biff,N="",U=[],j=ke(x["!ref"]||"A1"),W=I?65536:16384;if(j.e.c>255||j.e.r>=W){if(i.WTF)throw new Error("Range "+(x["!ref"]||"A1")+" exceeds format limit A1:IV16384");j.e.c=Math.min(j.e.c,255),j.e.r=Math.min(j.e.c,W-1)}zt(o,2057,Cd(0,16,i)),zt(o,13,wa(1)),zt(o,12,wa(100)),zt(o,15,Nn(!0)),zt(o,17,Nn(!1)),zt(o,16,ya(.001)),zt(o,95,Nn(!0)),zt(o,42,Nn(!1)),zt(o,43,Nn(!1)),zt(o,130,wa(1)),zt(o,128,function Ru(e){var i=A(8);return i.write_shift(4,0),i.write_shift(2,e[0]?e[0]+1:0),i.write_shift(2,e[1]?e[1]+1:0),i}([0,0])),zt(o,131,Nn(!1)),zt(o,132,Nn(!1)),I&&function $v(e,i){if(i){var r=0;i.forEach(function(o,c){++r<=256&&o&&zt(e,125,function l_(e,i){var r=A(12);r.write_shift(2,i),r.write_shift(2,i),r.write_shift(2,256*e.width),r.write_shift(2,0);var o=0;return e.hidden&&(o|=1),r.write_shift(1,o),r.write_shift(1,o=e.level||0),r.write_shift(2,0),r}(jn(c,o),c))})}}(o,x["!cols"]),zt(o,512,function zf(e,i){var r=8!=i.biff&&i.biff?2:4,o=A(2*r+6);return o.write_shift(r,e.s.r),o.write_shift(r,e.e.r+1),o.write_shift(2,e.s.c),o.write_shift(2,e.e.c+1),o.write_shift(2,0),o}(j,i)),I&&(x["!links"]=[]);for(var B=j.s.r;B<=j.e.r;++B){N=se(B);for(var X=j.s.c;X<=j.e.c;++X){B===j.s.r&&(U[X]=ce(X)),F=U[X]+N;var _e=C?(x[B]||[])[X]:x[F];!_e||(Wv(o,_e,B,X,i),I&&_e.l&&x["!links"].push([F,_e.l]))}}var me=T.CodeName||T.name||c;return I&&zt(o,574,function H0(e){var i=A(18),r=1718;return e&&e.RTL&&(r|=64),i.write_shift(2,r),i.write_shift(4,0),i.write_shift(4,64),i.write_shift(4,0),i.write_shift(4,0),i}((y.Views||[])[0])),I&&(x["!merges"]||[]).length&&zt(o,229,function op(e){var i=A(2+8*e.length);i.write_shift(2,e.length);for(var r=0;r<e.length;++r)G0(e[r],i);return i}(x["!merges"])),I&&function Gv(e,i){for(var r=0;r<i["!links"].length;++r){var o=i["!links"][r];zt(e,440,n_(o)),o[1].Tooltip&&zt(e,2048,Nf(o))}delete i["!links"]}(o,x),zt(o,442,Oc(me)),I&&function jv(e,i){var r=A(19);r.write_shift(4,2151),r.write_shift(4,0),r.write_shift(4,0),r.write_shift(2,3),r.write_shift(1,1),r.write_shift(4,0),zt(e,2151,r),(r=A(39)).write_shift(4,2152),r.write_shift(4,0),r.write_shift(4,0),r.write_shift(2,3),r.write_shift(1,0),r.write_shift(4,0),r.write_shift(2,1),r.write_shift(4,4),r.write_shift(2,0),G0(ke(i["!ref"]||"A1"),r),r.write_shift(4,4),zt(e,2152,r)}(o,x),zt(o,10),o.end()}function Hv(e,i,r){var o=O(),c=(e||{}).Workbook||{},x=c.Sheets||[],y=c.WBProps||{},T=8==r.biff,C=5==r.biff;zt(o,2057,Cd(0,5,r)),"xla"==r.bookType&&zt(o,135),zt(o,225,T?wa(1200):null),zt(o,193,function R0(e,i){i||(i=A(e));for(var r=0;r<e;++r)i.write_shift(1,0);return i}(2)),C&&zt(o,191),C&&zt(o,192),zt(o,226),zt(o,92,function Om(e,i){var r=!i||8==i.biff,o=A(r?112:54);for(o.write_shift(8==i.biff?2:1,7),r&&o.write_shift(1,0),o.write_shift(4,859007059),o.write_shift(4,5458548|(r?0:536870912));o.l<o.length;)o.write_shift(1,r?0:32);return o}(0,r)),zt(o,66,wa(T?1200:1252)),T&&zt(o,353,wa(0)),T&&zt(o,448),zt(o,317,function u_(e){for(var i=A(2*e),r=0;r<e;++r)i.write_shift(2,r+1);return i}(e.SheetNames.length)),T&&e.vbaraw&&zt(o,211),T&&e.vbaraw&&zt(o,442,Oc(y.CodeName||"ThisWorkbook")),zt(o,156,wa(17)),zt(o,25,Nn(!1)),zt(o,18,Nn(!1)),zt(o,19,wa(0)),T&&zt(o,431,Nn(!1)),T&&zt(o,444,wa(0)),zt(o,61,function Ch(){var e=A(18);return e.write_shift(2,0),e.write_shift(2,0),e.write_shift(2,29280),e.write_shift(2,17600),e.write_shift(2,56),e.write_shift(2,0),e.write_shift(2,0),e.write_shift(2,1),e.write_shift(2,500),e}()),zt(o,64,Nn(!1)),zt(o,141,wa(0)),zt(o,34,Nn("true"==function Cy(e){return e.Workbook&&e.Workbook.WBProps&&function yi(e){switch(e){case 1:case!0:case"1":case"true":case"TRUE":return!0;default:return!1}}(e.Workbook.WBProps.date1904)?"true":"false"}(e))),zt(o,14,Nn(!0)),T&&zt(o,439,Nn(!1)),zt(o,218,wa(0)),function Zv(e,i,r){zt(e,49,function Fd(e,i){var r=e.name||"Arial",o=i&&5==i.biff,x=A(o?15+r.length:16+2*r.length);return x.write_shift(2,20*(e.sz||12)),x.write_shift(4,0),x.write_shift(2,400),x.write_shift(4,0),x.write_shift(2,0),x.write_shift(1,r.length),o||x.write_shift(1,1),x.write_shift((o?1:2)*r.length,r,o?"sbcs":"utf16le"),x}({sz:12,color:{theme:1},name:"Arial",family:2,scheme:"minor"},r))}(o,0,r),function Vv(e,i,r){!i||[[5,8],[23,26],[41,44],[50,392]].forEach(function(o){for(var c=o[0];c<=o[1];++c)null!=i[c]&&zt(e,1054,jm(c,i[c],r))})}(o,e.SSF,r),function qv(e,i){for(var r=0;r<16;++r)zt(e,224,K0({numFmtId:0,style:!0},0,i));i.cellXfs.forEach(function(o){zt(e,224,K0(o,0,i))})}(o,r),T&&zt(o,352,Nn(!1));var F=o.end(),N=O();T&&zt(N,140,function lp(e){return e||(e=A(4)),e.write_shift(2,1),e.write_shift(2,1),e}()),T&&r.Strings&&function Rv(e,i,r,o){var c=o||(r||[]).length||0;if(c<=8224)return zt(e,i,r,c);var x=i;if(!isNaN(x)){for(var y=r.parts||[],T=0,C=0,I=0;I+(y[T]||8224)<=8224;)I+=y[T]||8224,T++;var F=e.next(4);for(F.write_shift(2,x),F.write_shift(2,I),e.push(r.slice(C,C+I)),C+=I;C<c;){for((F=e.next(4)).write_shift(2,60),I=0;I+(y[T]||8224)<=8224;)I+=y[T]||8224,T++;F.write_shift(2,I),e.push(r.slice(C,C+I)),C+=I}}}(N,252,function Lu(e,i){var r=A(8);r.write_shift(4,e.Count),r.write_shift(4,e.Unique);for(var o=[],c=0;c<e.length;++c)o[c]=Th(e[c]);var x=Bi([r].concat(o));return x.parts=[r.length].concat(o.map(function(y){return y.length})),x}(r.Strings)),zt(N,10);var U=N.end(),j=O(),W=0,B=0;for(B=0;B<e.SheetNames.length;++B)W+=(T?12:11)+(T?2:1)*e.SheetNames[B].length;var X=F.length+W+U.length;for(B=0;B<e.SheetNames.length;++B)zt(j,133,Id({pos:X,hs:(x[B]||{}).Hidden||0,dt:0,name:e.SheetNames[B]},r)),X+=i[B].length;var me=j.end();if(W!=me.length)throw new Error("BS8 "+W+" != "+me.length);var ue=[];return F.length&&ue.push(F),me.length&&ue.push(me),U.length&&ue.push(U),Bi(ue)}function Gg(e,i){for(var r=0;r<=e.SheetNames.length;++r){var o=e.Sheets[e.SheetNames[r]];o&&o["!ref"]&&qe(o["!ref"]).e.c>255&&"undefined"!=typeof console&&console.error&&console.error("Worksheet '"+e.SheetNames[r]+"' extends beyond column IV (255).  Data may be lost.")}var x=i||{};switch(x.biff||2){case 8:case 5:return function Yv(e,i){var r=i||{},o=[];e&&!e.SSF&&(e.SSF=Kr(or)),e&&e.SSF&&(Ro(),Lo(e.SSF),r.revssf=xc(e.SSF),r.revssf[e.SSF[65535]]=0,r.ssf=e.SSF),r.Strings=[],r.Strings.Count=0,r.Strings.Unique=0,fg(r),r.cellXfs=[],ao(r.cellXfs,{},{revssf:{General:0}}),e.Props||(e.Props={});for(var c=0;c<e.SheetNames.length;++c)o[o.length]=Xv(c,r,e);return o.unshift(Hv(e,o,r)),Bi(o)}(e,i);case 4:case 3:case 2:return function Uv(e,i){for(var r=i||{},o=O(),c=0,x=0;x<e.SheetNames.length;++x)e.SheetNames[x]==r.sheet&&(c=x);if(0==c&&r.sheet&&e.SheetNames[0]!=r.sheet)throw new Error("Sheet not found: "+r.sheet);return zt(o,4==r.biff?1033:3==r.biff?521:9,Cd(0,16,r)),function Nv(e,i,r,o){var y,c=Array.isArray(i),x=ke(i["!ref"]||"A1"),T="",C=[];if(x.e.c>255||x.e.r>16383){if(o.WTF)throw new Error("Range "+(i["!ref"]||"A1")+" exceeds format limit A1:IV16384");x.e.c=Math.min(x.e.c,255),x.e.r=Math.min(x.e.c,16383),y=Qe(x)}for(var I=x.s.r;I<=x.e.r;++I){T=se(I);for(var F=x.s.c;F<=x.e.c;++F){I===x.s.r&&(C[F]=ce(F)),y=C[F]+T;var N=c?(i[I]||[])[F]:i[y];!N||Bv(e,N,I,F)}}}(o,e.Sheets[e.SheetNames[c]],0,r),zt(o,10),o.end()}(e,i)}throw new Error("invalid type "+x.bookType+" for BIFF")}function Wg(e,i,r,o){for(var c=e["!merges"]||[],x=[],y=i.s.c;y<=i.e.c;++y){for(var T=0,C=0,I=0;I<c.length;++I)if(!(c[I].s.r>r||c[I].s.c>y||c[I].e.r<r||c[I].e.c<y)){if(c[I].s.r<r||c[I].s.c<y){T=-1;break}T=c[I].e.r-c[I].s.r+1,C=c[I].e.c-c[I].s.c+1;break}if(!(T<0)){var F=Le({r,c:y}),N=o.dense?(e[r]||[])[y]:e[F],U=N&&null!=N.v&&(N.h||ds(N.w||(dt(N),N.w)||""))||"",j={};T>1&&(j.rowspan=T),C>1&&(j.colspan=C),o.editable?U='<span contenteditable="true">'+U+"</span>":N&&(j["data-t"]=N&&N.t||"z",null!=N.v&&(j["data-v"]=N.v),null!=N.z&&(j["data-z"]=N.z),N.l&&"#"!=(N.l.Target||"#").charAt(0)&&(U='<a href="'+N.l.Target+'">'+U+"</a>")),j.id=(o.id||"sjs")+"-"+F,x.push(At("td",U,j))}}return"<tr>"+x.join("")+"</tr>"}function Kg(e,i){var r=i||{},c=null!=r.footer?r.footer:"</body></html>",x=[null!=r.header?r.header:'<html><head><meta charset="utf-8"/><title>SheetJS Table Export</title></head><body>'],y=qe(e["!ref"]);r.dense=Array.isArray(e),x.push(function Yg(e,i,r){return[].join("")+"<table"+(r&&r.id?' id="'+r.id+'"':"")+">"}(0,0,r));for(var T=y.s.r;T<=y.e.r;++T)x.push(Wg(e,y,T,r));return x.push("</table>"+c),x.join("")}function Jg(e,i,r){var o=r||{},c=0,x=0;if(null!=o.origin)if("number"==typeof o.origin)c=o.origin;else{var y="string"==typeof o.origin?Be(o.origin):o.origin;c=y.r,x=y.c}var T=i.getElementsByTagName("tr"),C=Math.min(o.sheetRows||1e7,T.length),I={s:{r:0,c:0},e:{r:c,c:x}};if(e["!ref"]){var F=qe(e["!ref"]);I.s.r=Math.min(I.s.r,F.s.r),I.s.c=Math.min(I.s.c,F.s.c),I.e.r=Math.max(I.e.r,F.e.r),I.e.c=Math.max(I.e.c,F.e.c),-1==c&&(I.e.r=c=F.e.r+1)}var N=[],U=0,j=e["!rows"]||(e["!rows"]=[]),W=0,B=0,X=0,_e=0,me=0,ue=0;for(e["!cols"]||(e["!cols"]=[]);W<T.length&&B<C;++W){var Ue=T[W];if(e1(Ue)){if(o.display)continue;j[B]={hidden:!0}}var We=Ue.children;for(X=_e=0;X<We.length;++X){var nt=We[X];if(!o.display||!e1(nt)){var Se=nt.hasAttribute("data-v")?nt.getAttribute("data-v"):nt.hasAttribute("v")?nt.getAttribute("v"):Tu(nt.innerHTML),Ge=nt.getAttribute("data-z")||nt.getAttribute("z");for(U=0;U<N.length;++U){var Ve=N[U];Ve.s.c==_e+x&&Ve.s.r<B+c&&B+c<=Ve.e.r&&(_e=Ve.e.c+1-x,U=-1)}ue=+nt.getAttribute("colspan")||1,((me=+nt.getAttribute("rowspan")||1)>1||ue>1)&&N.push({s:{r:B+c,c:_e+x},e:{r:B+c+(me||1)-1,c:_e+x+(ue||1)-1}});var at={t:"s",v:Se},ot=nt.getAttribute("data-t")||nt.getAttribute("t")||"";null!=Se&&(0==Se.length?at.t=ot||"z":o.raw||0==Se.trim().length||"s"==ot||("TRUE"===Se?at={t:"b",v:!0}:"FALSE"===Se?at={t:"b",v:!1}:isNaN(Pn(Se))?isNaN(la(Se).getDate())||(at={t:"d",v:Ei(Se)},o.cellDates||(at={t:"n",v:Di(at.v)}),at.z=o.dateNF||or[14]):at={t:"n",v:Pn(Se)})),void 0===at.z&&null!=Ge&&(at.z=Ge);var je="",Bt=nt.getElementsByTagName("A");if(Bt&&Bt.length)for(var er=0;er<Bt.length&&(!Bt[er].hasAttribute("href")||"#"==(je=Bt[er].getAttribute("href")).charAt(0));++er);je&&"#"!=je.charAt(0)&&(at.l={Target:je}),o.dense?(e[B+c]||(e[B+c]=[]),e[B+c][_e+x]=at):e[Le({c:_e+x,r:B+c})]=at,I.e.c<_e+x&&(I.e.c=_e+x),_e+=ue}}++B}return N.length&&(e["!merges"]=(e["!merges"]||[]).concat(N)),I.e.r=Math.max(I.e.r,B-1+c),e["!ref"]=Qe(I),B>=C&&(e["!fullref"]=Qe((I.e.r=T.length-W+B-1+c,I))),e}function Qg(e,i){return Jg((i||{}).dense?[]:{},e,i)}function e1(e){var i="",r=function Qv(e){return e.ownerDocument.defaultView&&"function"==typeof e.ownerDocument.defaultView.getComputedStyle?e.ownerDocument.defaultView.getComputedStyle:"function"==typeof getComputedStyle?getComputedStyle:null}(e);return r&&(i=r(e).getPropertyValue("display")),i||(i=e.style&&e.style.display),"none"===i}var t2=function(){var e=["<office:master-styles>",'<style:master-page style:name="mp1" style:page-layout-name="mp1">',"<style:header/>",'<style:header-left style:display="false"/>',"<style:footer/>",'<style:footer-left style:display="false"/>',"</style:master-page>","</office:master-styles>"].join(""),i="<office:document-styles "+Il({"xmlns:office":"urn:oasis:names:tc:opendocument:xmlns:office:1.0","xmlns:table":"urn:oasis:names:tc:opendocument:xmlns:table:1.0","xmlns:style":"urn:oasis:names:tc:opendocument:xmlns:style:1.0","xmlns:text":"urn:oasis:names:tc:opendocument:xmlns:text:1.0","xmlns:draw":"urn:oasis:names:tc:opendocument:xmlns:drawing:1.0","xmlns:fo":"urn:oasis:names:tc:opendocument:xmlns:xsl-fo-compatible:1.0","xmlns:xlink":"http://www.w3.org/1999/xlink","xmlns:dc":"http://purl.org/dc/elements/1.1/","xmlns:number":"urn:oasis:names:tc:opendocument:xmlns:datastyle:1.0","xmlns:svg":"urn:oasis:names:tc:opendocument:xmlns:svg-compatible:1.0","xmlns:of":"urn:oasis:names:tc:opendocument:xmlns:of:1.2","office:version":"1.2"})+">"+e+"</office:document-styles>";return function(){return xi+i}}(),a1=function(){var e=function(x){return ni(x).replace(/  +/g,function(y){return'<text:s text:c="'+y.length+'"/>'}).replace(/\t/g,"<text:tab/>").replace(/\n/g,"</text:p><text:p>").replace(/^ /,"<text:s/>").replace(/ $/,"<text:s/>")},i="          <table:table-cell />\n",o=function(x,y,T){var C=[];C.push('      <table:table table:name="'+ni(y.SheetNames[T])+'" table:style-name="ta1">\n');var I=0,F=0,N=qe(x["!ref"]||"A1"),U=x["!merges"]||[],j=0,W=Array.isArray(x);if(x["!cols"])for(F=0;F<=N.e.c;++F)C.push("        <table:table-column"+(x["!cols"][F]?' table:style-name="co'+x["!cols"][F].ods+'"':"")+"></table:table-column>\n");var X=x["!rows"]||[];for(I=0;I<N.s.r;++I)C.push("        <table:table-row"+(X[I]?' table:style-name="ro'+X[I].ods+'"':"")+"></table:table-row>\n");for(;I<=N.e.r;++I){for(C.push("        <table:table-row"+(X[I]?' table:style-name="ro'+X[I].ods+'"':"")+">\n"),F=0;F<N.s.c;++F)C.push(i);for(;F<=N.e.c;++F){var _e=!1,me={},ue="";for(j=0;j!=U.length;++j)if(!(U[j].s.c>F||U[j].s.r>I||U[j].e.c<F||U[j].e.r<I)){(U[j].s.c!=F||U[j].s.r!=I)&&(_e=!0),me["table:number-columns-spanned"]=U[j].e.c-U[j].s.c+1,me["table:number-rows-spanned"]=U[j].e.r-U[j].s.r+1;break}if(_e)C.push("          <table:covered-table-cell/>\n");else{var Ue=Le({r:I,c:F}),We=W?(x[I]||[])[F]:x[Ue];if(We&&We.f&&(me["table:formula"]=ni(gm(We.f)),We.F&&We.F.slice(0,Ue.length)==Ue)){var nt=qe(We.F);me["table:number-matrix-columns-spanned"]=nt.e.c-nt.s.c+1,me["table:number-matrix-rows-spanned"]=nt.e.r-nt.s.r+1}if(We){switch(We.t){case"b":ue=We.v?"TRUE":"FALSE",me["office:value-type"]="boolean",me["office:boolean-value"]=We.v?"true":"false";break;case"n":ue=We.w||String(We.v||0),me["office:value-type"]="float",me["office:value"]=We.v||0;break;case"s":case"str":ue=null==We.v?"":We.v,me["office:value-type"]="string";break;case"d":ue=We.w||Ei(We.v).toISOString(),me["office:value-type"]="date",me["office:date-value"]=Ei(We.v).toISOString(),me["table:style-name"]="ce1";break;default:C.push(i);continue}var Se=e(ue);if(We.l&&We.l.Target){var Ge=We.l.Target;"#"!=(Ge="#"==Ge.charAt(0)?"#"+u0(Ge.slice(1)):Ge).charAt(0)&&!Ge.match(/^\w+:/)&&(Ge="../"+Ge),Se=At("text:a",Se,{"xlink:href":Ge.replace(/&/g,"&amp;")})}C.push("          "+At("table:table-cell",At("text:p",Se,{}),me)+"\n")}else C.push(i)}}C.push("        </table:table-row>\n")}return C.push("      </table:table>\n"),C.join("")};return function(y,T){var C=[xi],I=Il({"xmlns:office":"urn:oasis:names:tc:opendocument:xmlns:office:1.0","xmlns:table":"urn:oasis:names:tc:opendocument:xmlns:table:1.0","xmlns:style":"urn:oasis:names:tc:opendocument:xmlns:style:1.0","xmlns:text":"urn:oasis:names:tc:opendocument:xmlns:text:1.0","xmlns:draw":"urn:oasis:names:tc:opendocument:xmlns:drawing:1.0","xmlns:fo":"urn:oasis:names:tc:opendocument:xmlns:xsl-fo-compatible:1.0","xmlns:xlink":"http://www.w3.org/1999/xlink","xmlns:dc":"http://purl.org/dc/elements/1.1/","xmlns:meta":"urn:oasis:names:tc:opendocument:xmlns:meta:1.0","xmlns:number":"urn:oasis:names:tc:opendocument:xmlns:datastyle:1.0","xmlns:presentation":"urn:oasis:names:tc:opendocument:xmlns:presentation:1.0","xmlns:svg":"urn:oasis:names:tc:opendocument:xmlns:svg-compatible:1.0","xmlns:chart":"urn:oasis:names:tc:opendocument:xmlns:chart:1.0","xmlns:dr3d":"urn:oasis:names:tc:opendocument:xmlns:dr3d:1.0","xmlns:math":"http://www.w3.org/1998/Math/MathML","xmlns:form":"urn:oasis:names:tc:opendocument:xmlns:form:1.0","xmlns:script":"urn:oasis:names:tc:opendocument:xmlns:script:1.0","xmlns:ooo":"http://openoffice.org/2004/office","xmlns:ooow":"http://openoffice.org/2004/writer","xmlns:oooc":"http://openoffice.org/2004/calc","xmlns:dom":"http://www.w3.org/2001/xml-events","xmlns:xforms":"http://www.w3.org/2002/xforms","xmlns:xsd":"http://www.w3.org/2001/XMLSchema","xmlns:xsi":"http://www.w3.org/2001/XMLSchema-instance","xmlns:sheet":"urn:oasis:names:tc:opendocument:sh33tjs:1.0","xmlns:rpt":"http://openoffice.org/2005/report","xmlns:of":"urn:oasis:names:tc:opendocument:xmlns:of:1.2","xmlns:xhtml":"http://www.w3.org/1999/xhtml","xmlns:grddl":"http://www.w3.org/2003/g/data-view#","xmlns:tableooo":"http://openoffice.org/2009/table","xmlns:drawooo":"http://openoffice.org/2010/draw","xmlns:calcext":"urn:org:documentfoundation:names:experimental:calc:xmlns:calcext:1.0","xmlns:loext":"urn:org:documentfoundation:names:experimental:office:xmlns:loext:1.0","xmlns:field":"urn:openoffice:names:experimental:ooo-ms-interop:xmlns:field:1.0","xmlns:formx":"urn:openoffice:names:experimental:ooxml-odf-interop:xmlns:form:1.0","xmlns:css3t":"http://www.w3.org/TR/css3-text/","office:version":"1.2"}),F=Il({"xmlns:config":"urn:oasis:names:tc:opendocument:xmlns:config:1.0","office:mimetype":"application/vnd.oasis.opendocument.spreadsheet"});"fods"==T.bookType?(C.push("<office:document"+I+F+">\n"),C.push(S0().replace(/office:document-meta/g,"office:meta"))):C.push("<office:document-content"+I+">\n"),function(x,y){x.push(" <office:automatic-styles>\n"),x.push('  <number:date-style style:name="N37" number:automatic-order="true">\n'),x.push('   <number:month number:style="long"/>\n'),x.push("   <number:text>/</number:text>\n"),x.push('   <number:day number:style="long"/>\n'),x.push("   <number:text>/</number:text>\n"),x.push("   <number:year/>\n"),x.push("  </number:date-style>\n");var T=0;y.SheetNames.map(function(I){return y.Sheets[I]}).forEach(function(I){if(I&&I["!cols"])for(var F=0;F<I["!cols"].length;++F)if(I["!cols"][F]){var N=I["!cols"][F];if(null==N.width&&null==N.wpx&&null==N.wch)continue;Vl(N),N.ods=T;var U=I["!cols"][F].wpx+"px";x.push('  <style:style style:name="co'+T+'" style:family="table-column">\n'),x.push('   <style:table-column-properties fo:break-before="auto" style:column-width="'+U+'"/>\n'),x.push("  </style:style>\n"),++T}});var C=0;y.SheetNames.map(function(I){return y.Sheets[I]}).forEach(function(I){if(I&&I["!rows"])for(var F=0;F<I["!rows"].length;++F)if(I["!rows"][F]){I["!rows"][F].ods=C;var N=I["!rows"][F].hpx+"px";x.push('  <style:style style:name="ro'+C+'" style:family="table-row">\n'),x.push('   <style:table-row-properties fo:break-before="auto" style:row-height="'+N+'"/>\n'),x.push("  </style:style>\n"),++C}}),x.push('  <style:style style:name="ta1" style:family="table" style:master-page-name="mp1">\n'),x.push('   <style:table-properties table:display="true" style:writing-mode="lr-tb"/>\n'),x.push("  </style:style>\n"),x.push('  <style:style style:name="ce1" style:family="table-cell" style:parent-style-name="Default" style:data-style-name="N37"/>\n'),x.push(" </office:automatic-styles>\n")}(C,y),C.push("  <office:body>\n"),C.push("    <office:spreadsheet>\n");for(var N=0;N!=y.SheetNames.length;++N)C.push(o(y.Sheets[y.SheetNames[N]],y,N));return C.push("    </office:spreadsheet>\n"),C.push("  </office:body>\n"),C.push("fods"==T.bookType?"</office:document>":"</office:document-content>"),C.join("")}}();function s1(e,i){if("fods"==i.bookType)return a1(e,i);var r=Ha(),o="",c=[],x=[];return mr(r,o="mimetype","application/vnd.oasis.opendocument.spreadsheet"),mr(r,o="content.xml",a1(e,i)),c.push([o,"text/xml"]),x.push([o,"ContentFile"]),mr(r,o="styles.xml",t2(e,i)),c.push([o,"text/xml"]),x.push([o,"StylesFile"]),mr(r,o="meta.xml",xi+S0()),c.push([o,"text/xml"]),x.push([o,"MetadataFile"]),mr(r,o="manifest.rdf",function gd(e){var i=[xi];i.push('<rdf:RDF xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#">\n');for(var r=0;r!=e.length;++r)i.push(xs(e[r][0],e[r][1])),i.push(Ef("",e[r][0]));return i.push(xs("","Document","pkg")),i.push("</rdf:RDF>"),i.join("")}(x)),c.push([o,"application/rdf+xml"]),mr(r,o="META-INF/manifest.xml",function E0(e){var i=[xi];i.push('<manifest:manifest xmlns:manifest="urn:oasis:names:tc:opendocument:xmlns:manifest:1.0" manifest:version="1.2">\n'),i.push('  <manifest:file-entry manifest:full-path="/" manifest:version="1.2" manifest:media-type="application/vnd.oasis.opendocument.spreadsheet"/>\n');for(var r=0;r<e.length;++r)i.push('  <manifest:file-entry manifest:full-path="'+e[r][0]+'" manifest:media-type="'+e[r][1]+'"/>\n');return i.push("</manifest:manifest>"),i.join("")}(c)),r}function Kh(e){return new DataView(e.buffer,e.byteOffset,e.byteLength)}function r2(e){return"undefined"!=typeof TextEncoder?(new TextEncoder).encode(e):Xn(ca(e))}function $u(e){var i=e.reduce(function(c,x){return c+x.length},0),r=new Uint8Array(i),o=0;return e.forEach(function(c){r.set(c,o),o+=c.length}),r}function m0(e,i){var r=i?i[0]:0,o=127&e[r];e:if(e[r++]>=128&&(o|=(127&e[r])<<7,e[r++]<128||(o|=(127&e[r])<<14,e[r++]<128)||(o|=(127&e[r])<<21,e[r++]<128)||(o+=(127&e[r])*Math.pow(2,28),++r,e[r++]<128)||(o+=(127&e[r])*Math.pow(2,35),++r,e[r++]<128)||(o+=(127&e[r])*Math.pow(2,42),++r,e[r++]<128)))break e;return i&&(i[0]=r),o}function _i(e){var i=new Uint8Array(7);i[0]=127&e;var r=1;e:if(e>127){if(i[r-1]|=128,i[r]=e>>7&127,++r,e<=16383||(i[r-1]|=128,i[r]=e>>14&127,++r,e<=2097151)||(i[r-1]|=128,i[r]=e>>21&127,++r,e<=268435455)||(i[r-1]|=128,i[r]=e/256>>>21&127,++r,e<=34359738367)||(i[r-1]|=128,i[r]=e/65536>>>21&127,++r,e<=4398046511103))break e;i[r-1]|=128,i[r]=e/16777216>>>21&127,++r}return i.slice(0,r)}function ln(e){var i=0,r=127&e[i];e:if(e[i++]>=128){if(r|=(127&e[i])<<7,e[i++]<128||(r|=(127&e[i])<<14,e[i++]<128)||(r|=(127&e[i])<<21,e[i++]<128))break e;r|=(127&e[i])<<28}return r}function ci(e){for(var i=[],r=[0];r[0]<e.length;){var T,o=r[0],c=m0(e,r),x=7&c,y=0;if(0==(c=Math.floor(c/8)))break;switch(x){case 0:for(var C=r[0];e[r[0]++]>=128;);T=e.slice(C,r[0]);break;case 5:T=e.slice(r[0],r[0]+(y=4)),r[0]+=y;break;case 1:T=e.slice(r[0],r[0]+(y=8)),r[0]+=y;break;case 2:y=m0(e,r),T=e.slice(r[0],r[0]+y),r[0]+=y;break;default:throw new Error("PB Type ".concat(x," for Field ").concat(c," at offset ").concat(o))}var I={data:T,type:x};null==i[c]?i[c]=[I]:i[c].push(I)}return i}function aa(e){var i=[];return e.forEach(function(r,o){r.forEach(function(c){!c.data||(i.push(_i(8*o+c.type)),2==c.type&&i.push(_i(c.data.length)),i.push(c.data))})}),$u(i)}function so(e){for(var i,r=[],o=[0];o[0]<e.length;){var c=m0(e,o),x=ci(e.slice(o[0],o[0]+c));o[0]+=c;var y={id:ln(x[1][0].data),messages:[]};x[2].forEach(function(T){var C=ci(T.data),I=ln(C[3][0].data);y.messages.push({meta:C,data:e.slice(o[0],o[0]+I)}),o[0]+=I}),(null==(i=x[3])?void 0:i[0])&&(y.merge=ln(x[3][0].data)>>>0>0),r.push(y)}return r}function id(e){var i=[];return e.forEach(function(r){var o=[];o[1]=[{data:_i(r.id),type:0}],o[2]=[],null!=r.merge&&(o[3]=[{data:_i(+!!r.merge),type:0}]);var c=[];r.messages.forEach(function(y){c.push(y.data),y.meta[3]=[{type:0,data:_i(y.data.length)}],o[2].push({data:aa(y.meta),type:2})});var x=aa(o);i.push(_i(x.length)),i.push(x),c.forEach(function(y){return i.push(y)})}),$u(i)}function s2(e,i){if(0!=e)throw new Error("Unexpected Snappy chunk type ".concat(e));for(var r=[0],o=m0(i,r),c=[];r[0]<i.length;){var x=3&i[r[0]];if(0!=x){var C=0,I=0;if(1==x?(I=4+(i[r[0]]>>2&7),C=(224&i[r[0]++])<<3,C|=i[r[0]++]):(I=1+(i[r[0]++]>>2),2==x?(C=i[r[0]]|i[r[0]+1]<<8,r[0]+=2):(C=(i[r[0]]|i[r[0]+1]<<8|i[r[0]+2]<<16|i[r[0]+3]<<24)>>>0,r[0]+=4)),c=[$u(c)],0==C)throw new Error("Invalid offset 0");if(C>c[0].length)throw new Error("Invalid offset beyond length");if(I>=C)for(c.push(c[0].slice(-C)),I-=C;I>=c[c.length-1].length;)c.push(c[c.length-1]),I-=c[c.length-1].length;c.push(c[0].slice(-C,-C+I))}else{var y=i[r[0]++]>>2;if(y<60)++y;else{var T=y-59;y=i[r[0]],T>1&&(y|=i[r[0]+1]<<8),T>2&&(y|=i[r[0]+2]<<16),T>3&&(y|=i[r[0]+3]<<24),y>>>=0,y++,r[0]+=T}c.push(i.slice(r[0],r[0]+y)),r[0]+=y}}var F=$u(c);if(F.length!=o)throw new Error("Unexpected length: ".concat(F.length," != ").concat(o));return F}function oo(e){for(var i=[],r=0;r<e.length;){var o=e[r++],c=e[r]|e[r+1]<<8|e[r+2]<<16;i.push(s2(o,e.slice(r+=3,r+c))),r+=c}if(r!==e.length)throw new Error("data is not a valid framed stream!");return $u(i)}function nd(e){for(var i=[],r=0;r<e.length;){var o=Math.min(e.length-r,268435455),c=new Uint8Array(4);i.push(c);var x=_i(o),y=x.length;i.push(x),o<=60?(y++,i.push(new Uint8Array([o-1<<2]))):o<=256?(y+=2,i.push(new Uint8Array([240,o-1&255]))):o<=65536?(y+=3,i.push(new Uint8Array([244,o-1&255,o-1>>8&255]))):o<=16777216?(y+=4,i.push(new Uint8Array([248,o-1&255,o-1>>8&255,o-1>>16&255]))):o<=4294967296&&(y+=5,i.push(new Uint8Array([252,o-1&255,o-1>>8&255,o-1>>16&255,o-1>>>24&255]))),i.push(e.slice(r,r+o)),y+=o,c[0]=0,c[1]=255&y,c[2]=y>>8&255,c[3]=y>>16&255,r+=o}return $u(i)}function lg(e,i){var r=new Uint8Array(32),o=Kh(r),c=12,x=0;switch(r[0]=5,e.t){case"n":r[1]=2,function a2(e,i,r){var o=Math.floor(0==r?0:Math.LOG10E*Math.log(Math.abs(r)))+6176-20,c=r/Math.pow(10,o-6176);e[i+15]|=o>>7,e[i+14]|=(127&o)<<1;for(var x=0;c>=1;++x,c/=256)e[i+x]=255&c;e[i+15]|=r>=0?0:128}(r,c,e.v),x|=1,c+=16;break;case"b":r[1]=6,o.setFloat64(c,e.v?1:0,!0),x|=2,c+=8;break;case"s":if(-1==i.indexOf(e.v))throw new Error("Value ".concat(e.v," missing from SST!"));r[1]=3,o.setUint32(c,i.indexOf(e.v),!0),x|=8,c+=4;break;default:throw"unsupported cell type "+e.t}return o.setUint32(8,x,!0),r.slice(0,c)}function cg(e,i){var r=new Uint8Array(32),o=Kh(r),c=12,x=0;switch(r[0]=3,e.t){case"n":r[2]=2,o.setFloat64(c,e.v,!0),x|=32,c+=8;break;case"b":r[2]=6,o.setFloat64(c,e.v?1:0,!0),x|=32,c+=8;break;case"s":if(-1==i.indexOf(e.v))throw new Error("Value ".concat(e.v," missing from SST!"));r[2]=3,o.setUint32(c,i.indexOf(e.v),!0),x|=16,c+=4;break;default:throw"unsupported cell type "+e.t}return o.setUint32(4,x,!0),r.slice(0,c)}function Ca(e){return m0(ci(e)[1][0].data)}function _2(e,i,r){var o,c,x,y;if(!(null==(o=e[6])?void 0:o[0])||!(null==(c=e[7])?void 0:c[0]))throw"Mutation only works on post-BNC storages!";if((null==(y=null==(x=e[8])?void 0:x[0])?void 0:y.data)&&ln(e[8][0].data)>0)throw"Math only works with normal offsets";for(var C=0,I=Kh(e[7][0].data),F=0,N=[],U=Kh(e[4][0].data),j=0,W=[],B=0;B<i.length;++B)if(null!=i[B]){var X,_e;switch(I.setUint16(2*B,F,!0),U.setUint16(2*B,j,!0),typeof i[B]){case"string":X=lg({t:"s",v:i[B]},r),_e=cg({t:"s",v:i[B]},r);break;case"number":X=lg({t:"n",v:i[B]},r),_e=cg({t:"n",v:i[B]},r);break;case"boolean":X=lg({t:"b",v:i[B]},r),_e=cg({t:"b",v:i[B]},r);break;default:throw new Error("Unsupported value "+i[B])}N.push(X),F+=X.length,W.push(_e),j+=_e.length,++C}else I.setUint16(2*B,65535,!0),U.setUint16(2*B,65535);for(e[2][0].data=_i(C);B<e[7][0].data.length/2;++B)I.setUint16(2*B,65535,!0),U.setUint16(2*B,65535,!0);return e[6][0].data=$u(N),e[3][0].data=$u(W),C}function fg(e){!function c1(e){return function(r){for(var o=0;o!=e.length;++o){var c=e[o];void 0===r[c[0]]&&(r[c[0]]=c[1]),"n"===c[2]&&(r[c[0]]=Number(r[c[0]]))}}}([["cellDates",!1],["bookSST",!1],["bookType","xlsx"],["compression",!1],["WTF",!1]])(e)}function T2(e,i){return"ods"==i.bookType?s1(e,i):"numbers"==i.bookType?function g2(e,i){if(!i||!i.numbers)throw new Error("Must pass a `numbers` option -- check the README");var r=e.Sheets[e.SheetNames[0]];e.SheetNames.length>1&&console.error("The Numbers writer currently writes only the first table");var o=qe(r["!ref"]);o.s.r=o.s.c=0;var c=!1;o.e.c>9&&(c=!0,o.e.c=9),o.e.r>49&&(c=!0,o.e.r=49),c&&console.error("The Numbers writer is currently limited to ".concat(Qe(o)));var x=wm(r,{range:o,header:1}),y=["~Sh33tJ5~"];x.forEach(function(Fe){return Fe.forEach(function(Ie){"string"==typeof Ie&&y.push(Ie)})});var T={},C=[],I=ar.read(i.numbers,{type:"base64"});I.FileIndex.map(function(Fe,Ie){return[Fe,I.FullPaths[Ie]]}).forEach(function(Fe){var Ie=Fe[0],ft=Fe[1];2==Ie.type&&Ie.name.match(/\.iwa/)&&so(oo(Ie.content)).forEach(function(xt){C.push(xt.id),T[xt.id]={deps:[],location:ft,type:ln(xt.messages[0].meta[1][0].data)}})}),C.sort(function(Fe,Ie){return Fe-Ie});var F=C.filter(function(Fe){return Fe>1}).map(function(Fe){return[Fe,_i(Fe)]});I.FileIndex.map(function(Fe,Ie){return[Fe,I.FullPaths[Ie]]}).forEach(function(Fe){var Ie=Fe[0];Ie.name.match(/\.iwa/)&&so(oo(Ie.content)).forEach(function(Pt){Pt.messages.forEach(function(Lt){F.forEach(function(xt){Pt.messages.some(function(zr){return 11006!=ln(zr.meta[1][0].data)&&function i2(e,i){e:for(var r=0;r<=e.length-i.length;++r){for(var o=0;o<i.length;++o)if(e[r+o]!=i[o])continue e;return!0}return!1}(zr.data,xt[1])})&&T[xt[0]].deps.push(Pt.id)})})})});for(var W,U=ar.find(I,T[1].location),j=so(oo(U.content)),B=0;B<j.length;++B){var X=j[B];1==X.id&&(W=X)}var _e=Ca(ci(W.messages[0].data)[1][0].data);for(j=so(oo((U=ar.find(I,T[_e].location)).content)),B=0;B<j.length;++B)(X=j[B]).id==_e&&(W=X);for(_e=Ca(ci(W.messages[0].data)[2][0].data),j=so(oo((U=ar.find(I,T[_e].location)).content)),B=0;B<j.length;++B)(X=j[B]).id==_e&&(W=X);for(_e=Ca(ci(W.messages[0].data)[2][0].data),j=so(oo((U=ar.find(I,T[_e].location)).content)),B=0;B<j.length;++B)(X=j[B]).id==_e&&(W=X);var me=ci(W.messages[0].data);me[6][0].data=_i(o.e.r+1),me[7][0].data=_i(o.e.c+1);for(var ue=Ca(me[46][0].data),Ue=ar.find(I,T[ue].location),We=so(oo(Ue.content)),nt=0;nt<We.length&&We[nt].id!=ue;++nt);if(We[nt].id!=ue)throw"Bad ColumnRowUIDMapArchive";var Se=ci(We[nt].messages[0].data);Se[1]=[],Se[2]=[],Se[3]=[];for(var Ge=0;Ge<=o.e.c;++Ge){var Ve=[];Ve[1]=Ve[2]=[{type:0,data:_i(Ge+420690)}],Se[1].push({type:2,data:aa(Ve)}),Se[2].push({type:0,data:_i(Ge)}),Se[3].push({type:0,data:_i(Ge)})}Se[4]=[],Se[5]=[],Se[6]=[];for(var at=0;at<=o.e.r;++at)(Ve=[])[1]=Ve[2]=[{type:0,data:_i(at+726270)}],Se[4].push({type:2,data:aa(Ve)}),Se[5].push({type:0,data:_i(at)}),Se[6].push({type:0,data:_i(at)});We[nt].messages[0].data=aa(Se),Ue.content=nd(id(We)),Ue.size=Ue.content.length,delete me[46];var ot=ci(me[4][0].data);ot[7][0].data=_i(o.e.r+1);var Bt=Ca(ci(ot[1][0].data)[2][0].data);if((We=so(oo((Ue=ar.find(I,T[Bt].location)).content)))[0].id!=Bt)throw"Bad HeaderStorageBucket";var er=ci(We[0].messages[0].data);for(at=0;at<x.length;++at){var jt=ci(er[2][0].data);jt[1][0].data=_i(at),jt[4][0].data=_i(x[at].length),er[2][at]={type:er[2][0].type,data:aa(jt)}}We[0].messages[0].data=aa(er),Ue.content=nd(id(We)),Ue.size=Ue.content.length;var pr=Ca(ot[2][0].data);if((We=so(oo((Ue=ar.find(I,T[pr].location)).content)))[0].id!=pr)throw"Bad HeaderStorageBucket";for(er=ci(We[0].messages[0].data),Ge=0;Ge<=o.e.c;++Ge)(jt=ci(er[2][0].data))[1][0].data=_i(Ge),jt[4][0].data=_i(o.e.r+1),er[2][Ge]={type:er[2][0].type,data:aa(jt)};We[0].messages[0].data=aa(er),Ue.content=nd(id(We)),Ue.size=Ue.content.length;var sr=Ca(ot[4][0].data);!function(){for(var ft,Fe=ar.find(I,T[sr].location),Ie=so(oo(Fe.content)),$t=0;$t<Ie.length;++$t){var Pt=Ie[$t];Pt.id==sr&&(ft=Pt)}var Lt=ci(ft.messages[0].data);Lt[3]=[];var xt=[];y.forEach(function(bi,Hr){xt[1]=[{type:0,data:_i(Hr)}],xt[2]=[{type:0,data:_i(1)}],xt[3]=[{type:2,data:r2(bi)}],Lt[3].push({type:2,data:aa(xt)})}),ft.messages[0].data=aa(Lt);var be=nd(id(Ie));Fe.content=be,Fe.size=Fe.content.length}();var Xr=ci(ot[3][0].data),Xt=Xr[1][0];delete Xr[2];var xr=ci(Xt.data),yt=Ca(xr[2][0].data);!function(){for(var ft,Fe=ar.find(I,T[yt].location),Ie=so(oo(Fe.content)),$t=0;$t<Ie.length;++$t){var Pt=Ie[$t];Pt.id==yt&&(ft=Pt)}var Lt=ci(ft.messages[0].data);delete Lt[6],delete Xr[7];var xt=new Uint8Array(Lt[5][0].data);Lt[5]=[];for(var zr=0,be=0;be<=o.e.r;++be){var bi=ci(xt);zr+=_2(bi,x[be],y),bi[1][0].data=_i(be),Lt[5].push({data:aa(bi),type:2})}Lt[1]=[{type:0,data:_i(o.e.c+1)}],Lt[2]=[{type:0,data:_i(o.e.r+1)}],Lt[3]=[{type:0,data:_i(zr)}],Lt[4]=[{type:0,data:_i(o.e.r+1)}],ft.messages[0].data=aa(Lt);var Ti=nd(id(Ie));Fe.content=Ti,Fe.size=Fe.content.length}(),Xt.data=aa(xr),ot[3][0].data=aa(Xr),me[4][0].data=aa(ot),W.messages[0].data=aa(me);var tt=nd(id(j));return U.content=tt,U.size=U.content.length,I}(e,i):"xlsb"==i.bookType?function E2(e,i){jc=1024,e&&!e.SSF&&(e.SSF=Kr(or)),e&&e.SSF&&(Ro(),Lo(e.SSF),i.revssf=xc(e.SSF),i.revssf[e.SSF[65535]]=0,i.ssf=e.SSF),i.rels={},i.wbrels={},i.Strings=[],i.Strings.Count=0,i.Strings.Unique=0,Yh?i.revStrings=new Map:(i.revStrings={},i.revStrings.foo=[],delete i.revStrings.foo);var r="xlsb"==i.bookType?"bin":"xml",o=Jf.indexOf(i.bookType)>-1,c={workbooks:[],sheets:[],charts:[],dialogs:[],macros:[],rels:[],strs:[],comments:[],threadedcomments:[],links:[],coreprops:[],extprops:[],custprops:[],themes:[],styles:[],calcchains:[],vba:[],drawings:[],metadata:[],people:[],TODO:[],xmlns:""};fg(i=i||{});var x=Ha(),y="",T=0;if(i.cellXfs=[],ao(i.cellXfs,{},{revssf:{General:0}}),e.Props||(e.Props={}),mr(x,y="docProps/core.xml",Rl(e.Props,i)),c.coreprops.push(y),Wr(i.rels,2,y,Ar.CORE_PROPS),y="docProps/app.xml",!e.Props||!e.Props.SheetNames)if(e.Workbook&&e.Workbook.Sheets){for(var C=[],I=0;I<e.SheetNames.length;++I)2!=(e.Workbook.Sheets[I]||{}).Hidden&&C.push(e.SheetNames[I]);e.Props.SheetNames=C}else e.Props.SheetNames=e.SheetNames;for(e.Props.Worksheets=e.Props.SheetNames.length,mr(x,y,I0(e.Props)),c.extprops.push(y),Wr(i.rels,3,y,Ar.EXT_PROPS),e.Custprops!==e.Props&&Fi(e.Custprops||{}).length>0&&(mr(x,y="docProps/custom.xml",Af(e.Custprops)),c.custprops.push(y),Wr(i.rels,4,y,Ar.CUST_PROPS)),T=1;T<=e.SheetNames.length;++T){var F={"!id":{}},N=e.Sheets[e.SheetNames[T-1]];if(mr(x,y="xl/worksheets/sheet"+T+"."+r,nv(T-1,y,i,e,F)),c.sheets.push(y),Wr(i.wbrels,-1,"worksheets/sheet"+T+"."+r,Ar.WS[0]),N){var j=N["!comments"],W=!1,B="";j&&j.length>0&&(mr(x,B="xl/comments"+T+"."+r,ov(j,B,i)),c.comments.push(B),Wr(F,-1,"../comments"+T+"."+r,Ar.CMNT),W=!0),N["!legacy"]&&W&&mr(x,"xl/drawings/vmlDrawing"+T+".vml",Yf(T,N["!comments"])),delete N["!comments"],delete N["!legacy"]}F["!id"].rId1&&mr(x,Dc(y),gs(F))}return null!=i.Strings&&i.Strings.length>0&&(mr(x,y="xl/sharedStrings."+r,function sv(e,i,r){return(".bin"===i.slice(-4)?xp:gp)(e,r)}(i.Strings,y,i)),c.strs.push(y),Wr(i.wbrels,-1,"sharedStrings."+r,Ar.SST)),mr(x,y="xl/workbook."+r,function iv(e,i,r){return(".bin"===i.slice(-4)?qy:Ug)(e,r)}(e,y,i)),c.workbooks.push(y),Wr(i.rels,1,y,Ar.WB),mr(x,y="xl/theme/theme1.xml",As(e.Themes,i)),c.themes.push(y),Wr(i.wbrels,-1,"theme/theme1.xml",Ar.THEME),mr(x,y="xl/styles."+r,function av(e,i,r){return(".bin"===i.slice(-4)?Uh:Op)(e,r)}(e,y,i)),c.styles.push(y),Wr(i.wbrels,-1,"styles."+r,Ar.STY),e.vbaraw&&o&&(mr(x,y="xl/vbaProject.bin",e.vbaraw),c.vba.push(y),Wr(i.wbrels,-1,"vbaProject.bin",Ar.VBA)),mr(x,y="xl/metadata."+r,function lv(e){return(".bin"===e.slice(-4)?Xp:ks)()}(y)),c.metadata.push(y),Wr(i.wbrels,-1,"metadata."+r,Ar.XLMETA),mr(x,"[Content_Types].xml",Jr(c,i)),mr(x,"_rels/.rels",gs(i.rels)),mr(x,"xl/_rels/workbook."+r+".rels",gs(i.wbrels)),delete i.revssf,delete i.ssf,x}(e,i):function u1(e,i){jc=1024,e&&!e.SSF&&(e.SSF=Kr(or)),e&&e.SSF&&(Ro(),Lo(e.SSF),i.revssf=xc(e.SSF),i.revssf[e.SSF[65535]]=0,i.ssf=e.SSF),i.rels={},i.wbrels={},i.Strings=[],i.Strings.Count=0,i.Strings.Unique=0,Yh?i.revStrings=new Map:(i.revStrings={},i.revStrings.foo=[],delete i.revStrings.foo);var r="xml",o=Jf.indexOf(i.bookType)>-1,c={workbooks:[],sheets:[],charts:[],dialogs:[],macros:[],rels:[],strs:[],comments:[],threadedcomments:[],links:[],coreprops:[],extprops:[],custprops:[],themes:[],styles:[],calcchains:[],vba:[],drawings:[],metadata:[],people:[],TODO:[],xmlns:""};fg(i=i||{});var x=Ha(),y="",T=0;if(i.cellXfs=[],ao(i.cellXfs,{},{revssf:{General:0}}),e.Props||(e.Props={}),mr(x,y="docProps/core.xml",Rl(e.Props,i)),c.coreprops.push(y),Wr(i.rels,2,y,Ar.CORE_PROPS),y="docProps/app.xml",!e.Props||!e.Props.SheetNames)if(e.Workbook&&e.Workbook.Sheets){for(var C=[],I=0;I<e.SheetNames.length;++I)2!=(e.Workbook.Sheets[I]||{}).Hidden&&C.push(e.SheetNames[I]);e.Props.SheetNames=C}else e.Props.SheetNames=e.SheetNames;e.Props.Worksheets=e.Props.SheetNames.length,mr(x,y,I0(e.Props)),c.extprops.push(y),Wr(i.rels,3,y,Ar.EXT_PROPS),e.Custprops!==e.Props&&Fi(e.Custprops||{}).length>0&&(mr(x,y="docProps/custom.xml",Af(e.Custprops)),c.custprops.push(y),Wr(i.rels,4,y,Ar.CUST_PROPS));var F=["SheetJ5"];for(i.tcid=0,T=1;T<=e.SheetNames.length;++T){var N={"!id":{}},U=e.Sheets[e.SheetNames[T-1]];if(mr(x,y="xl/worksheets/sheet"+T+"."+r,Dg(T-1,i,e,N)),c.sheets.push(y),Wr(i.wbrels,-1,"worksheets/sheet"+T+"."+r,Ar.WS[0]),U){var W=U["!comments"],B=!1,X="";if(W&&W.length>0){var _e=!1;W.forEach(function(me){me[1].forEach(function(ue){1==ue.T&&(_e=!0)})}),_e&&(mr(x,X="xl/threadedComments/threadedComment"+T+"."+r,em(W,F,i)),c.threadedcomments.push(X),Wr(N,-1,"../threadedComments/threadedComment"+T+"."+r,Ar.TCMNT)),mr(x,X="xl/comments"+T+"."+r,i0(W)),c.comments.push(X),Wr(N,-1,"../comments"+T+"."+r,Ar.CMNT),B=!0}U["!legacy"]&&B&&mr(x,"xl/drawings/vmlDrawing"+T+".vml",Yf(T,U["!comments"])),delete U["!comments"],delete U["!legacy"]}N["!id"].rId1&&mr(x,Dc(y),gs(N))}return null!=i.Strings&&i.Strings.length>0&&(mr(x,y="xl/sharedStrings."+r,gp(i.Strings,i)),c.strs.push(y),Wr(i.wbrels,-1,"sharedStrings."+r,Ar.SST)),mr(x,y="xl/workbook."+r,Ug(e)),c.workbooks.push(y),Wr(i.rels,1,y,Ar.WB),mr(x,y="xl/theme/theme1.xml",As(e.Themes,i)),c.themes.push(y),Wr(i.wbrels,-1,"theme/theme1.xml",Ar.THEME),mr(x,y="xl/styles."+r,Op(e,i)),c.styles.push(y),Wr(i.wbrels,-1,"styles."+r,Ar.STY),e.vbaraw&&o&&(mr(x,y="xl/vbaProject.bin",e.vbaraw),c.vba.push(y),Wr(i.wbrels,-1,"vbaProject.bin",Ar.VBA)),mr(x,y="xl/metadata."+r,ks()),c.metadata.push(y),Wr(i.wbrels,-1,"metadata."+r,Ar.XLMETA),F.length>1&&(mr(x,y="xl/persons/person.xml",function rm(e){var i=[xi,At("personList",null,{xmlns:Pi_TCMNT,"xmlns:x":ps[0]}).replace(/[\/]>/,">")];return e.forEach(function(r,o){i.push(At("person",null,{displayName:r,id:"{54EE7950-7262-4200-6969-"+("000000000000"+o).slice(-12)+"}",userId:r,providerId:"None"}))}),i.push("</personList>"),i.join("")}(F)),c.people.push(y),Wr(i.wbrels,-1,"persons/person.xml",Ar.PEOPLE)),mr(x,"[Content_Types].xml",Jr(c,i)),mr(x,"_rels/.rels",gs(i.rels)),mr(x,"xl/_rels/workbook.xml.rels",gs(i.wbrels)),delete i.revssf,delete i.ssf,x}(e,i)}function f1(e,i){switch(i.type){case"base64":case"binary":break;case"buffer":case"array":i.type="";break;case"file":return zo(i.file,ar.write(e,{type:_r?"buffer":""}));case"string":throw new Error("'string' output type invalid for '"+i.bookType+"' files");default:throw new Error("Unrecognized type "+i.type)}return ar.write(e,i)}function Yl(e,i,r){r||(r="");var o=r+e;switch(i.type){case"base64":return Mn(ca(o));case"binary":return ca(o);case"string":return e;case"file":return zo(i.file,o,"utf8");case"buffer":return _r?ls(o,"utf8"):"undefined"!=typeof TextEncoder?(new TextEncoder).encode(o):Yl(o,{type:"binary"}).split("").map(function(c){return c.charCodeAt(0)})}throw new Error("Unrecognized type "+i.type)}function vm(e,i){switch(i.type){case"string":case"base64":case"binary":for(var r="",o=0;o<e.length;++o)r+=String.fromCharCode(e[o]);return"base64"==i.type?Mn(r):"string"==i.type?di(r):r;case"file":return zo(i.file,e);case"buffer":return e;default:throw new Error("Unrecognized type "+i.type)}}function _g(e,i){(function Fr(){Wn(1200),function nu(){ss(1252)}()})(),function Ng(e){if(!e||!e.SheetNames||!e.Sheets)throw new Error("Invalid Workbook");if(!e.SheetNames.length)throw new Error("Workbook is empty");!function My(e,i,r){e.forEach(function(o,c){Bg(o);for(var x=0;x<c;++x)if(o==e[x])throw new Error("Duplicate Sheet Name: "+o);if(r){var y=i&&i[c]&&i[c].CodeName||o;if(95==y.charCodeAt(0)&&y.length>22)throw new Error("Bad Code Name: Worksheet"+y)}})}(e.SheetNames,e.Workbook&&e.Workbook.Sheets||[],!!e.vbaraw);for(var r=0;r<e.SheetNames.length;++r)$c(e.Sheets[e.SheetNames[r]],0,r)}(e);var r=Kr(i||{});if(r.cellStyles&&(r.cellNF=!0,r.sheetStubs=!0),"array"==r.type){r.type="binary";var o=_g(e,r);return r.type="array",hn(o)}var c=0;if(r.sheet&&(c="number"==typeof r.sheet?r.sheet:e.SheetNames.indexOf(r.sheet),!e.SheetNames[c]))throw new Error("Sheet not found: "+r.sheet+" : "+typeof r.sheet);switch(r.bookType||"xlsb"){case"xml":case"xlml":return Yl(kv(e,r),r);case"slk":case"sylk":return Yl(Zf.from_sheet(e.Sheets[e.SheetNames[c]],r),r);case"htm":case"html":return Yl(Kg(e.Sheets[e.SheetNames[c]],r),r);case"txt":return function P2(e,i){switch(i.type){case"base64":return Mn(e);case"binary":case"string":return e;case"file":return zo(i.file,e,"binary");case"buffer":return _r?ls(e,"binary"):e.split("").map(function(r){return r.charCodeAt(0)})}throw new Error("Unrecognized type "+i.type)}(x1(e.Sheets[e.SheetNames[c]],r),r);case"csv":return Yl(xg(e.Sheets[e.SheetNames[c]],r),r,"\ufeff");case"dif":return Yl(Rd.from_sheet(e.Sheets[e.SheetNames[c]],r),r);case"dbf":return vm(Qr.from_sheet(e.Sheets[e.SheetNames[c]],r),r);case"prn":return Yl(ba.from_sheet(e.Sheets[e.SheetNames[c]],r),r);case"rtf":return Yl(qd.from_sheet(e.Sheets[e.SheetNames[c]],r),r);case"eth":return Yl(Od.from_sheet(e.Sheets[e.SheetNames[c]],r),r);case"fods":return Yl(s1(e,r),r);case"wk1":return vm(Nl.sheet_to_wk1(e.Sheets[e.SheetNames[c]],r),r);case"wk3":return vm(Nl.book_to_wk3(e,r),r);case"biff2":r.biff||(r.biff=2);case"biff3":r.biff||(r.biff=3);case"biff4":return r.biff||(r.biff=4),vm(Gg(e,r),r);case"biff5":r.biff||(r.biff=5);case"biff8":case"xla":case"xls":return r.biff||(r.biff=8),function D2(e,i){var r=i||{};return f1(function Lv(e,i){var r=i||{},o=ar.utils.cfb_new({root:"R"}),c="/Workbook";switch(r.bookType||"xls"){case"xls":r.bookType="biff8";case"xla":r.bookType||(r.bookType="xla");case"biff8":c="/Workbook",r.biff=8;break;case"biff5":c="/Book",r.biff=5;break;default:throw new Error("invalid type "+r.bookType+" for XLS CFB")}return ar.utils.cfb_add(o,c,Gg(e,r)),8==r.biff&&(e.Props||e.Custprops)&&function Pv(e,i){var y,r=[],o=[],c=[],x=0,T=hf(pd,"n"),C=hf(md,"n");if(e.Props)for(y=Fi(e.Props),x=0;x<y.length;++x)(Object.prototype.hasOwnProperty.call(T,y[x])?r:Object.prototype.hasOwnProperty.call(C,y[x])?o:c).push([y[x],e.Props[y[x]]]);if(e.Custprops)for(y=Fi(e.Custprops),x=0;x<y.length;++x)Object.prototype.hasOwnProperty.call(e.Props||{},y[x])||(Object.prototype.hasOwnProperty.call(T,y[x])?r:Object.prototype.hasOwnProperty.call(C,y[x])?o:c).push([y[x],e.Custprops[y[x]]]);var I=[];for(x=0;x<c.length;++x)L0.indexOf(c[x][0])>-1||yh.indexOf(c[x][0])>-1||null!=c[x][1]&&I.push(c[x]);o.length&&ar.utils.cfb_add(i,"/\x05SummaryInformation",Fu(o,"e0859ff2f94f6810ab9108002b27b3d9",C,md)),(r.length||I.length)&&ar.utils.cfb_add(i,"/\x05DocumentSummaryInformation",Fu(r,"02d5cdd59c2e1b10939708002b2cf9ae",T,pd,I.length?I:null,"05d5cdd59c2e1b10939708002b2cf9ae"))}(e,o),8==r.biff&&e.vbaraw&&function io(e,i){i.FullPaths.forEach(function(r,o){if(0!=o){var c=r.replace(/[^\/]*[\/]/,"/_VBA_PROJECT_CUR/");"/"!==c.slice(-1)&&ar.utils.cfb_add(e,c,i.FileIndex[o].content)}})}(o,ar.read(e.vbaraw,{type:"string"==typeof e.vbaraw?"binary":"buffer"})),o}(e,r),r)}(e,r);case"xlsx":case"xlsm":case"xlam":case"xlsb":case"numbers":case"ods":return function M2(e,i){var r=Kr(i||{});return function d1(e,i){var r={},o=_r?"nodebuffer":"undefined"!=typeof Uint8Array?"array":"string";if(i.compression&&(r.compression="DEFLATE"),i.password)r.type=o;else switch(i.type){case"base64":r.type="base64";break;case"binary":r.type="string";break;case"string":throw new Error("'string' output type invalid for '"+i.bookType+"' files");case"buffer":case"file":r.type=o;break;default:throw new Error("Unrecognized type "+i.type)}var c=e.FullPaths?ar.write(e,{fileType:"zip",type:{nodebuffer:"buffer",string:"binary"}[r.type]||r.type,compression:!!i.compression}):e.generate(r);if("undefined"!=typeof Deno&&"string"==typeof c){if("binary"==i.type||"base64"==i.type)return c;c=new Uint8Array(hn(c))}return i.password&&"undefined"!=typeof encrypt_agile?f1(encrypt_agile(c,i.password),i):"file"===i.type?zo(i.file,c):"string"==i.type?di(c):c}(T2(e,r),r)}(e,r);default:throw new Error("Unrecognized bookType |"+r.bookType+"|")}}function m1(e,i,r,o,c,x,y,T){var C=se(r),I=T.defval,F=T.raw||!Object.prototype.hasOwnProperty.call(T,"raw"),N=!0,U=1===c?[]:{};if(1!==c)if(Object.defineProperty)try{Object.defineProperty(U,"__rowNum__",{value:r,enumerable:!1})}catch(X){U.__rowNum__=r}else U.__rowNum__=r;if(!y||e[r])for(var j=i.s.c;j<=i.e.c;++j){var W=y?e[r][j]:e[o[j]+C];if(void 0!==W&&void 0!==W.t){var B=W.v;switch(W.t){case"z":if(null==B)break;continue;case"e":B=0==B?null:void 0;break;case"s":case"d":case"b":case"n":break;default:throw new Error("unrecognized type "+W.t)}if(null!=x[j]){if(null==B)if("e"==W.t&&null===B)U[x[j]]=null;else if(void 0!==I)U[x[j]]=I;else{if(!F||null!==B)continue;U[x[j]]=null}else U[x[j]]=F&&("n"!==W.t||"n"===W.t&&!1!==T.rawNumbers)?B:dt(W,B,T);null!=B&&(N=!1)}}else{if(void 0===I)continue;null!=x[j]&&(U[x[j]]=I)}}return{row:U,isempty:N}}function wm(e,i){if(null==e||null==e["!ref"])return[];var r={t:"n",v:0},o=0,c=1,x=[],y=0,T="",C={s:{r:0,c:0},e:{r:0,c:0}},I=i||{},F=null!=I.range?I.range:e["!ref"];switch(1===I.header?o=1:"A"===I.header?o=2:Array.isArray(I.header)?o=3:null==I.header&&(o=0),typeof F){case"string":C=ke(F);break;case"number":(C=ke(e["!ref"])).s.r=F;break;default:C=F}o>0&&(c=0);var N=se(C.s.r),U=[],j=[],W=0,B=0,X=Array.isArray(e),_e=C.s.r,me=0,ue={};X&&!e[_e]&&(e[_e]=[]);var Ue=I.skipHidden&&e["!cols"]||[],We=I.skipHidden&&e["!rows"]||[];for(me=C.s.c;me<=C.e.c;++me)if(!(Ue[me]||{}).hidden)switch(U[me]=ce(me),r=X?e[_e][me]:e[U[me]+N],o){case 1:x[me]=me-C.s.c;break;case 2:x[me]=U[me];break;case 3:x[me]=I.header[me-C.s.c];break;default:if(null==r&&(r={w:"__EMPTY",t:"s"}),T=y=dt(r,null,I),B=ue[y]||0){do{T=y+"_"+B++}while(ue[T]);ue[y]=B,ue[T]=1}else ue[y]=1;x[me]=T}for(_e=C.s.r+c;_e<=C.e.r;++_e)if(!(We[_e]||{}).hidden){var nt=m1(e,C,_e,U,o,x,X,I);(!1===nt.isempty||(1===o?!1!==I.blankrows:I.blankrows))&&(j[W++]=nt.row)}return j.length=W,j}var _1=/"/g;function g1(e,i,r,o,c,x,y,T){for(var C=!0,I=[],F="",N=se(r),U=i.s.c;U<=i.e.c;++U)if(o[U]){var j=T.dense?(e[r]||[])[U]:e[o[U]+N];if(null==j)F="";else if(null!=j.v){C=!1,F=""+(T.rawNumbers&&"n"==j.t?j.v:dt(j,null,T));for(var W=0,B=0;W!==F.length;++W)if((B=F.charCodeAt(W))===c||B===x||34===B||T.forceQuotes){F='"'+F.replace(_1,'""')+'"';break}"ID"==F&&(F='"ID"')}else null==j.f||j.F?F="":(C=!1,(F="="+j.f).indexOf(",")>=0&&(F='"'+F.replace(_1,'""')+'"'));I.push(F)}return!1===T.blankrows&&C?null:I.join(y)}function xg(e,i){var r=[],o=null==i?{}:i;if(null==e||null==e["!ref"])return"";var c=ke(e["!ref"]),x=void 0!==o.FS?o.FS:",",y=x.charCodeAt(0),T=void 0!==o.RS?o.RS:"\n",C=T.charCodeAt(0),I=new RegExp(("|"==x?"\\|":x)+"+$"),F="",N=[];o.dense=Array.isArray(e);for(var U=o.skipHidden&&e["!cols"]||[],j=o.skipHidden&&e["!rows"]||[],W=c.s.c;W<=c.e.c;++W)(U[W]||{}).hidden||(N[W]=ce(W));for(var B=0,X=c.s.r;X<=c.e.r;++X)(j[X]||{}).hidden||null!=(F=g1(e,c,X,N,y,C,x,o))&&(o.strip&&(F=F.replace(I,"")),(F||!1!==o.blankrows)&&r.push((B++?T:"")+F));return delete o.dense,r.join("")}function x1(e,i){i||(i={}),i.FS="\t",i.RS="\n";var r=xg(e,i);return r}function y1(e,i,r){var o=r||{},c=+!o.skipHeader,x=e||{},y=0,T=0;if(x&&null!=o.origin)if("number"==typeof o.origin)y=o.origin;else{var C="string"==typeof o.origin?Be(o.origin):o.origin;y=C.r,T=C.c}var I,F={s:{c:0,r:0},e:{c:T,r:y+i.length-1+c}};if(x["!ref"]){var N=ke(x["!ref"]);F.e.c=Math.max(F.e.c,N.e.c),F.e.r=Math.max(F.e.r,N.e.r),-1==y&&(F.e.r=(y=N.e.r+1)+i.length-1+c)}else-1==y&&(y=0,F.e.r=i.length-1+c);var U=o.header||[],j=0;i.forEach(function(B,X){Fi(B).forEach(function(_e){-1==(j=U.indexOf(_e))&&(U[j=U.length]=_e);var me=B[_e],ue="z",Ue="",We=Le({c:T+j,r:y+X+c});I=_0(x,We),!me||"object"!=typeof me||me instanceof Date?("number"==typeof me?ue="n":"boolean"==typeof me?ue="b":"string"==typeof me?ue="s":me instanceof Date?(ue="d",o.cellDates||(ue="n",me=Di(me)),Ue=o.dateNF||or[14]):null===me&&o.nullError&&(ue="e",me=0),I?(I.t=ue,I.v=me,delete I.w,delete I.R,Ue&&(I.z=Ue)):x[We]=I={t:ue,v:me},Ue&&(I.z=Ue)):x[We]=me})}),F.e.c=Math.max(F.e.c,T+U.length-1);var W=se(y);if(c)for(j=0;j<U.length;++j)x[ce(j+T)+W]={t:"s",v:U[j]};return x["!ref"]=Qe(F),x}function _0(e,i,r){if("string"==typeof i){if(Array.isArray(e)){var o=Be(i);return e[o.r]||(e[o.r]=[]),e[o.r][o.c]||(e[o.r][o.c]={t:"z"})}return e[i]||(e[i]={t:"z"})}return _0(e,Le("number"!=typeof i?i:{r:i,c:r||0}))}function v1(e,i,r){return i?(e.l={Target:i},r&&(e.l.Tooltip=r)):delete e.l,e}var wg={encode_col:ce,encode_row:se,encode_cell:Le,encode_range:Qe,decode_col:de,decode_row:H,split_cell:function ze(e){return e.replace(/(\$?[A-Z]*)(\$?\d*)/,"$1,$2").split(",")},decode_cell:Be,decode_range:qe,format_cell:dt,sheet_add_aoa:et,sheet_add_json:y1,sheet_add_dom:Jg,aoa_to_sheet:Mt,json_to_sheet:function O2(e,i){return y1(null,e,i)},table_to_sheet:Qg,table_to_book:function Jv(e,i){return It(Qg(e,i),i)},sheet_to_csv:xg,sheet_to_txt:x1,sheet_to_json:wm,sheet_to_html:Kg,sheet_to_formulae:function R2(e){var r,i="",o="";if(null==e||null==e["!ref"])return[];var T,c=ke(e["!ref"]),x="",y=[],C=[],I=Array.isArray(e);for(T=c.s.c;T<=c.e.c;++T)y[T]=ce(T);for(var F=c.s.r;F<=c.e.r;++F)for(x=se(F),T=c.s.c;T<=c.e.c;++T)if(i=y[T]+x,o="",void 0!==(r=I?(e[F]||[])[T]:e[i])){if(null!=r.F){if(i=r.F,!r.f)continue;o=r.f,-1==i.indexOf(":")&&(i=i+":"+i)}if(null!=r.f)o=r.f;else{if("z"==r.t)continue;if("n"==r.t&&null!=r.v)o=""+r.v;else if("b"==r.t)o=r.v?"TRUE":"FALSE";else if(void 0!==r.w)o="'"+r.w;else{if(void 0===r.v)continue;o="s"==r.t?"'"+r.v:""+r.v}}C[C.length]=i+"="+o}return C},sheet_to_row_object_array:wm,sheet_get_cell:_0,book_new:function yg(){return{SheetNames:[],Sheets:{}}},book_append_sheet:function vg(e,i,r,o){var c=1;if(!r)for(;c<=65535&&-1!=e.SheetNames.indexOf(r="Sheet"+c);++c,r=void 0);if(!r||e.SheetNames.length>=65535)throw new Error("Too many worksheets");if(o&&e.SheetNames.indexOf(r)>=0){var x=r.match(/(^.*?)(\d+)$/);c=x&&+x[2]||0;var y=x&&x[1]||r;for(++c;c<=65535&&-1!=e.SheetNames.indexOf(r=y+c);++c);}if(Bg(r),e.SheetNames.indexOf(r)>=0)throw new Error("Worksheet with name |"+r+"| already exists!");return e.SheetNames.push(r),e.Sheets[r]=i,r},book_set_sheet_visibility:function B2(e,i,r){e.Workbook||(e.Workbook={}),e.Workbook.Sheets||(e.Workbook.Sheets=[]);var o=function z2(e,i){if("number"==typeof i){if(i>=0&&e.SheetNames.length>i)return i;throw new Error("Cannot find sheet # "+i)}if("string"==typeof i){var r=e.SheetNames.indexOf(i);if(r>-1)return r;throw new Error("Cannot find sheet name |"+i+"|")}throw new Error("Cannot find sheet |"+i+"|")}(e,i);switch(e.Workbook.Sheets[o]||(e.Workbook.Sheets[o]={}),r){case 0:case 1:case 2:break;default:throw new Error("Bad sheet visibility setting "+r)}e.Workbook.Sheets[o].Hidden=r},cell_set_number_format:function N2(e,i){return e.z=i,e},cell_set_hyperlink:v1,cell_set_internal_link:function U2(e,i,r){return v1(e,"#"+i,r)},cell_add_comment:function Z2(e,i,r){e.c||(e.c=[]),e.c.push({t:i,a:r||"SheetJS"})},sheet_set_array_formula:function V2(e,i,r,o){for(var c="string"!=typeof i?i:ke(i),x="string"==typeof i?i:Qe(i),y=c.s.r;y<=c.e.r;++y)for(var T=c.s.c;T<=c.e.c;++T){var C=_0(e,y,T);C.t="n",C.F=x,delete C.v,y==c.s.r&&T==c.s.c&&(C.f=r,o&&(C.D=!0))}return e},consts:{SHEET_VISIBLE:0,SHEET_HIDDEN:1,SHEET_VERY_HIDDEN:2}};let w1=(()=>{class e{constructor(r){this.http=r,this.url=Zt.N.url_version}getClientes(){const r=(new Rt.WM).set("Authorization",localStorage.getItem("token")||"");return this.http.get(`${this.url}users/clientes`,{headers:r}).pipe((0,ki.U)(this.crearArreglo),Rr(0))}crearArreglo(r){const o=[];return null===(r=r.message)?[]:(Object.keys(r).forEach(c=>{let x=r[c];x.genero=(x.genero=1)?"M":"F",o.push(x)}),o)}}return e.\u0275fac=function(r){return new(r||e)(_.LFG(Rt.eN))},e.\u0275prov=_.Yz7({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();function W2(e,i){if(1&e){const r=_.EpF();_.TgZ(0,"div",4)(1,"button",5),_.NdJ("click",function(){return _.CHM(r),_.oxw().exportexcel()}),_._uU(2,"Descargar"),_.qZA()()}}function X2(e,i){if(1&e&&(_.TgZ(0,"tr")(1,"th",8),_._uU(2),_.qZA(),_.TgZ(3,"td",8),_._uU(4),_.qZA(),_.TgZ(5,"td",8),_._uU(6),_.qZA(),_.TgZ(7,"td",8),_._uU(8),_.qZA(),_.TgZ(9,"td",8),_._uU(10),_.qZA(),_.TgZ(11,"td",8),_._uU(12),_.qZA(),_.TgZ(13,"td",8),_._uU(14),_.qZA()()),2&e){const r=i.$implicit,o=i.index;_.xp6(2),_.Oqu(o+1),_.xp6(2),_.Oqu(r.nombre),_.xp6(2),_.Oqu(r.genero),_.xp6(2),_.Oqu(r.email),_.xp6(2),_.Oqu(r.telefonoM),_.xp6(2),_.Oqu(r.rfc),_.xp6(2),_.Oqu(r.fecha_nac)}}function H2(e,i){if(1&e&&(_.TgZ(0,"table",6)(1,"thead",7)(2,"tr")(3,"th",8),_._uU(4,"#"),_.qZA(),_.TgZ(5,"th",8),_._uU(6,"Nombre"),_.qZA(),_.TgZ(7,"th",8),_._uU(8,"G\xe9nero"),_.qZA(),_.TgZ(9,"th",8),_._uU(10,"Correo electr\xf3nico"),_.qZA(),_.TgZ(11,"th",8),_._uU(12,"Tel\xe9fono"),_.qZA(),_.TgZ(13,"th",8),_._uU(14,"RFC"),_.qZA(),_.TgZ(15,"th",8),_._uU(16,"Fecha nacimiento"),_.qZA()()(),_.TgZ(17,"tbody"),_.YNc(18,X2,15,7,"tr",9),_.qZA()()),2&e){const r=_.oxw();_.xp6(18),_.Q6J("ngForOf",r.clientes)}}function Y2(e,i){1&e&&(_.TgZ(0,"div",10)(1,"h4",11),_._uU(2,"No hay registros"),_.qZA(),_.TgZ(3,"p"),_._UZ(4,"i",12),_.qZA(),_._UZ(5,"p",13),_.qZA())}function K2(e,i){1&e&&(_.TgZ(0,"div",14)(1,"h4",11),_._uU(2,"Cargando"),_.qZA(),_.TgZ(3,"p"),_._UZ(4,"i",15),_.qZA(),_.TgZ(5,"p",13),_._uU(6," Espere por favor "),_.qZA()())}let J2=(()=>{class e{constructor(r){this._ClientesService=r,this.clientes=[],this.cargando=!1,this.fileName="clientes.xlsx"}ngOnInit(){this.cargando=!0,this._ClientesService.getClientes().subscribe(r=>{this.clientes=r,this.cargando=!1})}exportexcel(){let r=document.getElementById("tablaClientes");const o=wg.table_to_sheet(r),c=wg.book_new();wg.book_append_sheet(c,o,"Hoja1"),function L2(e,i,r){var o=r||{};o.type="file",o.file=i,function gg(e){if(!e.bookType){var r=e.file.slice(e.file.lastIndexOf(".")).toLowerCase();r.match(/^\.[a-z]+$/)&&(e.bookType=r.slice(1)),e.bookType={xls:"biff8",htm:"html",slk:"sylk",socialcalc:"eth",Sh33tJS:"WTF"}[e.bookType]||e.bookType}}(o),_g(e,o)}(c,this.fileName)}}return e.\u0275fac=function(r){return new(r||e)(_.Y36(w1))},e.\u0275cmp=_.Xpm({type:e,selectors:[["app-clientes"]],decls:7,vars:4,consts:[["class","d-grid gap-2 d-md-flex justify-content-md-end",4,"ngIf"],["class","table mt-3 animated fadeIn faster","id","tablaClientes",4,"ngIf"],["class","alert alert-warning text-center mt-3",4,"ngIf"],["class","alert alert-info text-center mt-3 animated fadeIn faster",4,"ngIf"],[1,"d-grid","gap-2","d-md-flex","justify-content-md-end"],["type","button",1,"btn","btn-primary","me-md-2",3,"click"],["id","tablaClientes",1,"table","mt-3","animated","fadeIn","faster"],[1,"table-dark"],["scope","col"],[4,"ngFor","ngForOf"],[1,"alert","alert-warning","text-center","mt-3"],[1,"alert-heading"],[1,"fa","fa-exclamation","fa-2x"],[1,"mb-0"],[1,"alert","alert-info","text-center","mt-3","animated","fadeIn","faster"],[1,"fa","fa-sync-alt","fa-spin","fa-2x"]],template:function(r,o){1&r&&(_.TgZ(0,"h1"),_._uU(1,"Lista de clientes"),_.qZA(),_._UZ(2,"hr"),_.YNc(3,W2,3,0,"div",0),_.YNc(4,H2,19,1,"table",1),_.YNc(5,Y2,6,0,"div",2),_.YNc(6,K2,7,0,"div",3)),2&r&&(_.xp6(3),_.Q6J("ngIf",!o.cargando&&o.clientes.length>0),_.xp6(1),_.Q6J("ngIf",!o.cargando&&o.clientes.length>0),_.xp6(1),_.Q6J("ngIf",!o.cargando&&0===o.clientes.length),_.xp6(1),_.Q6J("ngIf",o.cargando))},directives:[Ri.O5,Ri.sg],styles:[""]}),e})();const Q2=function(e){return["/administrador/detalles-pedido/",e]};function ew(e,i){if(1&e&&(_.TgZ(0,"tr")(1,"th",5),_._uU(2),_.qZA(),_.TgZ(3,"td",5),_._uU(4),_.qZA(),_.TgZ(5,"td",5),_._uU(6),_.qZA(),_.TgZ(7,"td",5),_._uU(8),_.qZA(),_.TgZ(9,"td",5)(10,"button",7),_._UZ(11,"i",8),_.qZA()()()),2&e){const r=i.$implicit,o=i.index;_.xp6(2),_.Oqu(o+1),_.xp6(2),_.Oqu(r.cliente),_.xp6(2),_.Oqu(r.nombreTienda),_.xp6(2),_.Oqu(r.estatusPedido),_.xp6(2),_.Q6J("routerLink",_.VKq(5,Q2,r.id_pedido))}}function tw(e,i){if(1&e&&(_.TgZ(0,"table",3)(1,"thead",4)(2,"tr")(3,"th",5),_._uU(4,"#"),_.qZA(),_.TgZ(5,"th",5),_._uU(6,"Cliente"),_.qZA(),_.TgZ(7,"th",5),_._uU(8,"Nombre tienda"),_.qZA(),_.TgZ(9,"th",5),_._uU(10,"Estatus"),_.qZA(),_.TgZ(11,"th",5),_._uU(12,"Detalles"),_.qZA()()(),_.TgZ(13,"tbody"),_.YNc(14,ew,12,7,"tr",6),_.qZA()()),2&e){const r=_.oxw();_.xp6(14),_.Q6J("ngForOf",r.pedidos)}}function rw(e,i){1&e&&(_.TgZ(0,"div",9)(1,"h4",10),_._uU(2,"No hay registros"),_.qZA(),_.TgZ(3,"p"),_._UZ(4,"i",11),_.qZA(),_._UZ(5,"p",12),_.qZA())}function iw(e,i){1&e&&(_.TgZ(0,"div",13)(1,"h4",10),_._uU(2,"Cargando"),_.qZA(),_.TgZ(3,"p"),_._UZ(4,"i",14),_.qZA(),_.TgZ(5,"p",12),_._uU(6," Espere por favor "),_.qZA()())}let nw=(()=>{class e{constructor(r){this._PedidosService=r,this.pedidos=[],this.cargando=!1}ngOnInit(){this.cargando=!0,this._PedidosService.getPedidos().subscribe(r=>{this.pedidos=r,this.cargando=!1})}}return e.\u0275fac=function(r){return new(r||e)(_.Y36(cn))},e.\u0275cmp=_.Xpm({type:e,selectors:[["app-pedidos"]],decls:6,vars:3,consts:[["class","table mt-3 animated fadeIn faster",4,"ngIf"],["class","alert alert-warning text-center mt-3",4,"ngIf"],["class","alert alert-info text-center mt-3 animated fadeIn faster",4,"ngIf"],[1,"table","mt-3","animated","fadeIn","faster"],[1,"table-dark"],["scope","col"],[4,"ngFor","ngForOf"],[1,"btn","btn-info","mr-1",3,"routerLink"],[1,"fa","fa-list-ul"],[1,"alert","alert-warning","text-center","mt-3"],[1,"alert-heading"],[1,"fa","fa-exclamation","fa-2x"],[1,"mb-0"],[1,"alert","alert-info","text-center","mt-3","animated","fadeIn","faster"],[1,"fa","fa-sync-alt","fa-spin","fa-2x"]],template:function(r,o){1&r&&(_.TgZ(0,"h1"),_._uU(1,"Lista de pedidos"),_.qZA(),_._UZ(2,"hr"),_.YNc(3,tw,15,1,"table",0),_.YNc(4,rw,6,0,"div",1),_.YNc(5,iw,7,0,"div",2)),2&r&&(_.xp6(3),_.Q6J("ngIf",!o.cargando&&o.pedidos.length>0),_.xp6(1),_.Q6J("ngIf",!o.cargando&&0===o.pedidos.length),_.xp6(1),_.Q6J("ngIf",o.cargando))},directives:[Ri.O5,Ri.sg,xn.rH],styles:[""]}),e})();var g0=gi(9898);let aw=(()=>{class e{constructor(r,o){this._tiendasService=r,this._clientesService=o,this.tiendas=[],this.clientes=[],this.x=-99.64458554992817,this.y=19.305109805633386}ngOnInit(){this.mapa=new g0.Map({accessToken:Zt.N.mapboxKey,container:"mapa-mapbox",style:"mapbox://styles/mapbox/outdoors-v11",center:[this.x,this.y],zoom:15}),this.mapa.addControl(new g0.FullscreenControl);let r={type:"geojson",data:{type:"FeatureCollection",features:[]}};this._tiendasService.getTiendas().subscribe(o=>{o.forEach(c=>{const x=new g0.Popup({offset:25}).setText(c.nombreTienda);new g0.Marker({draggable:!1}).setLngLat([c.x,c.y]).setPopup(x).addTo(this.mapa),this._tiendasService.getIso("walking",c.x,c.y,10).then(T=>{r.data.features.push({type:"Feature",properties:T.properties,geometry:T.geometry})})})}),this.mapa.on("load",()=>{this.mapa.addSource("isocronas",r),this.mapa.addLayer({id:"park-boundary",type:"fill",source:"isocronas",paint:{"fill-color":"#888888","fill-opacity":.4},filter:["==","$type","Polygon"]})}),this._clientesService.getClientes().subscribe(o=>{o.forEach(c=>{new g0.Marker({color:"green",rotation:45}).setLngLat([c.x,c.y]).addTo(this.mapa)})})}}return e.\u0275fac=function(r){return new(r||e)(_.Y36(Tr),_.Y36(w1))},e.\u0275cmp=_.Xpm({type:e,selectors:[["app-cobertura"]],decls:4,vars:0,consts:[["id","mapa-mapbox"]],template:function(r,o){1&r&&(_.TgZ(0,"h1"),_._uU(1,"Mapa de cobertura"),_.qZA(),_._UZ(2,"hr")(3,"div",0))},styles:["#mapa-mapbox[_ngcontent-%COMP%]{width:100%;height:800px;background-color:#fff}"]}),e})(),sw=(()=>{class e{constructor(){}ngOnInit(){}}return e.\u0275fac=function(r){return new(r||e)},e.\u0275cmp=_.Xpm({type:e,selectors:[["app-faqs"]],decls:90,vars:0,consts:[["role","alert",1,"alert","alert-primary"],["role","alert",1,"alert","alert-secondary"],["role","alert",1,"alert","alert-success"],["id","accordionExample",1,"accordion"],[1,"accordion-item"],["id","headingOne",1,"accordion-header"],["type","button","data-bs-toggle","collapse","data-bs-target","#collapseOne","aria-expanded","true","aria-controls","collapseOne",1,"accordion-button"],["id","collapseOne","aria-labelledby","headingOne","data-bs-parent","#accordionExample",1,"accordion-collapse","collapse","show"],[1,"accordion-body"],["id","headingTwo",1,"accordion-header"],["type","button","data-bs-toggle","collapse","data-bs-target","#collapseTwo","aria-expanded","false","aria-controls","collapseTwo",1,"accordion-button","collapsed"],["id","collapseTwo","aria-labelledby","headingTwo","data-bs-parent","#accordionExample",1,"accordion-collapse","collapse"],["id","headingThree",1,"accordion-header"],["type","button","data-bs-toggle","collapse","data-bs-target","#collapseThree","aria-expanded","false","aria-controls","collapseThree",1,"accordion-button","collapsed"],["id","collapseThree","aria-labelledby","headingThree","data-bs-parent","#accordionExample",1,"accordion-collapse","collapse"],[1,"table"],["scope","col"],["scope","row"],["colspan","2"]],template:function(r,o){1&r&&(_.TgZ(0,"h1"),_._uU(1,"P\xe1gina de ayuda"),_.qZA(),_.TgZ(2,"p"),_._uU(3,"Lorem ipsum, dolor sit amet consectetur adipisicing elit. Laborum iure voluptate, quibusdam est, animi dolorum sunt obcaecati maiores consequuntur id voluptas ex vitae nam. Similique at amet quis debitis accusamus?"),_.qZA(),_._UZ(4,"p"),_.TgZ(5,"h1"),_._uU(6,"T\xedtulo 2"),_.qZA(),_.TgZ(7,"p"),_._uU(8,"Lorem ipsum, dolor sit amet consectetur adipisicing elit. Laborum iure voluptate, quibusdam est, animi dolorum sunt obcaecati maiores consequuntur id voluptas ex vitae nam. Similique at amet quis debitis accusamus?"),_.qZA(),_._UZ(9,"p"),_.TgZ(10,"div",0),_._uU(11," A simple primary alert\u2014check it out!\n"),_.qZA(),_.TgZ(12,"div",1),_._uU(13," A simple secondary alert\u2014check it out!\n"),_.qZA(),_.TgZ(14,"div",2),_._uU(15," A simple success alert\u2014check it out!\n"),_.qZA(),_.TgZ(16,"div",3)(17,"div",4)(18,"h2",5)(19,"button",6),_._uU(20," Accordion Item #1 "),_.qZA()(),_.TgZ(21,"div",7)(22,"div",8)(23,"strong"),_._uU(24,"This is the first item's accordion body."),_.qZA(),_._uU(25," It is shown by default, until the collapse plugin adds the appropriate classes that we use to style each element. These classes control the overall appearance, as well as the showing and hiding via CSS transitions. You can modify any of this with custom CSS or overriding our default variables. It's also worth noting that just about any HTML can go within the "),_.TgZ(26,"code"),_._uU(27,".accordion-body"),_.qZA(),_._uU(28,", though the transition does limit overflow. "),_.qZA()()(),_.TgZ(29,"div",4)(30,"h2",9)(31,"button",10),_._uU(32," Accordion Item #2 "),_.qZA()(),_.TgZ(33,"div",11)(34,"div",8)(35,"strong"),_._uU(36,"This is the second item's accordion body."),_.qZA(),_._uU(37," It is hidden by default, until the collapse plugin adds the appropriate classes that we use to style each element. These classes control the overall appearance, as well as the showing and hiding via CSS transitions. You can modify any of this with custom CSS or overriding our default variables. It's also worth noting that just about any HTML can go within the "),_.TgZ(38,"code"),_._uU(39,".accordion-body"),_.qZA(),_._uU(40,", though the transition does limit overflow. "),_.qZA()()(),_.TgZ(41,"div",4)(42,"h2",12)(43,"button",13),_._uU(44," Accordion Item #3 "),_.qZA()(),_.TgZ(45,"div",14)(46,"div",8)(47,"strong"),_._uU(48,"This is the third item's accordion body."),_.qZA(),_._uU(49," It is hidden by default, until the collapse plugin adds the appropriate classes that we use to style each element. These classes control the overall appearance, as well as the showing and hiding via CSS transitions. You can modify any of this with custom CSS or overriding our default variables. It's also worth noting that just about any HTML can go within the "),_.TgZ(50,"code"),_._uU(51,".accordion-body"),_.qZA(),_._uU(52,", though the transition does limit overflow. "),_.qZA()()()(),_.TgZ(53,"table",15)(54,"thead")(55,"tr")(56,"th",16),_._uU(57,"#"),_.qZA(),_.TgZ(58,"th",16),_._uU(59,"First"),_.qZA(),_.TgZ(60,"th",16),_._uU(61,"Last"),_.qZA(),_.TgZ(62,"th",16),_._uU(63,"Handle"),_.qZA()()(),_.TgZ(64,"tbody")(65,"tr")(66,"th",17),_._uU(67,"1"),_.qZA(),_.TgZ(68,"td"),_._uU(69,"Mark"),_.qZA(),_.TgZ(70,"td"),_._uU(71,"Otto"),_.qZA(),_.TgZ(72,"td"),_._uU(73,"@mdo"),_.qZA()(),_.TgZ(74,"tr")(75,"th",17),_._uU(76,"2"),_.qZA(),_.TgZ(77,"td"),_._uU(78,"Jacob"),_.qZA(),_.TgZ(79,"td"),_._uU(80,"Thornton"),_.qZA(),_.TgZ(81,"td"),_._uU(82,"@fat"),_.qZA()(),_.TgZ(83,"tr")(84,"th",17),_._uU(85,"3"),_.qZA(),_.TgZ(86,"td",18),_._uU(87,"Larry the Bird"),_.qZA(),_.TgZ(88,"td"),_._uU(89,"@twitter"),_.qZA()()()())},styles:[""]}),e})(),ow=(()=>{class e{constructor(r){this.http=r,this.url=Zt.N.url_version}getDetallePedido(r){const o=(new Rt.WM).set("Authorization",localStorage.getItem("token")||"");return this.http.get(`${this.url}tiendas/getdetallepedido/${r}`,{headers:o}).pipe((0,ki.U)(this.crearArreglo),Rr(0))}crearArreglo(r){let o=[],c=r.message.detallePedido;return null===c?[]:(Object.keys(c).forEach(x=>{o.push(c[x])}),o)}}return e.\u0275fac=function(r){return new(r||e)(_.LFG(Rt.eN))},e.\u0275prov=_.Yz7({token:e,factory:e.\u0275fac,providedIn:"root"}),e})(),lw=(()=>{class e{constructor(r){this.http=r,this.url=Zt.N.url_version}getAllStatus(r){const o=(new Rt.WM).set("Authorization",localStorage.getItem("token")||"");return this.http.get(`${this.url}tiendas/getallstatuspedido/${r}`,{headers:o}).pipe((0,ki.U)(this.crearArreglo),Rr(0))}crearArreglo(r){let o=[],c=r.message[0].allStatusPedido;return null===c?[]:(Object.keys(c).forEach(x=>{let y=c[x];switch(y.estatus){case 0:y.estatus="Se envio solicitud al retailer para que pese los productos";break;case 1:y.estatus="Surtiendo";break;case 2:y.estatus="Terminado de pesar";break;case 3:y.estatus="Confirmado para entrega (el cliente pag\xf3)";break;case 4:y.estatus="En camino";break;case 5:y.estatus="Entregado";break;case 6:y.estatus="Cancelado";break;case 7:y.estatus="Devolucion";break;case 8:y.estatus="Venta en piso";break;default:console.log("Error")}o.push(y)}),o)}}return e.\u0275fac=function(r){return new(r||e)(_.LFG(Rt.eN))},e.\u0275prov=_.Yz7({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();function cw(e,i){1&e&&(_.TgZ(0,"div",4)(1,"h4",5),_._uU(2,"No hay productos para mostrar"),_.qZA(),_.TgZ(3,"p"),_._UZ(4,"i",6),_.qZA(),_._UZ(5,"p",7),_.qZA())}function uw(e,i){1&e&&(_.TgZ(0,"div",8)(1,"h4",5),_._uU(2,"Cargando lista del pedido"),_.qZA(),_.TgZ(3,"p"),_._UZ(4,"i",9),_.qZA(),_.TgZ(5,"p",7),_._uU(6," Espere por favor "),_.qZA()())}function hw(e,i){if(1&e&&(_.TgZ(0,"tr")(1,"th",12),_._uU(2),_.qZA(),_.TgZ(3,"td",12),_._uU(4),_.qZA(),_.TgZ(5,"td",12),_._uU(6),_.qZA(),_.TgZ(7,"td",12),_._uU(8),_.qZA(),_.TgZ(9,"td",12),_._uU(10),_.qZA(),_.TgZ(11,"td",12),_._uU(12),_.qZA()()),2&e){const r=i.$implicit,o=i.index;_.xp6(2),_.Oqu(o+1),_.xp6(2),_.Oqu(r.pesoAjustado),_.xp6(2),_.Oqu(r.unidad_medida),_.xp6(2),_.Oqu(r.nombre),_.xp6(2),_.Oqu(r.nota),_.xp6(2),_.Oqu(r.importeAjustado)}}function fw(e,i){if(1&e&&(_.TgZ(0,"table",10)(1,"thead",11)(2,"tr")(3,"th",12),_._uU(4,"#"),_.qZA(),_.TgZ(5,"th",12),_._uU(6,"Cantidad"),_.qZA(),_.TgZ(7,"th",12),_._uU(8,"Unidad"),_.qZA(),_.TgZ(9,"th",12),_._uU(10,"Nombre"),_.qZA(),_.TgZ(11,"th",12),_._uU(12,"Nota"),_.qZA(),_.TgZ(13,"th",12),_._uU(14,"Importe"),_.qZA()()(),_.TgZ(15,"tbody"),_.YNc(16,hw,13,6,"tr",13),_.TgZ(17,"tr"),_._UZ(18,"th",12)(19,"th",12)(20,"th",12)(21,"th",12),_.TgZ(22,"th",12),_._uU(23,"Total"),_.qZA(),_.TgZ(24,"th",12),_._uU(25),_.ALo(26,"number"),_.qZA()()()()),2&e){const r=_.oxw();_.xp6(16),_.Q6J("ngForOf",r.listaDetallePedido),_.xp6(9),_.Oqu(_.xi3(26,2,r.suma,".0-2"))}}function dw(e,i){1&e&&(_.TgZ(0,"div",4)(1,"h4",5),_._uU(2,"No hay lista de estatus"),_.qZA(),_.TgZ(3,"p"),_._UZ(4,"i",6),_.qZA(),_._UZ(5,"p",7),_.qZA())}function pw(e,i){if(1&e&&(_.TgZ(0,"div",14),_._uU(1),_.qZA()),2&e){const r=i.$implicit;_.xp6(1),_.AsE(" ",r.estatus," el dia ",r.fecha_hora,"\n")}}function mw(e,i){1&e&&(_.TgZ(0,"div",8)(1,"h4",5),_._uU(2,"Cargando lista de estatus"),_.qZA(),_.TgZ(3,"p"),_._UZ(4,"i",9),_.qZA(),_.TgZ(5,"p",7),_._uU(6," Espere por favor "),_.qZA()())}const _w=[{path:"",component:ut,children:[{path:"tiendas",component:wo},{path:"tienda/:id_tienda",component:Or},{path:"dashboard",component:ic},{path:"categorias",component:Oa},{path:"categoria/:id",component:Oe},{path:"subcategoria/:id_categoria/:id_subcategoria",component:Ze},{path:"variedad/:id_categoria/:id_subcategoria/:id_variedad",component:Cn},{path:"clientes",component:J2},{path:"pedidos",component:nw},{path:"cobertura",component:aw},{path:"faqs",component:sw},{path:"detalles-pedido/:id_pedido",component:(()=>{class e{constructor(r,o,c){this.detallePedidoService=r,this.estatusPedidoService=o,this.route=c,this.listaEstatusPedido=[],this.listaDetallePedido=[],this.cargando=!1,this.suma=0}ngOnInit(){const r=this.route.snapshot.paramMap.get("id_pedido");this.cargando=!0,this.detallePedidoService.getDetallePedido(r).subscribe(o=>{this.listaDetallePedido=o,this.listaDetallePedido.forEach(c=>{this.suma+=parseFloat(c.importeAjustado)})}),this.estatusPedidoService.getAllStatus(r).subscribe(o=>{this.listaEstatusPedido=o,this.cargando=!1})}}return e.\u0275fac=function(r){return new(r||e)(_.Y36(ow),_.Y36(lw),_.Y36(xn.gz))},e.\u0275cmp=_.Xpm({type:e,selectors:[["app-detalles-pedido"]],decls:13,vars:6,consts:[["class","alert alert-warning text-center mt-3",4,"ngIf"],["class","alert alert-info text-center mt-3 animated fadeIn faster",4,"ngIf"],["class","table mt-3 animated fadeIn faster",4,"ngIf"],["class","alert alert-success","role","alert",4,"ngFor","ngForOf"],[1,"alert","alert-warning","text-center","mt-3"],[1,"alert-heading"],[1,"fa","fa-exclamation","fa-2x"],[1,"mb-0"],[1,"alert","alert-info","text-center","mt-3","animated","fadeIn","faster"],[1,"fa","fa-sync-alt","fa-spin","fa-2x"],[1,"table","mt-3","animated","fadeIn","faster"],[1,"table-dark"],["scope","col"],[4,"ngFor","ngForOf"],["role","alert",1,"alert","alert-success"]],template:function(r,o){1&r&&(_.TgZ(0,"h1"),_._uU(1,"Informaci\xf3n completa del pedido"),_.qZA(),_._UZ(2,"hr"),_.TgZ(3,"h4"),_._uU(4,"Lista de productos del pedido"),_.qZA(),_.YNc(5,cw,6,0,"div",0),_.YNc(6,uw,7,0,"div",1),_.YNc(7,fw,27,5,"table",2),_.TgZ(8,"h4"),_._uU(9,"Lista de estatus del producto"),_.qZA(),_.YNc(10,dw,6,0,"div",0),_.YNc(11,pw,2,2,"div",3),_.YNc(12,mw,7,0,"div",1)),2&r&&(_.xp6(5),_.Q6J("ngIf",!o.cargando&&0===o.listaDetallePedido.length),_.xp6(1),_.Q6J("ngIf",o.cargando),_.xp6(1),_.Q6J("ngIf",!o.cargando&&o.listaDetallePedido.length>0),_.xp6(3),_.Q6J("ngIf",!o.cargando&&0===o.listaEstatusPedido.length),_.xp6(1),_.Q6J("ngForOf",o.listaEstatusPedido),_.xp6(1),_.Q6J("ngIf",o.cargando))},directives:[Ri.O5,Ri.sg],pipes:[Ri.JJ],styles:[""]}),e})()},{path:"**",redirectTo:"dashboard"}]}];let gw=(()=>{class e{}return e.\u0275fac=function(r){return new(r||e)},e.\u0275mod=_.oAB({type:e}),e.\u0275inj=_.cJS({imports:[[xn.Bz.forChild(_w)],xn.Bz]}),e})(),xw=(()=>{class e{}return e.\u0275fac=function(r){return new(r||e)},e.\u0275mod=_.oAB({type:e}),e.\u0275inj=_.cJS({imports:[[Ri.ez,gw,ti.u5]]}),e})()},9898:function(Eg){Eg.exports=function(){"use strict";var Yc,gi,Ri;function ti(f,_){if(Yc)if(gi){var Ls="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+Yc+")(sharedChunk); ("+gi+")(sharedChunk); self.onerror = null;",sa={};Yc(sa),Ri=_(sa),"undefined"!=typeof window&&window&&window.URL&&window.URL.createObjectURL&&(Ri.workerUrl=window.URL.createObjectURL(new Blob([Ls],{type:"text/javascript"})))}else gi=_;else Yc=_}return ti(0,function(f){var _="2.8.2",Ls=sa;function sa(a,t,s,l){this.cx=3*a,this.bx=3*(s-a)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*t,this.by=3*(l-t)-this.cy,this.ay=1-this.cy-this.by,this.p1x=a,this.p1y=l,this.p2x=s,this.p2y=l}sa.prototype.sampleCurveX=function(a){return((this.ax*a+this.bx)*a+this.cx)*a},sa.prototype.sampleCurveY=function(a){return((this.ay*a+this.by)*a+this.cy)*a},sa.prototype.sampleCurveDerivativeX=function(a){return(3*this.ax*a+2*this.bx)*a+this.cx},sa.prototype.solveCurveX=function(a,t){var s,l,h,p,g;for(void 0===t&&(t=1e-6),h=a,g=0;g<8;g++){if(p=this.sampleCurveX(h)-a,Math.abs(p)<t)return h;var v=this.sampleCurveDerivativeX(h);if(Math.abs(v)<1e-6)break;h-=p/v}if((h=a)<(s=0))return s;if(h>(l=1))return l;for(;s<l;){if(p=this.sampleCurveX(h),Math.abs(p-a)<t)return h;a>p?s=h:l=h,h=.5*(l-s)+s}return h},sa.prototype.solve=function(a,t){return this.sampleCurveY(this.solveCurveX(a,t))};var ut=Rt;function Rt(a,t){this.x=a,this.y=t}Rt.prototype={clone:function(){return new Rt(this.x,this.y)},add:function(a){return this.clone()._add(a)},sub:function(a){return this.clone()._sub(a)},multByPoint:function(a){return this.clone()._multByPoint(a)},divByPoint:function(a){return this.clone()._divByPoint(a)},mult:function(a){return this.clone()._mult(a)},div:function(a){return this.clone()._div(a)},rotate:function(a){return this.clone()._rotate(a)},rotateAround:function(a,t){return this.clone()._rotateAround(a,t)},matMult:function(a){return this.clone()._matMult(a)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(a){return this.x===a.x&&this.y===a.y},dist:function(a){return Math.sqrt(this.distSqr(a))},distSqr:function(a){var t=a.x-this.x,s=a.y-this.y;return t*t+s*s},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(a){return Math.atan2(this.y-a.y,this.x-a.x)},angleWith:function(a){return this.angleWithSep(a.x,a.y)},angleWithSep:function(a,t){return Math.atan2(this.x*t-this.y*a,this.x*a+this.y*t)},_matMult:function(a){var t=a[2]*this.x+a[3]*this.y;return this.x=a[0]*this.x+a[1]*this.y,this.y=t,this},_add:function(a){return this.x+=a.x,this.y+=a.y,this},_sub:function(a){return this.x-=a.x,this.y-=a.y,this},_mult:function(a){return this.x*=a,this.y*=a,this},_div:function(a){return this.x/=a,this.y/=a,this},_multByPoint:function(a){return this.x*=a.x,this.y*=a.y,this},_divByPoint:function(a){return this.x/=a.x,this.y/=a.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var a=this.y;return this.y=this.x,this.x=-a,this},_rotate:function(a){var t=Math.cos(a),s=Math.sin(a),l=s*this.x+t*this.y;return this.x=t*this.x-s*this.y,this.y=l,this},_rotateAround:function(a,t){var s=Math.cos(a),l=Math.sin(a),h=t.y+l*(this.x-t.x)+s*(this.y-t.y);return this.x=t.x+s*(this.x-t.x)-l*(this.y-t.y),this.y=h,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},Rt.convert=function(a){return a instanceof Rt?a:Array.isArray(a)?new Rt(a[0],a[1]):a};var Zt="undefined"!=typeof self?self:{};const Ga=Math.PI/180,ki=180/Math.PI;function Pr(a){return a*Ga}function Gn(a){return a*ki}const ho=[[0,0],[1,0],[1,1],[0,1]];function fo(a){if(a<=0)return 0;if(a>=1)return 1;const t=a*a,s=t*a;return 4*(a<.5?s:3*(a-t)+s-.75)}function po(a,t,s,l){const h=new Ls(a,t,s,l);return function(p){return h.solve(p)}}const Ia=po(.25,.1,.25,1);function wr(a,t,s){return Math.min(s,Math.max(t,a))}function Ql(a,t,s){return(s=wr((s-a)/(t-a),0,1))*s*(3-2*s)}function Ma(a,t,s){const l=s-t,h=((a-t)%l+l)%l+t;return h===t?s:h}function rl(a,t,s){if(!a.length)return s(null,[]);let l=a.length;const h=new Array(a.length);let p=null;a.forEach((g,v)=>{t(g,(E,k)=>{E&&(p=E),h[v]=k,0==--l&&s(p,h)})})}function ec(a){const t=[];for(const s in a)t.push(a[s]);return t}function Gi(a,...t){for(const s of t)for(const l in s)a[l]=s[l];return a}let tc=1;function il(){return tc++}function Kc(){return function a(t){return t?(t^Math.random()*(16>>t/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,a)}()}function Jc(a){return a<=1?1:Math.pow(2,Math.ceil(Math.log(a)/Math.LN2))}function mo(a){return!!a&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(a)}function nl(a,t){a.forEach(s=>{t[s]&&(t[s]=t[s].bind(t))})}function Fa(a,t){return-1!==a.indexOf(t,a.length-t.length)}function Rs(a,t,s){const l={};for(const h in a)l[h]=t.call(s||this,a[h],h,a);return l}function rc(a,t,s){const l={};for(const h in a)t.call(s||this,a[h],h,a)&&(l[h]=a[h]);return l}function ma(a){return Array.isArray(a)?a.map(ma):"object"==typeof a&&a?Rs(a,ma):a}const Qc={};function Rr(a){Qc[a]||("undefined"!=typeof console&&console.warn(a),Qc[a]=!0)}function cn(a,t,s){return(s.y-a.y)*(t.x-a.x)>(t.y-a.y)*(s.x-a.x)}function Os(a){let t=0;for(let s,l,h=0,p=a.length,g=p-1;h<p;g=h++)s=a[h],l=a[g],t+=(l.x-s.x)*(s.y+l.y);return t}function Da(){return"undefined"!=typeof WorkerGlobalScope&&"undefined"!=typeof self&&self instanceof WorkerGlobalScope}function al(a){const t={};if(a.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(s,l,h,p)=>{const g=h||p;return t[l]=!g||g.toLowerCase(),""}),t["max-age"]){const s=parseInt(t["max-age"],10);isNaN(s)?delete t["max-age"]:t["max-age"]=s}return t}let zs,ic,Bs,$a,Tr=null;function kn(a){if(null==Tr){const t=a.navigator?a.navigator.userAgent:null;Tr=!!a.safari||!(!t||!(/\b(iPad|iPhone|iPod)\b/.test(t)||t.match("Safari")&&!t.match("Chrome")))}return Tr}function eu(a){try{const t=Zt[a];return t.setItem("_mapbox_test_",1),t.removeItem("_mapbox_test_"),!0}catch(t){return!1}}const $n={now:()=>void 0!==Bs?Bs:Zt.performance.now(),setNow(a){Bs=a},restoreNow(){Bs=void 0},frame(a){const t=Zt.requestAnimationFrame(a);return{cancel:()=>Zt.cancelAnimationFrame(t)}},getImageData(a,t=0){const{width:s,height:l}=a;$a||($a=Zt.document.createElement("canvas"));const h=$a.getContext("2d");if(!h)throw new Error("failed to create canvas 2d context");return(s>$a.width||l>$a.height)&&($a.width=s,$a.height=l),h.clearRect(-t,-t,s+2*t,l+2*t),h.drawImage(a,0,0,s,l),h.getImageData(-t,-t,s+2*t,l+2*t)},resolveURL:a=>(zs||(zs=Zt.document.createElement("a")),zs.href=a,zs.href),get devicePixelRatio(){return Zt.devicePixelRatio},get prefersReducedMotion(){return!!Zt.matchMedia&&(null==ic&&(ic=Zt.matchMedia("(prefers-reduced-motion: reduce)")),ic.matches)}};let _o;const Br={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){if(null==_o){const a=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;try{_o=null!=process.env.API_URL_REGEX?new RegExp(process.env.API_URL_REGEX):a}catch(t){_o=a}}return _o},get EVENTS_URL(){return this.API_URL?0===this.API_URL.indexOf("https://api.mapbox.cn")?"https://events.mapbox.cn/events/v2":0===this.API_URL.indexOf("https://api.mapbox.com")?"https://events.mapbox.com/events/v2":null:null},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,MAX_PARALLEL_IMAGE_REQUESTS:16},Ns={supported:!1,testSupport:function(a){!xo&&_a&&(sl?nc(a):go=a)}};let go,_a,xo=!1,sl=!1;function nc(a){const t=a.createTexture();a.bindTexture(a.TEXTURE_2D,t);try{if(a.texImage2D(a.TEXTURE_2D,0,a.RGBA,a.RGBA,a.UNSIGNED_BYTE,_a),a.isContextLost())return;Ns.supported=!0}catch(s){}a.deleteTexture(t),xo=!0}Zt.document&&(_a=Zt.document.createElement("img"),_a.onload=function(){go&&nc(go),go=null,sl=!0},_a.onerror=function(){xo=!0,go=null},_a.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const ol="01",yo="NO_ACCESS_TOKEN";function Pa(a){return 0===a.indexOf("mapbox:")}function vo(a){return Br.API_URL_REGEX.test(a)}const La=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function Ra(a){const t=a.match(La);if(!t)throw new Error("Unable to parse URL object");return{protocol:t[1],authority:t[2],path:t[3]||"/",params:t[4]?t[4].split("&"):[]}}function Us(a){const t=a.params.length?`?${a.params.join("&")}`:"";return`${a.protocol}://${a.authority}${a.path}${t}`}function ac(a){if(!a)return null;const t=a.split(".");if(!t||3!==t.length)return null;try{return JSON.parse(decodeURIComponent(Zt.atob(t[1]).split("").map(s=>"%"+("00"+s.charCodeAt(0).toString(16)).slice(-2)).join("")))}catch(s){return null}}class wo{constructor(t){this.type=t,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(t){const s=ac(Br.ACCESS_TOKEN);let l="";return l=s&&s.u?Zt.btoa(encodeURIComponent(s.u).replace(/%([0-9A-F]{2})/g,(h,p)=>String.fromCharCode(Number("0x"+p)))):Br.ACCESS_TOKEN||"",t?`mapbox.eventData.${t}:${l}`:`mapbox.eventData:${l}`}fetchEventData(){const t=eu("localStorage"),s=this.getStorageKey(),l=this.getStorageKey("uuid");if(t)try{const h=Zt.localStorage.getItem(s);h&&(this.eventData=JSON.parse(h));const p=Zt.localStorage.getItem(l);p&&(this.anonId=p)}catch(h){Rr("Unable to read from LocalStorage")}}saveEventData(){const t=eu("localStorage"),s=this.getStorageKey(),l=this.getStorageKey("uuid");if(t)try{Zt.localStorage.setItem(l,this.anonId),Object.keys(this.eventData).length>=1&&Zt.localStorage.setItem(s,JSON.stringify(this.eventData))}catch(h){Rr("Unable to write to LocalStorage")}}processRequests(t){}postEvent(t,s,l,h){if(!Br.EVENTS_URL)return;const p=Ra(Br.EVENTS_URL);p.params.push(`access_token=${h||Br.ACCESS_TOKEN||""}`);const g={event:this.type,created:new Date(t).toISOString(),sdkIdentifier:"mapbox-gl-js",sdkVersion:_,skuId:ol,userId:this.anonId},v=s?Gi(g,s):g,E={url:Us(p),headers:{"Content-Type":"text/plain"},body:JSON.stringify([v])};this.pendingRequest=Ee(E,k=>{this.pendingRequest=null,l(k),this.saveEventData(),this.processRequests(h)})}queueRequest(t,s){this.queue.push(t),this.processRequests(s)}}const ll=new class extends wo{constructor(a){super("appUserTurnstile"),this._customAccessToken=a}postTurnstileEvent(a,t){Br.EVENTS_URL&&Br.ACCESS_TOKEN&&Array.isArray(a)&&a.some(s=>Pa(s)||vo(s))&&this.queueRequest(Date.now(),t)}processRequests(a){if(this.pendingRequest||0===this.queue.length)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const t=ac(Br.ACCESS_TOKEN),s=t?t.u:Br.ACCESS_TOKEN;let l=s!==this.eventData.tokenU;mo(this.anonId)||(this.anonId=Kc(),l=!0);const h=this.queue.shift();if(this.eventData.lastSuccess){const p=new Date(this.eventData.lastSuccess),g=new Date(h),v=(h-this.eventData.lastSuccess)/864e5;l=l||v>=1||v<-1||p.getDate()!==g.getDate()}else l=!0;l?this.postEvent(h,{"enabled.telemetry":!1},p=>{p||(this.eventData.lastSuccess=h,this.eventData.tokenU=s)},a):this.processRequests()}},un=ll.postTurnstileEvent.bind(ll),sc=new class extends wo{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(a,t,s,l){this.skuToken=t,this.errorCb=l,Br.EVENTS_URL&&(s||Br.ACCESS_TOKEN?this.queueRequest({id:a,timestamp:Date.now()},s):this.errorCb(new Error(yo)))}processRequests(a){if(this.pendingRequest||0===this.queue.length)return;const{id:t,timestamp:s}=this.queue.shift();t&&this.success[t]||(this.anonId||this.fetchEventData(),mo(this.anonId)||(this.anonId=Kc()),this.postEvent(s,{skuToken:this.skuToken},l=>{l?this.errorCb(l):t&&(this.success[t]=!0)},a))}},tu=sc.postMapLoadEvent.bind(sc),cl=new class extends wo{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(a,t,s,l){if(!Br.API_URL||!Br.SESSION_PATH)return;const h=Ra(Br.API_URL+Br.SESSION_PATH);h.params.push(`sku=${t||""}`),h.params.push(`access_token=${l||Br.ACCESS_TOKEN||""}`);const p={url:Us(h),headers:{"Content-Type":"text/plain"}};this.pendingRequest=Oe(p,g=>{this.pendingRequest=null,s(g),this.saveEventData(),this.processRequests(l)})}getSessionAPI(a,t,s,l){this.skuToken=t,this.errorCb=l,Br.SESSION_PATH&&Br.API_URL&&(s||Br.ACCESS_TOKEN?this.queueRequest({id:a,timestamp:Date.now()},s):this.errorCb(new Error(yo)))}processRequests(a){if(this.pendingRequest||0===this.queue.length)return;const{id:t,timestamp:s}=this.queue.shift();t&&this.success[t]||this.getSession(s,this.skuToken,l=>{l?this.errorCb(l):t&&(this.success[t]=!0)},a)}},ru=cl.getSessionAPI.bind(cl),bo=new Set,iu="mapbox-tiles";let Oa,Zs,Vs=500,To=50;function ul(){Zt.caches&&!Oa&&(Oa=Zt.caches.open(iu))}function oc(a){const t=a.indexOf("?");return t<0?a:a.slice(0,t)}let hl=1/0;const ae={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};"function"==typeof Object.freeze&&Object.freeze(ae);class Z extends Error{constructor(t,s,l){401===s&&vo(l)&&(t+=": you may have provided an invalid Mapbox access token. See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes"),super(t),this.status=s,this.url=l}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const G=Da()?()=>self.worker&&self.worker.referrer:()=>("blob:"===Zt.location.protocol?Zt.parent:Zt).location.href,re=function(a,t){if(!(/^file:/.test(s=a.url)||/^file:/.test(G())&&!/^\w+:/.test(s))){if(Zt.fetch&&Zt.Request&&Zt.AbortController&&Zt.Request.prototype.hasOwnProperty("signal"))return function(l,h){const p=new Zt.AbortController,g=new Zt.Request(l.url,{method:l.method||"GET",body:l.body,credentials:l.credentials,headers:l.headers,referrer:G(),signal:p.signal});let v=!1,E=!1;const k=(M=g.url).indexOf("sku=")>0&&vo(M);var M;"json"===l.type&&g.headers.set("Accept","application/json");const D=(z,q,K)=>{if(E)return;if(z&&"SecurityError"!==z.message&&Rr(z),q&&K)return R(q);const ee=Date.now();Zt.fetch(g).then(ne=>{if(ne.ok){const ve=k?ne.clone():null;return R(ne,ve,ee)}return h(new Z(ne.statusText,ne.status,l.url))}).catch(ne=>{20!==ne.code&&h(new Error(ne.message))})},R=(z,q,K)=>{("arrayBuffer"===l.type?z.arrayBuffer():"json"===l.type?z.json():z.text()).then(ee=>{E||(q&&K&&function(ne,ve,Ae){if(ul(),!Oa)return;const Me={status:ve.status,statusText:ve.statusText,headers:new Zt.Headers};ve.headers.forEach((Xe,He)=>Me.headers.set(He,Xe));const De=al(ve.headers.get("Cache-Control")||"");if(De["no-store"])return;De["max-age"]&&Me.headers.set("Expires",new Date(Ae+1e3*De["max-age"]).toUTCString());const Pe=Me.headers.get("Expires");Pe&&(new Date(Pe).getTime()-Ae<42e4||function(Xe,He){if(void 0===Zs)try{new Response(new ReadableStream),Zs=!0}catch(st){Zs=!1}Zs?He(Xe.body):Xe.blob().then(He)}(ve,Xe=>{const He=new Zt.Response(Xe,Me);ul(),Oa&&Oa.then(st=>st.put(oc(ne.url),He)).catch(st=>Rr(st.message))}))}(g,q,K),v=!0,h(null,ee,z.headers.get("Cache-Control"),z.headers.get("Expires")))}).catch(ee=>{E||h(new Error(ee.message))})};return k?function(z,q){if(ul(),!Oa)return q(null);const K=oc(z.url);Oa.then(ee=>{ee.match(K).then(ne=>{const ve=function(Ae){if(!Ae)return!1;const Me=new Date(Ae.headers.get("Expires")||0),De=al(Ae.headers.get("Cache-Control")||"");return Me>Date.now()&&!De["no-cache"]}(ne);ee.delete(K),ve&&ee.put(K,ne.clone()),q(null,ne,ve)}).catch(q)}).catch(q)}(g,D):D(null,null),{cancel:()=>{E=!0,v||p.abort()}}}(a,t);if(Da()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",a,t,void 0,!0)}var s;return function(l,h){const p=new Zt.XMLHttpRequest;p.open(l.method||"GET",l.url,!0),"arrayBuffer"===l.type&&(p.responseType="arraybuffer");for(const g in l.headers)p.setRequestHeader(g,l.headers[g]);return"json"===l.type&&(p.responseType="text",p.setRequestHeader("Accept","application/json")),p.withCredentials="include"===l.credentials,p.onerror=()=>{h(new Error(p.statusText))},p.onload=()=>{if((p.status>=200&&p.status<300||0===p.status)&&null!==p.response){let g=p.response;if("json"===l.type)try{g=JSON.parse(p.response)}catch(v){return h(v)}h(null,g,p.getResponseHeader("Cache-Control"),p.getResponseHeader("Expires"))}else h(new Z(p.statusText,p.status,l.url))},p.send(l.body),{cancel:()=>p.abort()}}(a,t)},pe=function(a,t){return re(Gi(a,{type:"arrayBuffer"}),t)},Ee=function(a,t){return re(Gi(a,{method:"POST"}),t)},Oe=function(a,t){return re(Gi(a,{method:"GET"}),t)};function Re(a){const t=Zt.document.createElement("a");return t.href=a,t.protocol===Zt.document.location.protocol&&t.host===Zt.document.location.host}const Ce="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let Ne,lt;Ne=[],lt=0;const kt=function(a,t){if(Ns.supported&&(a.headers||(a.headers={}),a.headers.accept="image/webp,*/*"),lt>=Br.MAX_PARALLEL_IMAGE_REQUESTS){const p={requestParameters:a,callback:t,cancelled:!1,cancel(){this.cancelled=!0}};return Ne.push(p),p}lt++;let s=!1;const l=()=>{if(!s)for(s=!0,lt--;Ne.length&&lt<Br.MAX_PARALLEL_IMAGE_REQUESTS;){const p=Ne.shift(),{requestParameters:g,callback:v,cancelled:E}=p;E||(p.cancel=kt(g,v).cancel)}},h=pe(a,(p,g,v,E)=>{l(),p?t(p):g&&(Zt.createImageBitmap?function(k,M){const D=new Zt.Blob([new Uint8Array(k)],{type:"image/png"});Zt.createImageBitmap(D).then(R=>{M(null,R)}).catch(R=>{M(new Error(`Could not load image because of ${R.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(g,(k,M)=>t(k,M,v,E)):function(k,M){const D=new Zt.Image,R=Zt.URL;D.onload=()=>{M(null,D),R.revokeObjectURL(D.src),D.onload=null,Zt.requestAnimationFrame(()=>{D.src=Ce})},D.onerror=()=>M(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const z=new Zt.Blob([new Uint8Array(k)],{type:"image/png"});D.src=k.byteLength?R.createObjectURL(z):Ce}(g,(k,M)=>t(k,M,v,E)))});return{cancel:()=>{h.cancel(),l()}}};function mt(a,t,s){s[a]&&-1!==s[a].indexOf(t)||(s[a]=s[a]||[],s[a].push(t))}function tr(a,t,s){if(s&&s[a]){const l=s[a].indexOf(t);-1!==l&&s[a].splice(l,1)}}class Yt{constructor(t,s={}){Gi(this,s),this.type=t}}class Kt extends Yt{constructor(t,s={}){super("error",Gi({error:t},s))}}class nr{on(t,s){return this._listeners=this._listeners||{},mt(t,s,this._listeners),this}off(t,s){return tr(t,s,this._listeners),tr(t,s,this._oneTimeListeners),this}once(t,s){return s?(this._oneTimeListeners=this._oneTimeListeners||{},mt(t,s,this._oneTimeListeners),this):new Promise(l=>this.once(t,l))}fire(t,s){"string"==typeof t&&(t=new Yt(t,s||{}));const l=t.type;if(this.listens(l)){t.target=this;const h=this._listeners&&this._listeners[l]?this._listeners[l].slice():[];for(const v of h)v.call(this,t);const p=this._oneTimeListeners&&this._oneTimeListeners[l]?this._oneTimeListeners[l].slice():[];for(const v of p)tr(l,v,this._oneTimeListeners),v.call(this,t);const g=this._eventedParent;g&&(Gi(t,"function"==typeof this._eventedParentData?this._eventedParentData():this._eventedParentData),g.fire(t))}else t instanceof Kt&&console.error(t.error);return this}listens(t){return!!(this._listeners&&this._listeners[t]&&this._listeners[t].length>0||this._oneTimeListeners&&this._oneTimeListeners[t]&&this._oneTimeListeners[t].length>0||this._eventedParent&&this._eventedParent.listens(t))}setEventedParent(t,s){return this._eventedParent=t,this._eventedParentData=s,this}}var Ze=JSON.parse('{"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8]},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360,"units":"degrees"},"pitch":{"type":"number","default":0,"units":"degrees"},"light":{"type":"light"},"terrain":{"type":"terrain"},"fog":{"type":"fog"},"sources":{"required":true,"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"required":true,"type":"array","value":"layer"}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],"source_vector":{"type":{"required":true,"type":"enum","values":{"vector":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"required":true,"type":"enum","values":{"raster":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"required":true,"type":"enum","values":{"raster-dem":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":{},"mapbox":{}},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":{}}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":{}}},"urls":{"required":true,"type":"array","value":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":{}}},"url":{"required":true,"type":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"layer":{"id":{"type":"string","required":true},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"raster":{},"hillshade":{},"background":{},"sky":{}},"required":true},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background","layout_sky"],"layout_background":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":{},"round":{},"square":{}},"default":"butt","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":{},"round":{},"miter":{}},"default":"miter","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"requires":[{"line-join":"miter"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-round-limit":{"type":"number","default":1.05,"requires":[{"line-join":"round"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":{},"line":{},"line-center":{}},"default":"point","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"units":"pixels","requires":[{"symbol-placement":"line"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":{},"viewport-y":{},"source":{}},"default":"auto","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-optional":{"type":"boolean","default":false,"requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-size":{"type":"number","default":1,"minimum":0,"units":"factor of the original icon size","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{"type":"enum","values":{"none":{},"width":{},"height":{},"both":{}},"default":"none","requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"units":"pixels","requires":["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{"type":"boolean","default":false,"requires":["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{"type":"number","default":10,"minimum":0,"units":"ems","requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":{},"left":{},"center":{},"right":{}},"default":"center","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","units":"ems","default":0,"requires":["text-field"],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["text-field",{"!":"text-variable-anchor"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"units":"degrees","requires":["text-field",{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":{},"vertical":{}},"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-keep-upright":{"type":"boolean","default":true,"requires":["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-transform":{"type":"enum","values":{"none":{},"uppercase":{},"lowercase":{}},"default":"none","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","units":"ems","length":2,"default":[0,0],"requires":["text-field",{"!":"text-radial-offset"}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-optional":{"type":"boolean","default":false,"requires":["text-field","icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},"in":{},"!in":{},"all":{},"any":{},"none":{},"has":{},"!has":{},"within":{}}},"geometry_type":{"type":"enum","values":{"Point":{},"LineString":{},"Polygon":{}}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":{},"exponential":{},"interval":{},"categorical":{}},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":{},"lab":{},"hcl":{}},"default":"rgb"},"default":{"type":"*","required":false}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"horizon-blend":{"type":"number","property-type":"data-constant","default":0.1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":{},"viewport":{}},"property-type":"data-constant","transition":false,"expression":{"interpolated":false,"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":{},"equalEarth":{},"equirectangular":{},"lambertConformalConic":{},"mercator":{},"naturalEarth":{},"winkelTripel":{}},"default":"mercator","required":true},"center":{"type":"array","length":2,"value":"number","property-type":"data-constant","transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]},"parallels":{"type":"array","length":2,"value":"number","property-type":"data-constant","transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]}},"terrain":{"source":{"type":"string","required":true},"exaggeration":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background","paint_sky"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"requires":[{"!":"fill-pattern"},{"fill-antialias":true}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-extrusion-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-extrusion-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"requires":["fill-extrusion-height"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"line-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["line-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"transition":true,"units":"line widths","requires":[{"!":"line-pattern"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{"type":"color","transition":false,"requires":[{"!":"line-pattern"},{"source":"geojson","has":{"lineMetrics":true}}],"expression":{"interpolated":true,"parameters":["line-progress"]},"property-type":"color-ramp"}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["circle-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"transition":false,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"transition":false,"expression":{"interpolated":true,"parameters":["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["icon-image","icon-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["text-field","text-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"units":"degrees","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-resampling":{"type":"enum","values":{"linear":{},"nearest":{}},"default":"linear","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"transition":false,"units":"milliseconds","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"transition":false,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_background":{"background-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"background-pattern"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"cross-faded"},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":{},"atmosphere":{}},"default":"atmosphere","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"requires":[{"sky-type":"atmosphere"}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{"type":"number","requires":[{"sky-type":"atmosphere"}],"default":10,"minimum":0,"maximum":100,"transition":false,"property-type":"data-constant"},"sky-gradient-center":{"type":"array","requires":[{"sky-type":"gradient"}],"value":"number","default":[0,0],"length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{"type":"number","requires":[{"sky-type":"gradient"}],"default":90,"minimum":0,"maximum":180,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"transition":false,"requires":[{"sky-type":"gradient"}],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-atmosphere-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"transition":{"duration":{"type":"number","default":300,"minimum":0,"units":"milliseconds"},"delay":{"type":"number","default":0,"minimum":0,"units":"milliseconds"}},"property-type":{"data-driven":{"type":"property-type"},"cross-faded":{"type":"property-type"},"cross-faded-data-driven":{"type":"property-type"},"color-ramp":{"type":"property-type"},"data-constant":{"type":"property-type"},"constant":{"type":"property-type"}},"promoteId":{"*":{"type":"string"}}}');function Nr(a,...t){for(const s of t)for(const l in s)a[l]=s[l];return a}function Vt(a){return a instanceof Number||a instanceof String||a instanceof Boolean?a.valueOf():a}function Or(a){if(Array.isArray(a))return a.map(Or);if(a instanceof Object&&!(a instanceof Number||a instanceof String||a instanceof Boolean)){const t={};for(const s in a)t[s]=Or(a[s]);return t}return Vt(a)}class Ur extends Error{constructor(t,s){super(s),this.message=s,this.key=t}}class Eo{constructor(t,s=[]){this.parent=t,this.bindings={};for(const[l,h]of s)this.bindings[l]=h}concat(t){return new Eo(this,t)}get(t){if(this.bindings[t])return this.bindings[t];if(this.parent)return this.parent.get(t);throw new Error(`${t} not found in scope.`)}has(t){return!!this.bindings[t]||!!this.parent&&this.parent.has(t)}}const as={kind:"null"},Tt={kind:"number"},Cr={kind:"string"},yr={kind:"boolean"},Wa={kind:"color"},So={kind:"object"},br={kind:"value"},Ao={kind:"collator"},fl={kind:"formatted"},Cn={kind:"resolvedImage"};function yn(a,t){return{kind:"array",itemType:a,N:t}}function Lr(a){if("array"===a.kind){const t=Lr(a.itemType);return"number"==typeof a.N?`array<${t}, ${a.N}>`:"value"===a.itemType.kind?"array":`array<${t}>`}return a.kind}const ko=[as,Tt,Cr,yr,Wa,fl,So,yn(br),Cn];function lc(a,t){if("error"===t.kind)return null;if("array"===a.kind){if("array"===t.kind&&(0===t.N&&"value"===t.itemType.kind||!lc(a.itemType,t.itemType))&&("number"!=typeof a.N||a.N===t.N))return null}else{if(a.kind===t.kind)return null;if("value"===a.kind)for(const s of ko)if(!lc(s,t))return null}return`Expected ${Lr(a)} but found ${Lr(t)} instead.`}function dl(a,t){return t.some(s=>s.kind===a.kind)}function ss(a,t){return t.some(s=>"null"===s?null===a:"array"===s?Array.isArray(a):"object"===s?a&&!Array.isArray(a)&&"object"==typeof a:s===typeof a)}function nu(a){var t={exports:{}};return a(t,t.exports),t.exports}var Wn=nu(function(a,t){var s={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function l(v){return(v=Math.round(v))<0?0:v>255?255:v}function h(v){return l("%"===v[v.length-1]?parseFloat(v)/100*255:parseInt(v))}function p(v){return(E="%"===v[v.length-1]?parseFloat(v)/100:parseFloat(v))<0?0:E>1?1:E;var E}function g(v,E,k){return k<0?k+=1:k>1&&(k-=1),6*k<1?v+(E-v)*k*6:2*k<1?E:3*k<2?v+(E-v)*(2/3-k)*6:v}try{t.parseCSSColor=function(v){var E,k=v.replace(/ /g,"").toLowerCase();if(k in s)return s[k].slice();if("#"===k[0])return 4===k.length?(E=parseInt(k.substr(1),16))>=0&&E<=4095?[(3840&E)>>4|(3840&E)>>8,240&E|(240&E)>>4,15&E|(15&E)<<4,1]:null:7===k.length&&(E=parseInt(k.substr(1),16))>=0&&E<=16777215?[(16711680&E)>>16,(65280&E)>>8,255&E,1]:null;var M=k.indexOf("("),D=k.indexOf(")");if(-1!==M&&D+1===k.length){var R=k.substr(0,M),z=k.substr(M+1,D-(M+1)).split(","),q=1;switch(R){case"rgba":if(4!==z.length)return null;q=p(z.pop());case"rgb":return 3!==z.length?null:[h(z[0]),h(z[1]),h(z[2]),q];case"hsla":if(4!==z.length)return null;q=p(z.pop());case"hsl":if(3!==z.length)return null;var K=(parseFloat(z[0])%360+360)%360/360,ee=p(z[1]),ne=p(z[2]),ve=ne<=.5?ne*(ee+1):ne+ee-ne*ee,Ae=2*ne-ve;return[l(255*g(Ae,ve,K+1/3)),l(255*g(Ae,ve,K)),l(255*g(Ae,ve,K-1/3)),q];default:return null}}return null}}catch(v){}});class Fr{constructor(t,s,l,h=1){this.r=t,this.g=s,this.b=l,this.a=h}static parse(t){if(!t)return;if(t instanceof Fr)return t;if("string"!=typeof t)return;const s=Wn.parseCSSColor(t);return s?new Fr(s[0]/255*s[3],s[1]/255*s[3],s[2]/255*s[3],s[3]):void 0}toString(){const[t,s,l,h]=this.toArray();return`rgba(${Math.round(t)},${Math.round(s)},${Math.round(l)},${h})`}toArray(){const{r:t,g:s,b:l,a:h}=this;return 0===h?[0,0,0,0]:[255*t/h,255*s/h,255*l/h,h]}}Fr.black=new Fr(0,0,0,1),Fr.white=new Fr(1,1,1,1),Fr.transparent=new Fr(0,0,0,0),Fr.red=new Fr(1,0,0,1),Fr.blue=new Fr(0,0,1,1);class os{constructor(t,s,l){this.sensitivity=t?s?"variant":"case":s?"accent":"base",this.locale=l,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(t,s){return this.collator.compare(t,s)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class Hu{constructor(t,s,l,h,p){this.text=t.normalize?t.normalize():t,this.image=s,this.scale=l,this.fontStack=h,this.textColor=p}}class Oi{constructor(t){this.sections=t}static fromString(t){return new Oi([new Hu(t,null,null,null,null)])}isEmpty(){return 0===this.sections.length||!this.sections.some(t=>0!==t.text.length||t.image&&0!==t.image.name.length)}static factory(t){return t instanceof Oi?t:Oi.fromString(t)}toString(){return 0===this.sections.length?"":this.sections.map(t=>t.text).join("")}serialize(){const t=["format"];for(const s of this.sections){if(s.image){t.push(["image",s.image.name]);continue}t.push(s.text);const l={};s.fontStack&&(l["text-font"]=["literal",s.fontStack.split(",")]),s.scale&&(l["font-scale"]=s.scale),s.textColor&&(l["text-color"]=["rgba"].concat(s.textColor.toArray())),t.push(l)}return t}}class Ji{constructor(t){this.name=t.name,this.available=t.available}toString(){return this.name}static fromString(t){return t?new Ji({name:t,available:!1}):null}serialize(){return["image",this.name]}}function In(a,t,s,l){return"number"==typeof a&&a>=0&&a<=255&&"number"==typeof t&&t>=0&&t<=255&&"number"==typeof s&&s>=0&&s<=255?void 0===l||"number"==typeof l&&l>=0&&l<=1?null:`Invalid rgba value [${[a,t,s,l].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${("number"==typeof l?[a,t,s,l]:[a,t,s]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function pl(a){if(null===a||"string"==typeof a||"boolean"==typeof a||"number"==typeof a||a instanceof Fr||a instanceof os||a instanceof Oi||a instanceof Ji)return!0;if(Array.isArray(a)){for(const t of a)if(!pl(t))return!1;return!0}if("object"==typeof a){for(const t in a)if(!pl(a[t]))return!1;return!0}return!1}function lr(a){if(null===a)return as;if("string"==typeof a)return Cr;if("boolean"==typeof a)return yr;if("number"==typeof a)return Tt;if(a instanceof Fr)return Wa;if(a instanceof os)return Ao;if(a instanceof Oi)return fl;if(a instanceof Ji)return Cn;if(Array.isArray(a)){const t=a.length;let s;for(const l of a){const h=lr(l);if(s){if(s===h)continue;s=br;break}s=h}return yn(s||br,t)}return So}function js(a){const t=typeof a;return null===a?"":"string"===t||"number"===t||"boolean"===t?String(a):a instanceof Fr||a instanceof Oi||a instanceof Ji?a.toString():JSON.stringify(a)}class ri{constructor(t,s){this.type=t,this.value=s}static parse(t,s){if(2!==t.length)return s.error(`'literal' expression requires exactly one argument, but found ${t.length-1} instead.`);if(!pl(t[1]))return s.error("invalid value");const l=t[1];let h=lr(l);const p=s.expectedType;return"array"!==h.kind||0!==h.N||!p||"array"!==p.kind||"number"==typeof p.N&&0!==p.N||(h=p),new ri(h,l)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return"array"===this.type.kind||"object"===this.type.kind?["literal",this.value]:this.value instanceof Fr?["rgba"].concat(this.value.toArray()):this.value instanceof Oi?this.value.serialize():this.value}}class zi{constructor(t){this.name="ExpressionEvaluationError",this.message=t}toJSON(){return this.message}}const Xa={string:Cr,number:Tt,boolean:yr,object:So};class Mn{constructor(t,s){this.type=t,this.args=s}static parse(t,s){if(t.length<2)return s.error("Expected at least one argument.");let l,h=1;const p=t[0];if("array"===p){let v,E;if(t.length>2){const k=t[1];if("string"!=typeof k||!(k in Xa)||"object"===k)return s.error('The item type argument of "array" must be one of string, number, boolean',1);v=Xa[k],h++}else v=br;if(t.length>3){if(null!==t[2]&&("number"!=typeof t[2]||t[2]<0||t[2]!==Math.floor(t[2])))return s.error('The length argument to "array" must be a positive integer literal',2);E=t[2],h++}l=yn(v,E)}else l=Xa[p];const g=[];for(;h<t.length;h++){const v=s.parse(t[h],h,br);if(!v)return null;g.push(v)}return new Mn(l,g)}evaluate(t){for(let s=0;s<this.args.length;s++){const l=this.args[s].evaluate(t);if(!lc(this.type,lr(l)))return l;if(s===this.args.length-1)throw new zi(`Expected value to be of type ${Lr(this.type)}, but found ${Lr(lr(l))} instead.`)}return null}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}serialize(){const t=this.type,s=[t.kind];if("array"===t.kind){const l=t.itemType;if("string"===l.kind||"number"===l.kind||"boolean"===l.kind){s.push(l.kind);const h=t.N;("number"==typeof h||this.args.length>1)&&s.push(h)}}return s.concat(this.args.map(l=>l.serialize()))}}class Qi{constructor(t){this.type=fl,this.sections=t}static parse(t,s){if(t.length<2)return s.error("Expected at least one argument.");const l=t[1];if(!Array.isArray(l)&&"object"==typeof l)return s.error("First argument must be an image or text section.");const h=[];let p=!1;for(let g=1;g<=t.length-1;++g){const v=t[g];if(p&&"object"==typeof v&&!Array.isArray(v)){p=!1;let E=null;if(v["font-scale"]&&(E=s.parse(v["font-scale"],1,Tt),!E))return null;let k=null;if(v["text-font"]&&(k=s.parse(v["text-font"],1,yn(Cr)),!k))return null;let M=null;if(v["text-color"]&&(M=s.parse(v["text-color"],1,Wa),!M))return null;const D=h[h.length-1];D.scale=E,D.font=k,D.textColor=M}else{const E=s.parse(t[g],1,br);if(!E)return null;const k=E.type.kind;if("string"!==k&&"value"!==k&&"null"!==k&&"resolvedImage"!==k)return s.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");p=!0,h.push({content:E,scale:null,font:null,textColor:null})}}return new Qi(h)}evaluate(t){return new Oi(this.sections.map(s=>{const l=s.content.evaluate(t);return lr(l)===Cn?new Hu("",l,null,null,null):new Hu(js(l),null,s.scale?s.scale.evaluate(t):null,s.font?s.font.evaluate(t).join(","):null,s.textColor?s.textColor.evaluate(t):null)}))}eachChild(t){for(const s of this.sections)t(s.content),s.scale&&t(s.scale),s.font&&t(s.font),s.textColor&&t(s.textColor)}outputDefined(){return!1}serialize(){const t=["format"];for(const s of this.sections){t.push(s.content.serialize());const l={};s.scale&&(l["font-scale"]=s.scale.serialize()),s.font&&(l["text-font"]=s.font.serialize()),s.textColor&&(l["text-color"]=s.textColor.serialize()),t.push(l)}return t}}class _r{constructor(t){this.type=Cn,this.input=t}static parse(t,s){if(2!==t.length)return s.error("Expected two arguments.");const l=s.parse(t[1],1,Cr);return l?new _r(l):s.error("No image name provided.")}evaluate(t){const s=this.input.evaluate(t),l=Ji.fromString(s);return l&&t.availableImages&&(l.available=t.availableImages.indexOf(s)>-1),l}eachChild(t){t(this.input)}outputDefined(){return!1}serialize(){return["image",this.input.serialize()]}}const ls={"to-boolean":yr,"to-color":Wa,"to-number":Tt,"to-string":Cr};class en{constructor(t,s){this.type=t,this.args=s}static parse(t,s){if(t.length<2)return s.error("Expected at least one argument.");const l=t[0];if(("to-boolean"===l||"to-string"===l)&&2!==t.length)return s.error("Expected one argument.");const h=ls[l],p=[];for(let g=1;g<t.length;g++){const v=s.parse(t[g],g,br);if(!v)return null;p.push(v)}return new en(h,p)}evaluate(t){if("boolean"===this.type.kind)return Boolean(this.args[0].evaluate(t));if("color"===this.type.kind){let s,l;for(const h of this.args){if(s=h.evaluate(t),l=null,s instanceof Fr)return s;if("string"==typeof s){const p=t.parseColor(s);if(p)return p}else if(Array.isArray(s)&&(l=s.length<3||s.length>4?`Invalid rbga value ${JSON.stringify(s)}: expected an array containing either three or four numeric values.`:In(s[0],s[1],s[2],s[3]),!l))return new Fr(s[0]/255,s[1]/255,s[2]/255,s[3])}throw new zi(l||`Could not parse color from value '${"string"==typeof s?s:String(JSON.stringify(s))}'`)}if("number"===this.type.kind){let s=null;for(const l of this.args){if(s=l.evaluate(t),null===s)return 0;const h=Number(s);if(!isNaN(h))return h}throw new zi(`Could not convert ${JSON.stringify(s)} to number.`)}return"formatted"===this.type.kind?Oi.fromString(js(this.args[0].evaluate(t))):"resolvedImage"===this.type.kind?Ji.fromString(js(this.args[0].evaluate(t))):js(this.args[0].evaluate(t))}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}serialize(){if("formatted"===this.type.kind)return new Qi([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if("resolvedImage"===this.type.kind)return new _r(this.args[0]).serialize();const t=[`to-${this.type.kind}`];return this.eachChild(s=>{t.push(s.serialize())}),t}}const ef=["Unknown","Point","LineString","Polygon"];class Xn{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null}id(){return this.feature&&"id"in this.feature&&this.feature.id?this.feature.id:null}geometryType(){return this.feature?"number"==typeof this.feature.type?ef[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const t=this.featureDistanceData.center,s=this.featureDistanceData.scale,{x:l,y:h}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(l*s-t[0])+this.featureDistanceData.bearing[1]*(h*s-t[1])}return 0}parseColor(t){let s=this._parseColorCache[t];return s||(s=this._parseColorCache[t]=Fr.parse(t)),s}}class hn{constructor(t,s,l,h){this.name=t,this.type=s,this._evaluate=l,this.args=h}evaluate(t){return this._evaluate(t,this.args)}eachChild(t){this.args.forEach(t)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(t=>t.serialize()))}static parse(t,s){const l=t[0],h=hn.definitions[l];if(!h)return s.error(`Unknown expression "${l}". If you wanted a literal array, use ["literal", [...]].`,0);const p=Array.isArray(h)?h[0]:h.type,g=Array.isArray(h)?[[h[1],h[2]]]:h.overloads,v=g.filter(([k])=>!Array.isArray(k)||k.length===t.length-1);let E=null;for(const[k,M]of v){E=new Ba(s.registry,s.path,null,s.scope);const D=[];let R=!1;for(let z=1;z<t.length;z++){const q=t[z],K=Array.isArray(k)?k[z-1]:k.type,ee=E.parse(q,1+D.length,K);if(!ee){R=!0;break}D.push(ee)}if(!R)if(Array.isArray(k)&&k.length!==D.length)E.error(`Expected ${k.length} arguments, but found ${D.length} instead.`);else{for(let z=0;z<D.length;z++){const q=Array.isArray(k)?k[z]:k.type,K=D[z];E.concat(z+1).checkSubtype(q,K.type)}if(0===E.errors.length)return new hn(l,p,M,D)}}if(1===v.length)s.errors.push(...E.errors);else{const k=(v.length?v:g).map(([D])=>{return R=D,Array.isArray(R)?`(${R.map(Lr).join(", ")})`:`(${Lr(R.type)}...)`;var R}).join(" | "),M=[];for(let D=1;D<t.length;D++){const R=s.parse(t[D],1+M.length);if(!R)return null;M.push(Lr(R.type))}s.error(`Expected arguments of type ${k}, but found (${M.join(", ")}) instead.`)}return null}static register(t,s){hn.definitions=s;for(const l in s)t[l]=hn}}class za{constructor(t,s,l){this.type=Ao,this.locale=l,this.caseSensitive=t,this.diacriticSensitive=s}static parse(t,s){if(2!==t.length)return s.error("Expected one argument.");const l=t[1];if("object"!=typeof l||Array.isArray(l))return s.error("Collator options argument must be an object.");const h=s.parse(void 0!==l["case-sensitive"]&&l["case-sensitive"],1,yr);if(!h)return null;const p=s.parse(void 0!==l["diacritic-sensitive"]&&l["diacritic-sensitive"],1,yr);if(!p)return null;let g=null;return l.locale&&(g=s.parse(l.locale,1,Cr),!g)?null:new za(h,p,g)}evaluate(t){return new os(this.caseSensitive.evaluate(t),this.diacriticSensitive.evaluate(t),this.locale?this.locale.evaluate(t):null)}eachChild(t){t(this.caseSensitive),t(this.diacriticSensitive),this.locale&&t(this.locale)}outputDefined(){return!1}serialize(){const t={};return t["case-sensitive"]=this.caseSensitive.serialize(),t["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(t.locale=this.locale.serialize()),["collator",t]}}const qs=8192;function cc(a,t){a[0]=Math.min(a[0],t[0]),a[1]=Math.min(a[1],t[1]),a[2]=Math.max(a[2],t[0]),a[3]=Math.max(a[3],t[1])}function Bi(a,t){return!(a[0]<=t[0]||a[2]>=t[2]||a[1]<=t[1]||a[3]>=t[3])}function tf(a,t){const s=(180+a[0])/360,l=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+a[1]*Math.PI/360)))/360,h=Math.pow(2,t.z);return[Math.round(s*h*qs),Math.round(l*h*qs)]}function Hi(a,t,s){const l=a[0]-t[0],h=a[1]-t[1],p=a[0]-s[0],g=a[1]-s[1];return l*g-p*h==0&&l*p<=0&&h*g<=0}function Co(a,t){let s=!1;for(let g=0,v=t.length;g<v;g++){const E=t[g];for(let k=0,M=E.length;k<M-1;k++){if(Hi(a,E[k],E[k+1]))return!1;(h=E[k])[1]>(l=a)[1]!=(p=E[k+1])[1]>l[1]&&l[0]<(p[0]-h[0])*(l[1]-h[1])/(p[1]-h[1])+h[0]&&(s=!s)}}var l,h,p;return s}function ml(a,t){for(let s=0;s<t.length;s++)if(Co(a,t[s]))return!0;return!1}function ga(a,t,s,l){const h=l[0]-s[0],p=l[1]-s[1],g=(a[0]-s[0])*p-h*(a[1]-s[1]),v=(t[0]-s[0])*p-h*(t[1]-s[1]);return g>0&&v<0||g<0&&v>0}function Yu(a,t,s){for(const k of s)for(let M=0;M<k.length-1;++M)if((v=[(g=k[M+1])[0]-(p=k[M])[0],g[1]-p[1]])[0]*(E=[(h=t)[0]-(l=a)[0],h[1]-l[1]])[1]-v[1]*E[0]!=0&&ga(l,h,p,g)&&ga(p,g,l,h))return!0;var l,h,p,g,v,E;return!1}function uc(a,t){for(let s=0;s<a.length;++s)if(!Co(a[s],t))return!1;for(let s=0;s<a.length-1;++s)if(Yu(a[s],a[s+1],t))return!1;return!0}function ad(a,t){for(let s=0;s<t.length;s++)if(uc(a,t[s]))return!0;return!1}function au(a,t,s){const l=[];for(let h=0;h<a.length;h++){const p=[];for(let g=0;g<a[h].length;g++){const v=tf(a[h][g],s);cc(t,v),p.push(v)}l.push(p)}return l}function _l(a,t,s){const l=[];for(let h=0;h<a.length;h++){const p=au(a[h],t,s);l.push(p)}return l}function Io(a,t,s,l){if(a[0]<s[0]||a[0]>s[2]){const h=.5*l;let p=a[0]-s[0]>h?-l:s[0]-a[0]>h?l:0;0===p&&(p=a[0]-s[2]>h?-l:s[2]-a[0]>h?l:0),a[0]+=p}cc(t,a)}function hc(a,t,s,l){const h=Math.pow(2,l.z)*qs,p=[l.x*qs,l.y*qs],g=[];if(!a)return g;for(const v of a)for(const E of v){const k=[E.x+p[0],E.y+p[1]];Io(k,t,s,h),g.push(k)}return g}function Ku(a,t,s,l){const h=Math.pow(2,l.z)*qs,p=[l.x*qs,l.y*qs],g=[];if(!a)return g;for(const E of a){const k=[];for(const M of E){const D=[M.x+p[0],M.y+p[1]];cc(t,D),k.push(D)}g.push(k)}if(t[2]-t[0]<=h/2){(v=t)[0]=v[1]=1/0,v[2]=v[3]=-1/0;for(const E of g)for(const k of E)Io(k,t,s,h)}var v;return g}class cs{constructor(t,s){this.type=yr,this.geojson=t,this.geometries=s}static parse(t,s){if(2!==t.length)return s.error(`'within' expression requires exactly one argument, but found ${t.length-1} instead.`);if(pl(t[1])){const l=t[1];if("FeatureCollection"===l.type)for(let h=0;h<l.features.length;++h){const p=l.features[h].geometry.type;if("Polygon"===p||"MultiPolygon"===p)return new cs(l,l.features[h].geometry)}else if("Feature"===l.type){const h=l.geometry.type;if("Polygon"===h||"MultiPolygon"===h)return new cs(l,l.geometry)}else if("Polygon"===l.type||"MultiPolygon"===l.type)return new cs(l,l)}return s.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(t){if(null!=t.geometry()&&null!=t.canonicalID()){if("Point"===t.geometryType())return function(s,l){const h=[1/0,1/0,-1/0,-1/0],p=[1/0,1/0,-1/0,-1/0],g=s.canonicalID();if(!g)return!1;if("Polygon"===l.type){const v=au(l.coordinates,p,g),E=hc(s.geometry(),h,p,g);if(!Bi(h,p))return!1;for(const k of E)if(!Co(k,v))return!1}if("MultiPolygon"===l.type){const v=_l(l.coordinates,p,g),E=hc(s.geometry(),h,p,g);if(!Bi(h,p))return!1;for(const k of E)if(!ml(k,v))return!1}return!0}(t,this.geometries);if("LineString"===t.geometryType())return function(s,l){const h=[1/0,1/0,-1/0,-1/0],p=[1/0,1/0,-1/0,-1/0],g=s.canonicalID();if(!g)return!1;if("Polygon"===l.type){const v=au(l.coordinates,p,g),E=Ku(s.geometry(),h,p,g);if(!Bi(h,p))return!1;for(const k of E)if(!uc(k,v))return!1}if("MultiPolygon"===l.type){const v=_l(l.coordinates,p,g),E=Ku(s.geometry(),h,p,g);if(!Bi(h,p))return!1;for(const k of E)if(!ad(k,v))return!1}return!0}(t,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}function Hn(a){if(a instanceof hn&&("get"===a.name&&1===a.args.length||"feature-state"===a.name||"has"===a.name&&1===a.args.length||"properties"===a.name||"geometry-type"===a.name||"id"===a.name||/^filter-/.test(a.name))||a instanceof cs)return!1;let t=!0;return a.eachChild(s=>{t&&!Hn(s)&&(t=!1)}),t}function or(a){if(a instanceof hn&&"feature-state"===a.name)return!1;let t=!0;return a.eachChild(s=>{t&&!or(s)&&(t=!1)}),t}function gl(a,t){if(a instanceof hn&&t.indexOf(a.name)>=0)return!1;let s=!0;return a.eachChild(l=>{s&&!gl(l,t)&&(s=!1)}),s}class Mo{constructor(t,s){this.type=s.type,this.name=t,this.boundExpression=s}static parse(t,s){if(2!==t.length||"string"!=typeof t[1])return s.error("'var' expression requires exactly one string literal argument.");const l=t[1];return s.scope.has(l)?new Mo(l,s.scope.get(l)):s.error(`Unknown variable "${l}". Make sure "${l}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(t){return this.boundExpression.evaluate(t)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}class Ba{constructor(t,s=[],l,h=new Eo,p=[]){this.registry=t,this.path=s,this.key=s.map(g=>`[${g}]`).join(""),this.scope=h,this.errors=p,this.expectedType=l}parse(t,s,l,h,p={}){return s?this.concat(s,l,h)._parse(t,p):this._parse(t,p)}_parse(t,s){function l(h,p,g){return"assert"===g?new Mn(p,[h]):"coerce"===g?new en(p,[h]):h}if(null!==t&&"string"!=typeof t&&"boolean"!=typeof t&&"number"!=typeof t||(t=["literal",t]),Array.isArray(t)){if(0===t.length)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const h=t[0];if("string"!=typeof h)return this.error(`Expression name must be a string, but found ${typeof h} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const p=this.registry[h];if(p){let g=p.parse(t,this);if(!g)return null;if(this.expectedType){const v=this.expectedType,E=g.type;if("string"!==v.kind&&"number"!==v.kind&&"boolean"!==v.kind&&"object"!==v.kind&&"array"!==v.kind||"value"!==E.kind)if("color"!==v.kind&&"formatted"!==v.kind&&"resolvedImage"!==v.kind||"value"!==E.kind&&"string"!==E.kind){if(this.checkSubtype(v,E))return null}else g=l(g,v,s.typeAnnotation||"coerce");else g=l(g,v,s.typeAnnotation||"assert")}if(!(g instanceof ri)&&"resolvedImage"!==g.type.kind&&Na(g)){const v=new Xn;try{g=new ri(g.type,g.evaluate(v))}catch(E){return this.error(E.message),null}}return g}return this.error(`Unknown expression "${h}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(void 0===t?"'undefined' value invalid. Use null instead.":"object"==typeof t?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof t} instead.`)}concat(t,s,l){const h="number"==typeof t?this.path.concat(t):this.path,p=l?this.scope.concat(l):this.scope;return new Ba(this.registry,h,s||null,p,this.errors)}error(t,...s){const l=`${this.key}${s.map(h=>`[${h}]`).join("")}`;this.errors.push(new Ur(l,t))}checkSubtype(t,s){const l=lc(t,s);return l&&this.error(l),l}}function Na(a){if(a instanceof Mo)return Na(a.boundExpression);if(a instanceof hn&&"error"===a.name||a instanceof za||a instanceof cs)return!1;const t=a instanceof en||a instanceof Mn;let s=!0;return a.eachChild(l=>{s=t?s&&Na(l):s&&l instanceof ri}),!!s&&Hn(a)&&gl(a,["zoom","heatmap-density","line-progress","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center"])}function xl(a,t){const s=a.length-1;let l,h,p=0,g=s,v=0;for(;p<=g;)if(v=Math.floor((p+g)/2),l=a[v],h=a[v+1],l<=t){if(v===s||t<h)return v;p=v+1}else{if(!(l>t))throw new zi("Input is not a number.");g=v-1}return 0}class fc{constructor(t,s,l){this.type=t,this.input=s,this.labels=[],this.outputs=[];for(const[h,p]of l)this.labels.push(h),this.outputs.push(p)}static parse(t,s){if(t.length-1<4)return s.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return s.error("Expected an even number of arguments.");const l=s.parse(t[1],1,Tt);if(!l)return null;const h=[];let p=null;s.expectedType&&"value"!==s.expectedType.kind&&(p=s.expectedType);for(let g=1;g<t.length;g+=2){const v=1===g?-1/0:t[g],E=t[g+1],k=g,M=g+1;if("number"!=typeof v)return s.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',k);if(h.length&&h[h.length-1][0]>=v)return s.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',k);const D=s.parse(E,M,p);if(!D)return null;p=p||D.type,h.push([v,D])}return new fc(p,l,h)}evaluate(t){const s=this.labels,l=this.outputs;if(1===s.length)return l[0].evaluate(t);const h=this.input.evaluate(t);if(h<=s[0])return l[0].evaluate(t);const p=s.length;return h>=s[p-1]?l[p-1].evaluate(t):l[xl(s,h)].evaluate(t)}eachChild(t){t(this.input);for(const s of this.outputs)t(s)}outputDefined(){return this.outputs.every(t=>t.outputDefined())}serialize(){const t=["step",this.input.serialize()];for(let s=0;s<this.labels.length;s++)s>0&&t.push(this.labels[s]),t.push(this.outputs[s].serialize());return t}}function Qt(a,t,s){return a*(1-s)+t*s}var dc=Object.freeze({__proto__:null,number:Qt,color:function(a,t,s){return new Fr(Qt(a.r,t.r,s),Qt(a.g,t.g,s),Qt(a.b,t.b,s),Qt(a.a,t.a,s))},array:function(a,t,s){return a.map((l,h)=>Qt(l,t[h],s))}});const Ju=4/29,Qu=6/29,Fo=3*Qu*Qu,Gs=Math.PI/180,nf=180/Math.PI;function ou(a){return a>.008856451679035631?Math.pow(a,1/3):a/Fo+Ju}function Fn(a){return a>Qu?a*a*a:Fo*(a-Ju)}function Do(a){return 255*(a<=.0031308?12.92*a:1.055*Math.pow(a,1/2.4)-.055)}function eh(a){return(a/=255)<=.04045?a/12.92:Math.pow((a+.055)/1.055,2.4)}function lu(a){const t=eh(a.r),s=eh(a.g),l=eh(a.b),h=ou((.4124564*t+.3575761*s+.1804375*l)/.95047),p=ou((.2126729*t+.7151522*s+.072175*l)/1);return{l:116*p-16,a:500*(h-p),b:200*(p-ou((.0193339*t+.119192*s+.9503041*l)/1.08883)),alpha:a.a}}function cu(a){let t=(a.l+16)/116,s=isNaN(a.a)?t:t+a.a/500,l=isNaN(a.b)?t:t-a.b/200;return t=1*Fn(t),s=.95047*Fn(s),l=1.08883*Fn(l),new Fr(Do(3.2404542*s-1.5371385*t-.4985314*l),Do(-.969266*s+1.8760108*t+.041556*l),Do(.0556434*s-.2040259*t+1.0572252*l),a.alpha)}function af(a,t,s){const l=t-a;return a+s*(l>180||l<-180?l-360*Math.round(l/360):l)}const pc={forward:lu,reverse:cu,interpolate:function(a,t,s){return{l:Qt(a.l,t.l,s),a:Qt(a.a,t.a,s),b:Qt(a.b,t.b,s),alpha:Qt(a.alpha,t.alpha,s)}}},mc={forward:function(a){const{l:t,a:s,b:l}=lu(a),h=Math.atan2(l,s)*nf;return{h:h<0?h+360:h,c:Math.sqrt(s*s+l*l),l:t,alpha:a.a}},reverse:function(a){const t=a.h*Gs,s=a.c;return cu({l:a.l,a:Math.cos(t)*s,b:Math.sin(t)*s,alpha:a.alpha})},interpolate:function(a,t,s){return{h:af(a.h,t.h,s),c:Qt(a.c,t.c,s),l:Qt(a.l,t.l,s),alpha:Qt(a.alpha,t.alpha,s)}}};var uu=Object.freeze({__proto__:null,lab:pc,hcl:mc});class Yn{constructor(t,s,l,h,p){this.type=t,this.operator=s,this.interpolation=l,this.input=h,this.labels=[],this.outputs=[];for(const[g,v]of p)this.labels.push(g),this.outputs.push(v)}static interpolationFactor(t,s,l,h){let p=0;if("exponential"===t.name)p=_c(s,t.base,l,h);else if("linear"===t.name)p=_c(s,1,l,h);else if("cubic-bezier"===t.name){const g=t.controlPoints;p=new Ls(g[0],g[1],g[2],g[3]).solve(_c(s,1,l,h))}return p}static parse(t,s){let[l,h,p,...g]=t;if(!Array.isArray(h)||0===h.length)return s.error("Expected an interpolation type expression.",1);if("linear"===h[0])h={name:"linear"};else if("exponential"===h[0]){const k=h[1];if("number"!=typeof k)return s.error("Exponential interpolation requires a numeric base.",1,1);h={name:"exponential",base:k}}else{if("cubic-bezier"!==h[0])return s.error(`Unknown interpolation type ${String(h[0])}`,1,0);{const k=h.slice(1);if(4!==k.length||k.some(M=>"number"!=typeof M||M<0||M>1))return s.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);h={name:"cubic-bezier",controlPoints:k}}}if(t.length-1<4)return s.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return s.error("Expected an even number of arguments.");if(p=s.parse(p,2,Tt),!p)return null;const v=[];let E=null;"interpolate-hcl"===l||"interpolate-lab"===l?E=Wa:s.expectedType&&"value"!==s.expectedType.kind&&(E=s.expectedType);for(let k=0;k<g.length;k+=2){const M=g[k],D=g[k+1],R=k+3,z=k+4;if("number"!=typeof M)return s.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',R);if(v.length&&v[v.length-1][0]>=M)return s.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',R);const q=s.parse(D,z,E);if(!q)return null;E=E||q.type,v.push([M,q])}return"number"===E.kind||"color"===E.kind||"array"===E.kind&&"number"===E.itemType.kind&&"number"==typeof E.N?new Yn(E,l,h,p,v):s.error(`Type ${Lr(E)} is not interpolatable.`)}evaluate(t){const s=this.labels,l=this.outputs;if(1===s.length)return l[0].evaluate(t);const h=this.input.evaluate(t);if(h<=s[0])return l[0].evaluate(t);const p=s.length;if(h>=s[p-1])return l[p-1].evaluate(t);const g=xl(s,h),v=Yn.interpolationFactor(this.interpolation,h,s[g],s[g+1]),E=l[g].evaluate(t),k=l[g+1].evaluate(t);return"interpolate"===this.operator?dc[this.type.kind.toLowerCase()](E,k,v):"interpolate-hcl"===this.operator?mc.reverse(mc.interpolate(mc.forward(E),mc.forward(k),v)):pc.reverse(pc.interpolate(pc.forward(E),pc.forward(k),v))}eachChild(t){t(this.input);for(const s of this.outputs)t(s)}outputDefined(){return this.outputs.every(t=>t.outputDefined())}serialize(){let t;t="linear"===this.interpolation.name?["linear"]:"exponential"===this.interpolation.name?1===this.interpolation.base?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);const s=[this.operator,t,this.input.serialize()];for(let l=0;l<this.labels.length;l++)s.push(this.labels[l],this.outputs[l].serialize());return s}}function _c(a,t,s,l){const h=l-s,p=a-s;return 0===h?0:1===t?p/h:(Math.pow(t,p)-1)/(Math.pow(t,h)-1)}class Yi{constructor(t,s){this.type=t,this.args=s}static parse(t,s){if(t.length<2)return s.error("Expectected at least one argument.");let l=null;const h=s.expectedType;h&&"value"!==h.kind&&(l=h);const p=[];for(const v of t.slice(1)){const E=s.parse(v,1+p.length,l,void 0,{typeAnnotation:"omit"});if(!E)return null;l=l||E.type,p.push(E)}const g=h&&p.some(v=>lc(h,v.type));return new Yi(g?br:l,p)}evaluate(t){let s,l=null,h=0;for(const p of this.args){if(h++,l=p.evaluate(t),l&&l instanceof Ji&&!l.available&&(s||(s=l),l=null,h===this.args.length))return s;if(null!==l)break}return l}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}serialize(){const t=["coalesce"];return this.eachChild(s=>{t.push(s.serialize())}),t}}class yl{constructor(t,s){this.type=s.type,this.bindings=[].concat(t),this.result=s}evaluate(t){return this.result.evaluate(t)}eachChild(t){for(const s of this.bindings)t(s[1]);t(this.result)}static parse(t,s){if(t.length<4)return s.error(`Expected at least 3 arguments, but found ${t.length-1} instead.`);const l=[];for(let p=1;p<t.length-1;p+=2){const g=t[p];if("string"!=typeof g)return s.error(`Expected string, but found ${typeof g} instead.`,p);if(/[^a-zA-Z0-9_]/.test(g))return s.error("Variable names must contain only alphanumeric characters or '_'.",p);const v=s.parse(t[p+1],p+1);if(!v)return null;l.push([g,v])}const h=s.parse(t[t.length-1],t.length-1,s.expectedType,l);return h?new yl(l,h):null}outputDefined(){return this.result.outputDefined()}serialize(){const t=["let"];for(const[s,l]of this.bindings)t.push(s,l.serialize());return t.push(this.result.serialize()),t}}class hu{constructor(t,s,l){this.type=t,this.index=s,this.input=l}static parse(t,s){if(3!==t.length)return s.error(`Expected 2 arguments, but found ${t.length-1} instead.`);const l=s.parse(t[1],1,Tt),h=s.parse(t[2],2,yn(s.expectedType||br));return l&&h?new hu(h.type.itemType,l,h):null}evaluate(t){const s=this.index.evaluate(t),l=this.input.evaluate(t);if(s<0)throw new zi(`Array index out of bounds: ${s} < 0.`);if(s>=l.length)throw new zi(`Array index out of bounds: ${s} > ${l.length-1}.`);if(s!==Math.floor(s))throw new zi(`Array index must be an integer, but found ${s} instead.`);return l[s]}eachChild(t){t(this.index),t(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}class fu{constructor(t,s){this.type=yr,this.needle=t,this.haystack=s}static parse(t,s){if(3!==t.length)return s.error(`Expected 2 arguments, but found ${t.length-1} instead.`);const l=s.parse(t[1],1,br),h=s.parse(t[2],2,br);return l&&h?dl(l.type,[yr,Cr,Tt,as,br])?new fu(l,h):s.error(`Expected first argument to be of type boolean, string, number or null, but found ${Lr(l.type)} instead`):null}evaluate(t){const s=this.needle.evaluate(t),l=this.haystack.evaluate(t);if(null==l)return!1;if(!ss(s,["boolean","string","number","null"]))throw new zi(`Expected first argument to be of type boolean, string, number or null, but found ${Lr(lr(s))} instead.`);if(!ss(l,["string","array"]))throw new zi(`Expected second argument to be of type array or string, but found ${Lr(lr(l))} instead.`);return l.indexOf(s)>=0}eachChild(t){t(this.needle),t(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}class du{constructor(t,s,l){this.type=Tt,this.needle=t,this.haystack=s,this.fromIndex=l}static parse(t,s){if(t.length<=2||t.length>=5)return s.error(`Expected 3 or 4 arguments, but found ${t.length-1} instead.`);const l=s.parse(t[1],1,br),h=s.parse(t[2],2,br);if(!l||!h)return null;if(!dl(l.type,[yr,Cr,Tt,as,br]))return s.error(`Expected first argument to be of type boolean, string, number or null, but found ${Lr(l.type)} instead`);if(4===t.length){const p=s.parse(t[3],3,Tt);return p?new du(l,h,p):null}return new du(l,h)}evaluate(t){const s=this.needle.evaluate(t),l=this.haystack.evaluate(t);if(!ss(s,["boolean","string","number","null"]))throw new zi(`Expected first argument to be of type boolean, string, number or null, but found ${Lr(lr(s))} instead.`);if(!ss(l,["string","array"]))throw new zi(`Expected second argument to be of type array or string, but found ${Lr(lr(l))} instead.`);if(this.fromIndex){const h=this.fromIndex.evaluate(t);return l.indexOf(s,h)}return l.indexOf(s)}eachChild(t){t(this.needle),t(this.haystack),this.fromIndex&&t(this.fromIndex)}outputDefined(){return!1}serialize(){if(null!=this.fromIndex&&void 0!==this.fromIndex){const t=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),t]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}class Dn{constructor(t,s,l,h,p,g){this.inputType=t,this.type=s,this.input=l,this.cases=h,this.outputs=p,this.otherwise=g}static parse(t,s){if(t.length<5)return s.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if(t.length%2!=1)return s.error("Expected an even number of arguments.");let l,h;s.expectedType&&"value"!==s.expectedType.kind&&(h=s.expectedType);const p={},g=[];for(let k=2;k<t.length-1;k+=2){let M=t[k];const D=t[k+1];Array.isArray(M)||(M=[M]);const R=s.concat(k);if(0===M.length)return R.error("Expected at least one branch label.");for(const q of M){if("number"!=typeof q&&"string"!=typeof q)return R.error("Branch labels must be numbers or strings.");if("number"==typeof q&&Math.abs(q)>Number.MAX_SAFE_INTEGER)return R.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if("number"==typeof q&&Math.floor(q)!==q)return R.error("Numeric branch labels must be integer values.");if(l){if(R.checkSubtype(l,lr(q)))return null}else l=lr(q);if(void 0!==p[String(q)])return R.error("Branch labels must be unique.");p[String(q)]=g.length}const z=s.parse(D,k,h);if(!z)return null;h=h||z.type,g.push(z)}const v=s.parse(t[1],1,br);if(!v)return null;const E=s.parse(t[t.length-1],t.length-1,h);return E?"value"!==v.type.kind&&s.concat(1).checkSubtype(l,v.type)?null:new Dn(l,h,v,p,g,E):null}evaluate(t){const s=this.input.evaluate(t);return(lr(s)===this.inputType&&this.outputs[this.cases[s]]||this.otherwise).evaluate(t)}eachChild(t){t(this.input),this.outputs.forEach(t),t(this.otherwise)}outputDefined(){return this.outputs.every(t=>t.outputDefined())&&this.otherwise.outputDefined()}serialize(){const t=["match",this.input.serialize()],s=Object.keys(this.cases).sort(),l=[],h={};for(const g of s){const v=h[this.cases[g]];void 0===v?(h[this.cases[g]]=l.length,l.push([this.cases[g],[g]])):l[v][1].push(g)}const p=g=>"number"===this.inputType.kind?Number(g):g;for(const[g,v]of l)t.push(1===v.length?p(v[0]):v.map(p)),t.push(this.outputs[g].serialize());return t.push(this.otherwise.serialize()),t}}class pu{constructor(t,s,l){this.type=t,this.branches=s,this.otherwise=l}static parse(t,s){if(t.length<4)return s.error(`Expected at least 3 arguments, but found only ${t.length-1}.`);if(t.length%2!=0)return s.error("Expected an odd number of arguments.");let l;s.expectedType&&"value"!==s.expectedType.kind&&(l=s.expectedType);const h=[];for(let g=1;g<t.length-1;g+=2){const v=s.parse(t[g],g,yr);if(!v)return null;const E=s.parse(t[g+1],g+1,l);if(!E)return null;h.push([v,E]),l=l||E.type}const p=s.parse(t[t.length-1],t.length-1,l);return p?new pu(l,h,p):null}evaluate(t){for(const[s,l]of this.branches)if(s.evaluate(t))return l.evaluate(t);return this.otherwise.evaluate(t)}eachChild(t){for(const[s,l]of this.branches)t(s),t(l);t(this.otherwise)}outputDefined(){return this.branches.every(([t,s])=>s.outputDefined())&&this.otherwise.outputDefined()}serialize(){const t=["case"];return this.eachChild(s=>{t.push(s.serialize())}),t}}class mu{constructor(t,s,l,h){this.type=t,this.input=s,this.beginIndex=l,this.endIndex=h}static parse(t,s){if(t.length<=2||t.length>=5)return s.error(`Expected 3 or 4 arguments, but found ${t.length-1} instead.`);const l=s.parse(t[1],1,br),h=s.parse(t[2],2,Tt);if(!l||!h)return null;if(!dl(l.type,[yn(br),Cr,br]))return s.error(`Expected first argument to be of type array or string, but found ${Lr(l.type)} instead`);if(4===t.length){const p=s.parse(t[3],3,Tt);return p?new mu(l.type,l,h,p):null}return new mu(l.type,l,h)}evaluate(t){const s=this.input.evaluate(t),l=this.beginIndex.evaluate(t);if(!ss(s,["string","array"]))throw new zi(`Expected first argument to be of type array or string, but found ${Lr(lr(s))} instead.`);if(this.endIndex){const h=this.endIndex.evaluate(t);return s.slice(l,h)}return s.slice(l)}eachChild(t){t(this.input),t(this.beginIndex),this.endIndex&&t(this.endIndex)}outputDefined(){return!1}serialize(){if(null!=this.endIndex&&void 0!==this.endIndex){const t=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),t]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}function th(a,t){return"=="===a||"!="===a?"boolean"===t.kind||"string"===t.kind||"number"===t.kind||"null"===t.kind||"value"===t.kind:"string"===t.kind||"number"===t.kind||"value"===t.kind}function Ua(a,t,s,l){return 0===l.compare(t,s)}function Kn(a,t,s){const l="=="!==a&&"!="!==a;return class A1{constructor(p,g,v){this.type=yr,this.lhs=p,this.rhs=g,this.collator=v,this.hasUntypedArgument="value"===p.type.kind||"value"===g.type.kind}static parse(p,g){if(3!==p.length&&4!==p.length)return g.error("Expected two or three arguments.");const v=p[0];let E=g.parse(p[1],1,br);if(!E)return null;if(!th(v,E.type))return g.concat(1).error(`"${v}" comparisons are not supported for type '${Lr(E.type)}'.`);let k=g.parse(p[2],2,br);if(!k)return null;if(!th(v,k.type))return g.concat(2).error(`"${v}" comparisons are not supported for type '${Lr(k.type)}'.`);if(E.type.kind!==k.type.kind&&"value"!==E.type.kind&&"value"!==k.type.kind)return g.error(`Cannot compare types '${Lr(E.type)}' and '${Lr(k.type)}'.`);l&&("value"===E.type.kind&&"value"!==k.type.kind?E=new Mn(k.type,[E]):"value"!==E.type.kind&&"value"===k.type.kind&&(k=new Mn(E.type,[k])));let M=null;if(4===p.length){if("string"!==E.type.kind&&"string"!==k.type.kind&&"value"!==E.type.kind&&"value"!==k.type.kind)return g.error("Cannot use collator to compare non-string types.");if(M=g.parse(p[3],3,Ao),!M)return null}return new A1(E,k,M)}evaluate(p){const g=this.lhs.evaluate(p),v=this.rhs.evaluate(p);if(l&&this.hasUntypedArgument){const E=lr(g),k=lr(v);if(E.kind!==k.kind||"string"!==E.kind&&"number"!==E.kind)throw new zi(`Expected arguments for "${a}" to be (string, string) or (number, number), but found (${E.kind}, ${k.kind}) instead.`)}if(this.collator&&!l&&this.hasUntypedArgument){const E=lr(g),k=lr(v);if("string"!==E.kind||"string"!==k.kind)return t(p,g,v)}return this.collator?s(p,g,v,this.collator.evaluate(p)):t(p,g,v)}eachChild(p){p(this.lhs),p(this.rhs),this.collator&&p(this.collator)}outputDefined(){return!0}serialize(){const p=[a];return this.eachChild(g=>{p.push(g.serialize())}),p}}}const sd=Kn("==",function(a,t,s){return t===s},Ua),sf=Kn("!=",function(a,t,s){return t!==s},function(a,t,s,l){return!Ua(0,t,s,l)}),Po=Kn("<",function(a,t,s){return t<s},function(a,t,s,l){return l.compare(t,s)<0}),od=Kn(">",function(a,t,s){return t>s},function(a,t,s,l){return l.compare(t,s)>0}),of=Kn("<=",function(a,t,s){return t<=s},function(a,t,s,l){return l.compare(t,s)<=0}),lf=Kn(">=",function(a,t,s){return t>=s},function(a,t,s,l){return l.compare(t,s)>=0});class rh{constructor(t,s,l,h,p){this.type=Cr,this.number=t,this.locale=s,this.currency=l,this.minFractionDigits=h,this.maxFractionDigits=p}static parse(t,s){if(3!==t.length)return s.error("Expected two arguments.");const l=s.parse(t[1],1,Tt);if(!l)return null;const h=t[2];if("object"!=typeof h||Array.isArray(h))return s.error("NumberFormat options argument must be an object.");let p=null;if(h.locale&&(p=s.parse(h.locale,1,Cr),!p))return null;let g=null;if(h.currency&&(g=s.parse(h.currency,1,Cr),!g))return null;let v=null;if(h["min-fraction-digits"]&&(v=s.parse(h["min-fraction-digits"],1,Tt),!v))return null;let E=null;return h["max-fraction-digits"]&&(E=s.parse(h["max-fraction-digits"],1,Tt),!E)?null:new rh(l,p,g,v,E)}evaluate(t){return new Intl.NumberFormat(this.locale?this.locale.evaluate(t):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(t):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(t):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(t):void 0}).format(this.number.evaluate(t))}eachChild(t){t(this.number),this.locale&&t(this.locale),this.currency&&t(this.currency),this.minFractionDigits&&t(this.minFractionDigits),this.maxFractionDigits&&t(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const t={};return this.locale&&(t.locale=this.locale.serialize()),this.currency&&(t.currency=this.currency.serialize()),this.minFractionDigits&&(t["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(t["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),t]}}class vn{constructor(t){this.type=Tt,this.input=t}static parse(t,s){if(2!==t.length)return s.error(`Expected 1 argument, but found ${t.length-1} instead.`);const l=s.parse(t[1],1);return l?"array"!==l.type.kind&&"string"!==l.type.kind&&"value"!==l.type.kind?s.error(`Expected argument of type string or array, but found ${Lr(l.type)} instead.`):new vn(l):null}evaluate(t){const s=this.input.evaluate(t);if("string"==typeof s||Array.isArray(s))return s.length;throw new zi(`Expected value to be of type string or array, but found ${Lr(lr(s))} instead.`)}eachChild(t){t(this.input)}outputDefined(){return!1}serialize(){const t=["length"];return this.eachChild(s=>{t.push(s.serialize())}),t}}const wn={"==":sd,"!=":sf,">":od,"<":Po,">=":lf,"<=":of,array:Mn,at:hu,boolean:Mn,case:pu,coalesce:Yi,collator:za,format:Qi,image:_r,in:fu,"index-of":du,interpolate:Yn,"interpolate-hcl":Yn,"interpolate-lab":Yn,length:vn,let:yl,literal:ri,match:Dn,number:Mn,"number-format":rh,object:Mn,slice:mu,step:fc,string:Mn,"to-boolean":en,"to-color":en,"to-number":en,"to-string":en,var:Mo,within:cs};function Lo(a,[t,s,l,h]){t=t.evaluate(a),s=s.evaluate(a),l=l.evaluate(a);const p=h?h.evaluate(a):1,g=In(t,s,l,p);if(g)throw new zi(g);return new Fr(t/255*p,s/255*p,l/255*p,p)}function Ro(a,t){return a in t}function ih(a,t){const s=t[a];return void 0===s?null:s}function $s(a){return{type:a}}function _u(a){return{result:"success",value:a}}function Oo(a){return{result:"error",value:a}}function vl(a){return"data-driven"===a["property-type"]||"cross-faded-data-driven"===a["property-type"]}function cf(a){return!!a.expression&&a.expression.parameters.indexOf("zoom")>-1}function ar(a){return!!a.expression&&a.expression.interpolated}function Er(a){return a instanceof Number?"number":a instanceof String?"string":a instanceof Boolean?"boolean":Array.isArray(a)?"array":null===a?"null":typeof a}function wl(a){return"object"==typeof a&&null!==a&&!Array.isArray(a)}function uf(a){return a}function zo(a,t){const s="color"===t.type,l=a.stops&&"object"==typeof a.stops[0][0],h=l||!(l||void 0!==a.property),p=a.type||(ar(t)?"exponential":"interval");if(s&&((a=Nr({},a)).stops&&(a.stops=a.stops.map(k=>[k[0],Fr.parse(k[1])])),a.default=Fr.parse(a.default?a.default:t.default)),a.colorSpace&&"rgb"!==a.colorSpace&&!uu[a.colorSpace])throw new Error(`Unknown color space: ${a.colorSpace}`);let g,v,E;if("exponential"===p)g=bl;else if("interval"===p)g=hf;else if("categorical"===p){g=Fi,v=Object.create(null);for(const k of a.stops)v[k[0]]=k[1];E=typeof a.stops[0][0]}else{if("identity"!==p)throw new Error(`Unknown function type "${p}"`);g=xc}if(l){const k={},M=[];for(let z=0;z<a.stops.length;z++){const q=a.stops[z],K=q[0].zoom;void 0===k[K]&&(k[K]={zoom:K,type:a.type,property:a.property,default:a.default,stops:[]},M.push(K)),k[K].stops.push([q[0].value,q[1]])}const D=[];for(const z of M)D.push([k[z].zoom,zo(k[z],t)]);const R={name:"linear"};return{kind:"composite",interpolationType:R,interpolationFactor:Yn.interpolationFactor.bind(void 0,R),zoomStops:D.map(z=>z[0]),evaluate:({zoom:z},q)=>bl({stops:D,base:a.base},t,z).evaluate(z,q)}}if(h){const k="exponential"===p?{name:"exponential",base:void 0!==a.base?a.base:1}:null;return{kind:"camera",interpolationType:k,interpolationFactor:Yn.interpolationFactor.bind(void 0,k),zoomStops:a.stops.map(M=>M[0]),evaluate:({zoom:M})=>g(a,t,M,v,E)}}return{kind:"source",evaluate(k,M){const D=M&&M.properties?M.properties[a.property]:void 0;return void 0===D?gc(a.default,t.default):g(a,t,D,v,E)}}}function gc(a,t,s){return void 0!==a?a:void 0!==t?t:void 0!==s?s:void 0}function Fi(a,t,s,l,h){return gc(typeof s===h?l[s]:void 0,a.default,t.default)}function hf(a,t,s){if("number"!==Er(s))return gc(a.default,t.default);const l=a.stops.length;if(1===l||s<=a.stops[0][0])return a.stops[0][1];if(s>=a.stops[l-1][0])return a.stops[l-1][1];const h=xl(a.stops.map(p=>p[0]),s);return a.stops[h][1]}function bl(a,t,s){const l=void 0!==a.base?a.base:1;if("number"!==Er(s))return gc(a.default,t.default);const h=a.stops.length;if(1===h||s<=a.stops[0][0])return a.stops[0][1];if(s>=a.stops[h-1][0])return a.stops[h-1][1];const p=xl(a.stops.map(M=>M[0]),s),g=function(M,D,R,z){const q=z-R,K=M-R;return 0===q?0:1===D?K/q:(Math.pow(D,K)-1)/(Math.pow(D,q)-1)}(s,l,a.stops[p][0],a.stops[p+1][0]),v=a.stops[p][1],E=a.stops[p+1][1];let k=dc[t.type]||uf;if(a.colorSpace&&"rgb"!==a.colorSpace){const M=uu[a.colorSpace];k=(D,R)=>M.reverse(M.interpolate(M.forward(D),M.forward(R),g))}return"function"==typeof v.evaluate?{evaluate(...M){const D=v.evaluate.apply(void 0,M),R=E.evaluate.apply(void 0,M);if(void 0!==D&&void 0!==R)return k(D,R,g)}}:k(v,E,g)}function xc(a,t,s){return"color"===t.type?s=Fr.parse(s):"formatted"===t.type?s=Oi.fromString(s.toString()):"resolvedImage"===t.type?s=Ji.fromString(s.toString()):Er(s)===t.type||"enum"===t.type&&t.values[s]||(s=void 0),gc(s,a.default,t.default)}hn.register(wn,{error:[{kind:"error"},[Cr],(a,[t])=>{throw new zi(t.evaluate(a))}],typeof:[Cr,[br],(a,[t])=>Lr(lr(t.evaluate(a)))],"to-rgba":[yn(Tt,4),[Wa],(a,[t])=>t.evaluate(a).toArray()],rgb:[Wa,[Tt,Tt,Tt],Lo],rgba:[Wa,[Tt,Tt,Tt,Tt],Lo],has:{type:yr,overloads:[[[Cr],(a,[t])=>Ro(t.evaluate(a),a.properties())],[[Cr,So],(a,[t,s])=>Ro(t.evaluate(a),s.evaluate(a))]]},get:{type:br,overloads:[[[Cr],(a,[t])=>ih(t.evaluate(a),a.properties())],[[Cr,So],(a,[t,s])=>ih(t.evaluate(a),s.evaluate(a))]]},"feature-state":[br,[Cr],(a,[t])=>ih(t.evaluate(a),a.featureState||{})],properties:[So,[],a=>a.properties()],"geometry-type":[Cr,[],a=>a.geometryType()],id:[br,[],a=>a.id()],zoom:[Tt,[],a=>a.globals.zoom],pitch:[Tt,[],a=>a.globals.pitch||0],"distance-from-center":[Tt,[],a=>a.distanceFromCenter()],"heatmap-density":[Tt,[],a=>a.globals.heatmapDensity||0],"line-progress":[Tt,[],a=>a.globals.lineProgress||0],"sky-radial-progress":[Tt,[],a=>a.globals.skyRadialProgress||0],accumulated:[br,[],a=>void 0===a.globals.accumulated?null:a.globals.accumulated],"+":[Tt,$s(Tt),(a,t)=>{let s=0;for(const l of t)s+=l.evaluate(a);return s}],"*":[Tt,$s(Tt),(a,t)=>{let s=1;for(const l of t)s*=l.evaluate(a);return s}],"-":{type:Tt,overloads:[[[Tt,Tt],(a,[t,s])=>t.evaluate(a)-s.evaluate(a)],[[Tt],(a,[t])=>-t.evaluate(a)]]},"/":[Tt,[Tt,Tt],(a,[t,s])=>t.evaluate(a)/s.evaluate(a)],"%":[Tt,[Tt,Tt],(a,[t,s])=>t.evaluate(a)%s.evaluate(a)],ln2:[Tt,[],()=>Math.LN2],pi:[Tt,[],()=>Math.PI],e:[Tt,[],()=>Math.E],"^":[Tt,[Tt,Tt],(a,[t,s])=>Math.pow(t.evaluate(a),s.evaluate(a))],sqrt:[Tt,[Tt],(a,[t])=>Math.sqrt(t.evaluate(a))],log10:[Tt,[Tt],(a,[t])=>Math.log(t.evaluate(a))/Math.LN10],ln:[Tt,[Tt],(a,[t])=>Math.log(t.evaluate(a))],log2:[Tt,[Tt],(a,[t])=>Math.log(t.evaluate(a))/Math.LN2],sin:[Tt,[Tt],(a,[t])=>Math.sin(t.evaluate(a))],cos:[Tt,[Tt],(a,[t])=>Math.cos(t.evaluate(a))],tan:[Tt,[Tt],(a,[t])=>Math.tan(t.evaluate(a))],asin:[Tt,[Tt],(a,[t])=>Math.asin(t.evaluate(a))],acos:[Tt,[Tt],(a,[t])=>Math.acos(t.evaluate(a))],atan:[Tt,[Tt],(a,[t])=>Math.atan(t.evaluate(a))],min:[Tt,$s(Tt),(a,t)=>Math.min(...t.map(s=>s.evaluate(a)))],max:[Tt,$s(Tt),(a,t)=>Math.max(...t.map(s=>s.evaluate(a)))],abs:[Tt,[Tt],(a,[t])=>Math.abs(t.evaluate(a))],round:[Tt,[Tt],(a,[t])=>{const s=t.evaluate(a);return s<0?-Math.round(-s):Math.round(s)}],floor:[Tt,[Tt],(a,[t])=>Math.floor(t.evaluate(a))],ceil:[Tt,[Tt],(a,[t])=>Math.ceil(t.evaluate(a))],"filter-==":[yr,[Cr,br],(a,[t,s])=>a.properties()[t.value]===s.value],"filter-id-==":[yr,[br],(a,[t])=>a.id()===t.value],"filter-type-==":[yr,[Cr],(a,[t])=>a.geometryType()===t.value],"filter-<":[yr,[Cr,br],(a,[t,s])=>{const l=a.properties()[t.value],h=s.value;return typeof l==typeof h&&l<h}],"filter-id-<":[yr,[br],(a,[t])=>{const s=a.id(),l=t.value;return typeof s==typeof l&&s<l}],"filter->":[yr,[Cr,br],(a,[t,s])=>{const l=a.properties()[t.value],h=s.value;return typeof l==typeof h&&l>h}],"filter-id->":[yr,[br],(a,[t])=>{const s=a.id(),l=t.value;return typeof s==typeof l&&s>l}],"filter-<=":[yr,[Cr,br],(a,[t,s])=>{const l=a.properties()[t.value],h=s.value;return typeof l==typeof h&&l<=h}],"filter-id-<=":[yr,[br],(a,[t])=>{const s=a.id(),l=t.value;return typeof s==typeof l&&s<=l}],"filter->=":[yr,[Cr,br],(a,[t,s])=>{const l=a.properties()[t.value],h=s.value;return typeof l==typeof h&&l>=h}],"filter-id->=":[yr,[br],(a,[t])=>{const s=a.id(),l=t.value;return typeof s==typeof l&&s>=l}],"filter-has":[yr,[br],(a,[t])=>t.value in a.properties()],"filter-has-id":[yr,[],a=>null!==a.id()&&void 0!==a.id()],"filter-type-in":[yr,[yn(Cr)],(a,[t])=>t.value.indexOf(a.geometryType())>=0],"filter-id-in":[yr,[yn(br)],(a,[t])=>t.value.indexOf(a.id())>=0],"filter-in-small":[yr,[Cr,yn(br)],(a,[t,s])=>s.value.indexOf(a.properties()[t.value])>=0],"filter-in-large":[yr,[Cr,yn(br)],(a,[t,s])=>function(l,h,p,g){for(;p<=g;){const v=p+g>>1;if(h[v]===l)return!0;h[v]>l?g=v-1:p=v+1}return!1}(a.properties()[t.value],s.value,0,s.value.length-1)],all:{type:yr,overloads:[[[yr,yr],(a,[t,s])=>t.evaluate(a)&&s.evaluate(a)],[$s(yr),(a,t)=>{for(const s of t)if(!s.evaluate(a))return!1;return!0}]]},any:{type:yr,overloads:[[[yr,yr],(a,[t,s])=>t.evaluate(a)||s.evaluate(a)],[$s(yr),(a,t)=>{for(const s of t)if(s.evaluate(a))return!0;return!1}]]},"!":[yr,[yr],(a,[t])=>!t.evaluate(a)],"is-supported-script":[yr,[Cr],(a,[t])=>{const s=a.globals&&a.globals.isSupportedScript;return!s||s(t.evaluate(a))}],upcase:[Cr,[Cr],(a,[t])=>t.evaluate(a).toUpperCase()],downcase:[Cr,[Cr],(a,[t])=>t.evaluate(a).toLowerCase()],concat:[Cr,$s(br),(a,t)=>t.map(s=>js(s.evaluate(a))).join("")],"resolved-locale":[Cr,[Ao],(a,[t])=>t.evaluate(a).resolvedLocale()]});class gu{constructor(t,s){var l;this.expression=t,this._warningHistory={},this._evaluator=new Xn,this._defaultValue=s?"color"===(l=s).type&&wl(l.default)?new Fr(0,0,0,0):"color"===l.type?Fr.parse(l.default)||null:void 0===l.default?null:l.default:null,this._enumValues=s&&"enum"===s.type?s.values:null}evaluateWithoutErrorHandling(t,s,l,h,p,g,v,E){return this._evaluator.globals=t,this._evaluator.feature=s,this._evaluator.featureState=l,this._evaluator.canonical=h||null,this._evaluator.availableImages=p||null,this._evaluator.formattedSection=g,this._evaluator.featureTileCoord=v||null,this._evaluator.featureDistanceData=E||null,this.expression.evaluate(this._evaluator)}evaluate(t,s,l,h,p,g,v,E){this._evaluator.globals=t,this._evaluator.feature=s||null,this._evaluator.featureState=l||null,this._evaluator.canonical=h||null,this._evaluator.availableImages=p||null,this._evaluator.formattedSection=g||null,this._evaluator.featureTileCoord=v||null,this._evaluator.featureDistanceData=E||null;try{const k=this.expression.evaluate(this._evaluator);if(null==k||"number"==typeof k&&k!=k)return this._defaultValue;if(this._enumValues&&!(k in this._enumValues))throw new zi(`Expected value to be one of ${Object.keys(this._enumValues).map(M=>JSON.stringify(M)).join(", ")}, but found ${JSON.stringify(k)} instead.`);return k}catch(k){return this._warningHistory[k.message]||(this._warningHistory[k.message]=!0,"undefined"!=typeof console&&console.warn(k.message)),this._defaultValue}}}function us(a){return Array.isArray(a)&&a.length>0&&"string"==typeof a[0]&&a[0]in wn}function Di(a,t){const s=new Ba(wn,[],t?function(h){const p={color:Wa,string:Cr,number:Tt,enum:Cr,boolean:yr,formatted:fl,resolvedImage:Cn};return"array"===h.type?yn(p[h.value]||br,h.length):p[h.type]}(t):void 0),l=s.parse(a,void 0,void 0,void 0,t&&"string"===t.type?{typeAnnotation:"coerce"}:void 0);return l?_u(new gu(l,t)):Oo(s.errors)}class xu{constructor(t,s){this.kind=t,this._styleExpression=s,this.isStateDependent="constant"!==t&&!or(s.expression)}evaluateWithoutErrorHandling(t,s,l,h,p,g){return this._styleExpression.evaluateWithoutErrorHandling(t,s,l,h,p,g)}evaluate(t,s,l,h,p,g){return this._styleExpression.evaluate(t,s,l,h,p,g)}}class nh{constructor(t,s,l,h){this.kind=t,this.zoomStops=l,this._styleExpression=s,this.isStateDependent="camera"!==t&&!or(s.expression),this.interpolationType=h}evaluateWithoutErrorHandling(t,s,l,h,p,g){return this._styleExpression.evaluateWithoutErrorHandling(t,s,l,h,p,g)}evaluate(t,s,l,h,p,g){return this._styleExpression.evaluate(t,s,l,h,p,g)}interpolationFactor(t,s,l){return this.interpolationType?Yn.interpolationFactor(this.interpolationType,t,s,l):0}}function ah(a,t){if("error"===(a=Di(a,t)).result)return a;const s=a.value.expression,l=Hn(s);if(!l&&!vl(t))return Oo([new Ur("","data expressions not supported")]);const h=gl(s,["zoom","pitch","distance-from-center"]);if(!h&&!cf(t))return Oo([new Ur("","zoom expressions not supported")]);const p=yu(s);return p||h?p instanceof Ur?Oo([p]):p instanceof Yn&&!ar(t)?Oo([new Ur("",'"interpolate" expressions cannot be used with this property')]):_u(p?new nh(l?"camera":"composite",a.value,p.labels,p instanceof Yn?p.interpolation:void 0):new xu(l?"constant":"source",a.value)):Oo([new Ur("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class Tl{constructor(t,s){this._parameters=t,this._specification=s,Nr(this,zo(this._parameters,this._specification))}static deserialize(t){return new Tl(t._parameters,t._specification)}static serialize(t){return{_parameters:t._parameters,_specification:t._specification}}}function yu(a){let t=null;if(a instanceof yl)t=yu(a.result);else if(a instanceof Yi){for(const s of a.args)if(t=yu(s),t)break}else(a instanceof fc||a instanceof Yn)&&a.input instanceof hn&&"zoom"===a.input.name&&(t=a);return t instanceof Ur||a.eachChild(s=>{const l=yu(s);l instanceof Ur?t=l:!t&&l?t=new Ur("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):t&&l&&t!==l&&(t=new Ur("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),t}class Ct{constructor(t,s,l,h){this.message=(t?`${t}: `:"")+l,h&&(this.identifier=h),null!=s&&s.__line__&&(this.line=s.__line__)}}function oa(a){const t=a.key,s=a.value,l=a.valueSpec||{},h=a.objectElementValidators||{},p=a.style,g=a.styleSpec;let v=[];const E=Er(s);if("object"!==E)return[new Ct(t,s,`object expected, ${E} found`)];for(const k in s){const M=k.split(".")[0],D=l[M]||l["*"];let R;h[M]?R=h[M]:l[M]?R=Ni:h["*"]?R=h["*"]:l["*"]&&(R=Ni),R?v=v.concat(R({key:(t&&`${t}.`)+k,value:s[k],valueSpec:D,style:p,styleSpec:g,object:s,objectKey:k},s)):v.push(new Ct(t,s[k],`unknown property "${k}"`))}for(const k in l)h[k]||l[k].required&&void 0===l[k].default&&void 0===s[k]&&v.push(new Ct(t,s,`missing required property "${k}"`));return v}function yc(a){const t=a.value,s=a.valueSpec,l=a.style,h=a.styleSpec,p=a.key,g=a.arrayElementValidator||Ni;if("array"!==Er(t))return[new Ct(p,t,`array expected, ${Er(t)} found`)];if(s.length&&t.length!==s.length)return[new Ct(p,t,`array length ${s.length} expected, length ${t.length} found`)];if(s["min-length"]&&t.length<s["min-length"])return[new Ct(p,t,`array length at least ${s["min-length"]} expected, length ${t.length} found`)];let v={type:s.value,values:s.values,minimum:s.minimum,maximum:s.maximum,function:void 0};h.$version<7&&(v.function=s.function),"object"===Er(s.value)&&(v=s.value);let E=[];for(let k=0;k<t.length;k++)E=E.concat(g({array:t,arrayIndex:k,value:t[k],valueSpec:v,style:l,styleSpec:h,key:`${p}[${k}]`}));return E}function Ei(a){const t=a.key,s=a.value,l=a.valueSpec;let h=Er(s);if("number"===h&&s!=s&&(h="NaN"),"number"!==h)return[new Ct(t,s,`number expected, ${h} found`)];if("minimum"in l){let p=l.minimum;if("array"===Er(l.minimum)&&(p=l.minimum[a.arrayIndex]),s<p)return[new Ct(t,s,`${s} is less than the minimum value ${p}`)]}if("maximum"in l){let p=l.maximum;if("array"===Er(l.maximum)&&(p=l.maximum[a.arrayIndex]),s>p)return[new Ct(t,s,`${s} is greater than the maximum value ${p}`)]}return[]}function Ws(a){const t=a.valueSpec,s=Vt(a.value.type);let l,h,p,g={};const v="categorical"!==s&&void 0===a.value.property,E=!v,k="array"===Er(a.value.stops)&&"array"===Er(a.value.stops[0])&&"object"===Er(a.value.stops[0][0]),M=oa({key:a.key,value:a.value,valueSpec:a.styleSpec.function,style:a.style,styleSpec:a.styleSpec,objectElementValidators:{stops:function(z){if("identity"===s)return[new Ct(z.key,z.value,'identity function may not have a "stops" property')];let q=[];const K=z.value;return q=q.concat(yc({key:z.key,value:K,valueSpec:z.valueSpec,style:z.style,styleSpec:z.styleSpec,arrayElementValidator:D})),"array"===Er(K)&&0===K.length&&q.push(new Ct(z.key,K,"array must have at least one stop")),q},default:function(z){return Ni({key:z.key,value:z.value,valueSpec:t,style:z.style,styleSpec:z.styleSpec})}}});return"identity"===s&&v&&M.push(new Ct(a.key,a.value,'missing required property "property"')),"identity"===s||a.value.stops||M.push(new Ct(a.key,a.value,'missing required property "stops"')),"exponential"===s&&a.valueSpec.expression&&!ar(a.valueSpec)&&M.push(new Ct(a.key,a.value,"exponential functions not supported")),a.styleSpec.$version>=8&&(E&&!vl(a.valueSpec)?M.push(new Ct(a.key,a.value,"property functions not supported")):v&&!cf(a.valueSpec)&&M.push(new Ct(a.key,a.value,"zoom functions not supported"))),"categorical"!==s&&!k||void 0!==a.value.property||M.push(new Ct(a.key,a.value,'"property" property is required')),M;function D(z){let q=[];const K=z.value,ee=z.key;if("array"!==Er(K))return[new Ct(ee,K,`array expected, ${Er(K)} found`)];if(2!==K.length)return[new Ct(ee,K,`array length 2 expected, length ${K.length} found`)];if(k){if("object"!==Er(K[0]))return[new Ct(ee,K,`object expected, ${Er(K[0])} found`)];if(void 0===K[0].zoom)return[new Ct(ee,K,"object stop key must have zoom")];if(void 0===K[0].value)return[new Ct(ee,K,"object stop key must have value")];const ne=Vt(K[0].zoom);if("number"!=typeof ne)return[new Ct(ee,K[0].zoom,"stop zoom values must be numbers")];if(p&&p>ne)return[new Ct(ee,K[0].zoom,"stop zoom values must appear in ascending order")];ne!==p&&(p=ne,h=void 0,g={}),q=q.concat(oa({key:`${ee}[0]`,value:K[0],valueSpec:{zoom:{}},style:z.style,styleSpec:z.styleSpec,objectElementValidators:{zoom:Ei,value:R}}))}else q=q.concat(R({key:`${ee}[0]`,value:K[0],valueSpec:{},style:z.style,styleSpec:z.styleSpec},K));return us(Or(K[1]))?q.concat([new Ct(`${ee}[1]`,K[1],"expressions are not allowed in function stops.")]):q.concat(Ni({key:`${ee}[1]`,value:K[1],valueSpec:t,style:z.style,styleSpec:z.styleSpec}))}function R(z,q){const K=Er(z.value),ee=Vt(z.value),ne=null!==z.value?z.value:q;if(l){if(K!==l)return[new Ct(z.key,ne,`${K} stop domain type must match previous stop domain type ${l}`)]}else l=K;if("number"!==K&&"string"!==K&&"boolean"!==K&&"number"!=typeof ee&&"string"!=typeof ee&&"boolean"!=typeof ee)return[new Ct(z.key,ne,"stop domain value must be a number, string, or boolean")];if("number"!==K&&"categorical"!==s){let ve=`number expected, ${K} found`;return vl(t)&&void 0===s&&(ve+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Ct(z.key,ne,ve)]}return"categorical"!==s||"number"!==K||"number"==typeof ee&&isFinite(ee)&&Math.floor(ee)===ee?"categorical"!==s&&"number"===K&&"number"==typeof ee&&"number"==typeof h&&void 0!==h&&ee<h?[new Ct(z.key,ne,"stop domain values must appear in ascending order")]:(h=ee,"categorical"===s&&ee in g?[new Ct(z.key,ne,"stop domain values must be unique")]:(g[ee]=!0,[])):[new Ct(z.key,ne,`integer expected, found ${String(ee)}`)]}}function Kr(a){const t=("property"===a.expressionContext?ah:Di)(Or(a.value),a.valueSpec);if("error"===t.result)return t.value.map(l=>new Ct(`${a.key}${l.key}`,a.value,l.message));const s=t.value.expression||t.value._styleExpression.expression;if("property"===a.expressionContext&&"text-font"===a.propertyKey&&!s.outputDefined())return[new Ct(a.key,a.value,`Invalid data expression for "${a.propertyKey}". Output values must be contained as literals within the expression.`)];if("property"===a.expressionContext&&"layout"===a.propertyType&&!or(s))return[new Ct(a.key,a.value,'"feature-state" data expressions are not supported with layout properties.')];if("filter"===a.expressionContext)return ii(s,a);if(a.expressionContext&&0===a.expressionContext.indexOf("cluster")){if(!gl(s,["zoom","feature-state"]))return[new Ct(a.key,a.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if("cluster-initial"===a.expressionContext&&!Hn(s))return[new Ct(a.key,a.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function ii(a,t){const s=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(t.valueSpec&&t.valueSpec.expression)for(const h of t.valueSpec.expression.parameters)s.delete(h);if(0===s.size)return[];const l=[];return a instanceof hn&&s.has(a.name)?[new Ct(t.key,t.value,`["${a.name}"] expression is not supported in a filter for a ${t.object.type} layer with id: ${t.object.id}`)]:(a.eachChild(h=>{l.push(...ii(h,t))}),l)}function Pn(a){const t=a.key,s=a.value,l=a.valueSpec,h=[];return Array.isArray(l.values)?-1===l.values.indexOf(Vt(s))&&h.push(new Ct(t,s,`expected one of [${l.values.join(", ")}], ${JSON.stringify(s)} found`)):-1===Object.keys(l.values).indexOf(Vt(s))&&h.push(new Ct(t,s,`expected one of [${Object.keys(l.values).join(", ")}], ${JSON.stringify(s)} found`)),h}function Xs(a){if(!0===a||!1===a)return!0;if(!Array.isArray(a)||0===a.length)return!1;switch(a[0]){case"has":return a.length>=2&&"$id"!==a[1]&&"$type"!==a[1];case"in":return a.length>=3&&("string"!=typeof a[1]||Array.isArray(a[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return 3!==a.length||Array.isArray(a[1])||Array.isArray(a[2]);case"any":case"all":for(const t of a.slice(1))if(!Xs(t)&&"boolean"!=typeof t)return!1;return!0;default:return!0}}function la(a,t="fill"){if(null==a)return{filter:()=>!0,needGeometry:!1,needFeature:!1};Xs(a)||(a=Si(a));const s=a;let l=!0;try{l=function(k){if(!hs(k))return k;let M=Or(k);return oh(M),M=sh(M),M}(s)}catch(k){console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.\nThis is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md\nand paste the contents of this message in the report.\nThank you!\nFilter Expression:\n${JSON.stringify(s,null,2)}\n        `)}const h=Ze[`filter_${t}`],p=Di(l,h);let g=null;if("error"===p.result)throw new Error(p.value.map(k=>`${k.key}: ${k.message}`).join(", "));g=(k,M,D)=>p.value.evaluate(k,M,{},D);let v=null,E=null;if(l!==s){const k=Di(s,h);if("error"===k.result)throw new Error(k.value.map(M=>`${M.key}: ${M.message}`).join(", "));v=(M,D,R,z,q)=>k.value.evaluate(M,D,{},R,void 0,void 0,z,q),E=!Hn(k.value.expression)}return g=g,{filter:g,dynamicFilter:v||void 0,needGeometry:El(l),needFeature:!!E}}function sh(a){if(!Array.isArray(a))return a;const t=function(s){if(ff.has(s[0]))for(let l=1;l<s.length;l++)if(hs(s[l]))return!0;return s}(a);return!0===t?t:t.map(s=>sh(s))}function oh(a){let t=!1;const s=[];if("case"===a[0]){for(let l=1;l<a.length-1;l+=2)t=t||hs(a[l]),s.push(a[l+1]);s.push(a[a.length-1])}else if("match"===a[0]){t=t||hs(a[1]);for(let l=2;l<a.length-1;l+=2)s.push(a[l+1]);s.push(a[a.length-1])}else if("step"===a[0]){t=t||hs(a[1]);for(let l=1;l<a.length-1;l+=2)s.push(a[l+1])}t&&(a.length=0,a.push("any",...s));for(let l=1;l<a.length;l++)oh(a[l])}function hs(a){if(!Array.isArray(a))return!1;if("pitch"===(t=a[0])||"distance-from-center"===t)return!0;var t;for(let s=1;s<a.length;s++)if(hs(a[s]))return!0;return!1}const ff=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function Jn(a,t){return a<t?-1:a>t?1:0}function El(a){if(!Array.isArray(a))return!1;if("within"===a[0])return!0;for(let t=1;t<a.length;t++)if(El(a[t]))return!0;return!1}function Si(a){if(!a)return!0;const t=a[0];return a.length<=1?"any"!==t:"=="===t?fn(a[1],a[2],"=="):"!="===t?mr(fn(a[1],a[2],"==")):"<"===t||">"===t||"<="===t||">="===t?fn(a[1],a[2],t):"any"===t?(s=a.slice(1),["any"].concat(s.map(Si))):"all"===t?["all"].concat(a.slice(1).map(Si)):"none"===t?["all"].concat(a.slice(1).map(Si).map(mr)):"in"===t?vu(a[1],a.slice(2)):"!in"===t?mr(vu(a[1],a.slice(2))):"has"===t?wu(a[1]):"!has"===t?mr(wu(a[1])):"within"!==t||a;var s}function fn(a,t,s){switch(a){case"$type":return[`filter-type-${s}`,t];case"$id":return[`filter-id-${s}`,t];default:return[`filter-${s}`,a,t]}}function vu(a,t){if(0===t.length)return!1;switch(a){case"$type":return["filter-type-in",["literal",t]];case"$id":return["filter-id-in",["literal",t]];default:return t.length>200&&!t.some(s=>typeof s!=typeof t[0])?["filter-in-large",a,["literal",t.sort(Jn)]]:["filter-in-small",a,["literal",t]]}}function wu(a){switch(a){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",a]}}function mr(a){return["!",a]}function Ha(a){return Xs(Or(a.value))?Kr(Nr({},a,{expressionContext:"filter",valueSpec:a.styleSpec[`filter_${a.layerType||"fill"}`]})):bu(a)}function bu(a){const t=a.value,s=a.key;if("array"!==Er(t))return[new Ct(s,t,`array expected, ${Er(t)} found`)];const l=a.styleSpec;let h,p=[];if(t.length<1)return[new Ct(s,t,"filter array must have at least 1 element")];switch(p=p.concat(Pn({key:`${s}[0]`,value:t[0],valueSpec:l.filter_operator,style:a.style,styleSpec:a.styleSpec})),Vt(t[0])){case"<":case"<=":case">":case">=":t.length>=2&&"$type"===Vt(t[1])&&p.push(new Ct(s,t,`"$type" cannot be use with operator "${t[0]}"`));case"==":case"!=":3!==t.length&&p.push(new Ct(s,t,`filter array for operator "${t[0]}" must have 3 elements`));case"in":case"!in":t.length>=2&&(h=Er(t[1]),"string"!==h&&p.push(new Ct(`${s}[1]`,t[1],`string expected, ${h} found`)));for(let g=2;g<t.length;g++)h=Er(t[g]),"$type"===Vt(t[1])?p=p.concat(Pn({key:`${s}[${g}]`,value:t[g],valueSpec:l.geometry_type,style:a.style,styleSpec:a.styleSpec})):"string"!==h&&"number"!==h&&"boolean"!==h&&p.push(new Ct(`${s}[${g}]`,t[g],`string, number, or boolean expected, ${h} found`));break;case"any":case"all":case"none":for(let g=1;g<t.length;g++)p=p.concat(bu({key:`${s}[${g}]`,value:t[g],style:a.style,styleSpec:a.styleSpec}));break;case"has":case"!has":h=Er(t[1]),2!==t.length?p.push(new Ct(s,t,`filter array for "${t[0]}" operator must have 2 elements`)):"string"!==h&&p.push(new Ct(`${s}[1]`,t[1],`string expected, ${h} found`));break;case"within":h=Er(t[1]),2!==t.length?p.push(new Ct(s,t,`filter array for "${t[0]}" operator must have 2 elements`)):"object"!==h&&p.push(new Ct(`${s}[1]`,t[1],`object expected, ${h} found`))}return p}function Bo(a,t){const s=a.key,l=a.style,h=a.styleSpec,p=a.value,g=a.objectKey,v=h[`${t}_${a.layerType}`];if(!v)return[];const E=g.match(/^(.*)-transition$/);if("paint"===t&&E&&v[E[1]]&&v[E[1]].transition)return Ni({key:s,value:p,valueSpec:h.transition,style:l,styleSpec:h});const k=a.valueSpec||v[g];if(!k)return[new Ct(s,p,`unknown property "${g}"`)];let M;if("string"===Er(p)&&vl(k)&&!k.tokens&&(M=/^{([^}]+)}$/.exec(p)))return[new Ct(s,p,`"${g}" does not support interpolation syntax\nUse an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(M[1])} }\`.`)];const D=[];return"symbol"===a.layerType&&("text-field"===g&&l&&!l.glyphs&&D.push(new Ct(s,p,'use of "text-field" requires a style "glyphs" property')),"text-font"===g&&wl(Or(p))&&"identity"===Vt(p.type)&&D.push(new Ct(s,p,'"text-font" does not support identity functions'))),D.concat(Ni({key:a.key,value:p,valueSpec:k,style:l,styleSpec:h,expressionContext:"property",propertyType:t,propertyKey:g}))}function xi(a){return Bo(a,"paint")}function lh(a){return Bo(a,"layout")}function ch(a){let t=[];const s=a.value,l=a.key,h=a.style,p=a.styleSpec;s.type||s.ref||t.push(new Ct(l,s,'either "type" or "ref" is required'));let g=Vt(s.type);const v=Vt(s.ref);if(s.id){const E=Vt(s.id);for(let k=0;k<a.arrayIndex;k++){const M=h.layers[k];Vt(M.id)===E&&t.push(new Ct(l,s.id,`duplicate layer id "${s.id}", previously used at line ${M.id.__line__}`))}}if("ref"in s){let E;["type","source","source-layer","filter","layout"].forEach(k=>{k in s&&t.push(new Ct(l,s[k],`"${k}" is prohibited for ref layers`))}),h.layers.forEach(k=>{Vt(k.id)===v&&(E=k)}),E?E.ref?t.push(new Ct(l,s.ref,"ref cannot reference another ref layer")):g=Vt(E.type):"string"==typeof v&&t.push(new Ct(l,s.ref,`ref layer "${v}" not found`))}else if("background"!==g&&"sky"!==g)if(s.source){const E=h.sources&&h.sources[s.source],k=E&&Vt(E.type);E?"vector"===k&&"raster"===g?t.push(new Ct(l,s.source,`layer "${s.id}" requires a raster source`)):"raster"===k&&"raster"!==g?t.push(new Ct(l,s.source,`layer "${s.id}" requires a vector source`)):"vector"!==k||s["source-layer"]?"raster-dem"===k&&"hillshade"!==g?t.push(new Ct(l,s.source,"raster-dem source can only be used with layer type 'hillshade'.")):"line"!==g||!s.paint||!s.paint["line-gradient"]||"geojson"===k&&E.lineMetrics||t.push(new Ct(l,s,`layer "${s.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):t.push(new Ct(l,s,`layer "${s.id}" must specify a "source-layer"`)):t.push(new Ct(l,s.source,`source "${s.source}" not found`))}else t.push(new Ct(l,s,'missing required property "source"'));return t=t.concat(oa({key:l,value:s,valueSpec:p.layer,style:a.style,styleSpec:a.styleSpec,objectElementValidators:{"*":()=>[],type:()=>Ni({key:`${l}.type`,value:s.type,valueSpec:p.layer.type,style:a.style,styleSpec:a.styleSpec,object:s,objectKey:"type"}),filter:E=>Ha(Nr({layerType:g},E)),layout:E=>oa({layer:s,key:E.key,value:E.value,valueSpec:{},style:E.style,styleSpec:E.styleSpec,objectElementValidators:{"*":k=>lh(Nr({layerType:g},k))}}),paint:E=>oa({layer:s,key:E.key,value:E.value,valueSpec:{},style:E.style,styleSpec:E.styleSpec,objectElementValidators:{"*":k=>xi(Nr({layerType:g},k))}})}})),t}function fs(a){const t=a.value,s=a.key,l=Er(t);return"string"!==l?[new Ct(s,t,`string expected, ${l} found`)]:[]}const dn={promoteId:function({key:a,value:t}){if("string"===Er(t))return fs({key:a,value:t});{const s=[];for(const l in t)s.push(...fs({key:`${a}.${l}`,value:t[l]}));return s}}};function df(a){const t=a.value,s=a.key,l=a.styleSpec,h=a.style;if(!t.type)return[new Ct(s,t,'"type" is required')];const p=Vt(t.type);let g;switch(p){case"vector":case"raster":case"raster-dem":return g=oa({key:s,value:t,valueSpec:l[`source_${p.replace("-","_")}`],style:a.style,styleSpec:l,objectElementValidators:dn}),g;case"geojson":if(g=oa({key:s,value:t,valueSpec:l.source_geojson,style:h,styleSpec:l,objectElementValidators:dn}),t.cluster)for(const v in t.clusterProperties){const[E,k]=t.clusterProperties[v],M="string"==typeof E?[E,["accumulated"],["get",v]]:E;g.push(...Kr({key:`${s}.${v}.map`,value:k,expressionContext:"cluster-map"})),g.push(...Kr({key:`${s}.${v}.reduce`,value:M,expressionContext:"cluster-reduce"}))}return g;case"video":return oa({key:s,value:t,valueSpec:l.source_video,style:h,styleSpec:l});case"image":return oa({key:s,value:t,valueSpec:l.source_image,style:h,styleSpec:l});case"canvas":return[new Ct(s,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Pn({key:`${s}.type`,value:t.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:h,styleSpec:l})}}function pf(a){const t=a.value,s=a.styleSpec,l=s.light,h=a.style;let p=[];const g=Er(t);if(void 0===t)return p;if("object"!==g)return p=p.concat([new Ct("light",t,`object expected, ${g} found`)]),p;for(const v in t){const E=v.match(/^(.*)-transition$/);p=p.concat(E&&l[E[1]]&&l[E[1]].transition?Ni({key:v,value:t[v],valueSpec:s.transition,style:h,styleSpec:s}):l[v]?Ni({key:v,value:t[v],valueSpec:l[v],style:h,styleSpec:s}):[new Ct(v,t[v],`unknown property "${v}"`)])}return p}function gr(a){const t=a.value,s=a.key,l=a.style,h=a.styleSpec,p=h.terrain;let g=[];const v=Er(t);if(void 0===t)return g;if("object"!==v)return g=g.concat([new Ct("terrain",t,`object expected, ${v} found`)]),g;for(const E in t){const k=E.match(/^(.*)-transition$/);g=g.concat(k&&p[k[1]]&&p[k[1]].transition?Ni({key:E,value:t[E],valueSpec:h.transition,style:l,styleSpec:h}):p[E]?Ni({key:E,value:t[E],valueSpec:p[E],style:l,styleSpec:h}):[new Ct(E,t[E],`unknown property "${E}"`)])}if(t.source){const E=l.sources&&l.sources[t.source],k=E&&Vt(E.type);E?"raster-dem"!==k&&g.push(new Ct(s,t.source,`terrain cannot be used with a source of type ${String(k)}, it only be used with a "raster-dem" source type`)):g.push(new Ct(s,t.source,`source "${t.source}" not found`))}else g.push(new Ct(s,t,'terrain is missing required property "source"'));return g}function Za(a){const t=a.value,s=a.style,l=a.styleSpec,h=l.fog;let p=[];const g=Er(t);if(void 0===t)return p;if("object"!==g)return p=p.concat([new Ct("fog",t,`object expected, ${g} found`)]),p;for(const v in t){const E=v.match(/^(.*)-transition$/);p=p.concat(E&&h[E[1]]&&h[E[1]].transition?Ni({key:v,value:t[v],valueSpec:l.transition,style:s,styleSpec:l}):h[v]?Ni({key:v,value:t[v],valueSpec:h[v],style:s,styleSpec:l}):[new Ct(v,t[v],`unknown property "${v}"`)])}return p}const vc={"*":()=>[],array:yc,boolean:function(a){const t=a.value,s=a.key,l=Er(t);return"boolean"!==l?[new Ct(s,t,`boolean expected, ${l} found`)]:[]},number:Ei,color:function(a){const t=a.key,s=a.value,l=Er(s);return"string"!==l?[new Ct(t,s,`color expected, ${l} found`)]:null===Wn.parseCSSColor(s)?[new Ct(t,s,`color expected, "${s}" found`)]:[]},enum:Pn,filter:Ha,function:Ws,layer:ch,object:oa,source:df,light:pf,terrain:gr,fog:Za,string:fs,formatted:function(a){return 0===fs(a).length?[]:Kr(a)},resolvedImage:function(a){return 0===fs(a).length?[]:Kr(a)},projection:function(a){const t=a.value,s=a.styleSpec,l=s.projection,h=a.style;let p=[];const g=Er(t);if("object"===g)for(const v in t)p=p.concat(Ni({key:v,value:t[v],valueSpec:l[v],style:h,styleSpec:s}));else"string"!==g&&(p=p.concat([new Ct("projection",t,`object or string expected, ${g} found`)]));return p}};function Ni(a){const t=a.value,s=a.valueSpec,l=a.styleSpec;return s.expression&&wl(Vt(t))?Ws(a):s.expression&&us(Or(t))?Kr(a):s.type&&vc[s.type]?vc[s.type](a):oa(Nr({},a,{valueSpec:s.type?l[s.type]:s}))}function Sr(a){const t=a.value,s=a.key,l=fs(a);return l.length||(-1===t.indexOf("{fontstack}")&&l.push(new Ct(s,t,'"glyphs" url must include a "{fontstack}" token')),-1===t.indexOf("{range}")&&l.push(new Ct(s,t,'"glyphs" url must include a "{range}" token'))),l}function No(a,t=Ze){return Ya(Ni({key:"",value:a,valueSpec:t.$root,styleSpec:t,style:a,objectElementValidators:{glyphs:Sr,"*":()=>[]}}))}const ld=a=>Ya(xi(a)),ni=a=>Ya(lh(a));function Ya(a){return a.slice().sort((t,s)=>t.line&&s.line?t.line-s.line:0)}function uh(a,t){let s=!1;if(t&&t.length)for(const l of t)a.fire(new Kt(new Error(l.message))),s=!0;return s}var ds=Ka;function Ka(a,t,s){var l=this.cells=[];if(a instanceof ArrayBuffer){this.arrayBuffer=a;var h=new Int32Array(this.arrayBuffer);a=h[0],this.d=(t=h[1])+2*(s=h[2]);for(var p=0;p<this.d*this.d;p++){var g=h[3+p],v=h[3+p+1];l.push(g===v?null:h.subarray(g,v))}var E=h[3+l.length+1];this.keys=h.subarray(h[3+l.length],E),this.bboxes=h.subarray(E),this.insert=this._insertReadonly}else{this.d=t+2*s;for(var k=0;k<this.d*this.d;k++)l.push([]);this.keys=[],this.bboxes=[]}this.n=t,this.extent=a,this.padding=s,this.scale=t/a,this.uid=0;var M=s/t*a;this.min=-M,this.max=a+M}Ka.prototype.insert=function(a,t,s,l,h){this._forEachCell(t,s,l,h,this._insertCell,this.uid++),this.keys.push(a),this.bboxes.push(t),this.bboxes.push(s),this.bboxes.push(l),this.bboxes.push(h)},Ka.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},Ka.prototype._insertCell=function(a,t,s,l,h,p){this.cells[h].push(p)},Ka.prototype.query=function(a,t,s,l,h){var p=this.min,g=this.max;if(a<=p&&t<=p&&g<=s&&g<=l&&!h)return Array.prototype.slice.call(this.keys);var v=[];return this._forEachCell(a,t,s,l,this._queryCell,v,{},h),v},Ka.prototype._queryCell=function(a,t,s,l,h,p,g,v){var E=this.cells[h];if(null!==E)for(var k=this.keys,M=this.bboxes,D=0;D<E.length;D++){var R=E[D];if(void 0===g[R]){var z=4*R;(v?v(M[z+0],M[z+1],M[z+2],M[z+3]):a<=M[z+2]&&t<=M[z+3]&&s>=M[z+0]&&l>=M[z+1])?(g[R]=!0,p.push(k[R])):g[R]=!1}}},Ka.prototype._forEachCell=function(a,t,s,l,h,p,g,v){for(var E=this._convertToCellCoord(a),k=this._convertToCellCoord(t),M=this._convertToCellCoord(s),D=this._convertToCellCoord(l),R=E;R<=M;R++)for(var z=k;z<=D;z++){var q=this.d*z+R;if((!v||v(this._convertFromCellCoord(R),this._convertFromCellCoord(z),this._convertFromCellCoord(R+1),this._convertFromCellCoord(z+1)))&&h.call(this,a,t,s,l,q,p,g,v))return}},Ka.prototype._convertFromCellCoord=function(a){return(a-this.padding)/this.scale},Ka.prototype._convertToCellCoord=function(a){return Math.max(0,Math.min(this.d-1,Math.floor(a*this.scale)+this.padding))},Ka.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var a=this.cells,t=3+this.cells.length+1+1,s=0,l=0;l<this.cells.length;l++)s+=this.cells[l].length;var h=new Int32Array(t+s+this.keys.length+this.bboxes.length);h[0]=this.extent,h[1]=this.n,h[2]=this.padding;for(var p=t,g=0;g<a.length;g++){var v=a[g];h[3+g]=p,h.set(v,p),p+=v.length}return h[3+a.length]=p,h.set(this.keys,p),h[3+a.length+1]=p+=this.keys.length,h.set(this.bboxes,p),p+=this.bboxes.length,h.buffer};const Uo={};function Dt(a,t,s={}){Object.defineProperty(a,"_classRegistryKey",{value:t,writeable:!1}),Uo[t]={klass:a,omit:s.omit||[]}}Dt(Object,"Object"),ds.serialize=function(a,t){const s=a.toArrayBuffer();return t&&t.push(s),{buffer:s}},ds.deserialize=function(a){return new ds(a.buffer)},Object.defineProperty(ds,"name",{value:"Grid"}),Dt(ds,"Grid"),Dt(Fr,"Color"),Dt(Error,"Error"),Dt(Z,"AJAXError"),Dt(Ji,"ResolvedImage"),Dt(Tl,"StylePropertyFunction"),Dt(gu,"StyleExpression",{omit:["_evaluator"]}),Dt(nh,"ZoomDependentExpression"),Dt(xu,"ZoomConstantExpression"),Dt(hn,"CompoundExpression",{omit:["_evaluate"]});for(const a in wn)Uo[wn[a]._classRegistryKey]||Dt(wn[a],`Expression${a}`);function yi(a){return a&&"undefined"!=typeof ArrayBuffer&&(a instanceof ArrayBuffer||a.constructor&&"ArrayBuffer"===a.constructor.name)}function Sl(a){return Zt.ImageBitmap&&a instanceof Zt.ImageBitmap}function Al(a,t){if(null==a||"boolean"==typeof a||"number"==typeof a||"string"==typeof a||a instanceof Boolean||a instanceof Number||a instanceof String||a instanceof Date||a instanceof RegExp)return a;if(yi(a)||Sl(a))return t&&t.push(a),a;if(ArrayBuffer.isView(a)){const s=a;return t&&t.push(s.buffer),s}if(a instanceof Zt.ImageData)return t&&t.push(a.data.buffer),a;if(Array.isArray(a)){const s=[];for(const l of a)s.push(Al(l,t));return s}if("object"==typeof a){const s=a.constructor,l=s._classRegistryKey;if(!l)throw new Error(`can't serialize object of unregistered class ${l}`);const h=s.serialize?s.serialize(a,t):{};if(!s.serialize){for(const p in a)a.hasOwnProperty(p)&&(Uo[l].omit.indexOf(p)>=0||(h[p]=Al(a[p],t)));a instanceof Error&&(h.message=a.message)}if(h.$name)throw new Error("$name property is reserved for worker serialization logic.");return"Object"!==l&&(h.$name=l),h}throw new Error("can't serialize object of type "+typeof a)}function Zo(a){if(null==a||"boolean"==typeof a||"number"==typeof a||"string"==typeof a||a instanceof Boolean||a instanceof Number||a instanceof String||a instanceof Date||a instanceof RegExp||yi(a)||Sl(a)||ArrayBuffer.isView(a)||a instanceof Zt.ImageData)return a;if(Array.isArray(a))return a.map(Zo);if("object"==typeof a){const t=a.$name||"Object",{klass:s}=Uo[t];if(!s)throw new Error(`can't deserialize unregistered class ${t}`);if(s.deserialize)return s.deserialize(a);const l=Object.create(s.prototype);for(const h of Object.keys(a))"$name"!==h&&(l[h]=Zo(a[h]));return l}throw new Error("can't deserialize object of type "+typeof a)}class kl{constructor(){this.first=!0}update(t,s){const l=Math.floor(t);return this.first?(this.first=!1,this.lastIntegerZoom=l,this.lastIntegerZoomTime=0,this.lastZoom=t,this.lastFloorZoom=l,!0):(this.lastFloorZoom>l?(this.lastIntegerZoom=l+1,this.lastIntegerZoomTime=s):this.lastFloorZoom<l&&(this.lastIntegerZoom=l,this.lastIntegerZoomTime=s),t!==this.lastZoom&&(this.lastZoom=t,this.lastFloorZoom=l,!0))}}const di=a=>a>=1536&&a<=1791,ca=a=>a>=1872&&a<=1919,wc=a=>a>=2208&&a<=2303,Tu=a=>a>=11904&&a<=12031,mf=a=>a>=12032&&a<=12255,hh=a=>a>=12272&&a<=12287,Eu=a=>a>=12288&&a<=12351,Cl=a=>a>=12352&&a<=12447,bc=a=>a>=12448&&a<=12543,tn=a=>a>=12544&&a<=12591,Il=a=>a>=12704&&a<=12735,At=a=>a>=12736&&a<=12783,Tc=a=>a>=12784&&a<=12799,_f=a=>a>=12800&&a<=13055,Su=a=>a>=13056&&a<=13311,Ml=a=>a>=13312&&a<=19903,Pi=a=>a>=19968&&a<=40959,ps=a=>a>=40960&&a<=42127,Qn=a=>a>=42128&&a<=42191,gf=a=>a>=44032&&a<=55215,Ec=a=>a>=63744&&a<=64255,Au=a=>a>=64336&&a<=65023,fh=a=>a>=65040&&a<=65055,Vo=a=>a>=65072&&a<=65103,Sc=a=>a>=65104&&a<=65135,Ac=a=>a>=65136&&a<=65279,ku=a=>a>=65280&&a<=65519;function kc(a){for(const t of a)if(Fl(t.charCodeAt(0)))return!0;return!1}function jo(a){for(const t of a)if(!dh(t.charCodeAt(0)))return!1;return!0}function dh(a){return!(di(a)||ca(a)||wc(a)||Au(a)||Ac(a))}function Fl(a){return!(746!==a&&747!==a&&(a<4352||!(Il(a)||tn(a)||Vo(a)&&!(a>=65097&&a<=65103)||Ec(a)||Su(a)||Tu(a)||At(a)||!(!Eu(a)||a>=12296&&a<=12305||a>=12308&&a<=12319||12336===a)||Ml(a)||Pi(a)||_f(a)||(t=a,t>=12592&&t<=12687)||(t=>t>=43360&&t<=43391)(a)||(t=>t>=55216&&t<=55295)(a)||(t=>t>=4352&&t<=4607)(a)||gf(a)||Cl(a)||hh(a)||(t=>t>=12688&&t<=12703)(a)||mf(a)||Tc(a)||bc(a)&&12540!==a||!(!ku(a)||65288===a||65289===a||65293===a||a>=65306&&a<=65310||65339===a||65341===a||65343===a||a>=65371&&a<=65503||65507===a||a>=65512&&a<=65519)||!(!Sc(a)||a>=65112&&a<=65118||a>=65123&&a<=65126)||(t=>t>=5120&&t<=5759)(a)||(t=>t>=6320&&t<=6399)(a)||fh(a)||(t=>t>=19904&&t<=19967)(a)||ps(a)||Qn(a))));var t}function Cc(a){return!(Fl(a)||(t=a,(s=t)>=128&&s<=255&&(167===t||169===t||174===t||177===t||188===t||189===t||190===t||215===t||247===t)||(s=>s>=8192&&s<=8303)(t)&&(8214===t||8224===t||8225===t||8240===t||8241===t||8251===t||8252===t||8258===t||8263===t||8264===t||8265===t||8273===t)||(s=>s>=8448&&s<=8527)(t)||(s=>s>=8528&&s<=8591)(t)||(s=>s>=8960&&s<=9215)(t)&&(t>=8960&&t<=8967||t>=8972&&t<=8991||t>=8996&&t<=9e3||9003===t||t>=9085&&t<=9114||t>=9150&&t<=9165||9167===t||t>=9169&&t<=9179||t>=9186&&t<=9215)||(s=>s>=9216&&s<=9279)(t)&&9251!==t||(s=>s>=9280&&s<=9311)(t)||(s=>s>=9312&&s<=9471)(t)||(s=>s>=9632&&s<=9727)(t)||(s=>s>=9728&&s<=9983)(t)&&!(t>=9754&&t<=9759)||(s=>s>=11008&&s<=11263)(t)&&(t>=11026&&t<=11055||t>=11088&&t<=11097||t>=11192&&t<=11243)||Eu(t)||bc(t)||(s=>s>=57344&&s<=63743)(t)||Vo(t)||Sc(t)||ku(t)||8734===t||8756===t||8757===t||t>=9984&&t<=10087||t>=10102&&t<=10131||65532===t||65533===t));var t,s}function Dl(a){return a>=1424&&a<=2303||Au(a)||Ac(a)}function xf(a,t){return!(!t&&Dl(a)||a>=2304&&a<=3583||a>=3840&&a<=4255||(s=a,s>=6016&&s<=6143));var s}function ph(a){for(const t of a)if(Dl(t.charCodeAt(0)))return!0;return!1}const Cu="deferred",qo="loading",Iu="loaded";let Ic=null,Ln="unavailable",bn=null;const Go=function(a){a&&"string"==typeof a&&a.indexOf("NetworkError")>-1&&(Ln="error"),Ic&&Ic(a)};function Hs(){Ys.fire(new Yt("pluginStateChange",{pluginStatus:Ln,pluginURL:bn}))}const Ys=new nr,xa=function(){return Ln},Pl=function(){if(Ln!==Cu||!bn)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");Ln=qo,Hs(),bn&&pe({url:bn},a=>{a?Go(a):(Ln=Iu,Hs())})},ai={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>Ln===Iu||null!=ai.applyArabicShaping,isLoading:()=>Ln===qo,setState(a){Ln=a.pluginStatus,bn=a.pluginURL},isParsed:()=>null!=ai.applyArabicShaping&&null!=ai.processBidirectionalText&&null!=ai.processStyledBidirectionalText,getPluginURL:()=>bn};class qr{constructor(t,s){this.zoom=t,s?(this.now=s.now,this.fadeDuration=s.fadeDuration,this.zoomHistory=s.zoomHistory,this.transition=s.transition,this.pitch=s.pitch):(this.now=0,this.fadeDuration=0,this.zoomHistory=new kl,this.transition={},this.pitch=0)}isSupportedScript(t){return function(s,l){for(const h of s)if(!xf(h.charCodeAt(0),l))return!1;return!0}(t,ai.isLoaded())}crossFadingFactor(){return 0===this.fadeDuration?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const t=this.zoom,s=t-Math.floor(t),l=this.crossFadingFactor();return t>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:s+(1-s)*l}:{fromScale:.5,toScale:1,t:1-(1-l)*s}}}class Mc{constructor(t,s){this.property=t,this.value=s,this.expression=function(l,h){if(wl(l))return new Tl(l,h);if(us(l)){const p=ah(l,h);if("error"===p.result)throw new Error(p.value.map(g=>`${g.key}: ${g.message}`).join(", "));return p.value}{let p=l;return"string"==typeof l&&"color"===h.type&&(p=Fr.parse(l)),{kind:"constant",evaluate:()=>p}}}(void 0===s?t.specification.default:s,t.specification)}isDataDriven(){return"source"===this.expression.kind||"composite"===this.expression.kind}possiblyEvaluate(t,s,l){return this.property.possiblyEvaluate(this,t,s,l)}}class Ja{constructor(t){this.property=t,this.value=new Mc(t,void 0)}transitioned(t,s){return new n(this.property,this.value,s,Gi({},t.transition,this.transition),t.now)}untransitioned(){return new n(this.property,this.value,null,{},0)}}class d{constructor(t){this._properties=t,this._values=Object.create(t.defaultTransitionablePropertyValues)}getValue(t){return ma(this._values[t].value.value)}setValue(t,s){this._values.hasOwnProperty(t)||(this._values[t]=new Ja(this._values[t].property)),this._values[t].value=new Mc(this._values[t].property,null===s?void 0:ma(s))}getTransition(t){return ma(this._values[t].transition)}setTransition(t,s){this._values.hasOwnProperty(t)||(this._values[t]=new Ja(this._values[t].property)),this._values[t].transition=ma(s)||void 0}serialize(){const t={};for(const s of Object.keys(this._values)){const l=this.getValue(s);void 0!==l&&(t[s]=l);const h=this.getTransition(s);void 0!==h&&(t[`${s}-transition`]=h)}return t}transitioned(t,s){const l=new u(this._properties);for(const h of Object.keys(this._values))l._values[h]=this._values[h].transitioned(t,s._values[h]);return l}untransitioned(){const t=new u(this._properties);for(const s of Object.keys(this._values))t._values[s]=this._values[s].untransitioned();return t}}class n{constructor(t,s,l,h,p){const g=h.delay||0,v=h.duration||0;p=p||0,this.property=t,this.value=s,this.begin=p+g,this.end=this.begin+v,t.specification.transition&&(h.delay||h.duration)&&(this.prior=l)}possiblyEvaluate(t,s,l){const h=t.now||0,p=this.value.possiblyEvaluate(t,s,l),g=this.prior;if(g){if(h>this.end)return this.prior=null,p;if(this.value.isDataDriven())return this.prior=null,p;if(h<this.begin)return g.possiblyEvaluate(t,s,l);{const v=(h-this.begin)/(this.end-this.begin);return this.property.interpolate(g.possiblyEvaluate(t,s,l),p,fo(v))}}return p}}class u{constructor(t){this._properties=t,this._values=Object.create(t.defaultTransitioningPropertyValues)}possiblyEvaluate(t,s,l){const h=new b(this._properties);for(const p of Object.keys(this._values))h._values[p]=this._values[p].possiblyEvaluate(t,s,l);return h}hasTransition(){for(const t of Object.keys(this._values))if(this._values[t].prior)return!0;return!1}}class m{constructor(t){this._properties=t,this._values=Object.create(t.defaultPropertyValues)}getValue(t){return ma(this._values[t].value)}setValue(t,s){this._values[t]=new Mc(this._values[t].property,null===s?void 0:ma(s))}serialize(){const t={};for(const s of Object.keys(this._values)){const l=this.getValue(s);void 0!==l&&(t[s]=l)}return t}possiblyEvaluate(t,s,l){const h=new b(this._properties);for(const p of Object.keys(this._values))h._values[p]=this._values[p].possiblyEvaluate(t,s,l);return h}}class w{constructor(t,s,l){this.property=t,this.value=s,this.parameters=l}isConstant(){return"constant"===this.value.kind}constantOr(t){return"constant"===this.value.kind?this.value.value:t}evaluate(t,s,l,h){return this.property.evaluate(this.value,this.parameters,t,s,l,h)}}class b{constructor(t){this._properties=t,this._values=Object.create(t.defaultPossiblyEvaluatedValues)}get(t){return this._values[t]}}class S{constructor(t){this.specification=t}possiblyEvaluate(t,s){return t.expression.evaluate(s)}interpolate(t,s,l){const h=dc[this.specification.type];return h?h(t,s,l):t}}class A{constructor(t,s){this.specification=t,this.overrides=s}possiblyEvaluate(t,s,l,h){return new w(this,"constant"===t.expression.kind||"camera"===t.expression.kind?{kind:"constant",value:t.expression.evaluate(s,null,{},l,h)}:t.expression,s)}interpolate(t,s,l){if("constant"!==t.value.kind||"constant"!==s.value.kind)return t;if(void 0===t.value.value||void 0===s.value.value)return new w(this,{kind:"constant",value:void 0},t.parameters);const h=dc[this.specification.type];return h?new w(this,{kind:"constant",value:h(t.value.value,s.value.value,l)},t.parameters):t}evaluate(t,s,l,h,p,g){return"constant"===t.kind?t.value:t.evaluate(s,l,h,p,g)}}class P extends A{possiblyEvaluate(t,s,l,h){if(void 0===t.value)return new w(this,{kind:"constant",value:void 0},s);if("constant"===t.expression.kind){const p=t.expression.evaluate(s,null,{},l,h),g="resolvedImage"===t.property.specification.type&&"string"!=typeof p?p.name:p,v=this._calculate(g,g,g,s);return new w(this,{kind:"constant",value:v},s)}if("camera"===t.expression.kind){const p=this._calculate(t.expression.evaluate({zoom:s.zoom-1}),t.expression.evaluate({zoom:s.zoom}),t.expression.evaluate({zoom:s.zoom+1}),s);return new w(this,{kind:"constant",value:p},s)}return new w(this,t.expression,s)}evaluate(t,s,l,h,p,g){if("source"===t.kind){const v=t.evaluate(s,l,h,p,g);return this._calculate(v,v,v,s)}return"composite"===t.kind?this._calculate(t.evaluate({zoom:Math.floor(s.zoom)-1},l,h),t.evaluate({zoom:Math.floor(s.zoom)},l,h),t.evaluate({zoom:Math.floor(s.zoom)+1},l,h),s):t.value}_calculate(t,s,l,h){return h.zoom>h.zoomHistory.lastIntegerZoom?{from:t,to:s,other:l}:{from:l,to:s,other:t}}interpolate(t){return t}}class O{constructor(t){this.specification=t}possiblyEvaluate(t,s,l,h){if(void 0!==t.value){if("constant"===t.expression.kind){const p=t.expression.evaluate(s,null,{},l,h);return this._calculate(p,p,p,s)}return this._calculate(t.expression.evaluate(new qr(Math.floor(s.zoom-1),s)),t.expression.evaluate(new qr(Math.floor(s.zoom),s)),t.expression.evaluate(new qr(Math.floor(s.zoom+1),s)),s)}}_calculate(t,s,l,h){return h.zoom>h.zoomHistory.lastIntegerZoom?{from:t,to:s}:{from:l,to:s}}interpolate(t){return t}}class L{constructor(t){this.specification=t}possiblyEvaluate(t,s,l,h){return!!t.expression.evaluate(s,null,{},l,h)}interpolate(){return!1}}class V{constructor(t){this.properties=t,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const s in t){const l=t[s];l.specification.overridable&&this.overridableProperties.push(s);const h=this.defaultPropertyValues[s]=new Mc(l,void 0),p=this.defaultTransitionablePropertyValues[s]=new Ja(l);this.defaultTransitioningPropertyValues[s]=p.untransitioned(),this.defaultPossiblyEvaluatedValues[s]=h.possiblyEvaluate({})}}}function Y(a,t){return 256*(a=wr(Math.floor(a),0,255))+wr(Math.floor(t),0,255)}Dt(A,"DataDrivenProperty"),Dt(S,"DataConstantProperty"),Dt(P,"CrossFadedDataDrivenProperty"),Dt(O,"CrossFadedProperty"),Dt(L,"ColorRampProperty");const te={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class J{constructor(t,s){this._structArray=t,this._pos1=s*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class H{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(t,s){return t._trim(),s&&(t.isTransferred=!0,s.push(t.arrayBuffer)),{length:t.length,arrayBuffer:t.arrayBuffer}}static deserialize(t){const s=Object.create(this.prototype);return s.arrayBuffer=t.arrayBuffer,s.length=t.length,s.capacity=t.arrayBuffer.byteLength/s.bytesPerElement,s._refreshViews(),s}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(t){this.reserve(t),this.length=t}reserve(t){if(t>this.capacity){this.capacity=Math.max(t,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const s=this.uint8;this._refreshViews(),s&&this.uint8.set(s)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function se(a,t=1){let s=0,l=0;return{members:a.map(h=>{const p=te[h.type].BYTES_PER_ELEMENT,g=s=ie(s,Math.max(t,p)),v=h.components||1;return l=Math.max(l,p),s+=p*v,{name:h.name,type:h.type,components:v,offset:g}}),size:ie(s,Math.max(l,t)),alignment:t}}function ie(a,t){return Math.ceil(a/t)*t}class he extends H{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,s){const l=this.length;return this.resize(l+1),this.emplace(l,t,s)}emplace(t,s,l){const h=2*t;return this.int16[h+0]=s,this.int16[h+1]=l,t}}he.prototype.bytesPerElement=4,Dt(he,"StructArrayLayout2i4");class de extends H{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,s,l){const h=this.length;return this.resize(h+1),this.emplace(h,t,s,l)}emplace(t,s,l,h){const p=3*t;return this.int16[p+0]=s,this.int16[p+1]=l,this.int16[p+2]=h,t}}de.prototype.bytesPerElement=6,Dt(de,"StructArrayLayout3i6");class ce extends H{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,s,l,h){const p=this.length;return this.resize(p+1),this.emplace(p,t,s,l,h)}emplace(t,s,l,h,p){const g=4*t;return this.int16[g+0]=s,this.int16[g+1]=l,this.int16[g+2]=h,this.int16[g+3]=p,t}}ce.prototype.bytesPerElement=8,Dt(ce,"StructArrayLayout4i8");class le extends H{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,s,l,h,p,g,v){const E=this.length;return this.resize(E+1),this.emplace(E,t,s,l,h,p,g,v)}emplace(t,s,l,h,p,g,v,E){const k=6*t,M=12*t,D=3*t;return this.int16[k+0]=s,this.int16[k+1]=l,this.uint8[M+4]=h,this.uint8[M+5]=p,this.uint8[M+6]=g,this.uint8[M+7]=v,this.float32[D+2]=E,t}}le.prototype.bytesPerElement=12,Dt(le,"StructArrayLayout2i4ub1f12");class we extends H{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,s,l,h){const p=this.length;return this.resize(p+1),this.emplace(p,t,s,l,h)}emplace(t,s,l,h,p){const g=4*t;return this.float32[g+0]=s,this.float32[g+1]=l,this.float32[g+2]=h,this.float32[g+3]=p,t}}we.prototype.bytesPerElement=16,Dt(we,"StructArrayLayout4f16");class ze extends H{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,s,l,h,p,g,v,E,k,M){const D=this.length;return this.resize(D+1),this.emplace(D,t,s,l,h,p,g,v,E,k,M)}emplace(t,s,l,h,p,g,v,E,k,M,D){const R=10*t;return this.uint16[R+0]=s,this.uint16[R+1]=l,this.uint16[R+2]=h,this.uint16[R+3]=p,this.uint16[R+4]=g,this.uint16[R+5]=v,this.uint16[R+6]=E,this.uint16[R+7]=k,this.uint16[R+8]=M,this.uint16[R+9]=D,t}}ze.prototype.bytesPerElement=20,Dt(ze,"StructArrayLayout10ui20");class Be extends H{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,s,l,h,p,g,v,E){const k=this.length;return this.resize(k+1),this.emplace(k,t,s,l,h,p,g,v,E)}emplace(t,s,l,h,p,g,v,E,k){const M=8*t;return this.uint16[M+0]=s,this.uint16[M+1]=l,this.uint16[M+2]=h,this.uint16[M+3]=p,this.uint16[M+4]=g,this.uint16[M+5]=v,this.uint16[M+6]=E,this.uint16[M+7]=k,t}}Be.prototype.bytesPerElement=16,Dt(Be,"StructArrayLayout8ui16");class Le extends H{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,s,l,h,p,g){const v=this.length;return this.resize(v+1),this.emplace(v,t,s,l,h,p,g)}emplace(t,s,l,h,p,g,v){const E=6*t;return this.int16[E+0]=s,this.int16[E+1]=l,this.int16[E+2]=h,this.int16[E+3]=p,this.int16[E+4]=g,this.int16[E+5]=v,t}}Le.prototype.bytesPerElement=12,Dt(Le,"StructArrayLayout6i12");class qe extends H{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,s,l,h,p,g,v,E,k,M,D,R,z,q,K,ee){const ne=this.length;return this.resize(ne+1),this.emplace(ne,t,s,l,h,p,g,v,E,k,M,D,R,z,q,K,ee)}emplace(t,s,l,h,p,g,v,E,k,M,D,R,z,q,K,ee,ne){const ve=16*t;return this.int16[ve+0]=s,this.int16[ve+1]=l,this.int16[ve+2]=h,this.int16[ve+3]=p,this.uint16[ve+4]=g,this.uint16[ve+5]=v,this.uint16[ve+6]=E,this.uint16[ve+7]=k,this.int16[ve+8]=M,this.int16[ve+9]=D,this.int16[ve+10]=R,this.int16[ve+11]=z,this.int16[ve+12]=q,this.int16[ve+13]=K,this.int16[ve+14]=ee,this.int16[ve+15]=ne,t}}qe.prototype.bytesPerElement=32,Dt(qe,"StructArrayLayout4i4ui4i4i32");class Qe extends H{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,s,l){const h=this.length;return this.resize(h+1),this.emplace(h,t,s,l)}emplace(t,s,l,h){const p=3*t;return this.float32[p+0]=s,this.float32[p+1]=l,this.float32[p+2]=h,t}}Qe.prototype.bytesPerElement=12,Dt(Qe,"StructArrayLayout3f12");class ke extends H{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(t){const s=this.length;return this.resize(s+1),this.emplace(s,t)}emplace(t,s){return this.uint32[1*t+0]=s,t}}ke.prototype.bytesPerElement=4,Dt(ke,"StructArrayLayout1ul4");class gt extends H{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,s,l,h,p,g,v,E,k,M,D,R,z){const q=this.length;return this.resize(q+1),this.emplace(q,t,s,l,h,p,g,v,E,k,M,D,R,z)}emplace(t,s,l,h,p,g,v,E,k,M,D,R,z,q){const K=20*t,ee=10*t;return this.int16[K+0]=s,this.int16[K+1]=l,this.int16[K+2]=h,this.int16[K+3]=p,this.int16[K+4]=g,this.float32[ee+3]=v,this.float32[ee+4]=E,this.float32[ee+5]=k,this.float32[ee+6]=M,this.int16[K+14]=D,this.uint32[ee+8]=R,this.uint16[K+18]=z,this.uint16[K+19]=q,t}}gt.prototype.bytesPerElement=40,Dt(gt,"StructArrayLayout5i4f1i1ul2ui40");class dt extends H{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,s,l,h,p,g,v){const E=this.length;return this.resize(E+1),this.emplace(E,t,s,l,h,p,g,v)}emplace(t,s,l,h,p,g,v,E){const k=8*t;return this.int16[k+0]=s,this.int16[k+1]=l,this.int16[k+2]=h,this.int16[k+4]=p,this.int16[k+5]=g,this.int16[k+6]=v,this.int16[k+7]=E,t}}dt.prototype.bytesPerElement=16,Dt(dt,"StructArrayLayout3i2i2i16");class It extends H{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,s,l,h,p){const g=this.length;return this.resize(g+1),this.emplace(g,t,s,l,h,p)}emplace(t,s,l,h,p,g){const v=4*t,E=8*t;return this.float32[v+0]=s,this.float32[v+1]=l,this.float32[v+2]=h,this.int16[E+6]=p,this.int16[E+7]=g,t}}It.prototype.bytesPerElement=16,Dt(It,"StructArrayLayout2f1f2i16");class et extends H{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,s,l,h){const p=this.length;return this.resize(p+1),this.emplace(p,t,s,l,h)}emplace(t,s,l,h,p){const g=12*t,v=3*t;return this.uint8[g+0]=s,this.uint8[g+1]=l,this.float32[v+1]=h,this.float32[v+2]=p,t}}et.prototype.bytesPerElement=12,Dt(et,"StructArrayLayout2ub2f12");class Mt extends H{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,s,l){const h=this.length;return this.resize(h+1),this.emplace(h,t,s,l)}emplace(t,s,l,h){const p=3*t;return this.uint16[p+0]=s,this.uint16[p+1]=l,this.uint16[p+2]=h,t}}Mt.prototype.bytesPerElement=6,Dt(Mt,"StructArrayLayout3ui6");class Jt extends H{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(t,s,l,h,p,g,v,E,k,M,D,R,z,q,K,ee,ne,ve,Ae,Me,De){const Pe=this.length;return this.resize(Pe+1),this.emplace(Pe,t,s,l,h,p,g,v,E,k,M,D,R,z,q,K,ee,ne,ve,Ae,Me,De)}emplace(t,s,l,h,p,g,v,E,k,M,D,R,z,q,K,ee,ne,ve,Ae,Me,De,Pe){const Xe=30*t,He=15*t,st=60*t;return this.int16[Xe+0]=s,this.int16[Xe+1]=l,this.int16[Xe+2]=h,this.float32[He+2]=p,this.float32[He+3]=g,this.uint16[Xe+8]=v,this.uint16[Xe+9]=E,this.uint32[He+5]=k,this.uint32[He+6]=M,this.uint32[He+7]=D,this.uint16[Xe+16]=R,this.uint16[Xe+17]=z,this.uint16[Xe+18]=q,this.float32[He+10]=K,this.float32[He+11]=ee,this.uint8[st+48]=ne,this.uint8[st+49]=ve,this.uint8[st+50]=Ae,this.uint32[He+13]=Me,this.int16[Xe+28]=De,this.uint8[st+58]=Pe,t}}Jt.prototype.bytesPerElement=60,Dt(Jt,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class Et extends H{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(t,s,l,h,p,g,v,E,k,M,D,R,z,q,K,ee,ne,ve,Ae,Me,De,Pe,Xe,He,st,ht,$e,rt,pt,vt){const _t=this.length;return this.resize(_t+1),this.emplace(_t,t,s,l,h,p,g,v,E,k,M,D,R,z,q,K,ee,ne,ve,Ae,Me,De,Pe,Xe,He,st,ht,$e,rt,pt,vt)}emplace(t,s,l,h,p,g,v,E,k,M,D,R,z,q,K,ee,ne,ve,Ae,Me,De,Pe,Xe,He,st,ht,$e,rt,pt,vt,_t){const wt=38*t,cr=19*t;return this.int16[wt+0]=s,this.int16[wt+1]=l,this.int16[wt+2]=h,this.float32[cr+2]=p,this.float32[cr+3]=g,this.int16[wt+8]=v,this.int16[wt+9]=E,this.int16[wt+10]=k,this.int16[wt+11]=M,this.int16[wt+12]=D,this.int16[wt+13]=R,this.uint16[wt+14]=z,this.uint16[wt+15]=q,this.uint16[wt+16]=K,this.uint16[wt+17]=ee,this.uint16[wt+18]=ne,this.uint16[wt+19]=ve,this.uint16[wt+20]=Ae,this.uint16[wt+21]=Me,this.uint16[wt+22]=De,this.uint16[wt+23]=Pe,this.uint16[wt+24]=Xe,this.uint16[wt+25]=He,this.uint16[wt+26]=st,this.uint16[wt+27]=ht,this.uint16[wt+28]=$e,this.uint32[cr+15]=rt,this.float32[cr+16]=pt,this.float32[cr+17]=vt,this.float32[cr+18]=_t,t}}Et.prototype.bytesPerElement=76,Dt(Et,"StructArrayLayout3i2f6i15ui1ul3f76");class bt extends H{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t){const s=this.length;return this.resize(s+1),this.emplace(s,t)}emplace(t,s){return this.float32[1*t+0]=s,t}}bt.prototype.bytesPerElement=4,Dt(bt,"StructArrayLayout1f4");class Ot extends H{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,s,l,h,p,g,v){const E=this.length;return this.resize(E+1),this.emplace(E,t,s,l,h,p,g,v)}emplace(t,s,l,h,p,g,v,E){const k=7*t;return this.float32[k+0]=s,this.float32[k+1]=l,this.float32[k+2]=h,this.float32[k+3]=p,this.float32[k+4]=g,this.float32[k+5]=v,this.float32[k+6]=E,t}}Ot.prototype.bytesPerElement=28,Dt(Ot,"StructArrayLayout7f28");class fr extends H{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,s,l,h,p){const g=this.length;return this.resize(g+1),this.emplace(g,t,s,l,h,p)}emplace(t,s,l,h,p,g){const v=5*t;return this.float32[v+0]=s,this.float32[v+1]=l,this.float32[v+2]=h,this.float32[v+3]=p,this.float32[v+4]=g,t}}fr.prototype.bytesPerElement=20,Dt(fr,"StructArrayLayout5f20");class Ht extends H{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,s,l,h){const p=this.length;return this.resize(p+1),this.emplace(p,t,s,l,h)}emplace(t,s,l,h,p){const g=6*t;return this.uint32[3*t+0]=s,this.uint16[g+2]=l,this.uint16[g+3]=h,this.uint16[g+4]=p,t}}Ht.prototype.bytesPerElement=12,Dt(Ht,"StructArrayLayout1ul3ui12");class rr extends H{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,s){const l=this.length;return this.resize(l+1),this.emplace(l,t,s)}emplace(t,s,l){const h=2*t;return this.uint16[h+0]=s,this.uint16[h+1]=l,t}}rr.prototype.bytesPerElement=4,Dt(rr,"StructArrayLayout2ui4");class Dr extends H{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t){const s=this.length;return this.resize(s+1),this.emplace(s,t)}emplace(t,s){return this.uint16[1*t+0]=s,t}}Dr.prototype.bytesPerElement=2,Dt(Dr,"StructArrayLayout1ui2");class vi extends H{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,s){const l=this.length;return this.resize(l+1),this.emplace(l,t,s)}emplace(t,s,l){const h=2*t;return this.float32[h+0]=s,this.float32[h+1]=l,t}}vi.prototype.bytesPerElement=8,Dt(vi,"StructArrayLayout2f8");class Tn extends H{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,s,l,h,p,g,v){const E=this.length;return this.resize(E+1),this.emplace(E,t,s,l,h,p,g,v)}emplace(t,s,l,h,p,g,v,E){const k=8*t,M=4*t;return this.int16[k+0]=s,this.int16[k+1]=l,this.int16[k+2]=h,this.int16[k+3]=p,this.int16[k+4]=g,this.int16[k+5]=v,this.float32[M+3]=E,t}}Tn.prototype.bytesPerElement=16,Dt(Tn,"StructArrayLayout6i1f16");class ui extends J{get a_pos_30(){return this._structArray.int16[this._pos2+0]}get a_pos_31(){return this._structArray.int16[this._pos2+1]}get a_pos_32(){return this._structArray.int16[this._pos2+2]}get a_pos_normal_30(){return this._structArray.int16[this._pos2+3]}get a_pos_normal_31(){return this._structArray.int16[this._pos2+4]}get a_pos_normal_32(){return this._structArray.int16[this._pos2+5]}}ui.prototype.size=12;class Ki extends Le{get(t){return new ui(this,t)}}Dt(Ki,"FillExtrusionExtArray");class pn extends J{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}pn.prototype.size=40;class Rn extends gt{get(t){return new pn(this,t)}}Dt(Rn,"CollisionBoxArray");class Ks extends J{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(t){this._structArray.uint8[this._pos1+49]=t}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(t){this._structArray.uint8[this._pos1+50]=t}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(t){this._structArray.uint32[this._pos4+13]=t}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(t){this._structArray.uint8[this._pos1+58]=t}}Ks.prototype.size=60;class Qa extends Jt{get(t){return new Ks(this,t)}}Dt(Qa,"PlacedSymbolArray");class pi extends J{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+11]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+13]}get key(){return this._structArray.uint16[this._pos2+14]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+17]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+19]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+21]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+22]}get featureIndex(){return this._structArray.uint16[this._pos2+23]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+25]}get numIconVertices(){return this._structArray.uint16[this._pos2+26]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+27]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+28]}get crossTileID(){return this._structArray.uint32[this._pos4+15]}set crossTileID(t){this._structArray.uint32[this._pos4+15]=t}get textOffset0(){return this._structArray.float32[this._pos4+16]}get textOffset1(){return this._structArray.float32[this._pos4+17]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+18]}}pi.prototype.size=76;class mi extends Et{get(t){return new pi(this,t)}}Dt(mi,"SymbolInstanceArray");class Zr extends bt{getoffsetX(t){return this.float32[1*t+0]}}Dt(Zr,"GlyphOffsetArray");class Ci extends de{getx(t){return this.int16[3*t+0]}gety(t){return this.int16[3*t+1]}gettileUnitDistanceFromAnchor(t){return this.int16[3*t+2]}}Dt(Ci,"SymbolLineVertexArray");class On extends J{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}On.prototype.size=12;class hi extends Ht{get(t){return new On(this,t)}}Dt(hi,"FeatureIndexArray");class ua extends J{get a_centroid_pos0(){return this._structArray.uint16[this._pos2+0]}get a_centroid_pos1(){return this._structArray.uint16[this._pos2+1]}}ua.prototype.size=4;class Ll extends rr{get(t){return new ua(this,t)}}Dt(Ll,"FillExtrusionCentroidArray");class ha extends J{get a_pos_30(){return this._structArray.int16[this._pos2+0]}get a_pos_31(){return this._structArray.int16[this._pos2+1]}get a_pos_32(){return this._structArray.int16[this._pos2+2]}get a_pos_normal_30(){return this._structArray.int16[this._pos2+3]}get a_pos_normal_31(){return this._structArray.int16[this._pos2+4]}get a_pos_normal_32(){return this._structArray.int16[this._pos2+5]}get a_scale(){return this._structArray.float32[this._pos4+3]}}ha.prototype.size=16;class fa extends Tn{get(t){return new ha(this,t)}}Dt(fa,"CircleGlobeExtArray");const $o=se([{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"}]),rn=se([{name:"a_dash_to",components:4,type:"Uint16"},{name:"a_dash_from",components:4,type:"Uint16"}]);var ya=nu(function(a){a.exports=function(t,s){var l,h,p,g,v,E,k,M;for(h=t.length-(l=3&t.length),p=s,v=3432918353,E=461845907,M=0;M<h;)k=255&t.charCodeAt(M)|(255&t.charCodeAt(++M))<<8|(255&t.charCodeAt(++M))<<16|(255&t.charCodeAt(++M))<<24,++M,p=27492+(65535&(g=5*(65535&(p=(p^=k=(65535&(k=(k=(65535&k)*v+(((k>>>16)*v&65535)<<16)&4294967295)<<15|k>>>17))*E+(((k>>>16)*E&65535)<<16)&4294967295)<<13|p>>>19))+((5*(p>>>16)&65535)<<16)&4294967295))+((58964+(g>>>16)&65535)<<16);switch(k=0,l){case 3:k^=(255&t.charCodeAt(M+2))<<16;case 2:k^=(255&t.charCodeAt(M+1))<<8;case 1:p^=k=(65535&(k=(k=(65535&(k^=255&t.charCodeAt(M)))*v+(((k>>>16)*v&65535)<<16)&4294967295)<<15|k>>>17))*E+(((k>>>16)*E&65535)<<16)&4294967295}return p^=t.length,p=2246822507*(65535&(p^=p>>>16))+((2246822507*(p>>>16)&65535)<<16)&4294967295,p=3266489909*(65535&(p^=p>>>13))+((3266489909*(p>>>16)&65535)<<16)&4294967295,(p^=p>>>16)>>>0}}),cd=nu(function(a){a.exports=function(t,s){for(var l,h=t.length,p=s^h,g=0;h>=4;)l=1540483477*(65535&(l=255&t.charCodeAt(g)|(255&t.charCodeAt(++g))<<8|(255&t.charCodeAt(++g))<<16|(255&t.charCodeAt(++g))<<24))+((1540483477*(l>>>16)&65535)<<16),p=1540483477*(65535&p)+((1540483477*(p>>>16)&65535)<<16)^(l=1540483477*(65535&(l^=l>>>24))+((1540483477*(l>>>16)&65535)<<16)),h-=4,++g;switch(h){case 3:p^=(255&t.charCodeAt(g+2))<<16;case 2:p^=(255&t.charCodeAt(g+1))<<8;case 1:p=1540483477*(65535&(p^=255&t.charCodeAt(g)))+((1540483477*(p>>>16)&65535)<<16)}return p=1540483477*(65535&(p^=p>>>13))+((1540483477*(p>>>16)&65535)<<16),(p^=p>>>15)>>>0}}),Va=ya,mh=cd;Va.murmur3=ya,Va.murmur2=mh;class yf{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(t,s,l,h){this.ids.push(ud(t)),this.positions.push(s,l,h)}getPositions(t){const s=ud(t);let l=0,h=this.ids.length-1;for(;l<h;){const g=l+h>>1;this.ids[g]>=s?h=g:l=g+1}const p=[];for(;this.ids[l]===s;)p.push({index:this.positions[3*l],start:this.positions[3*l+1],end:this.positions[3*l+2]}),l++;return p}static serialize(t,s){const l=new Float64Array(t.ids),h=new Uint32Array(t.positions);return hd(l,h,0,l.length-1),s&&s.push(l.buffer,h.buffer),{ids:l,positions:h}}static deserialize(t){const s=new yf;return s.ids=t.ids,s.positions=t.positions,s.indexed=!0,s}}function ud(a){const t=+a;return!isNaN(t)&&Number.MIN_SAFE_INTEGER<=t&&t<=Number.MAX_SAFE_INTEGER?t:Va(String(a))}function hd(a,t,s,l){for(;s<l;){const h=a[s+l>>1];let p=s-1,g=l+1;for(;;){do{p++}while(a[p]<h);do{g--}while(a[g]>h);if(p>=g)break;vf(a,p,g),vf(t,3*p,3*g),vf(t,3*p+1,3*g+1),vf(t,3*p+2,3*g+2)}g-s<l-g?(hd(a,t,s,g),s=g+1):(hd(a,t,g+1,l),l=g)}}function vf(a,t,s){const l=a[t];a[t]=a[s],a[s]=l}Dt(yf,"FeaturePositionMap");class ms{constructor(t,s){this.gl=t.gl,this.location=s}}class zn extends ms{constructor(t,s){super(t,s),this.current=0}set(t){this.current!==t&&(this.current=t,this.gl.uniform1f(this.location,t))}}class _h extends ms{constructor(t,s){super(t,s),this.current=[0,0,0,0]}set(t){t[0]===this.current[0]&&t[1]===this.current[1]&&t[2]===this.current[2]&&t[3]===this.current[3]||(this.current=t,this.gl.uniform4f(this.location,t[0],t[1],t[2],t[3]))}}class fd extends ms{constructor(t,s){super(t,s),this.current=Fr.transparent}set(t){t.r===this.current.r&&t.g===this.current.g&&t.b===this.current.b&&t.a===this.current.a||(this.current=t,this.gl.uniform4f(this.location,t.r,t.g,t.b,t.a))}}const wf=new Float32Array(16),Sg=new Float32Array(9),bf=new Float32Array(4);function dd(a){return[Y(255*a.r,255*a.g),Y(255*a.b,255*a.a)]}class gh{constructor(t,s,l){this.value=t,this.uniformNames=s.map(h=>`u_${h}`),this.type=l}setUniform(t,s,l){t.set(l.constantOr(this.value))}getBinding(t,s,l){return"color"===this.type?new fd(t,s):new zn(t,s)}}class xh{constructor(t,s){this.uniformNames=s.map(l=>`u_${l}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(t,s){this.pixelRatioFrom=s.pixelRatio||1,this.pixelRatioTo=t.pixelRatio||1,this.patternFrom=s.tl.concat(s.br),this.patternTo=t.tl.concat(t.br)}setUniform(t,s,l,h){const p="u_pattern_to"===h||"u_dash_to"===h?this.patternTo:"u_pattern_from"===h||"u_dash_from"===h?this.patternFrom:"u_pixel_ratio_to"===h?this.pixelRatioTo:"u_pixel_ratio_from"===h?this.pixelRatioFrom:null;p&&t.set(p)}getBinding(t,s,l){return"u_pattern_from"===l||"u_pattern_to"===l||"u_dash_from"===l||"u_dash_to"===l?new _h(t,s):new zn(t,s)}}class Wo{constructor(t,s,l,h){this.expression=t,this.type=l,this.maxValue=0,this.paintVertexAttributes=s.map(p=>({name:`a_${p}`,type:"Float32",components:"color"===l?2:1,offset:0})),this.paintVertexArray=new h}populatePaintArray(t,s,l,h,p,g){const v=this.paintVertexArray.length,E=this.expression.evaluate(new qr(0),s,{},p,h,g);this.paintVertexArray.resize(t),this._setPaintValue(v,t,E)}updatePaintArray(t,s,l,h,p){const g=this.expression.evaluate({zoom:0},l,h,void 0,p);this._setPaintValue(t,s,g)}_setPaintValue(t,s,l){if("color"===this.type){const h=dd(l);for(let p=t;p<s;p++)this.paintVertexArray.emplace(p,h[0],h[1])}else{for(let h=t;h<s;h++)this.paintVertexArray.emplace(h,l);this.maxValue=Math.max(this.maxValue,Math.abs(l))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class _s{constructor(t,s,l,h,p,g){this.expression=t,this.uniformNames=s.map(v=>`u_${v}_t`),this.type=l,this.useIntegerZoom=h,this.zoom=p,this.maxValue=0,this.paintVertexAttributes=s.map(v=>({name:`a_${v}`,type:"Float32",components:"color"===l?4:2,offset:0})),this.paintVertexArray=new g}populatePaintArray(t,s,l,h,p,g){const v=this.expression.evaluate(new qr(this.zoom),s,{},p,h,g),E=this.expression.evaluate(new qr(this.zoom+1),s,{},p,h,g),k=this.paintVertexArray.length;this.paintVertexArray.resize(t),this._setPaintValue(k,t,v,E)}updatePaintArray(t,s,l,h,p){const g=this.expression.evaluate({zoom:this.zoom},l,h,void 0,p),v=this.expression.evaluate({zoom:this.zoom+1},l,h,void 0,p);this._setPaintValue(t,s,g,v)}_setPaintValue(t,s,l,h){if("color"===this.type){const p=dd(l),g=dd(h);for(let v=t;v<s;v++)this.paintVertexArray.emplace(v,p[0],p[1],g[0],g[1])}else{for(let p=t;p<s;p++)this.paintVertexArray.emplace(p,l,h);this.maxValue=Math.max(this.maxValue,Math.abs(l),Math.abs(h))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(t,s){const l=this.useIntegerZoom?Math.floor(s.zoom):s.zoom,h=wr(this.expression.interpolationFactor(l,this.zoom,this.zoom+1),0,1);t.set(h)}getBinding(t,s,l){return new zn(t,s)}}class Ii{constructor(t,s,l,h,p,g,v){this.expression=t,this.type=l,this.useIntegerZoom=h,this.zoom=p,this.layerId=v,this.paintVertexAttributes=("array"===l?rn:$o).members;for(let E=0;E<s.length;++E);this.zoomInPaintVertexArray=new g,this.zoomOutPaintVertexArray=new g}populatePaintArray(t,s,l){const h=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(t),this.zoomOutPaintVertexArray.resize(t),this._setPaintValues(h,t,s.patterns&&s.patterns[this.layerId],l)}updatePaintArray(t,s,l,h,p,g){this._setPaintValues(t,s,l.patterns&&l.patterns[this.layerId],g)}_setPaintValues(t,s,l,h){if(!h||!l)return;const{min:p,mid:g,max:v}=l,E=h[p],k=h[g],M=h[v];if(E&&k&&M)for(let D=t;D<s;D++)this._setPaintValue(this.zoomInPaintVertexArray,D,k,E),this._setPaintValue(this.zoomOutPaintVertexArray,D,k,M)}_setPaintValue(t,s,l,h){t.emplace(s,l.tl[0],l.tl[1],l.br[0],l.br[1],h.tl[0],h.tl[1],h.br[0],h.br[1],l.pixelRatio,h.pixelRatio)}upload(t){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=t.createVertexBuffer(this.zoomInPaintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=t.createVertexBuffer(this.zoomOutPaintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class Xo{constructor(t,s,l=(()=>!0)){this.binders={},this._buffers=[];const h=[];for(const p in t.paint._values){if(!l(p))continue;const g=t.paint.get(p);if(!(g instanceof w&&vl(g.property.specification)))continue;const v=md(p,t.type),E=g.value,k=g.property.specification.type,M=g.property.useIntegerZoom,D=g.property.specification["property-type"],R="cross-faded"===D||"cross-faded-data-driven"===D,z="line-dasharray"===String(p)&&"constant"!==t.layout.get("line-cap").value.kind;if("constant"!==E.kind||z)if("source"===E.kind||z||R){const q=T0(p,k,"source");this.binders[p]=R?new Ii(E,v,k,M,s,q,t.id):new Wo(E,v,k,q),h.push(`/a_${p}`)}else{const q=T0(p,k,"composite");this.binders[p]=new _s(E,v,k,M,s,q),h.push(`/z_${p}`)}else this.binders[p]=R?new xh(E.value,v):new gh(E.value,v,k),h.push(`/u_${p}`)}this.cacheKey=h.sort().join("")}getMaxValue(t){const s=this.binders[t];return s instanceof Wo||s instanceof _s?s.maxValue:0}populatePaintArrays(t,s,l,h,p,g){for(const v in this.binders){const E=this.binders[v];(E instanceof Wo||E instanceof _s||E instanceof Ii)&&E.populatePaintArray(t,s,l,h,p,g)}}setConstantPatternPositions(t,s){for(const l in this.binders){const h=this.binders[l];h instanceof xh&&h.setConstantPatternPositions(t,s)}}updatePaintArrays(t,s,l,h,p,g){let v=!1;for(const E in t){const k=s.getPositions(E);for(const M of k){const D=l.feature(M.index);for(const R in this.binders){const z=this.binders[R];if((z instanceof Wo||z instanceof _s||z instanceof Ii)&&!0===z.expression.isStateDependent){const q=h.paint.get(R);z.expression=q.value,z.updatePaintArray(M.start,M.end,D,t[E],p,g),v=!0}}}}return v}defines(){const t=[];for(const s in this.binders){const l=this.binders[s];(l instanceof gh||l instanceof xh)&&t.push(...l.uniformNames.map(h=>`#define HAS_UNIFORM_${h}`))}return t}getBinderAttributes(){const t=[];for(const s in this.binders){const l=this.binders[s];if(l instanceof Wo||l instanceof _s||l instanceof Ii)for(let h=0;h<l.paintVertexAttributes.length;h++)t.push(l.paintVertexAttributes[h].name)}return t}getBinderUniforms(){const t=[];for(const s in this.binders){const l=this.binders[s];if(l instanceof gh||l instanceof xh||l instanceof _s)for(const h of l.uniformNames)t.push(h)}return t}getPaintVertexBuffers(){return this._buffers}getUniforms(t,s){const l=[];for(const h in this.binders){const p=this.binders[h];if(p instanceof gh||p instanceof xh||p instanceof _s)for(const g of p.uniformNames)if(s[g]){const v=p.getBinding(t,s[g],g);l.push({name:g,property:h,binding:v})}}return l}setUniforms(t,s,l,h){for(const{name:p,property:g,binding:v}of s)this.binders[g].setUniform(v,h,l.get(g),p)}updatePaintBuffers(t){this._buffers=[];for(const s in this.binders){const l=this.binders[s];if(t&&l instanceof Ii){const h=2===t.fromScale?l.zoomInPaintVertexBuffer:l.zoomOutPaintVertexBuffer;h&&this._buffers.push(h)}else(l instanceof Wo||l instanceof _s)&&l.paintVertexBuffer&&this._buffers.push(l.paintVertexBuffer)}}upload(t){for(const s in this.binders){const l=this.binders[s];(l instanceof Wo||l instanceof _s||l instanceof Ii)&&l.upload(t)}this.updatePaintBuffers()}destroy(){for(const t in this.binders){const s=this.binders[t];(s instanceof Wo||s instanceof _s||s instanceof Ii)&&s.destroy()}}}class Fc{constructor(t,s,l=(()=>!0)){this.programConfigurations={};for(const h of t)this.programConfigurations[h.id]=new Xo(h,s,l);this.needsUpload=!1,this._featureMap=new yf,this._bufferOffset=0}populatePaintArrays(t,s,l,h,p,g,v){for(const E in this.programConfigurations)this.programConfigurations[E].populatePaintArrays(t,s,h,p,g,v);void 0!==s.id&&this._featureMap.add(s.id,l,this._bufferOffset,t),this._bufferOffset=t,this.needsUpload=!0}updatePaintArrays(t,s,l,h,p){for(const g of l)this.needsUpload=this.programConfigurations[g.id].updatePaintArrays(t,this._featureMap,s,g,h,p)||this.needsUpload}get(t){return this.programConfigurations[t]}upload(t){if(this.needsUpload){for(const s in this.programConfigurations)this.programConfigurations[s].upload(t);this.needsUpload=!1}}destroy(){for(const t in this.programConfigurations)this.programConfigurations[t].destroy()}}const pd={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"line-dasharray":["dash_to","dash_from"]};function md(a,t){return pd[a]||[a.replace(`${t}-`,"").replace(/-/g,"_")]}const b0={"line-pattern":{source:ze,composite:ze},"fill-pattern":{source:ze,composite:ze},"fill-extrusion-pattern":{source:ze,composite:ze},"line-dasharray":{source:Be,composite:Be}},Em={color:{source:vi,composite:we},number:{source:bt,composite:vi}};function T0(a,t,s){const l=b0[a];return l&&l[s]||Em[t][s]}Dt(gh,"ConstantBinder"),Dt(xh,"CrossFadedConstantBinder"),Dt(Wo,"SourceExpressionBinder"),Dt(Ii,"CrossFadedCompositeBinder"),Dt(_s,"CompositeExpressionBinder"),Dt(Xo,"ProgramConfiguration",{omit:["_buffers"]}),Dt(Fc,"ProgramConfigurationSet");const Tf="-transition";class Bn extends nr{constructor(t,s){if(super(),this.id=t.id,this.type=t.type,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,"custom"!==t.type&&(this.metadata=(t=t).metadata,this.minzoom=t.minzoom,this.maxzoom=t.maxzoom,"background"!==t.type&&"sky"!==t.type&&(this.source=t.source,this.sourceLayer=t["source-layer"],this.filter=t.filter),s.layout&&(this._unevaluatedLayout=new m(s.layout)),s.paint)){this._transitionablePaint=new d(s.paint);for(const l in t.paint)this.setPaintProperty(l,t.paint[l],{validate:!1});for(const l in t.layout)this.setLayoutProperty(l,t.layout[l],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new b(s.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(t){return"visibility"===t?this.visibility:this._unevaluatedLayout.getValue(t)}setLayoutProperty(t,s,l={}){null!=s&&this._validate(ni,`layers.${this.id}.layout.${t}`,t,s,l)||("visibility"!==t?this._unevaluatedLayout.setValue(t,s):this.visibility=s)}getPaintProperty(t){return Fa(t,Tf)?this._transitionablePaint.getTransition(t.slice(0,-Tf.length)):this._transitionablePaint.getValue(t)}setPaintProperty(t,s,l={}){if(null!=s&&this._validate(ld,`layers.${this.id}.paint.${t}`,t,s,l))return!1;if(Fa(t,Tf))return this._transitionablePaint.setTransition(t.slice(0,-Tf.length),s||void 0),!1;{const h=this._transitionablePaint._values[t],p="cross-faded-data-driven"===h.property.specification["property-type"],g=h.value.isDataDriven(),v=h.value;this._transitionablePaint.setValue(t,s),this._handleSpecialPaintPropertyUpdate(t);const E=this._transitionablePaint._values[t].value;return E.isDataDriven()||g||p||this._handleOverridablePaintPropertyUpdate(t,v,E)}}_handleSpecialPaintPropertyUpdate(t){}getProgramIds(){return null}getProgramConfiguration(t){return null}_handleOverridablePaintPropertyUpdate(t,s,l){return!1}isHidden(t){return!!(this.minzoom&&t<this.minzoom)||!!(this.maxzoom&&t>=this.maxzoom)||"none"===this.visibility}updateTransitions(t){this._transitioningPaint=this._transitionablePaint.transitioned(t,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(t,s){t.getCrossfadeParameters&&(this._crossfadeParameters=t.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(t,void 0,s)),this.paint=this._transitioningPaint.possiblyEvaluate(t,void 0,s)}serialize(){const t={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(t.layout=t.layout||{},t.layout.visibility=this.visibility),rc(t,(s,l)=>!(void 0===s||"layout"===l&&!Object.keys(s).length||"paint"===l&&!Object.keys(s).length))}_validate(t,s,l,h,p={}){return(!p||!1!==p.validate)&&uh(this,t.call(No,{key:s,layerType:this.type,objectKey:l,value:h,styleSpec:Ze,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const t in this.paint._values){const s=this.paint.get(t);if(s instanceof w&&vl(s.property.specification)&&("source"===s.value.kind||"composite"===s.value.kind)&&s.value.isStateDependent)return!0}return!1}compileFilter(){this._filterCompiled||(this._featureFilter=la(this.filter),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}}const Ho=se([{name:"a_pos",components:2,type:"Int16"}],4),Sm=se([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"},{name:"a_scale",components:1,type:"Float32"}]);class wi{constructor(t=[]){this.segments=t}prepareSegment(t,s,l,h){let p=this.segments[this.segments.length-1];return t>wi.MAX_VERTEX_ARRAY_LENGTH&&Rr(`Max vertices per segment is ${wi.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${t}`),(!p||p.vertexLength+t>wi.MAX_VERTEX_ARRAY_LENGTH||p.sortKey!==h)&&(p={vertexOffset:s.length,primitiveOffset:l.length,vertexLength:0,primitiveLength:0},void 0!==h&&(p.sortKey=h),this.segments.push(p)),p}get(){return this.segments}destroy(){for(const t of this.segments)for(const s in t.vaos)t.vaos[s].destroy()}static simpleSegment(t,s,l,h){return new wi([{vertexOffset:t,primitiveOffset:s,vertexLength:l,primitiveLength:h,vaos:{},sortKey:0}])}}wi.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Dt(wi,"SegmentVector");var hr=8192;class Js{constructor(t,s){t&&(s?this.setSouthWest(t).setNorthEast(s):4===t.length?this.setSouthWest([t[0],t[1]]).setNorthEast([t[2],t[3]]):this.setSouthWest(t[0]).setNorthEast(t[1]))}setNorthEast(t){return this._ne=t instanceof Jr?new Jr(t.lng,t.lat):Jr.convert(t),this}setSouthWest(t){return this._sw=t instanceof Jr?new Jr(t.lng,t.lat):Jr.convert(t),this}extend(t){const s=this._sw,l=this._ne;let h,p;if(t instanceof Jr)h=t,p=t;else{if(!(t instanceof Js))return Array.isArray(t)?4===t.length||t.every(Array.isArray)?this.extend(Js.convert(t)):this.extend(Jr.convert(t)):this;if(h=t._sw,p=t._ne,!h||!p)return this}return s||l?(s.lng=Math.min(h.lng,s.lng),s.lat=Math.min(h.lat,s.lat),l.lng=Math.max(p.lng,l.lng),l.lat=Math.max(p.lat,l.lat)):(this._sw=new Jr(h.lng,h.lat),this._ne=new Jr(p.lng,p.lat)),this}getCenter(){return new Jr((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new Jr(this.getWest(),this.getNorth())}getSouthEast(){return new Jr(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(t){const{lng:s,lat:l}=Jr.convert(t);let h=this._sw.lng<=s&&s<=this._ne.lng;return this._sw.lng>this._ne.lng&&(h=this._sw.lng>=s&&s>=this._ne.lng),this._sw.lat<=l&&l<=this._ne.lat&&h}static convert(t){return!t||t instanceof Js?t:new Js(t)}}const _d=6371008.8;class Jr{constructor(t,s){if(isNaN(t)||isNaN(s))throw new Error(`Invalid LngLat object: (${t}, ${s})`);if(this.lng=+t,this.lat=+s,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Jr(Ma(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(t){const s=Math.PI/180,l=this.lat*s,h=t.lat*s,p=Math.sin(l)*Math.sin(h)+Math.cos(l)*Math.cos(h)*Math.cos((t.lng-this.lng)*s);return _d*Math.acos(Math.min(p,1))}toBounds(t=0){const s=360*t/40075017,l=s/Math.cos(Math.PI/180*this.lat);return new Js(new Jr(this.lng-l,this.lat-s),new Jr(this.lng+l,this.lat+s))}static convert(t){if(t instanceof Jr)return t;if(Array.isArray(t)&&(2===t.length||3===t.length))return new Jr(Number(t[0]),Number(t[1]));if(!Array.isArray(t)&&"object"==typeof t&&null!==t)return new Jr(Number("lng"in t?t.lng:t.lon),Number(t.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const Ar=2*Math.PI*_d;function Dc(a){return Ar*Math.cos(a*Math.PI/180)}function Yo(a){return(180+a)/360}function gs(a){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+a*Math.PI/360)))/360}function Wr(a,t){return a/Dc(t)}function es(a){return 360*a-180}function En(a){return 360/Math.PI*Math.atan(Math.exp((180-360*a)*Math.PI/180))-90}function E0(a,t){return a*Dc(En(t))}const xs=85.051129;class Ef{constructor(t,s,l=0){this.x=+t,this.y=+s,this.z=+l}static fromLngLat(t,s=0){const l=Jr.convert(t);return new Ef(Yo(l.lng),gs(l.lat),Wr(s,l.lat))}toLngLat(){return new Jr(es(this.x),En(this.y))}toAltitude(){return E0(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/Ar*(t=En(this.y),1/Math.cos(t*Math.PI/180));var t}}function gd(a,t,s,l,h,p,g,v,E){const k=(t+l)/2,M=(s+h)/2,D=new ut(k,M);v(D),function(R,z,q,K,ee,ne){const ve=q-ee,Ae=K-ne;return Math.abs((K-z)*ve-(q-R)*Ae)/Math.hypot(ve,Ae)}(D.x,D.y,p.x,p.y,g.x,g.y)>=E?(gd(a,t,s,k,M,p,D,v,E),gd(a,k,M,l,h,D,g,v,E)):a.push(g)}function S0(a,t,s){let l=a[0],h=l.x,p=l.y;t(l);const g=[l];for(let v=1;v<a.length;v++){const E=a[v],{x:k,y:M}=E;t(E),gd(g,h,p,k,M,l,E,t,s),h=k,p=M,l=E}return g}const ys=Math.pow(2,14)-1,A0=-ys-1;function k0(a,t){const s=Math.round(a.x*t),l=Math.round(a.y*t);return a.x=wr(s,A0,ys),a.y=wr(l,A0,ys),(s<a.x||s>a.x+1||l<a.y||l>a.y+1)&&Rr("Geometry exceeds allowed extent, reduce your vector tile buffer size"),a}function vs(a,t,s){const l=a.loadGeometry(),h=a.extent,p=hr/h;if(t&&s&&s.projection.isReprojectedInTileSpace){const g=1<<t.z,{scale:v,x:E,y:k,projection:M}=s,D=R=>{const z=es((t.x+R.x/h)/g),q=En((t.y+R.y/h)/g),K=M.project(z,q);R.x=(K.x*v-E)*h,R.y=(K.y*v-k)*h};for(let R=0;R<l.length;R++)if(1!==a.type)l[R]=S0(l[R],D,1);else{const z=[];for(const q of l[R])q.x<0||q.x>=h||q.y<0||q.y>=h||(D(q),z.push(q));l[R]=z}}for(const g of l)for(const v of g)k0(v,p);return l}function Rl(a,t){return{type:a.type,id:a.id,properties:a.properties,geometry:t?vs(a):[]}}function Qs(a,t,s,l,h){a.emplaceBack(2*t+(l+1)/2,2*s+(h+1)/2)}function yh(a,t,s,l){a.emplaceBack(t.x,t.y,t.z,16384*s[0],16384*s[1],16384*s[2],l)}class Sf{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(s=>s.id),this.index=t.index,this.hasPattern=!1,this.projection=t.projection,this.layoutVertexArray=new he,this.indexArray=new Mt,this.segments=new wi,this.programConfigurations=new Fc(t.layers,t.zoom),this.stateDependentLayerIds=this.layers.filter(s=>s.isStateDependent()).map(s=>s.id)}populate(t,s,l,h){const p=this.layers[0],g=[];let v=null;"circle"===p.type&&(v=p.layout.get("circle-sort-key"));for(const{feature:k,id:M,index:D,sourceLayerIndex:R}of t){const z=this.layers[0]._featureFilter.needGeometry,q=Rl(k,z);if(!this.layers[0]._featureFilter.filter(new qr(this.zoom),q,l))continue;const K=v?v.evaluate(q,{},l):void 0,ee={id:M,properties:k.properties,type:k.type,sourceLayerIndex:R,index:D,geometry:z?q.geometry:vs(k,l,h),patterns:{},sortKey:K};g.push(ee)}v&&g.sort((k,M)=>k.sortKey-M.sortKey);let E=null;"globe"===h.projection.name&&(this.globeExtVertexArray=new fa,E=h.projection);for(const k of g){const{geometry:M,index:D,sourceLayerIndex:R}=k,z=t[D].feature;this.addFeature(k,M,D,s.availableImages,l,E),s.featureIndex.insert(z,M,D,R,this.index)}}update(t,s,l,h){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,s,this.stateDependentLayers,l,h)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Ho.members),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=t.createVertexBuffer(this.globeExtVertexArray,Sm.members))),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}addFeature(t,s,l,h,p,g){for(const v of s)for(const E of v){const k=E.x,M=E.y;if(k<0||k>=hr||M<0||M>=hr)continue;if(g){const z=g.projectTilePoint(k,M,p),q=g.upVector(p,k,M),K=En((M/hr+p.y)/(1<<p.z)),ee=g.pixelsPerMeter(K,1)/Wr(1,K),ne=this.globeExtVertexArray;yh(ne,z,q,ee),yh(ne,z,q,ee),yh(ne,z,q,ee),yh(ne,z,q,ee)}const D=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,t.sortKey),R=D.vertexLength;Qs(this.layoutVertexArray,k,M,-1,-1),Qs(this.layoutVertexArray,k,M,1,-1),Qs(this.layoutVertexArray,k,M,1,1),Qs(this.layoutVertexArray,k,M,-1,1),this.indexArray.emplaceBack(R,R+1,R+2),this.indexArray.emplaceBack(R,R+3,R+2),D.vertexLength+=4,D.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,l,{},h,p)}}function C0(a,t){for(let s=0;s<a.length;s++)if(Mu(t,a[s]))return!0;for(let s=0;s<t.length;s++)if(Mu(a,t[s]))return!0;return!!Af(a,t)}function I0(a,t,s){return!!Mu(a,t)||!!vh(t,a,s)}function M0(a,t){if(1===a.length)return D0(t,a[0]);for(let s=0;s<t.length;s++){const l=t[s];for(let h=0;h<l.length;h++)if(Mu(a,l[h]))return!0}for(let s=0;s<a.length;s++)if(D0(t,a[s]))return!0;for(let s=0;s<t.length;s++)if(Af(a,t[s]))return!0;return!1}function Am(a,t,s){if(a.length>1){if(Af(a,t))return!0;for(let l=0;l<t.length;l++)if(vh(t[l],a,s))return!0}for(let l=0;l<a.length;l++)if(vh(a[l],t,s))return!0;return!1}function Af(a,t){if(0===a.length||0===t.length)return!1;for(let s=0;s<a.length-1;s++){const l=a[s],h=a[s+1];for(let p=0;p<t.length-1;p++)if(xd(l,h,t[p],t[p+1]))return!0}return!1}function xd(a,t,s,l){return cn(a,s,l)!==cn(t,s,l)&&cn(a,t,s)!==cn(a,t,l)}function vh(a,t,s){const l=s*s;if(1===t.length)return a.distSqr(t[0])<l;for(let h=1;h<t.length;h++)if(F0(a,t[h-1],t[h])<l)return!0;return!1}function F0(a,t,s){const l=t.distSqr(s);if(0===l)return a.distSqr(t);const h=((a.x-t.x)*(s.x-t.x)+(a.y-t.y)*(s.y-t.y))/l;return a.distSqr(h<0?t:h>1?s:s.sub(t)._mult(h)._add(t))}function D0(a,t){let s,l,h,p=!1;for(let g=0;g<a.length;g++){s=a[g];for(let v=0,E=s.length-1;v<s.length;E=v++)l=s[v],h=s[E],l.y>t.y!=h.y>t.y&&t.x<(h.x-l.x)*(t.y-l.y)/(h.y-l.y)+l.x&&(p=!p)}return p}function Mu(a,t){let s=!1;for(let l=0,h=a.length-1;l<a.length;h=l++){const p=a[l],g=a[h];p.y>t.y!=g.y>t.y&&t.x<(g.x-p.x)*(t.y-p.y)/(g.y-p.y)+p.x&&(s=!s)}return s}function kf(a,t,s,l,h){for(const g of a)if(t<=g.x&&s<=g.y&&l>=g.x&&h>=g.y)return!0;const p=[new ut(t,s),new ut(t,h),new ut(l,h),new ut(l,s)];if(a.length>2)for(const g of p)if(Mu(a,g))return!0;for(let g=0;g<a.length-1;g++)if(km(a[g],a[g+1],p))return!0;return!1}function km(a,t,s){const l=s[0],h=s[2];if(a.x<l.x&&t.x<l.x||a.x>h.x&&t.x>h.x||a.y<l.y&&t.y<l.y||a.y>h.y&&t.y>h.y)return!1;const p=cn(a,t,s[0]);return p!==cn(a,t,s[1])||p!==cn(a,t,s[2])||p!==cn(a,t,s[3])}function Pc(a,t,s){const l=t.paint.get(a).value;return"constant"===l.kind?l.value:s.programConfigurations.get(t.id).getMaxValue(a)}function wh(a){return Math.sqrt(a[0]*a[0]+a[1]*a[1])}function yd(a,t,s,l,h){if(!t[0]&&!t[1])return a;const p=ut.convert(t)._mult(h);"viewport"===s&&p._rotate(-l);const g=[];for(let v=0;v<a.length;v++)g.push(a[v].sub(p));return g}function Cf(a,t,s,l){const h=ut.convert(a)._mult(l);return"viewport"===t&&h._rotate(-s),h}Dt(Sf,"CircleBucket",{omit:["layers"]});const Cm=new V({"circle-sort-key":new A(Ze.layout_circle["circle-sort-key"])});var Im={paint:new V({"circle-radius":new A(Ze.paint_circle["circle-radius"]),"circle-color":new A(Ze.paint_circle["circle-color"]),"circle-blur":new A(Ze.paint_circle["circle-blur"]),"circle-opacity":new A(Ze.paint_circle["circle-opacity"]),"circle-translate":new S(Ze.paint_circle["circle-translate"]),"circle-translate-anchor":new S(Ze.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new S(Ze.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new S(Ze.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new A(Ze.paint_circle["circle-stroke-width"]),"circle-stroke-color":new A(Ze.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new A(Ze.paint_circle["circle-stroke-opacity"])}),layout:Cm},vd=1e-6,va="undefined"!=typeof Float32Array?Float32Array:Array;function P0(){var a=new va(9);return va!=Float32Array&&(a[1]=0,a[2]=0,a[3]=0,a[5]=0,a[6]=0,a[7]=0),a[0]=1,a[4]=1,a[8]=1,a}function ws(a){return a[0]=1,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=1,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=1,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a}function If(a,t,s){var l=t[0],h=t[1],p=t[2],g=t[3],v=t[4],E=t[5],k=t[6],M=t[7],D=t[8],R=t[9],z=t[10],q=t[11],K=t[12],ee=t[13],ne=t[14],ve=t[15],Ae=s[0],Me=s[1],De=s[2],Pe=s[3];return a[0]=Ae*l+Me*v+De*D+Pe*K,a[1]=Ae*h+Me*E+De*R+Pe*ee,a[2]=Ae*p+Me*k+De*z+Pe*ne,a[3]=Ae*g+Me*M+De*q+Pe*ve,a[4]=(Ae=s[4])*l+(Me=s[5])*v+(De=s[6])*D+(Pe=s[7])*K,a[5]=Ae*h+Me*E+De*R+Pe*ee,a[6]=Ae*p+Me*k+De*z+Pe*ne,a[7]=Ae*g+Me*M+De*q+Pe*ve,a[8]=(Ae=s[8])*l+(Me=s[9])*v+(De=s[10])*D+(Pe=s[11])*K,a[9]=Ae*h+Me*E+De*R+Pe*ee,a[10]=Ae*p+Me*k+De*z+Pe*ne,a[11]=Ae*g+Me*M+De*q+Pe*ve,a[12]=(Ae=s[12])*l+(Me=s[13])*v+(De=s[14])*D+(Pe=s[15])*K,a[13]=Ae*h+Me*E+De*R+Pe*ee,a[14]=Ae*p+Me*k+De*z+Pe*ne,a[15]=Ae*g+Me*M+De*q+Pe*ve,a}function Lc(a,t,s){var l,h,p,g,v,E,k,M,D,R,z,q,K=s[0],ee=s[1],ne=s[2];return t===a?(a[12]=t[0]*K+t[4]*ee+t[8]*ne+t[12],a[13]=t[1]*K+t[5]*ee+t[9]*ne+t[13],a[14]=t[2]*K+t[6]*ee+t[10]*ne+t[14],a[15]=t[3]*K+t[7]*ee+t[11]*ne+t[15]):(h=t[1],p=t[2],g=t[3],v=t[4],E=t[5],k=t[6],M=t[7],D=t[8],R=t[9],z=t[10],q=t[11],a[0]=l=t[0],a[1]=h,a[2]=p,a[3]=g,a[4]=v,a[5]=E,a[6]=k,a[7]=M,a[8]=D,a[9]=R,a[10]=z,a[11]=q,a[12]=l*K+v*ee+D*ne+t[12],a[13]=h*K+E*ee+R*ne+t[13],a[14]=p*K+k*ee+z*ne+t[14],a[15]=g*K+M*ee+q*ne+t[15]),a}function bs(a,t,s){var l=s[0],h=s[1],p=s[2];return a[0]=t[0]*l,a[1]=t[1]*l,a[2]=t[2]*l,a[3]=t[3]*l,a[4]=t[4]*h,a[5]=t[5]*h,a[6]=t[6]*h,a[7]=t[7]*h,a[8]=t[8]*p,a[9]=t[9]*p,a[10]=t[10]*p,a[11]=t[11]*p,a[12]=t[12],a[13]=t[13],a[14]=t[14],a[15]=t[15],a}function Mf(a,t,s){var l=Math.sin(s),h=Math.cos(s),p=t[4],g=t[5],v=t[6],E=t[7],k=t[8],M=t[9],D=t[10],R=t[11];return t!==a&&(a[0]=t[0],a[1]=t[1],a[2]=t[2],a[3]=t[3],a[12]=t[12],a[13]=t[13],a[14]=t[14],a[15]=t[15]),a[4]=p*h+k*l,a[5]=g*h+M*l,a[6]=v*h+D*l,a[7]=E*h+R*l,a[8]=k*h-p*l,a[9]=M*h-g*l,a[10]=D*h-v*l,a[11]=R*h-E*l,a}function Ff(a,t,s){var l=Math.sin(s),h=Math.cos(s),p=t[0],g=t[1],v=t[2],E=t[3],k=t[8],M=t[9],D=t[10],R=t[11];return t!==a&&(a[4]=t[4],a[5]=t[5],a[6]=t[6],a[7]=t[7],a[12]=t[12],a[13]=t[13],a[14]=t[14],a[15]=t[15]),a[0]=p*h-k*l,a[1]=g*h-M*l,a[2]=v*h-D*l,a[3]=E*h-R*l,a[8]=p*l+k*h,a[9]=g*l+M*h,a[10]=v*l+D*h,a[11]=E*l+R*h,a}Math.hypot||(Math.hypot=function(){for(var a=0,t=arguments.length;t--;)a+=arguments[t]*arguments[t];return Math.sqrt(a)});var L0=If;function wd(){var a=new va(3);return va!=Float32Array&&(a[0]=0,a[1]=0,a[2]=0),a}function bd(a){var t=new va(3);return t[0]=a[0],t[1]=a[1],t[2]=a[2],t}function Td(a){return Math.hypot(a[0],a[1],a[2])}function Fu(a,t,s){var l=new va(3);return l[0]=a,l[1]=t,l[2]=s,l}function Ko(a,t,s){return a[0]=t[0]+s[0],a[1]=t[1]+s[1],a[2]=t[2]+s[2],a}function R0(a,t,s){return a[0]=t[0]-s[0],a[1]=t[1]-s[1],a[2]=t[2]-s[2],a}function O0(a,t,s){return a[0]=t[0]*s[0],a[1]=t[1]*s[1],a[2]=t[2]*s[2],a}function Ui(a,t,s){return a[0]=Math.min(t[0],s[0]),a[1]=Math.min(t[1],s[1]),a[2]=Math.min(t[2],s[2]),a}function Nn(a,t,s){return a[0]=Math.max(t[0],s[0]),a[1]=Math.max(t[1],s[1]),a[2]=Math.max(t[2],s[2]),a}function Li(a,t,s){return a[0]=t[0]*s,a[1]=t[1]*s,a[2]=t[2]*s,a}function wa(a,t,s,l){return a[0]=t[0]+s[0]*l,a[1]=t[1]+s[1]*l,a[2]=t[2]+s[2]*l,a}function Du(a,t){var s=t[0],l=t[1],h=t[2],p=s*s+l*l+h*h;return p>0&&(p=1/Math.sqrt(p)),a[0]=t[0]*p,a[1]=t[1]*p,a[2]=t[2]*p,a}function bh(a,t){return a[0]*t[0]+a[1]*t[1]+a[2]*t[2]}function Ed(a,t,s){var l=t[0],h=t[1],p=t[2],g=s[0],v=s[1],E=s[2];return a[0]=h*E-p*v,a[1]=p*g-l*E,a[2]=l*v-h*g,a}function Ts(a,t,s){var l=t[0],h=t[1],p=t[2],g=s[3]*l+s[7]*h+s[11]*p+s[15];return a[0]=(s[0]*l+s[4]*h+s[8]*p+s[12])/(g=g||1),a[1]=(s[1]*l+s[5]*h+s[9]*p+s[13])/g,a[2]=(s[2]*l+s[6]*h+s[10]*p+s[14])/g,a}function z0(a,t,s){var l=s[0],h=s[1],p=s[2],g=t[0],v=t[1],E=t[2],k=h*E-p*v,M=p*g-l*E,D=l*v-h*g,R=h*D-p*M,z=p*k-l*D,q=l*M-h*k,K=2*s[3];return M*=K,D*=K,z*=2,q*=2,a[0]=g+(k*=K)+(R*=2),a[1]=v+M+z,a[2]=E+D+q,a}var Th,ts=R0,Eh=O0,Rc=Td;function Oc(a,t,s){var l=t[0],h=t[1],p=t[2],g=t[3];return a[0]=s[0]*l+s[4]*h+s[8]*p+s[12]*g,a[1]=s[1]*l+s[5]*h+s[9]*p+s[13]*g,a[2]=s[2]*l+s[6]*h+s[10]*p+s[14]*g,a[3]=s[3]*l+s[7]*h+s[11]*p+s[15]*g,a}function B0(){var a=new va(4);return va!=Float32Array&&(a[0]=0,a[1]=0,a[2]=0),a[3]=1,a}function N0(a){return a[0]=0,a[1]=0,a[2]=0,a[3]=1,a}function U0(a,t,s){s*=.5;var l=t[0],h=t[1],p=t[2],g=t[3],v=Math.sin(s),E=Math.cos(s);return a[0]=l*E+g*v,a[1]=h*E+p*v,a[2]=p*E-h*v,a[3]=g*E-l*v,a}wd(),Th=new va(4),va!=Float32Array&&(Th[0]=0,Th[1]=0,Th[2]=0,Th[3]=0),wd(),Fu(1,0,0),Fu(0,1,0),B0(),B0(),P0();class Sd{constructor(t,s){this.points=t,this.planes=s}static fromInvProjectionMatrix(t,s,l,h){const p=Math.pow(2,l),g=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(E=>{const k=Oc([],E,t),M=1/k[3]/s*p;return(D=k)[0]=(R=k)[0]*(z=[M,M,h?1/k[3]:M,M])[0],D[1]=R[1]*z[1],D[2]=R[2]*z[2],D[3]=R[3]*z[3],D;var D,R,z}),v=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(E=>{const k=Du([],Ed([],ts([],g[E[0]],g[E[1]]),ts([],g[E[2]],g[E[1]]))),M=-bh(k,g[E[1]]);return k.concat(M)});return new Sd(g,v)}}class ea{constructor(t,s){this.min=t,this.max=s,this.center=Li([],Ko([],this.min,this.max),.5)}quadrant(t){const s=[t%2==0,t<2],l=bd(this.min),h=bd(this.max);for(let p=0;p<s.length;p++)l[p]=s[p]?this.min[p]:this.center[p],h[p]=s[p]?this.center[p]:this.max[p];return h[2]=this.max[2],new ea(l,h)}distanceX(t){return Math.max(Math.min(this.max[0],t[0]),this.min[0])-t[0]}distanceY(t){return Math.max(Math.min(this.max[1],t[1]),this.min[1])-t[1]}distanceZ(t){return Math.max(Math.min(this.max[2],t[2]),this.min[2])-t[2]}getCorners(){const t=this.min,s=this.max;return[[t[0],t[1],t[2]],[s[0],t[1],t[2]],[s[0],s[1],t[2]],[t[0],s[1],t[2]],[t[0],t[1],s[2]],[s[0],t[1],s[2]],[s[0],s[1],s[2]],[t[0],s[1],s[2]]]}intersects(t){const s=this.getCorners();let l=!0;for(let h=0;h<t.planes.length;h++){const p=t.planes[h];let g=0;for(let v=0;v<s.length;v++)g+=bh(p,s[v])+p[3]>=0;if(0===g)return 0;g!==s.length&&(l=!1)}if(l)return 2;for(let h=0;h<3;h++){let p=Number.MAX_VALUE,g=-Number.MAX_VALUE;for(let v=0;v<t.points.length;v++){const E=t.points[v][h]-this.min[h];p=Math.min(p,E),g=Math.max(g,E)}if(g<0||p>this.max[h]-this.min[h])return 0}return 1}}function Ad(a,t,s,l,h,p,g,v,E){if(p&&a.queryGeometry.isAboveHorizon)return!1;p&&(E*=a.pixelToTileUnitsFactor);for(const k of t)for(const M of k){const D=M.add(v),R=h&&s.elevation?s.elevation.exaggeration()*h.getElevationAt(D.x,D.y,!0):0,z=p?D:Mm(D,R,l),q=p?a.tilespaceRays.map(ee=>j0(ee,R)):a.queryGeometry.screenGeometry,K=Oc([],[M.x,M.y,R,1],l);if(!g&&p?E*=K[3]/s.cameraToCenterDistance:g&&!p&&(E*=s.cameraToCenterDistance/K[3]),I0(q,z,E))return!0}return!1}function Mm(a,t,s){const l=Oc([],[a.x,a.y,t,1],s);return new ut(l[0]/l[3],l[1]/l[3])}const Z0=Fu(0,0,0),V0=Fu(0,0,1);function j0(a,t){const s=wd();return Z0[2]=t,a.intersectsPlane(Z0,V0,s),new ut(s[0],s[1])}class Es extends Sf{}function Ol(a,{width:t,height:s},l,h){if(h){if(h instanceof Uint8ClampedArray)h=new Uint8Array(h.buffer);else if(h.length!==t*s*l)throw new RangeError("mismatched image size")}else h=new Uint8Array(t*s*l);return a.width=t,a.height=s,a.data=h,a}function q0(a,t,s){const{width:l,height:h}=t;l===a.width&&h===a.height||(kd(a,t,{x:0,y:0},{x:0,y:0},{width:Math.min(a.width,l),height:Math.min(a.height,h)},s),a.width=l,a.height=h,a.data=t.data)}function kd(a,t,s,l,h,p){if(0===h.width||0===h.height)return t;if(h.width>a.width||h.height>a.height||s.x>a.width-h.width||s.y>a.height-h.height)throw new RangeError("out of range source coordinates for image copy");if(h.width>t.width||h.height>t.height||l.x>t.width-h.width||l.y>t.height-h.height)throw new RangeError("out of range destination coordinates for image copy");const g=a.data,v=t.data;for(let E=0;E<h.height;E++){const k=((s.y+E)*a.width+s.x)*p,M=((l.y+E)*t.width+l.x)*p;for(let D=0;D<h.width*p;D++)v[M+D]=g[k+D]}return t}Dt(Es,"HeatmapBucket",{omit:["layers"]});class Jo{constructor(t,s){Ol(this,t,1,s)}resize(t){q0(this,new Jo(t),1)}clone(){return new Jo({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,s,l,h,p){kd(t,s,l,h,p,1)}}class da{constructor(t,s){Ol(this,t,4,s)}resize(t){q0(this,new da(t),4)}replace(t,s){s?this.data.set(t):this.data=t instanceof Uint8ClampedArray?new Uint8Array(t.buffer):t}clone(){return new da({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,s,l,h,p){kd(t,s,l,h,p,4)}}Dt(Jo,"AlphaImage"),Dt(da,"RGBAImage");var Fm={paint:new V({"heatmap-radius":new A(Ze.paint_heatmap["heatmap-radius"]),"heatmap-weight":new A(Ze.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new S(Ze.paint_heatmap["heatmap-intensity"]),"heatmap-color":new L(Ze.paint_heatmap["heatmap-color"]),"heatmap-opacity":new S(Ze.paint_heatmap["heatmap-opacity"])})};function Pu(a){const t={},s=a.resolution||256,l=a.clips?a.clips.length:1,h=a.image||new da({width:s,height:l}),p=(g,v,E)=>{t[a.evaluationKey]=E;const k=a.expression.evaluate(t);h.data[g+v+0]=Math.floor(255*k.r/k.a),h.data[g+v+1]=Math.floor(255*k.g/k.a),h.data[g+v+2]=Math.floor(255*k.b/k.a),h.data[g+v+3]=Math.floor(255*k.a)};if(a.clips)for(let g=0,v=0;g<l;++g,v+=4*s)for(let E=0,k=0;E<s;E++,k+=4){const M=E/(s-1),{start:D,end:R}=a.clips[g];p(v,k,D*(1-M)+R*M)}else for(let g=0,v=0;g<s;g++,v+=4)p(0,v,g/(s-1));return h}var G0={paint:new V({"hillshade-illumination-direction":new S(Ze.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new S(Ze.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new S(Ze.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new S(Ze.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new S(Ze.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new S(Ze.paint_hillshade["hillshade-accent-color"])})};const $0=se([{name:"a_pos",components:2,type:"Int16"}],4),{members:Dm}=$0;var Sh=Df,Pm=Df;function Df(a,t,s){s=s||2;var l,h,p,g,v,E,k,M=t&&t.length,D=M?t[0]*s:a.length,R=Un(a,0,D,s,!0),z=[];if(!R||R.next===R.prev)return z;if(M&&(R=function(K,ee,ne,ve){var Ae,Me,De,Pe=[];for(Ae=0,Me=ee.length;Ae<Me;Ae++)(De=Un(K,ee[Ae]*ve,Ae<Me-1?ee[Ae+1]*ve:K.length,ve,!1))===De.next&&(De.steiner=!0),Pe.push(Nm(De));for(Pe.sort(Om),Ae=0;Ae<Pe.length;Ae++)ne=zl(ne=zm(Pe[Ae],ne),ne.next);return ne}(a,t,R,s)),a.length>80*s){l=p=a[0],h=g=a[1];for(var q=s;q<D;q+=s)(v=a[q])<l&&(l=v),(E=a[q+1])<h&&(h=E),v>p&&(p=v),E>g&&(g=E);k=0!==(k=Math.max(p-l,g-h))?1/k:0}return Ah(R,z,s,l,h,k),z}function Un(a,t,s,l,h){var p,g;if(h===Fd(a,t,s,l)>0)for(p=t;p<s;p+=l)g=H0(p,a[p],a[p+1],g);else for(p=s-l;p>=t;p-=l)g=H0(p,a[p],a[p+1],g);return g&&Lf(g,g.next)&&(Ih(g),g=g.next),g}function zl(a,t){if(!a)return a;t||(t=a);var s,l=a;do{if(s=!1,l.steiner||!Lf(l,l.next)&&0!==Zi(l.prev,l,l.next))l=l.next;else{if(Ih(l),(l=t=l.prev)===l.next)break;s=!0}}while(s||l!==t);return t}function Ah(a,t,s,l,h,p,g){if(a){!g&&p&&function(M,D,R,z){var q=M;do{null===q.z&&(q.z=Id(q.x,q.y,D,R,z)),q.prevZ=q.prev,q.nextZ=q.next,q=q.next}while(q!==M);q.prevZ.nextZ=null,q.prevZ=null,function(K){var ee,ne,ve,Ae,Me,De,Pe,Xe,He=1;do{for(ne=K,K=null,Me=null,De=0;ne;){for(De++,ve=ne,Pe=0,ee=0;ee<He&&(Pe++,ve=ve.nextZ);ee++);for(Xe=He;Pe>0||Xe>0&&ve;)0!==Pe&&(0===Xe||!ve||ne.z<=ve.z)?(Ae=ne,ne=ne.nextZ,Pe--):(Ae=ve,ve=ve.nextZ,Xe--),Me?Me.nextZ=Ae:K=Ae,Ae.prevZ=Me,Me=Ae;ne=ve}Me.nextZ=null,He*=2}while(De>1)}(q)}(a,l,h,p);for(var v,E,k=a;a.prev!==a.next;)if(v=a.prev,E=a.next,p?Cd(a,l,h,p):Pf(a))t.push(v.i/s),t.push(a.i/s),t.push(E.i/s),Ih(a),a=E.next,k=E.next;else if((a=E)===k){g?1===g?Ah(a=Lm(zl(a),t,s),t,s,l,h,p,2):2===g&&Rm(a,t,s,l,h,p):Ah(zl(a),t,s,l,h,p,1);break}}}function Pf(a){var t=a.prev,s=a,l=a.next;if(Zi(t,s,l)>=0)return!1;for(var h=a.next.next;h!==a.prev;){if(Lu(t.x,t.y,s.x,s.y,l.x,l.y,h.x,h.y)&&Zi(h.prev,h,h.next)>=0)return!1;h=h.next}return!0}function Cd(a,t,s,l){var h=a.prev,p=a,g=a.next;if(Zi(h,p,g)>=0)return!1;for(var v=h.x>p.x?h.x>g.x?h.x:g.x:p.x>g.x?p.x:g.x,E=h.y>p.y?h.y>g.y?h.y:g.y:p.y>g.y?p.y:g.y,k=Id(h.x<p.x?h.x<g.x?h.x:g.x:p.x<g.x?p.x:g.x,h.y<p.y?h.y<g.y?h.y:g.y:p.y<g.y?p.y:g.y,t,s,l),M=Id(v,E,t,s,l),D=a.prevZ,R=a.nextZ;D&&D.z>=k&&R&&R.z<=M;){if(D!==a.prev&&D!==a.next&&Lu(h.x,h.y,p.x,p.y,g.x,g.y,D.x,D.y)&&Zi(D.prev,D,D.next)>=0||(D=D.prevZ,R!==a.prev&&R!==a.next&&Lu(h.x,h.y,p.x,p.y,g.x,g.y,R.x,R.y)&&Zi(R.prev,R,R.next)>=0))return!1;R=R.nextZ}for(;D&&D.z>=k;){if(D!==a.prev&&D!==a.next&&Lu(h.x,h.y,p.x,p.y,g.x,g.y,D.x,D.y)&&Zi(D.prev,D,D.next)>=0)return!1;D=D.prevZ}for(;R&&R.z<=M;){if(R!==a.prev&&R!==a.next&&Lu(h.x,h.y,p.x,p.y,g.x,g.y,R.x,R.y)&&Zi(R.prev,R,R.next)>=0)return!1;R=R.nextZ}return!0}function Lm(a,t,s){var l=a;do{var h=l.prev,p=l.next.next;!Lf(h,p)&&W0(h,l,l.next,p)&&Ch(h,p)&&Ch(p,h)&&(t.push(h.i/s),t.push(l.i/s),t.push(p.i/s),Ih(l),Ih(l.next),l=a=p),l=l.next}while(l!==a);return zl(l)}function Rm(a,t,s,l,h,p){var g=a;do{for(var v=g.next.next;v!==g.prev;){if(g.i!==v.i&&Um(g,v)){var E=X0(g,v);return g=zl(g,g.next),E=zl(E,E.next),Ah(g,t,s,l,h,p),void Ah(E,t,s,l,h,p)}v=v.next}g=g.next}while(g!==a)}function Om(a,t){return a.x-t.x}function zm(a,t){var s=function(p,g){var v,E=g,k=p.x,M=p.y,D=-1/0;do{if(M<=E.y&&M>=E.next.y&&E.next.y!==E.y){var R=E.x+(M-E.y)*(E.next.x-E.x)/(E.next.y-E.y);if(R<=k&&R>D){if(D=R,R===k){if(M===E.y)return E;if(M===E.next.y)return E.next}v=E.x<E.next.x?E:E.next}}E=E.next}while(E!==g);if(!v)return null;if(k===D)return v;var z,q=v,K=v.x,ee=v.y,ne=1/0;E=v;do{k>=E.x&&E.x>=K&&k!==E.x&&Lu(M<ee?k:D,M,K,ee,M<ee?D:k,M,E.x,E.y)&&(z=Math.abs(M-E.y)/(k-E.x),Ch(E,p)&&(z<ne||z===ne&&(E.x>v.x||E.x===v.x&&Bm(v,E)))&&(v=E,ne=z)),E=E.next}while(E!==q);return v}(a,t);if(!s)return t;var l=X0(s,a),h=zl(s,s.next);return zl(l,l.next),t===s?h:t}function Bm(a,t){return Zi(a.prev,a,t.prev)<0&&Zi(t.next,a,a.next)<0}function Id(a,t,s,l,h){return(a=1431655765&((a=858993459&((a=252645135&((a=16711935&((a=32767*(a-s)*h)|a<<8))|a<<4))|a<<2))|a<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-l)*h)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function Nm(a){var t=a,s=a;do{(t.x<s.x||t.x===s.x&&t.y<s.y)&&(s=t),t=t.next}while(t!==a);return s}function Lu(a,t,s,l,h,p,g,v){return(h-g)*(t-v)-(a-g)*(p-v)>=0&&(a-g)*(l-v)-(s-g)*(t-v)>=0&&(s-g)*(p-v)-(h-g)*(l-v)>=0}function Um(a,t){return a.next.i!==t.i&&a.prev.i!==t.i&&!function(s,l){var h=s;do{if(h.i!==s.i&&h.next.i!==s.i&&h.i!==l.i&&h.next.i!==l.i&&W0(h,h.next,s,l))return!0;h=h.next}while(h!==s);return!1}(a,t)&&(Ch(a,t)&&Ch(t,a)&&function(s,l){var h=s,p=!1,g=(s.x+l.x)/2,v=(s.y+l.y)/2;do{h.y>v!=h.next.y>v&&h.next.y!==h.y&&g<(h.next.x-h.x)*(v-h.y)/(h.next.y-h.y)+h.x&&(p=!p),h=h.next}while(h!==s);return p}(a,t)&&(Zi(a.prev,a,t.prev)||Zi(a,t.prev,t))||Lf(a,t)&&Zi(a.prev,a,a.next)>0&&Zi(t.prev,t,t.next)>0)}function Zi(a,t,s){return(t.y-a.y)*(s.x-t.x)-(t.x-a.x)*(s.y-t.y)}function Lf(a,t){return a.x===t.x&&a.y===t.y}function W0(a,t,s,l){var h=Rf(Zi(a,t,s)),p=Rf(Zi(a,t,l)),g=Rf(Zi(s,l,a)),v=Rf(Zi(s,l,t));return h!==p&&g!==v||!(0!==h||!kh(a,s,t))||!(0!==p||!kh(a,l,t))||!(0!==g||!kh(s,a,l))||!(0!==v||!kh(s,t,l))}function kh(a,t,s){return t.x<=Math.max(a.x,s.x)&&t.x>=Math.min(a.x,s.x)&&t.y<=Math.max(a.y,s.y)&&t.y>=Math.min(a.y,s.y)}function Rf(a){return a>0?1:a<0?-1:0}function Ch(a,t){return Zi(a.prev,a,a.next)<0?Zi(a,t,a.next)>=0&&Zi(a,a.prev,t)>=0:Zi(a,t,a.prev)<0||Zi(a,a.next,t)<0}function X0(a,t){var s=new Md(a.i,a.x,a.y),l=new Md(t.i,t.x,t.y),h=a.next,p=t.prev;return a.next=t,t.prev=a,s.next=h,h.prev=s,l.next=s,s.prev=l,p.next=l,l.prev=p,l}function H0(a,t,s,l){var h=new Md(a,t,s);return l?(h.next=l.next,h.prev=l,l.next.prev=h,l.next=h):(h.prev=h,h.next=h),h}function Ih(a){a.next.prev=a.prev,a.prev.next=a.next,a.prevZ&&(a.prevZ.nextZ=a.nextZ),a.nextZ&&(a.nextZ.prevZ=a.prevZ)}function Md(a,t,s){this.i=a,this.x=t,this.y=s,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function Fd(a,t,s,l){for(var h=0,p=t,g=s-l;p<s;p+=l)h+=(a[g]-a[p])*(a[p+1]+a[g+1]),g=p;return h}function Zm(a,t,s,l,h){Y0(a,t,s||0,l||a.length-1,h||Vm)}function Y0(a,t,s,l,h){for(;l>s;){if(l-s>600){var p=l-s+1,g=t-s+1,v=Math.log(p),E=.5*Math.exp(2*v/3),k=.5*Math.sqrt(v*E*(p-E)/p)*(g-p/2<0?-1:1);Y0(a,t,Math.max(s,Math.floor(t-g*E/p+k)),Math.min(l,Math.floor(t+(p-g)*E/p+k)),h)}var M=a[t],D=s,R=l;for(Mh(a,s,t),h(a[l],M)>0&&Mh(a,s,l);D<R;){for(Mh(a,D,R),D++,R--;h(a[D],M)<0;)D++;for(;h(a[R],M)>0;)R--}0===h(a[s],M)?Mh(a,s,R):Mh(a,++R,l),R<=t&&(s=R+1),t<=R&&(l=R-1)}}function Mh(a,t,s){var l=a[t];a[t]=a[s],a[s]=l}function Vm(a,t){return a<t?-1:a>t?1:0}function Dd(a,t){const s=a.length;if(s<=1)return[a];const l=[];let h,p;for(let g=0;g<s;g++){const v=Os(a[g]);0!==v&&(a[g].area=Math.abs(v),void 0===p&&(p=v<0),p===v<0?(h&&l.push(h),h=[a[g]]):h.push(a[g]))}if(h&&l.push(h),t>1)for(let g=0;g<l.length;g++)l[g].length<=t||(Zm(l[g],t,1,l[g].length-1,jm),l[g]=l[g].slice(0,t));return l}function jm(a,t){return t.area-a.area}function Pd(a,t,s){const l=s.patternDependencies;let h=!1;for(const p of t){const g=p.paint.get(`${a}-pattern`);g.isConstant()||(h=!0);const v=g.constantOr(null);v&&(h=!0,l[v.to]=!0,l[v.from]=!0)}return h}function Of(a,t,s,l,h){const p=h.patternDependencies;for(const g of t){const v=g.paint.get(`${a}-pattern`).value;if("constant"!==v.kind){let E=v.evaluate({zoom:l-1},s,{},h.availableImages),k=v.evaluate({zoom:l},s,{},h.availableImages),M=v.evaluate({zoom:l+1},s,{},h.availableImages);E=E&&E.name?E.name:E,k=k&&k.name?k.name:k,M=M&&M.name?M.name:M,p[E]=!0,p[k]=!0,p[M]=!0,s.patterns[g.id]={min:E,mid:k,max:M}}}return s}Df.deviation=function(a,t,s,l){var h=t&&t.length,p=Math.abs(Fd(a,0,h?t[0]*s:a.length,s));if(h)for(var g=0,v=t.length;g<v;g++)p-=Math.abs(Fd(a,t[g]*s,g<v-1?t[g+1]*s:a.length,s));var E=0;for(g=0;g<l.length;g+=3){var k=l[g]*s,M=l[g+1]*s,D=l[g+2]*s;E+=Math.abs((a[k]-a[D])*(a[M+1]-a[k+1])-(a[k]-a[M])*(a[D+1]-a[k+1]))}return 0===p&&0===E?0:Math.abs((E-p)/p)},Df.flatten=function(a){for(var t=a[0][0].length,s={vertices:[],holes:[],dimensions:t},l=0,h=0;h<a.length;h++){for(var p=0;p<a[h].length;p++)for(var g=0;g<t;g++)s.vertices.push(a[h][p][g]);h>0&&s.holes.push(l+=a[h-1].length)}return s},Sh.default=Pm;class zf{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(s=>s.id),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new he,this.indexArray=new Mt,this.indexArray2=new rr,this.programConfigurations=new Fc(t.layers,t.zoom),this.segments=new wi,this.segments2=new wi,this.stateDependentLayerIds=this.layers.filter(s=>s.isStateDependent()).map(s=>s.id),this.projection=t.projection}populate(t,s,l,h){this.hasPattern=Pd("fill",this.layers,s);const p=this.layers[0].layout.get("fill-sort-key"),g=[];for(const{feature:v,id:E,index:k,sourceLayerIndex:M}of t){const D=this.layers[0]._featureFilter.needGeometry,R=Rl(v,D);if(!this.layers[0]._featureFilter.filter(new qr(this.zoom),R,l))continue;const z=p?p.evaluate(R,{},l,s.availableImages):void 0,q={id:E,properties:v.properties,type:v.type,sourceLayerIndex:M,index:k,geometry:D?R.geometry:vs(v,l,h),patterns:{},sortKey:z};g.push(q)}p&&g.sort((v,E)=>v.sortKey-E.sortKey);for(const v of g){const{geometry:E,index:k,sourceLayerIndex:M}=v;if(this.hasPattern){const D=Of("fill",this.layers,v,this.zoom,s);this.patternFeatures.push(D)}else this.addFeature(v,E,k,l,{},s.availableImages);s.featureIndex.insert(t[k].feature,E,k,M,this.index)}}update(t,s,l,h){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,s,this.stateDependentLayers,l,h)}addFeatures(t,s,l,h,p){for(const g of this.patternFeatures)this.addFeature(g,g.geometry,g.index,s,l,h)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Dm),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.indexBuffer2=t.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(t,s,l,h,p,g=[]){for(const v of Dd(s,500)){let E=0;for(const q of v)E+=q.length;const k=this.segments.prepareSegment(E,this.layoutVertexArray,this.indexArray),M=k.vertexLength,D=[],R=[];for(const q of v){if(0===q.length)continue;q!==v[0]&&R.push(D.length/2);const K=this.segments2.prepareSegment(q.length,this.layoutVertexArray,this.indexArray2),ee=K.vertexLength;this.layoutVertexArray.emplaceBack(q[0].x,q[0].y),this.indexArray2.emplaceBack(ee+q.length-1,ee),D.push(q[0].x),D.push(q[0].y);for(let ne=1;ne<q.length;ne++)this.layoutVertexArray.emplaceBack(q[ne].x,q[ne].y),this.indexArray2.emplaceBack(ee+ne-1,ee+ne),D.push(q[ne].x),D.push(q[ne].y);K.vertexLength+=q.length,K.primitiveLength+=q.length}const z=Sh(D,R);for(let q=0;q<z.length;q+=3)this.indexArray.emplaceBack(M+z[q],M+z[q+1],M+z[q+2]);k.vertexLength+=E,k.primitiveLength+=z.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,l,p,g,h)}}Dt(zf,"FillBucket",{omit:["layers","patternFeatures"]});const qm=new V({"fill-sort-key":new A(Ze.layout_fill["fill-sort-key"])});var Gm={paint:new V({"fill-antialias":new S(Ze.paint_fill["fill-antialias"]),"fill-opacity":new A(Ze.paint_fill["fill-opacity"]),"fill-color":new A(Ze.paint_fill["fill-color"]),"fill-outline-color":new A(Ze.paint_fill["fill-outline-color"]),"fill-translate":new S(Ze.paint_fill["fill-translate"]),"fill-translate-anchor":new S(Ze.paint_fill["fill-translate-anchor"]),"fill-pattern":new P(Ze.paint_fill["fill-pattern"])}),layout:qm};const $m=se([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),Wm=se([{name:"a_centroid_pos",components:2,type:"Uint16"}]),Xm=se([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:K0}=$m;var J0=Ru;function Ru(a,t,s,l,h){this.properties={},this.extent=s,this.type=0,this._pbf=a,this._geometry=-1,this._keys=l,this._values=h,a.readFields(Q0,this,t)}function Q0(a,t,s){1==a?t.id=s.readVarint():2==a?function(l,h){for(var p=l.readVarint()+l.pos;l.pos<p;){var g=h._keys[l.readVarint()],v=h._values[l.readVarint()];h.properties[g]=v}}(s,t):3==a?t.type=s.readVarint():4==a&&(t._geometry=s.pos)}function Hm(a){for(var t,s,l=0,h=0,p=a.length,g=p-1;h<p;g=h++)l+=((s=a[g]).x-(t=a[h]).x)*(t.y+s.y);return l}Ru.types=["Unknown","Point","LineString","Polygon"],Ru.prototype.loadGeometry=function(){var a=this._pbf;a.pos=this._geometry;for(var t,s=a.readVarint()+a.pos,l=1,h=0,p=0,g=0,v=[];a.pos<s;){if(h<=0){var E=a.readVarint();l=7&E,h=E>>3}if(h--,1===l||2===l)p+=a.readSVarint(),g+=a.readSVarint(),1===l&&(t&&v.push(t),t=[]),t.push(new ut(p,g));else{if(7!==l)throw new Error("unknown command "+l);t&&t.push(t[0].clone())}}return t&&v.push(t),v},Ru.prototype.bbox=function(){var a=this._pbf;a.pos=this._geometry;for(var t=a.readVarint()+a.pos,s=1,l=0,h=0,p=0,g=1/0,v=-1/0,E=1/0,k=-1/0;a.pos<t;){if(l<=0){var M=a.readVarint();s=7&M,l=M>>3}if(l--,1===s||2===s)(h+=a.readSVarint())<g&&(g=h),h>v&&(v=h),(p+=a.readSVarint())<E&&(E=p),p>k&&(k=p);else if(7!==s)throw new Error("unknown command "+s)}return[g,E,v,k]},Ru.prototype.toGeoJSON=function(a,t,s){var l,h,p=this.extent*Math.pow(2,s),g=this.extent*a,v=this.extent*t,E=this.loadGeometry(),k=Ru.types[this.type];function M(z){for(var q=0;q<z.length;q++){var K=z[q];z[q]=[360*(K.x+g)/p-180,360/Math.PI*Math.atan(Math.exp((180-360*(K.y+v)/p)*Math.PI/180))-90]}}switch(this.type){case 1:var D=[];for(l=0;l<E.length;l++)D[l]=E[l][0];M(E=D);break;case 2:for(l=0;l<E.length;l++)M(E[l]);break;case 3:for(E=function(z){var q=z.length;if(q<=1)return[z];for(var K,ee,ne=[],ve=0;ve<q;ve++){var Ae=Hm(z[ve]);0!==Ae&&(void 0===ee&&(ee=Ae<0),ee===Ae<0?(K&&ne.push(K),K=[z[ve]]):K.push(z[ve]))}return K&&ne.push(K),ne}(E),l=0;l<E.length;l++)for(h=0;h<E[l].length;h++)M(E[l][h])}1===E.length?E=E[0]:k="Multi"+k;var R={type:"Feature",geometry:{type:k,coordinates:E},properties:this.properties};return"id"in this&&(R.id=this.id),R};var ep=tp;function tp(a,t){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=a,this._keys=[],this._values=[],this._features=[],a.readFields(rp,this,t),this.length=this._features.length}function rp(a,t,s){15===a?t.version=s.readVarint():1===a?t.name=s.readString():5===a?t.extent=s.readVarint():2===a?t._features.push(s.pos):3===a?t._keys.push(s.readString()):4===a&&t._values.push(function(l){for(var h=null,p=l.readVarint()+l.pos;l.pos<p;){var g=l.readVarint()>>3;h=1===g?l.readString():2===g?l.readFloat():3===g?l.readDouble():4===g?l.readVarint64():5===g?l.readVarint():6===g?l.readSVarint():7===g?l.readBoolean():null}return h}(s))}function Ym(a,t,s){if(3===a){var l=new ep(s,s.readVarint()+s.pos);l.length&&(t[l.name]=l)}}tp.prototype.feature=function(a){if(a<0||a>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[a];var t=this._pbf.readVarint()+this._pbf.pos;return new J0(this._pbf,t,this.extent,this._keys,this._values)};var Bl={VectorTile:function(a,t){this.layers=a.readFields(Ym,{},t)},VectorTileFeature:J0,VectorTileLayer:ep};function Bf(a,t,s,l){const h=[],p=0===l?(g,v,E,k,M,D)=>{g.push(new ut(D,E+(D-v)/(k-v)*(M-E)))}:(g,v,E,k,M,D)=>{g.push(new ut(v+(D-E)/(M-E)*(k-v),D))};for(const g of a){const v=[];for(const E of g){if(E.length<=2)continue;const k=[];for(let R=0;R<E.length-1;R++){const z=E[R].x,q=E[R].y,K=E[R+1].x,ee=E[R+1].y,ne=0===l?z:q,ve=0===l?K:ee;ne<t?ve>t&&p(k,z,q,K,ee,t):ne>s?ve<s&&p(k,z,q,K,ee,s):k.push(E[R]),ve<t&&ne>=t&&p(k,z,q,K,ee,t),ve>s&&ne<=s&&p(k,z,q,K,ee,s)}let M=E[E.length-1];const D=0===l?M.x:M.y;D>=t&&D<=s&&k.push(M),k.length&&(M=k[k.length-1],k[0].x===M.x&&k[0].y===M.y||k.push(k[0]),v.push(k))}v.length&&h.push(v)}return h}const ip=Bl.VectorTileFeature.types,np=Math.pow(2,13);function Fh(a,t,s,l,h,p,g,v){a.emplaceBack((t<<1)+g,(s<<1)+p,(Math.floor(l*np)<<1)+h,Math.round(v))}function Dh(a,t,s){a.emplaceBack(t.x,t.y,t.z,16384*s[0],16384*s[1],16384*s[2])}class ap{constructor(){this.acc=new ut(0,0),this.polyCount=[]}startRing(t){this.currentPolyCount={edges:0,top:0},this.polyCount.push(this.currentPolyCount),this.min||(this.min=new ut(t.x,t.y),this.max=new ut(t.x,t.y))}append(t,s){this.currentPolyCount.edges++,this.acc._add(t);const l=this.min,h=this.max;t.x<l.x?l.x=t.x:t.x>h.x&&(h.x=t.x),t.y<l.y?l.y=t.y:t.y>h.y&&(h.y=t.y),((0===t.x||t.x===hr)&&t.x===s.x)!=((0===t.y||t.y===hr)&&t.y===s.y)&&this.processBorderOverlap(t,s),s.x<0!=t.x<0&&this.addBorderIntersection(0,Qt(s.y,t.y,(0-s.x)/(t.x-s.x))),s.x>hr!=t.x>hr&&this.addBorderIntersection(1,Qt(s.y,t.y,(hr-s.x)/(t.x-s.x))),s.y<0!=t.y<0&&this.addBorderIntersection(2,Qt(s.x,t.x,(0-s.y)/(t.y-s.y))),s.y>hr!=t.y>hr&&this.addBorderIntersection(3,Qt(s.x,t.x,(hr-s.y)/(t.y-s.y)))}addBorderIntersection(t,s){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const l=this.borders[t];s<l[0]&&(l[0]=s),s>l[1]&&(l[1]=s)}processBorderOverlap(t,s){if(t.x===s.x){if(t.y===s.y)return;const l=0===t.x?0:1;this.addBorderIntersection(l,s.y),this.addBorderIntersection(l,t.y)}else{const l=0===t.y?2:3;this.addBorderIntersection(l,s.x),this.addBorderIntersection(l,t.x)}}centroid(){const t=this.polyCount.reduce((s,l)=>s+l.edges,0);return 0!==t?this.acc.div(t)._round():new ut(0,0)}span(){return new ut(this.max.x-this.min.x,this.max.y-this.min.y)}intersectsCount(){return this.borders.reduce((t,s)=>t+ +(s[0]!==Number.MAX_VALUE),0)}}class Ou{constructor(t){this.zoom=t.zoom,this.canonical=t.canonical,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(s=>s.id),this.index=t.index,this.hasPattern=!1,this.projection=t.projection,this.layoutVertexArray=new ce,this.centroidVertexArray=new Ll,this.indexArray=new Mt,this.programConfigurations=new Fc(t.layers,t.zoom),this.segments=new wi,this.stateDependentLayerIds=this.layers.filter(s=>s.isStateDependent()).map(s=>s.id),this.enableTerrain=t.enableTerrain}populate(t,s,l,h){this.features=[],this.hasPattern=Pd("fill-extrusion",this.layers,s),this.featuresOnBorder=[],this.borders=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.tileToMeter=function(p){const g=Math.exp(Math.PI*(1-p.y/(1<<p.z)*2));return 80150034*g/(g*g+1)/hr/(1<<p.z)}(l);for(const{feature:p,id:g,index:v,sourceLayerIndex:E}of t){const k=this.layers[0]._featureFilter.needGeometry,M=Rl(p,k);if(!this.layers[0]._featureFilter.filter(new qr(this.zoom),M,l))continue;const D={id:g,sourceLayerIndex:E,index:v,geometry:k?M.geometry:vs(p,l,h),properties:p.properties,type:p.type,patterns:{}},R=this.layoutVertexArray.length;this.hasPattern?this.features.push(Of("fill-extrusion",this.layers,D,this.zoom,s)):this.addFeature(D,D.geometry,v,l,{},s.availableImages,h),s.featureIndex.insert(p,D.geometry,v,E,this.index,R)}this.sortBorders()}addFeatures(t,s,l,h,p){for(const g of this.features){const{geometry:v}=g;this.addFeature(g,v,g.index,s,l,h,p)}this.sortBorders()}update(t,s,l,h){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,s,this.stateDependentLayers,l,h)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,K0),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=t.createVertexBuffer(this.layoutVertexExtArray,Xm.members,!0))),this.programConfigurations.upload(t),this.uploaded=!0}uploadCentroid(t){0!==this.centroidVertexArray.length&&(this.centroidVertexBuffer?this.needsCentroidUpdate&&this.centroidVertexBuffer.updateData(this.centroidVertexArray):this.centroidVertexBuffer=t.createVertexBuffer(this.centroidVertexArray,Wm.members,!0),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(t,s,l,h,p,g,v){const E=[new ut(0,0),new ut(hr,hr)],k=v.projection,M="globe"===k.name,D=this.enableTerrain&&!M?new ap:null;M&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new Ki);const R=Dd(s,500);for(let K=R.length-1;K>=0;K--){const ee=R[K];(0===ee.length||(z=ee[0]).every(ne=>ne.x<=0)||z.every(ne=>ne.x>=hr)||z.every(ne=>ne.y<=0)||z.every(ne=>ne.y>=hr))&&R.splice(K,1)}var z;let q;if(M){const ee=1<<h.z,ne=es(h.x/ee),ve=es((h.x+1)/ee),Ae=En(h.y/ee),Me=En((h.y+1)/ee);q=function(De,Pe,Xe,He,st=0,ht){const $e=[];if(!De.length||!Xe||!He)return $e;const rt=(ur,dr)=>{for(const qt of ur)$e.push({polygon:qt,bounds:dr})},pt=Math.ceil(Math.log2(Xe)),vt=Math.ceil(Math.log2(He)),_t=pt-vt,wt=[];for(let ur=0;ur<Math.abs(_t);ur++)wt.push(_t>0?0:1);for(let ur=0;ur<Math.min(pt,vt);ur++)wt.push(0),wt.push(1);let cr=De;if(cr=Bf(cr,Pe[0].y-st,Pe[1].y+st,1),cr=Bf(cr,Pe[0].x-st,Pe[1].x+st,0),!cr.length)return $e;const vr=[];for(wt.length?vr.push({polygons:cr,bounds:Pe,depth:0}):rt(cr,Pe);vr.length;){const ur=vr.pop(),dr=ur.depth,qt=wt[dr],Ft=ur.bounds[0],kr=ur.bounds[1],Vr=0===qt?Ft.x:Ft.y,Wi=0===qt?kr.x:kr.y,oi=ht?ht(qt,Vr,Wi):.5*(Vr+Wi),Xi=Bf(ur.polygons,Vr-st,oi+st,qt),jr=Bf(ur.polygons,oi-st,Wi+st,qt);if(Xi.length){const Ir=[Ft,new ut(0===qt?oi:kr.x,1===qt?oi:kr.y)];wt.length>dr+1?vr.push({polygons:Xi,bounds:Ir,depth:dr+1}):rt(Xi,Ir)}if(jr.length){const Ir=[new ut(0===qt?oi:Ft.x,1===qt?oi:Ft.y),kr];wt.length>dr+1?vr.push({polygons:jr,bounds:Ir,depth:dr+1}):rt(jr,Ir)}}return $e}(R,E,Math.ceil((ve-ne)/11.25),Math.ceil((Ae-Me)/11.25),1,(De,Pe,Xe)=>{if(0===De)return.5*(Pe+Xe);{const He=En((h.y+Pe/hr)/ee);return(gs(.5*(En((h.y+Xe/hr)/ee)+He))*ee-h.y)*hr}})}else{q=[];for(const K of R)q.push({polygon:K,bounds:E})}for(const K of q){const ee=K.polygon;let ne=0,ve=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);for(let Xe=0;Xe<ee.length;Xe++){const He=ee[Xe];if(0===He.length)continue;ne+=He.length;let st=0;D&&D.startRing(He[0]);for(let ht=0;ht<He.length;ht++){const $e=He[ht];if(ht>=1){const rt=He[ht-1];if(!Km($e,rt,K.bounds)){D&&D.append($e,rt),ve.vertexLength+4>wi.MAX_VERTEX_ARRAY_LENGTH&&(ve=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const pt=$e.sub(rt)._perp(),vt=pt.x/(Math.abs(pt.x)+Math.abs(pt.y)),_t=pt.y>0?1:0,wt=rt.dist($e);st+wt>32768&&(st=0),Fh(this.layoutVertexArray,$e.x,$e.y,vt,_t,0,0,st),Fh(this.layoutVertexArray,$e.x,$e.y,vt,_t,0,1,st),st+=wt,Fh(this.layoutVertexArray,rt.x,rt.y,vt,_t,0,0,st),Fh(this.layoutVertexArray,rt.x,rt.y,vt,_t,0,1,st);const cr=ve.vertexLength;if(this.indexArray.emplaceBack(cr,cr+2,cr+1),this.indexArray.emplaceBack(cr+1,cr+2,cr+3),ve.vertexLength+=4,ve.primitiveLength+=2,M){const vr=this.layoutVertexExtArray,ur=k.projectTilePoint($e.x,$e.y,h),dr=k.projectTilePoint(rt.x,rt.y,h),qt=k.upVector(h,$e.x,$e.y),Ft=k.upVector(h,rt.x,rt.y);Dh(vr,ur,qt),Dh(vr,ur,qt),Dh(vr,dr,Ft),Dh(vr,dr,Ft)}}}}}if(ve.vertexLength+ne>wi.MAX_VERTEX_ARRAY_LENGTH&&(ve=this.segments.prepareSegment(ne,this.layoutVertexArray,this.indexArray)),"Polygon"!==ip[t.type])continue;const Ae=[],Me=[],De=ve.vertexLength;for(let Xe=0;Xe<ee.length;Xe++){const He=ee[Xe];if(0!==He.length){He!==ee[0]&&Me.push(Ae.length/2);for(let st=0;st<He.length;st++){const ht=He[st];Fh(this.layoutVertexArray,ht.x,ht.y,0,0,1,1,0),Ae.push(ht.x),Ae.push(ht.y),D&&D.currentPolyCount.top++,M&&Dh(this.layoutVertexExtArray,k.projectTilePoint(ht.x,ht.y,h),k.upVector(h,ht.x,ht.y))}}}const Pe=Sh(Ae,Me);for(let Xe=0;Xe<Pe.length;Xe+=3)this.indexArray.emplaceBack(De+Pe[Xe],De+Pe[Xe+2],De+Pe[Xe+1]);ve.primitiveLength+=Pe.length/3,ve.vertexLength+=ne}if(D&&D.polyCount.length>0){if(D.borders){D.vertexArrayOffset=this.centroidVertexArray.length;const K=D.borders,ee=this.featuresOnBorder.push(D)-1;for(let ne=0;ne<4;ne++)K[ne][0]!==Number.MAX_VALUE&&this.borders[ne].push(ee)}this.encodeCentroid(D.borders?void 0:D.centroid(),D)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,l,p,g,h)}sortBorders(){for(let t=0;t<4;t++)this.borders[t].sort((s,l)=>this.featuresOnBorder[s].borders[t][0]-this.featuresOnBorder[l].borders[t][0])}encodeCentroid(t,s,l=!0){let h,p;if(t)if(0!==t.y){const v=s.span()._mult(this.tileToMeter);h=(Math.max(t.x,1)<<3)+Math.min(7,Math.round(v.x/10)),p=(Math.max(t.y,1)<<3)+Math.min(7,Math.round(v.y/10))}else h=Math.ceil(7*(t.x+450)),p=0;else h=0,p=+l;let g=l?this.centroidVertexArray.length:s.vertexArrayOffset;for(const v of s.polyCount){l&&this.centroidVertexArray.resize(this.centroidVertexArray.length+4*v.edges+v.top);for(let E=0;E<2*v.edges;E++)this.centroidVertexArray.emplace(g++,0,p),this.centroidVertexArray.emplace(g++,h,p);for(let E=0;E<v.top;E++)this.centroidVertexArray.emplace(g++,h,p)}}}function Km(a,t,s){return a.x===t.x&&(a.x<s[0].x||a.x>s[1].x)||a.y===t.y&&(a.y<s[0].y||a.y>s[1].y)}Dt(Ou,"FillExtrusionBucket",{omit:["layers","features"]}),Dt(ap,"PartMetadata");var Jm={paint:new V({"fill-extrusion-opacity":new S(Ze["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new A(Ze["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new S(Ze["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new S(Ze["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new P(Ze["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new A(Ze["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new A(Ze["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new S(Ze["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})};function Ph(a,t){return a.x*t.x+a.y*t.y}function sp(a,t){if(1===a.length){let s=0;const l=t[s++];let h;for(;!h||l.equals(h);)if(h=t[s++],!h)return 1/0;for(;s<t.length;s++){const p=t[s],g=a[0],v=h.sub(l),E=p.sub(l),k=g.sub(l),M=Ph(v,v),D=Ph(v,E),R=Ph(E,E),z=Ph(k,v),q=Ph(k,E),K=M*R-D*D,ee=(R*z-D*q)/K,ne=(M*q-D*z)/K,ve=l.z*(1-ee-ne)+h.z*ee+p.z*ne;if(isFinite(ve))return ve}return 1/0}{let s=1/0;for(const l of t)s=Math.min(s,l.z);return s}}function op(a){const t=new ut(a[0],a[1]);return t.z=a[2],t}function Qm(a,t,s,l,h,p,g,v){const E=g*h.getElevationAt(a,t,!0,!0),k=0!==p[0],M=k?0===p[1]?g*(p[0]/7-450):g*function(D,R,z){const q=Math.floor(R[0]/8),K=Math.floor(R[1]/8),ee=10*(R[0]-8*q),ne=10*(R[1]-8*K),ve=D.getElevationAt(q,K,!0,!0),Ae=D.getMeterToDEM(z),Me=Math.floor(.5*(ee*Ae-1)),De=Math.floor(.5*(ne*Ae-1)),Pe=D.tileCoordToPixel(q,K),Xe=2*Me+1,He=2*De+1,st=(vr=Xe,ur=He,[(_t=D).getElevationAtPixel(wt=Pe.x-Me,cr=Pe.y-De,!0),_t.getElevationAtPixel(wt+ur,cr,!0),_t.getElevationAtPixel(wt,cr+ur,!0),_t.getElevationAtPixel(wt+vr,cr+ur,!0)]),ht=Math.abs(st[0]-st[1]),$e=Math.abs(st[2]-st[3]),rt=Math.abs(st[0]-st[2])+Math.abs(st[1]-st[3]),pt=Math.min(.25,.5*Ae*(ht+$e)/Xe),vt=Math.min(.25,.5*Ae*rt/He);var _t,wt,cr,vr,ur;return ve+Math.max(pt*ee,vt*ne)}(h,p,v):E;return{base:E+(0===s)?-1:s,top:k?Math.max(M+l,E+s+2):E+l}}const e_=se([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),{members:t_}=e_,r_=se([{name:"a_packed",components:3,type:"Float32"}]),{members:i_}=r_,n_=Bl.VectorTileFeature.types,a_=Math.cos(Math.PI/180*37.5);class Nf{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(s=>s.id),this.index=t.index,this.projection=t.projection,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(s=>{this.gradients[s.id]={}}),this.layoutVertexArray=new le,this.layoutVertexArray2=new Qe,this.indexArray=new Mt,this.programConfigurations=new Fc(t.layers,t.zoom),this.segments=new wi,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(s=>s.isStateDependent()).map(s=>s.id)}populate(t,s,l,h){this.hasPattern=Pd("line",this.layers,s);const p=this.layers[0].layout.get("line-sort-key"),g=[];for(const{feature:M,id:D,index:R,sourceLayerIndex:z}of t){const q=this.layers[0]._featureFilter.needGeometry,K=Rl(M,q);if(!this.layers[0]._featureFilter.filter(new qr(this.zoom),K,l))continue;const ee=p?p.evaluate(K,{},l):void 0,ne={id:D,properties:M.properties,type:M.type,sourceLayerIndex:z,index:R,geometry:q?K.geometry:vs(M,l,h),patterns:{},sortKey:ee};g.push(ne)}p&&g.sort((M,D)=>M.sortKey-D.sortKey);const{lineAtlas:v,featureIndex:E}=s,k=this.addConstantDashes(v);for(const M of g){const{geometry:D,index:R,sourceLayerIndex:z}=M;if(k&&this.addFeatureDashes(M,v),this.hasPattern){const q=Of("line",this.layers,M,this.zoom,s);this.patternFeatures.push(q)}else this.addFeature(M,D,R,l,v.positions,s.availableImages);E.insert(t[R].feature,D,R,z,this.index)}}addConstantDashes(t){let s=!1;for(const l of this.layers){const h=l.paint.get("line-dasharray").value,p=l.layout.get("line-cap").value;if("constant"!==h.kind||"constant"!==p.kind)s=!0;else{const g=p.value,v=h.value;if(!v)continue;t.addDash(v.from,g),t.addDash(v.to,g),v.other&&t.addDash(v.other,g)}}return s}addFeatureDashes(t,s){const l=this.zoom;for(const h of this.layers){const p=h.paint.get("line-dasharray").value,g=h.layout.get("line-cap").value;if("constant"===p.kind&&"constant"===g.kind)continue;let v,E,k,M,D,R;if("constant"===p.kind){const ee=p.value;if(!ee)continue;v=ee.other||ee.to,E=ee.to,k=ee.from}else v=p.evaluate({zoom:l-1},t),E=p.evaluate({zoom:l},t),k=p.evaluate({zoom:l+1},t);"constant"===g.kind?M=D=R=g.value:(M=g.evaluate({zoom:l-1},t),D=g.evaluate({zoom:l},t),R=g.evaluate({zoom:l+1},t)),s.addDash(v,M),s.addDash(E,D),s.addDash(k,R);const z=s.getKey(v,M),q=s.getKey(E,D),K=s.getKey(k,R);t.patterns[h.id]={min:z,mid:q,max:K}}}update(t,s,l,h){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,s,this.stateDependentLayers,l,h)}addFeatures(t,s,l,h,p){for(const g of this.patternFeatures)this.addFeature(g,g.geometry,g.index,s,l,h)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(0!==this.layoutVertexArray2.length&&(this.layoutVertexBuffer2=t.createVertexBuffer(this.layoutVertexArray2,i_)),this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,t_),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(t){if(t.properties&&t.properties.hasOwnProperty("mapbox_clip_start")&&t.properties.hasOwnProperty("mapbox_clip_end"))return{start:+t.properties.mapbox_clip_start,end:+t.properties.mapbox_clip_end}}addFeature(t,s,l,h,p,g){const v=this.layers[0].layout,E=v.get("line-join").evaluate(t,{}),k=v.get("line-cap").evaluate(t,{}),M=v.get("line-miter-limit"),D=v.get("line-round-limit");this.lineClips=this.lineFeatureClips(t);for(const R of s)this.addLine(R,t,E,k,M,D);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,l,p,g,h)}addLine(t,s,l,h,p,g){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineSoFar=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let ne=0;ne<t.length-1;ne++)this.totalDistance+=t[ne].dist(t[ne+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const v="Polygon"===n_[s.type];let E=t.length;for(;E>=2&&t[E-1].equals(t[E-2]);)E--;let k=0;for(;k<E-1&&t[k].equals(t[k+1]);)k++;if(E<(v?3:2))return;"bevel"===l&&(p=1.05);const M=this.overscaling<=16?122880/(512*this.overscaling):0,D=this.segments.prepareSegment(10*E,this.layoutVertexArray,this.indexArray);let R,z,q,K,ee;this.e1=this.e2=-1,v&&(R=t[E-2],ee=t[k].sub(R)._unit()._perp());for(let ne=k;ne<E;ne++){if(q=ne===E-1?v?t[k+1]:void 0:t[ne+1],q&&t[ne].equals(q))continue;ee&&(K=ee),R&&(z=R),R=t[ne],ee=q?q.sub(R)._unit()._perp():K,K=K||ee;let ve=K.add(ee);0===ve.x&&0===ve.y||ve._unit();const Ae=K.x*ee.x+K.y*ee.y,Me=ve.x*ee.x+ve.y*ee.y,De=0!==Me?1/Me:1/0,Pe=2*Math.sqrt(2-2*Me),Xe=Me<a_&&z&&q,He=K.x*ee.y-K.y*ee.x>0;if(Xe&&ne>k){const $e=R.dist(z);if($e>2*M){const rt=R.sub(R.sub(z)._mult(M/$e)._round());this.updateDistance(z,rt),this.addCurrentVertex(rt,K,0,0,D),z=rt}}const st=z&&q;let ht=st?l:v?"butt":h;if(st&&"round"===ht&&(De<g?ht="miter":De<=2&&(ht="fakeround")),"miter"===ht&&De>p&&(ht="bevel"),"bevel"===ht&&(De>2&&(ht="flipbevel"),De<p&&(ht="miter")),z&&this.updateDistance(z,R),"miter"===ht)ve._mult(De),this.addCurrentVertex(R,ve,0,0,D);else if("flipbevel"===ht){if(De>100)ve=ee.mult(-1);else{const $e=De*K.add(ee).mag()/K.sub(ee).mag();ve._perp()._mult($e*(He?-1:1))}this.addCurrentVertex(R,ve,0,0,D),this.addCurrentVertex(R,ve.mult(-1),0,0,D)}else if("bevel"===ht||"fakeround"===ht){const $e=-Math.sqrt(De*De-1),rt=He?$e:0,pt=He?0:$e;if(z&&this.addCurrentVertex(R,K,rt,pt,D),"fakeround"===ht){const vt=Math.round(180*Pe/Math.PI/20);for(let _t=1;_t<vt;_t++){let wt=_t/vt;if(.5!==wt){const vr=wt-.5;wt+=wt*vr*(wt-1)*((1.0904+Ae*(Ae*(3.55645-1.43519*Ae)-3.2452))*vr*vr+(.848013+Ae*(.215638*Ae-1.06021)))}const cr=ee.sub(K)._mult(wt)._add(K)._unit()._mult(He?-1:1);this.addHalfVertex(R,cr.x,cr.y,!1,He,0,D)}}q&&this.addCurrentVertex(R,ee,-rt,-pt,D)}else if("butt"===ht)this.addCurrentVertex(R,ve,0,0,D);else if("square"===ht){const $e=z?1:-1;z||this.addCurrentVertex(R,ve,$e,$e,D),this.addCurrentVertex(R,ve,0,0,D),z&&this.addCurrentVertex(R,ve,$e,$e,D)}else"round"===ht&&(z&&(this.addCurrentVertex(R,K,0,0,D),this.addCurrentVertex(R,K,1,1,D,!0)),q&&(this.addCurrentVertex(R,ee,-1,-1,D,!0),this.addCurrentVertex(R,ee,0,0,D)));if(Xe&&ne<E-1){const $e=R.dist(q);if($e>2*M){const rt=R.add(q.sub(R)._mult(M/$e)._round());this.updateDistance(R,rt),this.addCurrentVertex(rt,ee,0,0,D),R=rt}}}}addCurrentVertex(t,s,l,h,p,g=!1){const v=s.y*h-s.x,E=-s.y-s.x*h;this.addHalfVertex(t,s.x+s.y*l,s.y-s.x*l,g,!1,l,p),this.addHalfVertex(t,v,E,g,!0,-h,p)}addHalfVertex({x:t,y:s},l,h,p,g,v,E){this.layoutVertexArray.emplaceBack((t<<1)+(p?1:0),(s<<1)+(g?1:0),Math.round(63*l)+128,Math.round(63*h)+128,1+(0===v?0:v<0?-1:1),0,this.lineSoFar),this.lineClips&&this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,this.lineSoFar);const k=E.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,k),E.primitiveLength++),g?this.e2=k:this.e1=k}updateScaledDistance(){if(this.lineClips){const t=this.totalDistance/(this.lineClips.end-this.lineClips.start);this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=t*this.lineClips.start+this.distance}else this.lineSoFar=this.distance}updateDistance(t,s){this.distance+=t.dist(s),this.updateScaledDistance()}}Dt(Nf,"LineBucket",{omit:["layers","patternFeatures"]});const s_=new V({"line-cap":new A(Ze.layout_line["line-cap"]),"line-join":new A(Ze.layout_line["line-join"]),"line-miter-limit":new S(Ze.layout_line["line-miter-limit"]),"line-round-limit":new S(Ze.layout_line["line-round-limit"]),"line-sort-key":new A(Ze.layout_line["line-sort-key"])});var lp={paint:new V({"line-opacity":new A(Ze.paint_line["line-opacity"]),"line-color":new A(Ze.paint_line["line-color"]),"line-translate":new S(Ze.paint_line["line-translate"]),"line-translate-anchor":new S(Ze.paint_line["line-translate-anchor"]),"line-width":new A(Ze.paint_line["line-width"]),"line-gap-width":new A(Ze.paint_line["line-gap-width"]),"line-offset":new A(Ze.paint_line["line-offset"]),"line-blur":new A(Ze.paint_line["line-blur"]),"line-dasharray":new P(Ze.paint_line["line-dasharray"]),"line-pattern":new P(Ze.paint_line["line-pattern"]),"line-gradient":new L(Ze.paint_line["line-gradient"])}),layout:s_};const cp=new class extends A{possiblyEvaluate(a,t){return t=new qr(Math.floor(t.zoom),{now:t.now,fadeDuration:t.fadeDuration,zoomHistory:t.zoomHistory,transition:t.transition}),super.possiblyEvaluate(a,t)}evaluate(a,t,s,l){return t=Gi({},t,{zoom:Math.floor(t.zoom)}),super.evaluate(a,t,s,l)}}(lp.paint.properties["line-width"].specification);function up(a,t){return t>0?t+2*a:a}cp.useIntegerZoom=!0;const o_=se([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"},{name:"a_z_tile_anchor",components:4,type:"Int16"}],4),hp=se([{name:"a_projected_pos",components:3,type:"Float32"}],4);se([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const l_=se([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]),c_=se([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"}]);se([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const fp=se([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),u_=se([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);se([{name:"triangle",components:3,type:"Uint16"}]),se([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),se([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),se([{type:"Float32",name:"offsetX"}]),se([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]);const eo=128;function Ld(a,t){const{expression:s}=t;if("constant"===s.kind)return{kind:"constant",layoutSize:s.evaluate(new qr(a+1))};if("source"===s.kind)return{kind:"source"};{const{zoomStops:l,interpolationType:h}=s;let p=0;for(;p<l.length&&l[p]<=a;)p++;p=Math.max(0,p-1);let g=p;for(;g<l.length&&l[g]<a+1;)g++;g=Math.min(l.length-1,g);const v=l[p],E=l[g];return"composite"===s.kind?{kind:"composite",minZoom:v,maxZoom:E,interpolationType:h}:{kind:"camera",minZoom:v,maxZoom:E,minSize:s.evaluate(new qr(v)),maxSize:s.evaluate(new qr(E)),interpolationType:h}}}function Uf(a,{uSize:t,uSizeT:s},{lowerSize:l,upperSize:h}){return"source"===a.kind?l/eo:"composite"===a.kind?Qt(l/eo,h/eo,s):t}function zu(a,t){let s=0,l=0;if("constant"===a.kind)l=a.layoutSize;else if("source"!==a.kind){const{interpolationType:h,minZoom:p,maxZoom:g}=a,v=h?wr(Yn.interpolationFactor(h,t,p,g),0,1):0;"camera"===a.kind?l=Qt(a.minSize,a.maxSize,v):s=v}return{uSizeT:s,uSize:l}}var h_=Object.freeze({__proto__:null,getSizeData:Ld,evaluateSizeForFeature:Uf,evaluateSizeForZoom:zu,SIZE_PACK_FACTOR:eo});function f_(a,t,s){return a.sections.forEach(l=>{l.text=function(h,p,g){const v=p.layout.get("text-transform").evaluate(g,{});return"uppercase"===v?h=h.toLocaleUpperCase():"lowercase"===v&&(h=h.toLocaleLowerCase()),ai.applyArabicShaping&&(h=ai.applyArabicShaping(h)),h}(l.text,t,s)}),a}const Lh={"!":"\ufe15","#":"\uff03",$:"\uff04","%":"\uff05","&":"\uff06","(":"\ufe35",")":"\ufe36","*":"\uff0a","+":"\uff0b",",":"\ufe10","-":"\ufe32",".":"\u30fb","/":"\uff0f",":":"\ufe13",";":"\ufe14","<":"\ufe3f","=":"\uff1d",">":"\ufe40","?":"\ufe16","@":"\uff20","[":"\ufe47","\\":"\uff3c","]":"\ufe48","^":"\uff3e",_:"\ufe33","`":"\uff40","{":"\ufe37","|":"\u2015","}":"\ufe38","~":"\uff5e","\xa2":"\uffe0","\xa3":"\uffe1","\xa5":"\uffe5","\xa6":"\uffe4","\xac":"\uffe2","\xaf":"\uffe3","\u2013":"\ufe32","\u2014":"\ufe31","\u2018":"\ufe43","\u2019":"\ufe44","\u201c":"\ufe41","\u201d":"\ufe42","\u2026":"\ufe19","\u2027":"\u30fb","\u20a9":"\uffe6","\u3001":"\ufe11","\u3002":"\ufe12","\u3008":"\ufe3f","\u3009":"\ufe40","\u300a":"\ufe3d","\u300b":"\ufe3e","\u300c":"\ufe41","\u300d":"\ufe42","\u300e":"\ufe43","\u300f":"\ufe44","\u3010":"\ufe3b","\u3011":"\ufe3c","\u3014":"\ufe39","\u3015":"\ufe3a","\u3016":"\ufe17","\u3017":"\ufe18","\uff01":"\ufe15","\uff08":"\ufe35","\uff09":"\ufe36","\uff0c":"\ufe10","\uff0d":"\ufe32","\uff0e":"\u30fb","\uff1a":"\ufe13","\uff1b":"\ufe14","\uff1c":"\ufe3f","\uff1e":"\ufe40","\uff1f":"\ufe16","\uff3b":"\ufe47","\uff3d":"\ufe48","\uff3f":"\ufe33","\uff5b":"\ufe37","\uff5c":"\u2015","\uff5d":"\ufe38","\uff5f":"\ufe35","\uff60":"\ufe36","\uff61":"\ufe12","\uff62":"\ufe41","\uff63":"\ufe42"};function d_(a){return"\ufe36"===a||"\ufe48"===a||"\ufe38"===a||"\ufe44"===a||"\ufe42"===a||"\ufe3e"===a||"\ufe3c"===a||"\ufe3a"===a||"\ufe18"===a||"\ufe40"===a||"\ufe10"===a||"\ufe13"===a||"\ufe14"===a||"\uff40"===a||"\uffe3"===a||"\ufe11"===a||"\ufe12"===a}function p_(a){return"\ufe35"===a||"\ufe47"===a||"\ufe37"===a||"\ufe43"===a||"\ufe41"===a||"\ufe3d"===a||"\ufe3b"===a||"\ufe39"===a||"\ufe17"===a||"\ufe3f"===a}var dp=function(a,t,s,l,h){var p,g,v=8*h-l-1,E=(1<<v)-1,k=E>>1,M=-7,D=s?h-1:0,R=s?-1:1,z=a[t+D];for(D+=R,p=z&(1<<-M)-1,z>>=-M,M+=v;M>0;p=256*p+a[t+D],D+=R,M-=8);for(g=p&(1<<-M)-1,p>>=-M,M+=l;M>0;g=256*g+a[t+D],D+=R,M-=8);if(0===p)p=1-k;else{if(p===E)return g?NaN:1/0*(z?-1:1);g+=Math.pow(2,l),p-=k}return(z?-1:1)*g*Math.pow(2,p-l)},pp=function(a,t,s,l,h,p){var g,v,E,k=8*p-h-1,M=(1<<k)-1,D=M>>1,R=23===h?Math.pow(2,-24)-Math.pow(2,-77):0,z=l?0:p-1,q=l?1:-1,K=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(v=isNaN(t)?1:0,g=M):(g=Math.floor(Math.log(t)/Math.LN2),t*(E=Math.pow(2,-g))<1&&(g--,E*=2),(t+=g+D>=1?R/E:R*Math.pow(2,1-D))*E>=2&&(g++,E/=2),g+D>=M?(v=0,g=M):g+D>=1?(v=(t*E-1)*Math.pow(2,h),g+=D):(v=t*Math.pow(2,D-1)*Math.pow(2,h),g=0));h>=8;a[s+z]=255&v,z+=q,v/=256,h-=8);for(g=g<<h|v,k+=h;k>0;a[s+z]=255&g,z+=q,g/=256,k-=8);a[s+z-q]|=128*K},Rh=Qr;function Qr(a){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(a)?a:new Uint8Array(a||0),this.pos=0,this.type=0,this.length=this.buf.length}Qr.Varint=0,Qr.Fixed64=1,Qr.Bytes=2,Qr.Fixed32=5;var Zf=4294967296,Rd=1/Zf,Od="undefined"==typeof TextDecoder?null:new TextDecoder("utf8");function ba(a){return a.type===Qr.Bytes?a.readVarint()+a.pos:a.pos+1}function Nl(a,t,s){var l=t<=16383?1:t<=2097151?2:t<=268435455?3:Math.floor(Math.log(t)/(7*Math.LN2));s.realloc(l);for(var h=s.pos-1;h>=a;h--)s.buf[h+l]=s.buf[h]}function Ag(a,t){for(var s=0;s<a.length;s++)t.writeVarint(a[s])}function m_(a,t){for(var s=0;s<a.length;s++)t.writeSVarint(a[s])}function __(a,t){for(var s=0;s<a.length;s++)t.writeFloat(a[s])}function g_(a,t){for(var s=0;s<a.length;s++)t.writeDouble(a[s])}function x_(a,t){for(var s=0;s<a.length;s++)t.writeBoolean(a[s])}function y_(a,t){for(var s=0;s<a.length;s++)t.writeFixed32(a[s])}function mp(a,t){for(var s=0;s<a.length;s++)t.writeSFixed32(a[s])}function v_(a,t){for(var s=0;s<a.length;s++)t.writeFixed64(a[s])}function w_(a,t){for(var s=0;s<a.length;s++)t.writeSFixed64(a[s])}function Vf(a,t){return(a[t]|a[t+1]<<8|a[t+2]<<16)+16777216*a[t+3]}function Nu(a,t,s){a[s]=t,a[s+1]=t>>>8,a[s+2]=t>>>16,a[s+3]=t>>>24}function _p(a,t){return(a[t]|a[t+1]<<8|a[t+2]<<16)+(a[t+3]<<24)}function gp(a,t,s){t.glyphs=[],1===a&&s.readMessage(b_,t)}function b_(a,t,s){if(3===a){const{id:l,bitmap:h,width:p,height:g,left:v,top:E,advance:k}=s.readMessage(T_,{});t.glyphs.push({id:l,bitmap:new Jo({width:p+6,height:g+6},h),metrics:{width:p,height:g,left:v,top:E,advance:k}})}else 4===a?t.ascender=s.readSVarint():5===a&&(t.descender=s.readSVarint())}function T_(a,t,s){1===a?t.id=s.readVarint():2===a?t.bitmap=s.readBytes():3===a?t.width=s.readVarint():4===a?t.height=s.readVarint():5===a?t.left=s.readSVarint():6===a?t.top=s.readSVarint():7===a&&(t.advance=s.readVarint())}function zd(a){let t=0,s=0;for(const g of a)t+=g.w*g.h,s=Math.max(s,g.w);a.sort((g,v)=>v.h-g.h);const l=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(t/.95)),s),h:1/0}];let h=0,p=0;for(const g of a)for(let v=l.length-1;v>=0;v--){const E=l[v];if(!(g.w>E.w||g.h>E.h)){if(g.x=E.x,g.y=E.y,p=Math.max(p,g.y+g.h),h=Math.max(h,g.x+g.w),g.w===E.w&&g.h===E.h){const k=l.pop();v<l.length&&(l[v]=k)}else g.h===E.h?(E.x+=g.w,E.w-=g.w):g.w===E.w?(E.y+=g.h,E.h-=g.h):(l.push({x:E.x+g.w,y:E.y,w:E.w-g.w,h:g.h}),E.y+=g.h,E.h-=g.h);break}}return{w:h,h:p,fill:t/(h*p)||0}}Qr.prototype={destroy:function(){this.buf=null},readFields:function(a,t,s){for(s=s||this.length;this.pos<s;){var l=this.readVarint(),h=l>>3,p=this.pos;this.type=7&l,a(h,t,this),this.pos===p&&this.skip(l)}return t},readMessage:function(a,t){return this.readFields(a,t,this.readVarint()+this.pos)},readFixed32:function(){var a=Vf(this.buf,this.pos);return this.pos+=4,a},readSFixed32:function(){var a=_p(this.buf,this.pos);return this.pos+=4,a},readFixed64:function(){var a=Vf(this.buf,this.pos)+Vf(this.buf,this.pos+4)*Zf;return this.pos+=8,a},readSFixed64:function(){var a=Vf(this.buf,this.pos)+_p(this.buf,this.pos+4)*Zf;return this.pos+=8,a},readFloat:function(){var a=dp(this.buf,this.pos,!0,23,4);return this.pos+=4,a},readDouble:function(){var a=dp(this.buf,this.pos,!0,52,8);return this.pos+=8,a},readVarint:function(a){var t,s,l=this.buf;return t=127&(s=l[this.pos++]),s<128?t:(t|=(127&(s=l[this.pos++]))<<7,s<128?t:(t|=(127&(s=l[this.pos++]))<<14,s<128?t:(t|=(127&(s=l[this.pos++]))<<21,s<128?t:function(h,p,g){var v,E,k=g.buf;if(v=(112&(E=k[g.pos++]))>>4,E<128||(v|=(127&(E=k[g.pos++]))<<3,E<128)||(v|=(127&(E=k[g.pos++]))<<10,E<128)||(v|=(127&(E=k[g.pos++]))<<17,E<128)||(v|=(127&(E=k[g.pos++]))<<24,E<128)||(v|=(1&(E=k[g.pos++]))<<31,E<128))return function Bu(a,t,s){return s?4294967296*t+(a>>>0):4294967296*(t>>>0)+(a>>>0)}(h,v,p);throw new Error("Expected varint not more than 10 bytes")}(t|=(15&(s=l[this.pos]))<<28,a,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var a=this.readVarint();return a%2==1?(a+1)/-2:a/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var a=this.readVarint()+this.pos,t=this.pos;return this.pos=a,a-t>=12&&Od?Od.decode(this.buf.subarray(t,a)):function(s,l,h){for(var p="",g=l;g<h;){var v,E,k,M=s[g],D=null,R=M>239?4:M>223?3:M>191?2:1;if(g+R>h)break;1===R?M<128&&(D=M):2===R?128==(192&(v=s[g+1]))&&(D=(31&M)<<6|63&v)<=127&&(D=null):3===R?(E=s[g+2],128==(192&(v=s[g+1]))&&128==(192&E)&&((D=(15&M)<<12|(63&v)<<6|63&E)<=2047||D>=55296&&D<=57343)&&(D=null)):4===R&&(E=s[g+2],k=s[g+3],128==(192&(v=s[g+1]))&&128==(192&E)&&128==(192&k)&&((D=(15&M)<<18|(63&v)<<12|(63&E)<<6|63&k)<=65535||D>=1114112)&&(D=null)),null===D?(D=65533,R=1):D>65535&&(D-=65536,p+=String.fromCharCode(D>>>10&1023|55296),D=56320|1023&D),p+=String.fromCharCode(D),g+=R}return p}(this.buf,t,a)},readBytes:function(){var a=this.readVarint()+this.pos,t=this.buf.subarray(this.pos,a);return this.pos=a,t},readPackedVarint:function(a,t){if(this.type!==Qr.Bytes)return a.push(this.readVarint(t));var s=ba(this);for(a=a||[];this.pos<s;)a.push(this.readVarint(t));return a},readPackedSVarint:function(a){if(this.type!==Qr.Bytes)return a.push(this.readSVarint());var t=ba(this);for(a=a||[];this.pos<t;)a.push(this.readSVarint());return a},readPackedBoolean:function(a){if(this.type!==Qr.Bytes)return a.push(this.readBoolean());var t=ba(this);for(a=a||[];this.pos<t;)a.push(this.readBoolean());return a},readPackedFloat:function(a){if(this.type!==Qr.Bytes)return a.push(this.readFloat());var t=ba(this);for(a=a||[];this.pos<t;)a.push(this.readFloat());return a},readPackedDouble:function(a){if(this.type!==Qr.Bytes)return a.push(this.readDouble());var t=ba(this);for(a=a||[];this.pos<t;)a.push(this.readDouble());return a},readPackedFixed32:function(a){if(this.type!==Qr.Bytes)return a.push(this.readFixed32());var t=ba(this);for(a=a||[];this.pos<t;)a.push(this.readFixed32());return a},readPackedSFixed32:function(a){if(this.type!==Qr.Bytes)return a.push(this.readSFixed32());var t=ba(this);for(a=a||[];this.pos<t;)a.push(this.readSFixed32());return a},readPackedFixed64:function(a){if(this.type!==Qr.Bytes)return a.push(this.readFixed64());var t=ba(this);for(a=a||[];this.pos<t;)a.push(this.readFixed64());return a},readPackedSFixed64:function(a){if(this.type!==Qr.Bytes)return a.push(this.readSFixed64());var t=ba(this);for(a=a||[];this.pos<t;)a.push(this.readSFixed64());return a},skip:function(a){var t=7&a;if(t===Qr.Varint)for(;this.buf[this.pos++]>127;);else if(t===Qr.Bytes)this.pos=this.readVarint()+this.pos;else if(t===Qr.Fixed32)this.pos+=4;else{if(t!==Qr.Fixed64)throw new Error("Unimplemented type: "+t);this.pos+=8}},writeTag:function(a,t){this.writeVarint(a<<3|t)},realloc:function(a){for(var t=this.length||16;t<this.pos+a;)t*=2;if(t!==this.length){var s=new Uint8Array(t);s.set(this.buf),this.buf=s,this.length=t}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(a){this.realloc(4),Nu(this.buf,a,this.pos),this.pos+=4},writeSFixed32:function(a){this.realloc(4),Nu(this.buf,a,this.pos),this.pos+=4},writeFixed64:function(a){this.realloc(8),Nu(this.buf,-1&a,this.pos),Nu(this.buf,Math.floor(a*Rd),this.pos+4),this.pos+=8},writeSFixed64:function(a){this.realloc(8),Nu(this.buf,-1&a,this.pos),Nu(this.buf,Math.floor(a*Rd),this.pos+4),this.pos+=8},writeVarint:function(a){(a=+a||0)>268435455||a<0?function(t,s){var l,h,p,v;if(t>=0?(l=t%4294967296|0,h=t/4294967296|0):(h=~(-t/4294967296),4294967295^(l=~(-t%4294967296))?l=l+1|0:(l=0,h=h+1|0)),t>=0x10000000000000000||t<-0x10000000000000000)throw new Error("Given varint doesn't fit into 10 bytes");s.realloc(10),p=l,(v=s).buf[v.pos++]=127&p|128,p>>>=7,v.buf[v.pos++]=127&p|128,p>>>=7,v.buf[v.pos++]=127&p|128,p>>>=7,v.buf[v.pos++]=127&p|128,v.buf[v.pos]=127&(p>>>=7),function(p,g){var v=(7&p)<<4;g.buf[g.pos++]|=v|((p>>>=3)?128:0),p&&(g.buf[g.pos++]=127&p|((p>>>=7)?128:0),p&&(g.buf[g.pos++]=127&p|((p>>>=7)?128:0),p&&(g.buf[g.pos++]=127&p|((p>>>=7)?128:0),p&&(g.buf[g.pos++]=127&p|((p>>>=7)?128:0),p&&(g.buf[g.pos++]=127&p)))))}(h,s)}(a,this):(this.realloc(4),this.buf[this.pos++]=127&a|(a>127?128:0),a<=127||(this.buf[this.pos++]=127&(a>>>=7)|(a>127?128:0),a<=127||(this.buf[this.pos++]=127&(a>>>=7)|(a>127?128:0),a<=127||(this.buf[this.pos++]=a>>>7&127))))},writeSVarint:function(a){this.writeVarint(a<0?2*-a-1:2*a)},writeBoolean:function(a){this.writeVarint(Boolean(a))},writeString:function(a){a=String(a),this.realloc(4*a.length),this.pos++;var t=this.pos;this.pos=function(l,h,p){for(var g,v,E=0;E<h.length;E++){if((g=h.charCodeAt(E))>55295&&g<57344){if(!v){g>56319||E+1===h.length?(l[p++]=239,l[p++]=191,l[p++]=189):v=g;continue}if(g<56320){l[p++]=239,l[p++]=191,l[p++]=189,v=g;continue}g=v-55296<<10|g-56320|65536,v=null}else v&&(l[p++]=239,l[p++]=191,l[p++]=189,v=null);g<128?l[p++]=g:(g<2048?l[p++]=g>>6|192:(g<65536?l[p++]=g>>12|224:(l[p++]=g>>18|240,l[p++]=g>>12&63|128),l[p++]=g>>6&63|128),l[p++]=63&g|128)}return p}(this.buf,a,this.pos);var s=this.pos-t;s>=128&&Nl(t,s,this),this.pos=t-1,this.writeVarint(s),this.pos+=s},writeFloat:function(a){this.realloc(4),pp(this.buf,a,this.pos,!0,23,4),this.pos+=4},writeDouble:function(a){this.realloc(8),pp(this.buf,a,this.pos,!0,52,8),this.pos+=8},writeBytes:function(a){var t=a.length;this.writeVarint(t),this.realloc(t);for(var s=0;s<t;s++)this.buf[this.pos++]=a[s]},writeRawMessage:function(a,t){this.pos++;var s=this.pos;a(t,this);var l=this.pos-s;l>=128&&Nl(s,l,this),this.pos=s-1,this.writeVarint(l),this.pos+=l},writeMessage:function(a,t,s){this.writeTag(a,Qr.Bytes),this.writeRawMessage(t,s)},writePackedVarint:function(a,t){t.length&&this.writeMessage(a,Ag,t)},writePackedSVarint:function(a,t){t.length&&this.writeMessage(a,m_,t)},writePackedBoolean:function(a,t){t.length&&this.writeMessage(a,x_,t)},writePackedFloat:function(a,t){t.length&&this.writeMessage(a,__,t)},writePackedDouble:function(a,t){t.length&&this.writeMessage(a,g_,t)},writePackedFixed32:function(a,t){t.length&&this.writeMessage(a,y_,t)},writePackedSFixed32:function(a,t){t.length&&this.writeMessage(a,mp,t)},writePackedFixed64:function(a,t){t.length&&this.writeMessage(a,v_,t)},writePackedSFixed64:function(a,t){t.length&&this.writeMessage(a,w_,t)},writeBytesField:function(a,t){this.writeTag(a,Qr.Bytes),this.writeBytes(t)},writeFixed32Field:function(a,t){this.writeTag(a,Qr.Fixed32),this.writeFixed32(t)},writeSFixed32Field:function(a,t){this.writeTag(a,Qr.Fixed32),this.writeSFixed32(t)},writeFixed64Field:function(a,t){this.writeTag(a,Qr.Fixed64),this.writeFixed64(t)},writeSFixed64Field:function(a,t){this.writeTag(a,Qr.Fixed64),this.writeSFixed64(t)},writeVarintField:function(a,t){this.writeTag(a,Qr.Varint),this.writeVarint(t)},writeSVarintField:function(a,t){this.writeTag(a,Qr.Varint),this.writeSVarint(t)},writeStringField:function(a,t){this.writeTag(a,Qr.Bytes),this.writeString(t)},writeFloatField:function(a,t){this.writeTag(a,Qr.Fixed32),this.writeFloat(t)},writeDoubleField:function(a,t){this.writeTag(a,Qr.Fixed64),this.writeDouble(t)},writeBooleanField:function(a,t){this.writeVarintField(a,Boolean(t))}};class Bd{constructor(t,{pixelRatio:s,version:l,stretchX:h,stretchY:p,content:g}){this.paddedRect=t,this.pixelRatio=s,this.stretchX=h,this.stretchY=p,this.content=g,this.version=l}get tl(){return[this.paddedRect.x+1,this.paddedRect.y+1]}get br(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]}get displaySize(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]}}class xp{constructor(t,s){const l={},h={};this.haveRenderCallbacks=[];const p=[];this.addImages(t,l,p),this.addImages(s,h,p);const{w:g,h:v}=zd(p),E=new da({width:g||1,height:v||1});for(const k in t){const M=t[k],D=l[k].paddedRect;da.copy(M.data,E,{x:0,y:0},{x:D.x+1,y:D.y+1},M.data)}for(const k in s){const M=s[k],D=h[k].paddedRect,R=D.x+1,z=D.y+1,q=M.data.width,K=M.data.height;da.copy(M.data,E,{x:0,y:0},{x:R,y:z},M.data),da.copy(M.data,E,{x:0,y:K-1},{x:R,y:z-1},{width:q,height:1}),da.copy(M.data,E,{x:0,y:0},{x:R,y:z+K},{width:q,height:1}),da.copy(M.data,E,{x:q-1,y:0},{x:R-1,y:z},{width:1,height:K}),da.copy(M.data,E,{x:0,y:0},{x:R+q,y:z},{width:1,height:K})}this.image=E,this.iconPositions=l,this.patternPositions=h}addImages(t,s,l){for(const h in t){const p=t[h],g={x:0,y:0,w:p.data.width+2,h:p.data.height+2};l.push(g),s[h]=new Bd(g,p),p.hasRenderCallback&&this.haveRenderCallbacks.push(h)}}patchUpdatedImages(t,s){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(l=>t.hasImage(l)),t.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const l in t.updatedImages)this.patchUpdatedImage(this.iconPositions[l],t.getImage(l),s),this.patchUpdatedImage(this.patternPositions[l],t.getImage(l),s)}patchUpdatedImage(t,s,l){if(!t||!s||t.version===s.version)return;t.version=s.version;const[h,p]=t.tl;l.update(s.data,void 0,{x:h,y:p})}}Dt(Bd,"ImagePosition"),Dt(xp,"ImageAtlas");const Ta={horizontal:1,vertical:2,horizontalOnly:3};class ja{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(t,s){const l=new ja;return l.scale=t||1,l.fontStack=s,l}static forImage(t){const s=new ja;return s.imageName=t,s}}class Uu{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(t,s){const l=new Uu;for(let h=0;h<t.sections.length;h++){const p=t.sections[h];p.image?l.addImageSection(p):l.addTextSection(p,s)}return l}length(){return this.text.length}getSection(t){return this.sections[this.sectionIndex[t]]}getSections(){return this.sections}getSectionIndex(t){return this.sectionIndex[t]}getCharCode(t){return this.text.charCodeAt(t)}verticalizePunctuation(t){this.text=function(s,l){let h="";for(let p=0;p<s.length;p++){const g=s.charCodeAt(p+1)||null,v=s.charCodeAt(p-1)||null;h+=!l&&(g&&Cc(g)&&!Lh[s[p+1]]||v&&Cc(v)&&!Lh[s[p-1]])||!Lh[s[p]]?s[p]:Lh[s[p]]}return h}(this.text,t)}trim(){let t=0;for(let l=0;l<this.text.length&&jf[this.text.charCodeAt(l)];l++)t++;let s=this.text.length;for(let l=this.text.length-1;l>=0&&l>=t&&jf[this.text.charCodeAt(l)];l--)s--;this.text=this.text.substring(t,s),this.sectionIndex=this.sectionIndex.slice(t,s)}substring(t,s){const l=new Uu;return l.text=this.text.substring(t,s),l.sectionIndex=this.sectionIndex.slice(t,s),l.sections=this.sections,l}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((t,s)=>Math.max(t,this.sections[s].scale),0)}addTextSection(t,s){this.text+=t.text,this.sections.push(ja.forText(t.scale,t.fontStack||s));const l=this.sections.length-1;for(let h=0;h<t.text.length;++h)this.sectionIndex.push(l)}addImageSection(t){const s=t.image?t.image.name:"";if(0===s.length)return void Rr("Can't add FormattedSection with an empty image.");const l=this.getNextImageSectionCharCode();l?(this.text+=String.fromCharCode(l),this.sections.push(ja.forImage(s)),this.sectionIndex.push(this.sections.length-1)):Rr("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function Nd(a,t,s,l,h,p,g,v,E,k,M,D,R,z,q,K){const ee=Uu.fromFeature(a,h);let ne;D===Ta.vertical&&ee.verticalizePunctuation(R);const{processBidirectionalText:ve,processStyledBidirectionalText:Ae}=ai;if(ve&&1===ee.sections.length){ne=[];const Pe=ve(ee.toString(),Zd(ee,k,p,t,l,z,q));for(const Xe of Pe){const He=new Uu;He.text=Xe,He.sections=ee.sections;for(let st=0;st<Xe.length;st++)He.sectionIndex.push(0);ne.push(He)}}else if(Ae){ne=[];const Pe=Ae(ee.text,ee.sectionIndex,Zd(ee,k,p,t,l,z,q));for(const Xe of Pe){const He=new Uu;He.text=Xe[0],He.sectionIndex=Xe[1],He.sections=ee.sections,ne.push(He)}}else ne=function(Pe,Xe){const He=[],st=Pe.text;let ht=0;for(const $e of Xe)He.push(Pe.substring(ht,$e)),ht=$e;return ht<st.length&&He.push(Pe.substring(ht,st.length)),He}(ee,Zd(ee,k,p,t,l,z,q));const Me=[],De={positionedLines:Me,text:ee.toString(),top:M[1],bottom:M[1],left:M[0],right:M[0],writingMode:D,iconsInText:!1,verticalizable:!1,hasBaseline:!1};return function(Pe,Xe,He,st,ht,$e,rt,pt,vt,_t,wt,cr){let vr=0,ur=0,dr=0;const qt="right"===pt?1:"left"===pt?0:.5;let Ft=!1;for(const jr of ht){const Ir=jr.getSections();for(const ei of Ir){if(ei.imageName)continue;const Ai=Xe[ei.fontStack];if(Ai&&(Ft=void 0!==Ai.ascender&&void 0!==Ai.descender,!Ft))break}if(!Ft)break}let kr=0;for(const jr of ht){jr.trim();const Ir=jr.getMaxScale(),ei=24*(Ir-1),Ai={positionedGlyphs:[],lineOffset:0};Pe.positionedLines[kr]=Ai;const Mi=Ai.positionedGlyphs;let Vi=0;if(!jr.length()){ur+=$e,++kr;continue}let nn=0,Aa=0;for(let Gr=0;Gr<jr.length();Gr++){const an=jr.getSection(Gr),ka=jr.getSectionIndex(Gr),mn=jr.getCharCode(Gr);let sn=an.scale,fi=null,si=null,li=null,ra=24,ji=0;const ia=!(vt===Ta.horizontal||!wt&&!Fl(mn)||wt&&(jf[mn]||(Vr=mn,di(Vr)||ca(Vr)||wc(Vr)||Au(Vr)||Ac(Vr))));if(an.imageName){const Vn=st[an.imageName];if(!Vn)continue;li=an.imageName,Pe.iconsInText=Pe.iconsInText||!0,si=Vn.paddedRect;const on=Vn.displaySize;sn=24*sn/cr,fi={width:on[0],height:on[1],left:1,top:-3,advance:ia?on[1]:on[0],localGlyph:!1},ji=Ft?-fi.height*sn:24*Ir-17-on[1]*sn,ra=fi.advance;const is=(ia?on[0]:on[1])*sn-24*Ir;is>0&&is>Vi&&(Vi=is)}else{const Vn=He[an.fontStack];if(!Vn)continue;Vn[mn]&&(si=Vn[mn]);const on=Xe[an.fontStack];if(!on)continue;const is=on.glyphs[mn];if(!is)continue;if(fi=is.metrics,ra=8203!==mn?24:0,Ft){const no=void 0!==on.ascender?Math.abs(on.ascender):0,Wh=void 0!==on.descender?Math.abs(on.descender):0,Wl=(no+Wh)*sn;nn<Wl&&(nn=Wl,Aa=(no-Wh)/2*sn),ji=-no*sn}else ji=24*(Ir-sn)-17}ia?(Pe.verticalizable=!0,Mi.push({glyph:mn,imageName:li,x:vr,y:ur+ji,vertical:ia,scale:sn,localGlyph:fi.localGlyph,fontStack:an.fontStack,sectionIndex:ka,metrics:fi,rect:si}),vr+=ra*sn+_t):(Mi.push({glyph:mn,imageName:li,x:vr,y:ur+ji,vertical:ia,scale:sn,localGlyph:fi.localGlyph,fontStack:an.fontStack,sectionIndex:ka,metrics:fi,rect:si}),vr+=fi.advance*sn+_t)}0!==Mi.length&&(dr=Math.max(vr-_t,dr),Ft?Tp(Mi,qt,Vi,Aa,$e*Ir/2):Tp(Mi,qt,Vi,0,$e/2)),vr=0;const pa=$e*Ir+Vi;Ai.lineOffset=Math.max(Vi,ei),ur+=pa,++kr}var Vr;const Wi=ur,{horizontalAlign:oi,verticalAlign:Xi}=Vd(rt);(function(jr,Ir,ei,Ai,Mi,Vi){const nn=(Ir-ei)*Mi,Aa=-Vi*Ai;for(const pa of jr)for(const Gr of pa.positionedGlyphs)Gr.x+=nn,Gr.y+=Aa})(Pe.positionedLines,qt,oi,Xi,dr,Wi),Pe.top+=-Xi*Wi,Pe.bottom=Pe.top+Wi,Pe.left+=-oi*dr,Pe.right=Pe.left+dr,Pe.hasBaseline=Ft}(De,t,s,l,ne,g,v,E,D,k,R,K),!function(Pe){for(const Xe of Pe)if(0!==Xe.positionedGlyphs.length)return!1;return!0}(Me)&&De}const jf={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},E_={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function yp(a,t,s,l,h,p){if(t.imageName){const g=l[t.imageName];return g?g.displaySize[0]*t.scale*24/p+h:0}{const g=s[t.fontStack],v=g&&g.glyphs[a];return v?v.metrics.advance*t.scale+h:0}}function vp(a,t,s,l){const h=Math.pow(a-t,2);return l?a<t?h/2:2*h:h+Math.abs(s)*s}function wp(a,t,s){let l=0;return 10===a&&(l-=1e4),s&&(l+=150),40!==a&&65288!==a||(l+=50),41!==t&&65289!==t||(l+=50),l}function Ud(a,t,s,l,h,p){let g=null,v=vp(t,s,h,p);for(const E of l){const k=vp(t-E.x,s,h,p)+E.badness;k<=v&&(g=E,v=k)}return{index:a,x:t,priorBreak:g,badness:v}}function bp(a){return a?bp(a.priorBreak).concat(a.index):[]}function Zd(a,t,s,l,h,p,g){if("point"!==p)return[];if(!a)return[];const v=[],E=function(R,z,q,K,ee,ne){let ve=0;for(let Ae=0;Ae<R.length();Ae++){const Me=R.getSection(Ae);ve+=yp(R.getCharCode(Ae),Me,K,ee,z,ne)}return ve/Math.max(1,Math.ceil(ve/q))}(a,t,s,l,h,g),k=a.text.indexOf("\u200b")>=0;let M=0;for(let R=0;R<a.length();R++){const z=a.getSection(R),q=a.getCharCode(R);if(jf[q]||(M+=yp(q,z,l,h,t,g)),R<a.length()-1){const K=!((D=q)<11904||!(Il(D)||tn(D)||Vo(D)||Ec(D)||Su(D)||Tu(D)||At(D)||Eu(D)||Ml(D)||Pi(D)||_f(D)||ku(D)||Cl(D)||hh(D)||mf(D)||Tc(D)||bc(D)||fh(D)||Qn(D)||ps(D)));(E_[q]||K||z.imageName)&&v.push(Ud(R+1,M,E,v,wp(q,a.getCharCode(R+1),K&&k),!1))}}var D;return bp(Ud(a.length(),M,E,v,0,!0))}function Vd(a){let t=.5,s=.5;switch(a){case"right":case"top-right":case"bottom-right":t=1;break;case"left":case"top-left":case"bottom-left":t=0}switch(a){case"bottom":case"bottom-right":case"bottom-left":s=1;break;case"top":case"top-right":case"top-left":s=0}return{horizontalAlign:t,verticalAlign:s}}function Tp(a,t,s,l,h){if(!(t||s||l||h))return;const p=a.length-1,g=a[p],v=(g.x+g.metrics.advance*g.scale)*t;for(let E=0;E<=p;E++)a[E].x-=v,a[E].y+=s+l+h}function S_(a,t,s){const{horizontalAlign:l,verticalAlign:h}=Vd(s),p=t[0]-a.displaySize[0]*l,g=t[1]-a.displaySize[1]*h;return{image:a,top:g,bottom:g+a.displaySize[1],left:p,right:p+a.displaySize[0]}}function Ep(a,t,s,l,h,p){const g=a.image;let v;if(g.content){const ee=g.content,ne=g.pixelRatio||1;v=[ee[0]/ne,ee[1]/ne,g.displaySize[0]-ee[2]/ne,g.displaySize[1]-ee[3]/ne]}const E=t.left*p,k=t.right*p;let M,D,R,z;"width"===s||"both"===s?(z=h[0]+E-l[3],D=h[0]+k+l[1]):(z=h[0]+(E+k-g.displaySize[0])/2,D=z+g.displaySize[0]);const q=t.top*p,K=t.bottom*p;return"height"===s||"both"===s?(M=h[1]+q-l[0],R=h[1]+K+l[2]):(M=h[1]+(q+K-g.displaySize[1])/2,R=M+g.displaySize[1]),{image:g,top:M,right:D,bottom:R,left:z,collisionPadding:v}}class Ss extends ut{constructor(t,s,l,h,p){super(t,s),this.angle=h,this.z=l,void 0!==p&&(this.segment=p)}clone(){return new Ss(this.x,this.y,this.z,this.angle,this.segment)}}function jd(a,t,s,l,h){if(void 0===t.segment)return!0;let p=t,g=t.segment+1,v=0;for(;v>-s/2;){if(g--,g<0)return!1;v-=a[g].dist(p),p=a[g]}v+=a[g].dist(a[g+1]),g++;const E=[];let k=0;for(;v<s/2;){const M=a[g],D=a[g+1];if(!D)return!1;let R=a[g-1].angleTo(M)-M.angleTo(D);for(R=Math.abs((R+3*Math.PI)%(2*Math.PI)-Math.PI),E.push({distance:v,angleDelta:R}),k+=R;v-E[0].distance>l;)k-=E.shift().angleDelta;if(k>h)return!1;g++,v+=M.dist(D)}return!0}function Sp(a){let t=0;for(let s=0;s<a.length-1;s++)t+=a[s].dist(a[s+1]);return t}function Ap(a,t,s){return a?.6*t*s:0}function kp(a,t){return Math.max(a?a.right-a.left:0,t?t.right-t.left:0)}function A_(a,t,s,l,h,p){const g=Ap(s,h,p),v=kp(s,l)*p;let E=0;const k=Sp(a)/2;for(let M=0;M<a.length-1;M++){const D=a[M],R=a[M+1],z=D.dist(R);if(E+z>k){const q=(k-E)/z,K=Qt(D.x,R.x,q),ee=Qt(D.y,R.y,q),ne=new Ss(K,ee,0,R.angleTo(D),M);return!g||jd(a,ne,v,g,t)?ne:void 0}E+=z}}function k_(a,t,s,l,h,p,g,v,E){const k=Ap(l,p,g),M=kp(l,h),D=M*g,R=0===a[0].x||a[0].x===E||0===a[0].y||a[0].y===E;return t-D<t/4&&(t=D+t/4),qd(a,R?t/2*v%t:(M/2+2*p)*g*v%t,t,k,s,D,R,!1,E)}function qd(a,t,s,l,h,p,g,v,E){const k=p/2,M=Sp(a);let D=0,R=t-s,z=[];for(let q=0;q<a.length-1;q++){const K=a[q],ee=a[q+1],ne=K.dist(ee),ve=ee.angleTo(K);for(;R+s<D+ne;){R+=s;const Ae=(R-D)/ne,Me=Qt(K.x,ee.x,Ae),De=Qt(K.y,ee.y,Ae);if(Me>=0&&Me<E&&De>=0&&De<E&&R-k>=0&&R+k<=M){const Pe=new Ss(Me,De,0,ve,q);Pe._round(),l&&!jd(a,Pe,p,l,h)||z.push(Pe)}}D+=ne}return v||z.length||g||(z=qd(a,D/2,s,l,h,p,g,!0,E)),z}function Cp(a,t,s,l,h){const p=[];for(let g=0;g<a.length;g++){const v=a[g];let E;for(let k=0;k<v.length-1;k++){let M=v[k],D=v[k+1];M.x<t&&D.x<t||(M.x<t?M=new ut(t,M.y+(t-M.x)/(D.x-M.x)*(D.y-M.y))._round():D.x<t&&(D=new ut(t,M.y+(t-M.x)/(D.x-M.x)*(D.y-M.y))._round()),M.y<s&&D.y<s||(M.y<s?M=new ut(M.x+(s-M.y)/(D.y-M.y)*(D.x-M.x),s)._round():D.y<s&&(D=new ut(M.x+(s-M.y)/(D.y-M.y)*(D.x-M.x),s)._round()),M.x>=l&&D.x>=l||(M.x>=l?M=new ut(l,M.y+(l-M.x)/(D.x-M.x)*(D.y-M.y))._round():D.x>=l&&(D=new ut(l,M.y+(l-M.x)/(D.x-M.x)*(D.y-M.y))._round()),M.y>=h&&D.y>=h||(M.y>=h?M=new ut(M.x+(h-M.y)/(D.y-M.y)*(D.x-M.x),h)._round():D.y>=h&&(D=new ut(M.x+(h-M.y)/(D.y-M.y)*(D.x-M.x),h)._round()),E&&M.equals(E[E.length-1])||(E=[M],p.push(E)),E.push(D)))))}}return p}Dt(Ss,"Anchor");const Qo=1e20;function Ip(a,t,s,l,h,p,g,v,E){for(let k=t;k<t+l;k++)Mp(a,s*p+k,p,h,g,v,E);for(let k=s;k<s+h;k++)Mp(a,k*p+t,1,l,g,v,E)}function Mp(a,t,s,l,h,p,g){p[0]=0,g[0]=-Qo,g[1]=Qo,h[0]=a[t];for(let v=1,E=0,k=0;v<l;v++){h[v]=a[t+v*s];const M=v*v;do{const D=p[E];k=(h[v]-h[D]+M-D*D)/(v-D)/2}while(k<=g[E]&&--E>-1);E++,p[E]=v,g[E]=k,g[E+1]=Qo}for(let v=0,E=0;v<l;v++){for(;g[E+1]<v;)E++;const k=p[E],M=v-k;a[t+v*s]=h[k]+M*M}}const Zu={none:0,ideographs:1,all:2};class zc{constructor(t,s,l){this.requestManager=t,this.localGlyphMode=s,this.localFontFamily=l,this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(t){this.url=t}getGlyphs(t,s){const l=[];for(const h in t)for(const p of t[h])l.push({stack:h,id:p});rl(l,({stack:h,id:p},g)=>{let v=this.entries[h];v||(v=this.entries[h]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let E=v.glyphs[p];if(void 0!==E)return void g(null,{stack:h,id:p,glyph:E});if(E=this._tinySDF(v,h,p),E)return v.glyphs[p]=E,void g(null,{stack:h,id:p,glyph:E});const k=Math.floor(p/256);if(256*k>65535)return void g(new Error("glyphs > 65535 not supported"));if(v.ranges[k])return void g(null,{stack:h,id:p,glyph:E});let M=v.requests[k];M||(M=v.requests[k]=[],zc.loadGlyphRange(h,k,this.url,this.requestManager,(D,R)=>{if(R){v.ascender=R.ascender,v.descender=R.descender;for(const z in R.glyphs)this._doesCharSupportLocalGlyph(+z)||(v.glyphs[+z]=R.glyphs[+z]);v.ranges[k]=!0}for(const z of M)z(D,R);delete v.requests[k]})),M.push((D,R)=>{D?g(D):R&&g(null,{stack:h,id:p,glyph:R.glyphs[p]||null})})},(h,p)=>{if(h)s(h);else if(p){const g={};for(const{stack:v,id:E,glyph:k}of p)void 0===g[v]&&(g[v]={}),void 0===g[v].glyphs&&(g[v].glyphs={}),g[v].glyphs[E]=k&&{id:k.id,bitmap:k.bitmap.clone(),metrics:k.metrics},g[v].ascender=this.entries[v].ascender,g[v].descender=this.entries[v].descender;s(null,g)}})}_doesCharSupportLocalGlyph(t){return this.localGlyphMode!==Zu.none&&(this.localGlyphMode===Zu.all?!!this.localFontFamily:!!this.localFontFamily&&(Pi(t)||gf(t)||Cl(t)||bc(t)||Eu(t)))}_tinySDF(t,s,l){const h=this.localFontFamily;if(!h||!this._doesCharSupportLocalGlyph(l))return;let p=t.tinySDF;if(!p){let K="400";/bold/i.test(s)?K="900":/medium/i.test(s)?K="500":/light/i.test(s)&&(K="200"),p=t.tinySDF=new zc.TinySDF({fontFamily:h,fontWeight:K,fontSize:48,buffer:6,radius:16}),p.fontWeight=K}if(this.localGlyphs[p.fontWeight][l])return this.localGlyphs[p.fontWeight][l];const g=String.fromCharCode(l),{data:v,width:E,height:k,glyphWidth:M,glyphHeight:D,glyphLeft:R,glyphTop:z,glyphAdvance:q}=p.draw(g);return this.localGlyphs[p.fontWeight][l]={id:l,bitmap:new Jo({width:E,height:k},v),metrics:{width:M/2,height:D/2,left:R/2,top:z/2-27,advance:q/2,localGlyph:!0}}}}function Fp(a,t,s,l){const h=[],p=a.image,g=p.pixelRatio,v=p.paddedRect.w-2,E=p.paddedRect.h-2,k=a.right-a.left,M=a.bottom-a.top,D=p.stretchX||[[0,v]],R=p.stretchY||[[0,E]],z=($e,rt)=>$e+rt[1]-rt[0],q=D.reduce(z,0),K=R.reduce(z,0),ee=v-q,ne=E-K;let ve=0,Ae=q,Me=0,De=K,Pe=0,Xe=ee,He=0,st=ne;if(p.content&&l){const $e=p.content;ve=qf(D,0,$e[0]),Me=qf(R,0,$e[1]),Ae=qf(D,$e[0],$e[2]),De=qf(R,$e[1],$e[3]),Pe=$e[0]-ve,He=$e[1]-Me,Xe=$e[2]-$e[0]-Ae,st=$e[3]-$e[1]-De}const ht=($e,rt,pt,vt)=>{const _t=Ul($e.stretch-ve,Ae,k,a.left),wt=Zl($e.fixed-Pe,Xe,$e.stretch,q),cr=Ul(rt.stretch-Me,De,M,a.top),vr=Zl(rt.fixed-He,st,rt.stretch,K),ur=Ul(pt.stretch-ve,Ae,k,a.left),dr=Zl(pt.fixed-Pe,Xe,pt.stretch,q),qt=Ul(vt.stretch-Me,De,M,a.top),Ft=Zl(vt.fixed-He,st,vt.stretch,K),kr=new ut(_t,cr),Vr=new ut(ur,cr),Wi=new ut(ur,qt),oi=new ut(_t,qt),Xi=new ut(wt/g,vr/g),jr=new ut(dr/g,Ft/g),Ir=t*Math.PI/180;if(Ir){const Mi=Math.sin(Ir),Vi=Math.cos(Ir),nn=[Vi,-Mi,Mi,Vi];kr._matMult(nn),Vr._matMult(nn),oi._matMult(nn),Wi._matMult(nn)}const ei=$e.stretch+$e.fixed,Ai=rt.stretch+rt.fixed;return{tl:kr,tr:Vr,bl:oi,br:Wi,tex:{x:p.paddedRect.x+1+ei,y:p.paddedRect.y+1+Ai,w:pt.stretch+pt.fixed-ei,h:vt.stretch+vt.fixed-Ai},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Xi,pixelOffsetBR:jr,minFontScaleX:Xe/g/k,minFontScaleY:st/g/M,isSDF:s}};if(l&&(p.stretchX||p.stretchY)){const $e=Zn(D,ee,q),rt=Zn(R,ne,K);for(let pt=0;pt<$e.length-1;pt++){const vt=$e[pt],_t=$e[pt+1];for(let wt=0;wt<rt.length-1;wt++)h.push(ht(vt,rt[wt],_t,rt[wt+1]))}}else h.push(ht({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:v+1},{fixed:0,stretch:E+1}));return h}function qf(a,t,s){let l=0;for(const h of a)l+=Math.max(t,Math.min(s,h[1]))-Math.max(t,Math.min(s,h[0]));return l}function Zn(a,t,s){const l=[{fixed:-1,stretch:0}];for(const[h,p]of a){const g=l[l.length-1];l.push({fixed:h-g.stretch,stretch:g.stretch}),l.push({fixed:h-g.stretch,stretch:g.stretch+(p-h)})}return l.push({fixed:t+1,stretch:s}),l}function Ul(a,t,s,l){return a/t*s+l}function Zl(a,t,s,l){return a-t*s/l}function Gf(a,t,s,l){const h=t+a.positionedLines[l].lineOffset;return 0===l?s+h/2:s+(h+(t+a.positionedLines[l-1].lineOffset))/2}zc.loadGlyphRange=function(a,t,s,l,h){const p=256*t,g=p+255,v=l.transformRequest(l.normalizeGlyphsURL(s).replace("{fontstack}",a).replace("{range}",`${p}-${g}`),ae.Glyphs);pe(v,(E,k)=>{if(E)h(E);else if(k){const M={},D=new Rh(k).readFields(gp,{});for(const R of D.glyphs)M[R.id]=R;h(null,{glyphs:M,ascender:D.ascender,descender:D.descender})}})},zc.TinySDF=class{constructor({fontSize:a=24,buffer:t=3,radius:s=8,cutoff:l=.25,fontFamily:h="sans-serif",fontWeight:p="normal",fontStyle:g="normal"}){this.buffer=t,this.cutoff=l,this.radius=s;const v=this.size=a+4*t,E=this._createCanvas(v),k=this.ctx=E.getContext("2d",{willReadFrequently:!0});k.font=`${g} ${p} ${a}px ${h}`,k.textBaseline="alphabetic",k.textAlign="left",k.fillStyle="black",this.gridOuter=new Float64Array(v*v),this.gridInner=new Float64Array(v*v),this.f=new Float64Array(v),this.z=new Float64Array(v+1),this.v=new Uint16Array(v)}_createCanvas(a){const t=document.createElement("canvas");return t.width=t.height=a,t}draw(a){const{width:t,actualBoundingBoxAscent:s,actualBoundingBoxDescent:l,actualBoundingBoxLeft:h,actualBoundingBoxRight:p}=this.ctx.measureText(a),g=Math.floor(s),v=Math.min(this.size-this.buffer,Math.ceil(p-h)),E=Math.min(this.size-this.buffer,Math.ceil(s)+Math.ceil(l)),k=v+2*this.buffer,M=E+2*this.buffer,D=k*M,R=new Uint8ClampedArray(D),z={data:R,width:k,height:M,glyphWidth:v,glyphHeight:E,glyphTop:g,glyphLeft:0,glyphAdvance:t};if(0===v||0===E)return z;const{ctx:q,buffer:K,gridInner:ee,gridOuter:ne}=this;q.clearRect(K,K,v,E),q.fillText(a,K,K+g+1);const ve=q.getImageData(K,K,v,E);ne.fill(Qo,0,D),ee.fill(0,0,D);for(let Ae=0;Ae<E;Ae++)for(let Me=0;Me<v;Me++){const De=ve.data[4*(Ae*v+Me)+3]/255;if(0===De)continue;const Pe=(Ae+K)*k+Me+K;if(1===De)ne[Pe]=0,ee[Pe]=Qo;else{const Xe=.5-De;ne[Pe]=Xe>0?Xe*Xe:0,ee[Pe]=Xe<0?Xe*Xe:0}}Ip(ne,0,0,k,M,k,this.f,this.v,this.z),Ip(ee,K,K,v,E,k,this.f,this.v,this.z);for(let Ae=0;Ae<D;Ae++){const Me=Math.sqrt(ne[Ae])-Math.sqrt(ee[Ae]);R[Ae]=Math.round(255-255*(Me/this.radius+this.cutoff))}return z}};class Gd{constructor(t=[],s=$d){if(this.data=t,this.length=this.data.length,this.compare=s,this.length>0)for(let l=(this.length>>1)-1;l>=0;l--)this._down(l)}push(t){this.data.push(t),this.length++,this._up(this.length-1)}pop(){if(0===this.length)return;const t=this.data[0],s=this.data.pop();return this.length--,this.length>0&&(this.data[0]=s,this._down(0)),t}peek(){return this.data[0]}_up(t){const{data:s,compare:l}=this,h=s[t];for(;t>0;){const p=t-1>>1,g=s[p];if(l(h,g)>=0)break;s[t]=g,t=p}s[t]=h}_down(t){const{data:s,compare:l}=this,h=this.length>>1,p=s[t];for(;t<h;){let g=1+(t<<1),v=s[g];const E=g+1;if(E<this.length&&l(s[E],v)<0&&(g=E,v=s[E]),l(v,p)>=0)break;s[t]=v,t=g}s[t]=p}}function $d(a,t){return a<t?-1:a>t?1:0}function Vl(a,t=1,s=!1){let l=1/0,h=1/0,p=-1/0,g=-1/0;const v=a[0];for(let z=0;z<v.length;z++){const q=v[z];(!z||q.x<l)&&(l=q.x),(!z||q.y<h)&&(h=q.y),(!z||q.x>p)&&(p=q.x),(!z||q.y>g)&&(g=q.y)}const E=Math.min(p-l,g-h);let k=E/2;const M=new Gd([],C_);if(0===E)return new ut(l,h);for(let z=l;z<p;z+=E)for(let q=h;q<g;q+=E)M.push(new Bc(z+k,q+k,k,a));let D=function(z){let q=0,K=0,ee=0;const ne=z[0];for(let ve=0,Ae=ne.length,Me=Ae-1;ve<Ae;Me=ve++){const De=ne[ve],Pe=ne[Me],Xe=De.x*Pe.y-Pe.x*De.y;K+=(De.x+Pe.x)*Xe,ee+=(De.y+Pe.y)*Xe,q+=3*Xe}return new Bc(K/q,ee/q,0,z)}(a),R=M.length;for(;M.length;){const z=M.pop();(z.d>D.d||!D.d)&&(D=z,s&&console.log("found best %d after %d probes",Math.round(1e4*z.d)/1e4,R)),z.max-D.d<=t||(k=z.h/2,M.push(new Bc(z.p.x-k,z.p.y-k,k,a)),M.push(new Bc(z.p.x+k,z.p.y-k,k,a)),M.push(new Bc(z.p.x-k,z.p.y+k,k,a)),M.push(new Bc(z.p.x+k,z.p.y+k,k,a)),R+=4)}return s&&(console.log(`num probes: ${R}`),console.log(`best distance: ${D.d}`)),D.p}function C_(a,t){return t.max-a.max}function Bc(a,t,s,l){this.p=new ut(a,t),this.h=s,this.d=function(h,p){let g=!1,v=1/0;for(let E=0;E<p.length;E++){const k=p[E];for(let M=0,D=k.length,R=D-1;M<D;R=M++){const z=k[M],q=k[R];z.y>h.y!=q.y>h.y&&h.x<(q.x-z.x)*(h.y-z.y)/(q.y-z.y)+z.x&&(g=!g),v=Math.min(v,F0(h,z,q))}}return(g?1:-1)*Math.sqrt(v)}(this.p,l),this.max=this.d+this.h*Math.SQRT2}const Nc=Number.POSITIVE_INFINITY,$f=Math.sqrt(2);function Dp(a,t){return t[1]!==Nc?function(s,l,h){let p=0,g=0;switch(l=Math.abs(l),h=Math.abs(h),s){case"top-right":case"top-left":case"top":g=h-7;break;case"bottom-right":case"bottom-left":case"bottom":g=7-h}switch(s){case"top-right":case"bottom-right":case"right":p=-l;break;case"top-left":case"bottom-left":case"left":p=l}return[p,g]}(a,t[0],t[1]):function(s,l){let h=0,p=0;l<0&&(l=0);const g=l/$f;switch(s){case"top-right":case"top-left":p=g-7;break;case"bottom-right":case"bottom-left":p=7-g;break;case"bottom":p=7-l;break;case"top":p=l-7}switch(s){case"top-right":case"bottom-right":h=-g;break;case"top-left":case"bottom-left":h=g;break;case"left":h=l;break;case"right":h=-l}return[h,p]}(a,t[0])}function kg(a,t,s,l,h,p,g,v,E,k){a.createArrays(),a.tilePixelRatio=hr/(512*a.overscaling),a.compareText={},a.iconsNeedLinear=!1;const M=a.layers[0].layout,D=a.layers[0]._unevaluatedLayout._values,R={};if("composite"===a.textSizeData.kind){const{minZoom:K,maxZoom:ee}=a.textSizeData;R.compositeTextSizes=[D["text-size"].possiblyEvaluate(new qr(K),v),D["text-size"].possiblyEvaluate(new qr(ee),v)]}if("composite"===a.iconSizeData.kind){const{minZoom:K,maxZoom:ee}=a.iconSizeData;R.compositeIconSizes=[D["icon-size"].possiblyEvaluate(new qr(K),v),D["icon-size"].possiblyEvaluate(new qr(ee),v)]}R.layoutTextSize=D["text-size"].possiblyEvaluate(new qr(E+1),v),R.layoutIconSize=D["icon-size"].possiblyEvaluate(new qr(E+1),v),R.textMaxSize=D["text-size"].possiblyEvaluate(new qr(18),v);const z="map"===M.get("text-rotation-alignment")&&"point"!==M.get("symbol-placement"),q=M.get("text-size");for(const K of a.features){const ee=M.get("text-font").evaluate(K,{},v).join(","),ne=q.evaluate(K,{},v),ve=R.layoutTextSize.evaluate(K,{},v),Ae=(R.layoutIconSize.evaluate(K,{},v),{horizontal:{},vertical:void 0}),Me=K.text;let De,Pe=[0,0];if(Me){const st=Me.toString(),ht=24*M.get("text-letter-spacing").evaluate(K,{},v),$e=24*M.get("text-line-height").evaluate(K,{},v),rt=jo(st)?ht:0,pt=M.get("text-anchor").evaluate(K,{},v),vt=M.get("text-variable-anchor");if(!vt){const dr=M.get("text-radial-offset").evaluate(K,{},v);Pe=dr?Dp(pt,[24*dr,Nc]):M.get("text-offset").evaluate(K,{},v).map(qt=>24*qt)}let _t=z?"center":M.get("text-justify").evaluate(K,{},v);const wt=M.get("symbol-placement"),cr="point"===wt,vr="point"===wt?24*M.get("text-max-width").evaluate(K,{},v):0,ur=dr=>{a.allowVerticalPlacement&&kc(st)&&(Ae.vertical=Nd(Me,t,s,h,ee,vr,$e,pt,dr,rt,Pe,Ta.vertical,!0,wt,ve,ne))};if(!z&&vt){const dr="auto"===_t?vt.map(Ft=>Pp(Ft)):[_t];let qt=!1;for(let Ft=0;Ft<dr.length;Ft++){const kr=dr[Ft];if(!Ae.horizontal[kr])if(qt)Ae.horizontal[kr]=Ae.horizontal[0];else{const Vr=Nd(Me,t,s,h,ee,vr,$e,"center",kr,rt,Pe,Ta.horizontal,!1,wt,ve,ne);Vr&&(Ae.horizontal[kr]=Vr,qt=1===Vr.positionedLines.length)}}ur("left")}else{if("auto"===_t&&(_t=Pp(pt)),cr||M.get("text-writing-mode").indexOf("horizontal")>=0||!kc(st)){const dr=Nd(Me,t,s,h,ee,vr,$e,pt,_t,rt,Pe,Ta.horizontal,!1,wt,ve,ne);dr&&(Ae.horizontal[_t]=dr)}ur("point"===wt?"left":_t)}}let Xe=!1;if(K.icon&&K.icon.name){const st=l[K.icon.name];st&&(De=S_(h[K.icon.name],M.get("icon-offset").evaluate(K,{},v),M.get("icon-anchor").evaluate(K,{},v)),Xe=st.sdf,void 0===a.sdfIcons?a.sdfIcons=st.sdf:a.sdfIcons!==st.sdf&&Rr("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(st.pixelRatio!==a.pixelRatio||0!==M.get("icon-rotate").constantOr(1))&&(a.iconsNeedLinear=!0))}const He=Oh(Ae.horizontal)||Ae.vertical;a.iconsInText||(a.iconsInText=!!He&&He.iconsInText),(He||De)&&Cg(a,K,Ae,De,l,R,ve,0,Pe,Xe,g,v,k)}p&&a.generateCollisionDebugBuffers(E,a.collisionBoxArray)}function Pp(a){switch(a){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function Cg(a,t,s,l,h,p,g,v,E,k,M,D,R){let z=p.textMaxSize.evaluate(t,{},D);void 0===z&&(z=g);const q=a.layers[0].layout,K=q.get("icon-offset").evaluate(t,{},D),ee=Oh(s.horizontal)||s.vertical,ne=g/24,ve=a.tilePixelRatio*z/24,Ae=($e=a.overscaling,a.zoom>18&&$e>2&&($e>>=1),Math.max(hr/(512*$e),1)*q.get("symbol-spacing")),Me=q.get("text-padding")*a.tilePixelRatio,De=q.get("icon-padding")*a.tilePixelRatio,Pe=Pr(q.get("text-max-angle")),Xe="map"===q.get("text-rotation-alignment")&&"point"!==q.get("symbol-placement"),He="map"===q.get("icon-rotation-alignment")&&"point"!==q.get("symbol-placement"),st=q.get("symbol-placement"),ht=Ae/2;var $e;const rt=q.get("icon-text-fit");let pt;l&&"none"!==rt&&(a.allowVerticalPlacement&&s.vertical&&(pt=Ep(l,s.vertical,rt,q.get("icon-text-fit-padding"),K,ne)),ee&&(l=Ep(l,ee,rt,q.get("icon-text-fit-padding"),K,ne)));const vt=(_t,wt,cr)=>{if(wt.x<0||wt.x>=hr||wt.y<0||wt.y>=hr)return;const{x:vr,y:ur,z:dr}=R.projectTilePoint(wt.x,wt.y,cr),qt=new Ss(vr,ur,dr,0,void 0);!function(Ft,kr,Vr,Wi,oi,Xi,jr,Ir,ei,Ai,Mi,Vi,nn,Aa,pa,Gr,an,ka,mn,sn,fi,si,li,ra,ji){const ia=Ft.addToLineVertexArray(kr,Wi);let Vn,on,is,no,Wh,Wl,dm,Xh=0,pm=0,mm=0,_m=0,rd=-1,c0=-1;const Is={};let gm=Va(""),Hh=0,u0=0;if(void 0===ei._unevaluatedLayout.getValue("text-radial-offset")?[Hh,u0]=ei.layout.get("text-offset").evaluate(fi,{},ji).map(na=>24*na):(Hh=24*ei.layout.get("text-radial-offset").evaluate(fi,{},ji),u0=Nc),Ft.allowVerticalPlacement&&oi.vertical){const na=oi.vertical;if(pa)Wl=Rp(na),Ir&&(dm=Rp(Ir));else{const jn=ei.layout.get("text-rotate").evaluate(fi,{},ji)+90;is=Zc(Ai,Vr,kr,Mi,Vi,nn,na,Aa,jn,Gr),Ir&&(no=Zc(Ai,Vr,kr,Mi,Vi,nn,Ir,ka,jn))}}if(Xi){const na=ei.layout.get("icon-rotate").evaluate(fi,{},ji),jn="none"!==ei.layout.get("icon-text-fit"),Fs=Fp(Xi,na,li,jn),ao=Ir?Fp(Ir,na,li,jn):void 0;on=Zc(Ai,Vr,kr,Mi,Vi,nn,Xi,ka,na),Xh=4*Fs.length;const xm=Ft.iconSizeData;let $c=null;"source"===xm.kind?($c=[eo*ei.layout.get("icon-size").evaluate(fi,{},ji)],$c[0]>Uc&&Rr(`${Ft.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)):"composite"===xm.kind&&($c=[eo*si.compositeIconSizes[0].evaluate(fi,{},ji),eo*si.compositeIconSizes[1].evaluate(fi,{},ji)],($c[0]>Uc||$c[1]>Uc)&&Rr(`${Ft.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)),Ft.addSymbols(Ft.icon,Fs,$c,sn,mn,fi,!1,Vr,kr,ia.lineStartIndex,ia.lineLength,-1,ra,ji),rd=Ft.icon.placedSymbolArray.length-1,ao&&(pm=4*ao.length,Ft.addSymbols(Ft.icon,ao,$c,sn,mn,fi,Ta.vertical,Vr,kr,ia.lineStartIndex,ia.lineLength,-1,ra,ji),c0=Ft.icon.placedSymbolArray.length-1)}for(const na in oi.horizontal){const jn=oi.horizontal[na];Vn||(gm=Va(jn.text),pa?Wh=Rp(jn):Vn=Zc(Ai,Vr,kr,Mi,Vi,nn,jn,Aa,ei.layout.get("text-rotate").evaluate(fi,{},ji),Gr));const Fs=1===jn.positionedLines.length;if(mm+=Lp(Ft,Vr,kr,jn,jr,ei,pa,fi,Gr,ia,oi.vertical?Ta.horizontal:Ta.horizontalOnly,Fs?Object.keys(oi.horizontal):[na],Is,rd,si,ra,ji),Fs)break}oi.vertical&&(_m+=Lp(Ft,Vr,kr,oi.vertical,jr,ei,pa,fi,Gr,ia,Ta.vertical,["vertical"],Is,c0,si,ra,ji));let Ms=-1;const Xl=(na,jn)=>na?Math.max(na,jn):jn;Ms=Xl(Wh,Ms),Ms=Xl(Wl,Ms),Ms=Xl(dm,Ms);const Yh=Ms>-1?1:0;Ft.glyphOffsetArray.length>=to.MAX_GLYPHS&&Rr("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),void 0!==fi.sortKey&&Ft.addToSortKeyRanges(Ft.symbolInstances.length,fi.sortKey),Ft.symbolInstances.emplaceBack(Vr.x,Vr.y,Vr.z,kr.x,kr.y,Is.right>=0?Is.right:-1,Is.center>=0?Is.center:-1,Is.left>=0?Is.left:-1,Is.vertical>=0?Is.vertical:-1,rd,c0,gm,void 0!==Vn?Vn:Ft.collisionBoxArray.length,void 0!==Vn?Vn+1:Ft.collisionBoxArray.length,void 0!==is?is:Ft.collisionBoxArray.length,void 0!==is?is+1:Ft.collisionBoxArray.length,void 0!==on?on:Ft.collisionBoxArray.length,void 0!==on?on+1:Ft.collisionBoxArray.length,no||Ft.collisionBoxArray.length,no?no+1:Ft.collisionBoxArray.length,Mi,mm,_m,Xh,pm,Yh,0,Hh,u0,Ms)}(a,wt,qt,_t,s,l,h,pt,a.layers[0],a.collisionBoxArray,t.index,t.sourceLayerIndex,a.index,Me,Xe,E,0,De,He,K,t,p,k,M,D)};if("line"===st)for(const _t of Cp(t.geometry,0,0,hr,hr)){const wt=k_(_t,Ae,Pe,s.vertical||ee,l,24,ve,a.overscaling,hr);for(const cr of wt){const vr=ee;vr&&I_(a,vr.text,ht,cr)||vt(_t,cr,D)}}else if("line-center"===st){for(const _t of t.geometry)if(_t.length>1){const wt=A_(_t,Pe,s.vertical||ee,l,24,ve);wt&&vt(_t,wt,D)}}else if("Polygon"===t.type)for(const _t of Dd(t.geometry,0)){const wt=Vl(_t,16);vt(_t[0],new Ss(wt.x,wt.y,0,0,void 0),D)}else if("LineString"===t.type)for(const _t of t.geometry)vt(_t,new Ss(_t[0].x,_t[0].y,0,0,void 0),D);else if("Point"===t.type)for(const _t of t.geometry)for(const wt of _t)vt([wt],new Ss(wt.x,wt.y,0,0,void 0),D)}const Uc=32640;function Lp(a,t,s,l,h,p,g,v,E,k,M,D,R,z,q,K,ee){const ne=function(Me,De,Pe,Xe,He,st,ht,$e){const rt=[];if(0===De.positionedLines.length)return rt;const pt=Xe.layout.get("text-rotate").evaluate(st,{})*Math.PI/180,vt=function(ur){const dr=ur[0],qt=ur[1],Ft=dr*qt;return Ft>0?[dr,-qt]:Ft<0?[-dr,qt]:0===dr?[qt,dr]:[qt,-dr]}(Pe);let _t=Math.abs(De.top-De.bottom);for(const ur of De.positionedLines)_t-=ur.lineOffset;const wt=De.positionedLines.length,cr=_t/wt;let vr=De.top-Pe[1];for(let ur=0;ur<wt;++ur){const dr=De.positionedLines[ur];vr=Gf(De,cr,vr,ur);for(const qt of dr.positionedGlyphs){if(!qt.rect)continue;const Ft=qt.rect||{};let kr=4,Vr=!0,Wi=1,oi=0;if(qt.imageName){const si=ht[qt.imageName];if(!si)continue;if(si.sdf){Rr("SDF images are not supported in formatted text and will be ignored.");continue}Vr=!1,Wi=si.pixelRatio,kr=1/Wi}const Xi=(He||$e)&&qt.vertical,jr=qt.metrics.advance*qt.scale/2,Ir=qt.metrics,ei=qt.rect;if(null===ei)continue;$e&&De.verticalizable&&(oi=qt.imageName?jr-qt.metrics.width*qt.scale/2:0);const Ai=He?[qt.x+jr,qt.y]:[0,0];let Mi=[0,0],Vi=[0,0],nn=!1;He||(Xi?(Vi=[qt.x+jr+vt[0],qt.y+vt[1]-oi],nn=!0):Mi=[qt.x+jr+Pe[0],qt.y+Pe[1]-oi]);const Aa=ei.w*qt.scale/(Wi*(qt.localGlyph?2:1)),pa=ei.h*qt.scale/(Wi*(qt.localGlyph?2:1));let Gr,an,ka,mn;if(Xi){const si=qt.y-vr,li=new ut(-jr,jr-si),ra=-Math.PI/2,ji=new ut(...Vi);Gr=new ut(-jr+Mi[0],Mi[1]),Gr._rotateAround(ra,li)._add(ji),Gr.x+=-si+jr,Gr.y-=(Ir.left-kr)*qt.scale;const ia=qt.imageName?Ir.advance*qt.scale:24*qt.scale,Vn=String.fromCharCode(qt.glyph);d_(Vn)?Gr.x+=(1-kr)*qt.scale:p_(Vn)?Gr.x+=ia-Ir.height*qt.scale+(-kr-1)*qt.scale:Gr.x+=qt.imageName||Ir.width+2*kr===ei.w&&Ir.height+2*kr===ei.h?(ia-pa)/2:(ia-(Ir.height+2*kr)*qt.scale)/2,an=new ut(Gr.x,Gr.y-Aa),ka=new ut(Gr.x+pa,Gr.y),mn=new ut(Gr.x+pa,Gr.y-Aa)}else{const si=(Ir.left-kr)*qt.scale-jr+Mi[0],li=(-Ir.top-kr)*qt.scale+Mi[1],ra=si+Aa,ji=li+pa;Gr=new ut(si,li),an=new ut(ra,li),ka=new ut(si,ji),mn=new ut(ra,ji)}if(pt){let si;si=He?new ut(0,0):nn?new ut(vt[0],vt[1]):new ut(Pe[0],Pe[1]),Gr._rotateAround(pt,si),an._rotateAround(pt,si),ka._rotateAround(pt,si),mn._rotateAround(pt,si)}const sn=new ut(0,0),fi=new ut(0,0);rt.push({tl:Gr,tr:an,bl:ka,br:mn,tex:Ft,writingMode:De.writingMode,glyphOffset:Ai,sectionIndex:qt.sectionIndex,isSDF:Vr,pixelOffsetTL:sn,pixelOffsetBR:fi,minFontScaleX:0,minFontScaleY:0})}}return rt}(0,l,E,p,g,v,h,a.allowVerticalPlacement),ve=a.textSizeData;let Ae=null;"source"===ve.kind?(Ae=[eo*p.layout.get("text-size").evaluate(v,{},ee)],Ae[0]>Uc&&Rr(`${a.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)):"composite"===ve.kind&&(Ae=[eo*q.compositeTextSizes[0].evaluate(v,{},ee),eo*q.compositeTextSizes[1].evaluate(v,{},ee)],(Ae[0]>Uc||Ae[1]>Uc)&&Rr(`${a.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)),a.addSymbols(a.text,ne,Ae,E,g,v,M,t,s,k.lineStartIndex,k.lineLength,z,K,ee);for(const Me of D)R[Me]=a.text.placedSymbolArray.length-1;return 4*ne.length}function Oh(a){for(const t in a)return a[t];return null}function Zc(a,t,s,l,h,p,g,v,E,k){let M=g.top,D=g.bottom,R=g.left,z=g.right;const q=g.collisionPadding;if(q&&(R-=q[0],M-=q[1],z+=q[2],D+=q[3]),E){const K=new ut(R,M),ee=new ut(z,M),ne=new ut(R,D),ve=new ut(z,D),Ae=Pr(E);let Me=new ut(0,0);k&&(Me=new ut(k[0],k[1])),K._rotateAround(Ae,Me),ee._rotateAround(Ae,Me),ne._rotateAround(Ae,Me),ve._rotateAround(Ae,Me),R=Math.min(K.x,ee.x,ne.x,ve.x),z=Math.max(K.x,ee.x,ne.x,ve.x),M=Math.min(K.y,ee.y,ne.y,ve.y),D=Math.max(K.y,ee.y,ne.y,ve.y)}return a.emplaceBack(t.x,t.y,t.z,s.x,s.y,R,M,z,D,v,l,h,p),a.length-1}function Rp(a){a.collisionPadding&&(a.top-=a.collisionPadding[1],a.bottom+=a.collisionPadding[3]);const t=a.bottom-a.top;return t>0?Math.max(10,t):null}function I_(a,t,s,l){const h=a.compareText;if(t in h){const p=h[t];for(let g=p.length-1;g>=0;g--)if(l.dist(p[g])<s)return!0}else h[t]=[];return h[t].push(l),!1}const M_=Bl.VectorTileFeature.types,Op=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Wf(a,t,s,l,h,p,g,v,E,k,M,D,R,z,q,K){const ee=M?Math.min(Uc,Math.round(M[0])):0,ne=M?Math.min(Uc,Math.round(M[1])):0;a.emplaceBack(t,s,Math.round(32*g),Math.round(32*v),E,k,(ee<<1)+(D?1:0),ne,16*R,16*z,256*q,256*K,l,h,p,0)}function Wd(a,t,s){a.emplaceBack(t.x,t.y,s),a.emplaceBack(t.x,t.y,s),a.emplaceBack(t.x,t.y,s),a.emplaceBack(t.x,t.y,s)}function F_(a){for(const t of a.sections)if(ph(t.text))return!0;return!1}class Xd{constructor(t){this.layoutVertexArray=new qe,this.indexArray=new Mt,this.programConfigurations=t,this.segments=new wi,this.dynamicLayoutVertexArray=new Qe,this.opacityVertexArray=new ke,this.placedSymbolArray=new Qa}isEmpty(){return 0===this.layoutVertexArray.length&&0===this.indexArray.length&&0===this.dynamicLayoutVertexArray.length&&0===this.opacityVertexArray.length}upload(t,s,l,h){this.isEmpty()||(l&&(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,o_.members),this.indexBuffer=t.createIndexBuffer(this.indexArray,s),this.dynamicLayoutVertexBuffer=t.createVertexBuffer(this.dynamicLayoutVertexArray,hp.members,!0),this.opacityVertexBuffer=t.createVertexBuffer(this.opacityVertexArray,Op,!0),this.opacityVertexBuffer.itemSize=1),(l||h)&&this.programConfigurations.upload(t))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}Dt(Xd,"SymbolBuffers");class Hd{constructor(t,s,l){this.layoutVertexArray=new t,this.layoutAttributes=s,this.indexArray=new l,this.segments=new wi,this.collisionVertexArray=new et,this.collisionVertexArrayExt=new Qe}upload(t){this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=t.createVertexBuffer(this.collisionVertexArray,l_.members,!0),this.collisionVertexBufferExt=t.createVertexBuffer(this.collisionVertexArrayExt,c_.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}Dt(Hd,"CollisionBuffers");class to{constructor(t){this.collisionBoxArray=t.collisionBoxArray,this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(g=>g.id),this.index=t.index,this.pixelRatio=t.pixelRatio,this.sourceLayerIndex=t.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=ws([]),this.placementViewportMatrix=ws([]);const s=this.layers[0]._unevaluatedLayout._values;this.textSizeData=Ld(this.zoom,s["text-size"]),this.iconSizeData=Ld(this.zoom,s["icon-size"]);const l=this.layers[0].layout,h=l.get("symbol-sort-key"),p=l.get("symbol-z-order");this.canOverlap=l.get("text-allow-overlap")||l.get("icon-allow-overlap")||l.get("text-ignore-placement")||l.get("icon-ignore-placement"),this.sortFeaturesByKey="viewport-y"!==p&&void 0!==h.constantOr(1),this.sortFeaturesByY=("viewport-y"===p||"auto"===p&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=l.get("text-writing-mode").map(g=>Ta[g]),this.stateDependentLayerIds=this.layers.filter(g=>g.isStateDependent()).map(g=>g.id),this.sourceID=t.sourceID,this.projection=t.projection}createArrays(){this.text=new Xd(new Fc(this.layers,this.zoom,t=>/^text/.test(t))),this.icon=new Xd(new Fc(this.layers,this.zoom,t=>/^icon/.test(t))),this.glyphOffsetArray=new Zr,this.lineVertexArray=new Ci,this.symbolInstances=new mi}calculateGlyphDependencies(t,s,l,h,p){for(let g=0;g<t.length;g++)if(s[t.charCodeAt(g)]=!0,h&&p){const v=Lh[t.charAt(g)];v&&(s[v.charCodeAt(0)]=!0)}}populate(t,s,l,h){const p=this.layers[0],g=p.layout,v=g.get("text-font"),E=g.get("text-field"),k=g.get("icon-image"),M=("constant"!==E.value.kind||E.value.value instanceof Oi&&!E.value.value.isEmpty()||E.value.value.toString().length>0)&&("constant"!==v.value.kind||v.value.value.length>0),D="constant"!==k.value.kind||!!k.value.value||Object.keys(k.parameters).length>0,R=g.get("symbol-sort-key");if(this.features=[],!M&&!D)return;const z=s.iconDependencies,q=s.glyphDependencies,K=s.availableImages,ee=new qr(this.zoom);for(const{feature:ne,id:ve,index:Ae,sourceLayerIndex:Me}of t){const De=p._featureFilter.needGeometry,Pe=Rl(ne,De);if(!p._featureFilter.filter(ee,Pe,l))continue;let Xe,He;if(De||(Pe.geometry=vs(ne,l,h)),M){const ht=p.getValueAndResolveTokens("text-field",Pe,l,K),$e=Oi.factory(ht);F_($e)&&(this.hasRTLText=!0),(!this.hasRTLText||"unavailable"===xa()||this.hasRTLText&&ai.isParsed())&&(Xe=f_($e,p,Pe))}if(D){const ht=p.getValueAndResolveTokens("icon-image",Pe,l,K);He=ht instanceof Ji?ht:Ji.fromString(ht)}if(!Xe&&!He)continue;const st=this.sortFeaturesByKey?R.evaluate(Pe,{},l):void 0;if(this.features.push({id:ve,text:Xe,icon:He,index:Ae,sourceLayerIndex:Me,geometry:Pe.geometry,properties:ne.properties,type:M_[ne.type],sortKey:st}),He&&(z[He.name]=!0),Xe){const ht=v.evaluate(Pe,{},l).join(","),$e="map"===g.get("text-rotation-alignment")&&"point"!==g.get("symbol-placement");this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(Ta.vertical)>=0;for(const rt of Xe.sections)if(rt.image)z[rt.image.name]=!0;else{const pt=kc(Xe.toString()),vt=rt.fontStack||ht,_t=q[vt]=q[vt]||{};this.calculateGlyphDependencies(rt.text,_t,$e,this.allowVerticalPlacement,pt)}}}"line"===g.get("symbol-placement")&&(this.features=function(ne){const ve={},Ae={},Me=[];let De=0;function Pe(ht){Me.push(ne[ht]),De++}function Xe(ht,$e,rt){const pt=Ae[ht];return delete Ae[ht],Ae[$e]=pt,Me[pt].geometry[0].pop(),Me[pt].geometry[0]=Me[pt].geometry[0].concat(rt[0]),pt}function He(ht,$e,rt){const pt=ve[$e];return delete ve[$e],ve[ht]=pt,Me[pt].geometry[0].shift(),Me[pt].geometry[0]=rt[0].concat(Me[pt].geometry[0]),pt}function st(ht,$e,rt){const pt=rt?$e[0][$e[0].length-1]:$e[0][0];return`${ht}:${pt.x}:${pt.y}`}for(let ht=0;ht<ne.length;ht++){const $e=ne[ht],rt=$e.geometry,pt=$e.text?$e.text.toString():null;if(!pt){Pe(ht);continue}const vt=st(pt,rt),_t=st(pt,rt,!0);if(vt in Ae&&_t in ve&&Ae[vt]!==ve[_t]){const wt=He(vt,_t,rt),cr=Xe(vt,_t,Me[wt].geometry);delete ve[vt],delete Ae[_t],Ae[st(pt,Me[cr].geometry,!0)]=cr,Me[wt].geometry=null}else vt in Ae?Xe(vt,_t,rt):_t in ve?He(vt,_t,rt):(Pe(ht),ve[vt]=De-1,Ae[_t]=De-1)}return Me.filter(ht=>ht.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((ne,ve)=>ne.sortKey-ve.sortKey)}update(t,s,l,h){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(t,s,this.layers,l,h),this.icon.programConfigurations.updatePaintArrays(t,s,this.layers,l,h))}isEmpty(){return 0===this.symbolInstances.length&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(t){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(t),this.iconCollisionBox.upload(t)),this.text.upload(t,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(t,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(t,s){const l=this.lineVertexArray.length,h=t.segment;if(void 0!==h){let p=t.dist(s[h+1]),g=t.dist(s[h]);const v={};for(let E=h+1;E<s.length;E++)v[E]={x:s[E].x,y:s[E].y,tileUnitDistanceFromAnchor:p},E<s.length-1&&(p+=s[E+1].dist(s[E]));for(let E=h||0;E>=0;E--)v[E]={x:s[E].x,y:s[E].y,tileUnitDistanceFromAnchor:g},E>0&&(g+=s[E-1].dist(s[E]));for(let E=0;E<s.length;E++){const k=v[E];this.lineVertexArray.emplaceBack(k.x,k.y,k.tileUnitDistanceFromAnchor)}}return{lineStartIndex:l,lineLength:this.lineVertexArray.length-l}}addSymbols(t,s,l,h,p,g,v,E,k,M,D,R,z,q){const K=t.indexArray,ee=t.layoutVertexArray,ne=t.segments.prepareSegment(4*s.length,ee,K,this.canOverlap?g.sortKey:void 0),ve=this.glyphOffsetArray.length,Ae=ne.vertexLength,Me=this.allowVerticalPlacement&&v===Ta.vertical?Math.PI/2:0,De=g.text&&g.text.sections;for(let Pe=0;Pe<s.length;Pe++){const{tl:Xe,tr:He,bl:st,br:ht,tex:$e,pixelOffsetTL:rt,pixelOffsetBR:pt,minFontScaleX:vt,minFontScaleY:_t,glyphOffset:wt,isSDF:cr,sectionIndex:vr}=s[Pe],ur=ne.vertexLength,dr=wt[1];Wf(ee,E.x,E.y,E.z,k.x,k.y,Xe.x,dr+Xe.y,$e.x,$e.y,l,cr,rt.x,rt.y,vt,_t),Wf(ee,E.x,E.y,E.z,k.x,k.y,He.x,dr+He.y,$e.x+$e.w,$e.y,l,cr,pt.x,rt.y,vt,_t),Wf(ee,E.x,E.y,E.z,k.x,k.y,st.x,dr+st.y,$e.x,$e.y+$e.h,l,cr,rt.x,pt.y,vt,_t),Wf(ee,E.x,E.y,E.z,k.x,k.y,ht.x,dr+ht.y,$e.x+$e.w,$e.y+$e.h,l,cr,pt.x,pt.y,vt,_t),Wd(t.dynamicLayoutVertexArray,E,Me),K.emplaceBack(ur,ur+1,ur+2),K.emplaceBack(ur+1,ur+2,ur+3),ne.vertexLength+=4,ne.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(wt[0]),Pe!==s.length-1&&vr===s[Pe+1].sectionIndex||t.programConfigurations.populatePaintArrays(ee.length,g,g.index,{},z,q,De&&De[vr])}t.placedSymbolArray.emplaceBack(E.x,E.y,E.z,k.x,k.y,ve,this.glyphOffsetArray.length-ve,Ae,M,D,k.segment,l?l[0]:0,l?l[1]:0,h[0],h[1],v,0,!1,0,R,0)}_commitLayoutVertex(t,s,l,h,p,g,v){t.emplaceBack(s,l,h,p,g,Math.round(v.x),Math.round(v.y))}_addCollisionDebugVertices(t,s,l,h,p,g,v){const E=l.segments.prepareSegment(4,l.layoutVertexArray,l.indexArray),k=E.vertexLength,M=v.tileAnchorX,D=v.tileAnchorY;for(let z=0;z<4;z++)l.collisionVertexArray.emplaceBack(0,0,0,0);l.collisionVertexArrayExt.emplaceBack(s,-t.padding,-t.padding),l.collisionVertexArrayExt.emplaceBack(s,t.padding,-t.padding),l.collisionVertexArrayExt.emplaceBack(s,t.padding,t.padding),l.collisionVertexArrayExt.emplaceBack(s,-t.padding,t.padding),this._commitLayoutVertex(l.layoutVertexArray,h,p,g,M,D,new ut(t.x1,t.y1)),this._commitLayoutVertex(l.layoutVertexArray,h,p,g,M,D,new ut(t.x2,t.y1)),this._commitLayoutVertex(l.layoutVertexArray,h,p,g,M,D,new ut(t.x2,t.y2)),this._commitLayoutVertex(l.layoutVertexArray,h,p,g,M,D,new ut(t.x1,t.y2)),E.vertexLength+=4;const R=l.indexArray;R.emplaceBack(k,k+1),R.emplaceBack(k+1,k+2),R.emplaceBack(k+2,k+3),R.emplaceBack(k+3,k),E.primitiveLength+=4}_addTextDebugCollisionBoxes(t,s,l,h,p,g){for(let v=h;v<p;v++){const E=l.get(v),k=this.getSymbolInstanceTextSize(t,g,s,v);this._addCollisionDebugVertices(E,k,this.textCollisionBox,E.projectedAnchorX,E.projectedAnchorY,E.projectedAnchorZ,g)}}_addIconDebugCollisionBoxes(t,s,l,h,p,g){for(let v=h;v<p;v++){const E=l.get(v),k=this.getSymbolInstanceIconSize(t,s,v);this._addCollisionDebugVertices(E,k,this.iconCollisionBox,E.projectedAnchorX,E.projectedAnchorY,E.projectedAnchorZ,g)}}generateCollisionDebugBuffers(t,s){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Hd(dt,fp.members,rr),this.iconCollisionBox=new Hd(dt,fp.members,rr);const l=zu(this.iconSizeData,t),h=zu(this.textSizeData,t);for(let p=0;p<this.symbolInstances.length;p++){const g=this.symbolInstances.get(p);this._addTextDebugCollisionBoxes(h,t,s,g.textBoxStartIndex,g.textBoxEndIndex,g),this._addTextDebugCollisionBoxes(h,t,s,g.verticalTextBoxStartIndex,g.verticalTextBoxEndIndex,g),this._addIconDebugCollisionBoxes(l,t,s,g.iconBoxStartIndex,g.iconBoxEndIndex,g),this._addIconDebugCollisionBoxes(l,t,s,g.verticalIconBoxStartIndex,g.verticalIconBoxEndIndex,g)}}getSymbolInstanceTextSize(t,s,l,h){const p=this.text.placedSymbolArray.get(s.rightJustifiedTextSymbolIndex>=0?s.rightJustifiedTextSymbolIndex:s.centerJustifiedTextSymbolIndex>=0?s.centerJustifiedTextSymbolIndex:s.leftJustifiedTextSymbolIndex>=0?s.leftJustifiedTextSymbolIndex:s.verticalPlacedTextSymbolIndex>=0?s.verticalPlacedTextSymbolIndex:h),g=Uf(this.textSizeData,t,p)/24;return this.tilePixelRatio*g}getSymbolInstanceIconSize(t,s,l){const h=this.icon.placedSymbolArray.get(l),p=Uf(this.iconSizeData,t,h);return this.tilePixelRatio*p}_commitDebugCollisionVertexUpdate(t,s,l){t.emplaceBack(s,-l,-l),t.emplaceBack(s,l,-l),t.emplaceBack(s,l,l),t.emplaceBack(s,-l,l)}_updateTextDebugCollisionBoxes(t,s,l,h,p,g){for(let v=h;v<p;v++){const E=l.get(v),k=this.getSymbolInstanceTextSize(t,g,s,v);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,k,E.padding)}}_updateIconDebugCollisionBoxes(t,s,l,h,p){for(let g=h;g<p;g++){const v=l.get(g),E=this.getSymbolInstanceIconSize(t,s,g);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,E,v.padding)}}updateCollisionDebugBuffers(t,s){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const l=zu(this.iconSizeData,t),h=zu(this.textSizeData,t);for(let p=0;p<this.symbolInstances.length;p++){const g=this.symbolInstances.get(p);this._updateTextDebugCollisionBoxes(h,t,s,g.textBoxStartIndex,g.textBoxEndIndex,g),this._updateTextDebugCollisionBoxes(h,t,s,g.verticalTextBoxStartIndex,g.verticalTextBoxEndIndex,g),this._updateIconDebugCollisionBoxes(l,t,s,g.iconBoxStartIndex,g.iconBoxEndIndex),this._updateIconDebugCollisionBoxes(l,t,s,g.verticalIconBoxStartIndex,g.verticalIconBoxEndIndex)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(t,s,l,h,p,g,v,E,k){const M={};for(let D=s;D<l;D++){const R=t.get(D);M.textBox={x1:R.x1,y1:R.y1,x2:R.x2,y2:R.y2,padding:R.padding,projectedAnchorX:R.projectedAnchorX,projectedAnchorY:R.projectedAnchorY,projectedAnchorZ:R.projectedAnchorZ,tileAnchorX:R.tileAnchorX,tileAnchorY:R.tileAnchorY},M.textFeatureIndex=R.featureIndex;break}for(let D=h;D<p;D++){const R=t.get(D);M.verticalTextBox={x1:R.x1,y1:R.y1,x2:R.x2,y2:R.y2,padding:R.padding,projectedAnchorX:R.projectedAnchorX,projectedAnchorY:R.projectedAnchorY,projectedAnchorZ:R.projectedAnchorZ,tileAnchorX:R.tileAnchorX,tileAnchorY:R.tileAnchorY},M.verticalTextFeatureIndex=R.featureIndex;break}for(let D=g;D<v;D++){const R=t.get(D);M.iconBox={x1:R.x1,y1:R.y1,x2:R.x2,y2:R.y2,padding:R.padding,projectedAnchorX:R.projectedAnchorX,projectedAnchorY:R.projectedAnchorY,projectedAnchorZ:R.projectedAnchorZ,tileAnchorX:R.tileAnchorX,tileAnchorY:R.tileAnchorY},M.iconFeatureIndex=R.featureIndex;break}for(let D=E;D<k;D++){const R=t.get(D);M.verticalIconBox={x1:R.x1,y1:R.y1,x2:R.x2,y2:R.y2,padding:R.padding,projectedAnchorX:R.projectedAnchorX,projectedAnchorY:R.projectedAnchorY,projectedAnchorZ:R.projectedAnchorZ,tileAnchorX:R.tileAnchorX,tileAnchorY:R.tileAnchorY},M.verticalIconFeatureIndex=R.featureIndex;break}return M}deserializeCollisionBoxes(t){this.collisionArrays=[];for(let s=0;s<this.symbolInstances.length;s++){const l=this.symbolInstances.get(s);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(t,l.textBoxStartIndex,l.textBoxEndIndex,l.verticalTextBoxStartIndex,l.verticalTextBoxEndIndex,l.iconBoxStartIndex,l.iconBoxEndIndex,l.verticalIconBoxStartIndex,l.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(t,s){const l=t.placedSymbolArray.get(s),h=l.vertexStartIndex+4*l.numGlyphs;for(let p=l.vertexStartIndex;p<h;p+=4)t.indexArray.emplaceBack(p,p+1,p+2),t.indexArray.emplaceBack(p+1,p+2,p+3)}getSortedSymbolIndexes(t){if(this.sortedAngle===t&&void 0!==this.symbolInstanceIndexes)return this.symbolInstanceIndexes;const s=Math.sin(t),l=Math.cos(t),h=[],p=[],g=[];for(let v=0;v<this.symbolInstances.length;++v){g.push(v);const E=this.symbolInstances.get(v);h.push(0|Math.round(s*E.tileAnchorX+l*E.tileAnchorY)),p.push(E.featureIndex)}return g.sort((v,E)=>h[v]-h[E]||p[E]-p[v]),g}addToSortKeyRanges(t,s){const l=this.sortKeyRanges[this.sortKeyRanges.length-1];l&&l.sortKey===s?l.symbolInstanceEnd=t+1:this.sortKeyRanges.push({sortKey:s,symbolInstanceStart:t,symbolInstanceEnd:t+1})}sortFeatures(t){if(this.sortFeaturesByY&&this.sortedAngle!==t&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(t),this.sortedAngle=t,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const s of this.symbolInstanceIndexes){const l=this.symbolInstances.get(s);this.featureSortOrder.push(l.featureIndex),[l.rightJustifiedTextSymbolIndex,l.centerJustifiedTextSymbolIndex,l.leftJustifiedTextSymbolIndex].forEach((h,p,g)=>{h>=0&&g.indexOf(h)===p&&this.addIndicesForPlacedSymbol(this.text,h)}),l.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,l.verticalPlacedTextSymbolIndex),l.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,l.placedIconSymbolIndex),l.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,l.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}Dt(to,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),to.MAX_GLYPHS=65535,to.addDynamicAttributes=Wd;const D_=new V({"symbol-placement":new S(Ze.layout_symbol["symbol-placement"]),"symbol-spacing":new S(Ze.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new S(Ze.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new A(Ze.layout_symbol["symbol-sort-key"]),"symbol-z-order":new S(Ze.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new S(Ze.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new S(Ze.layout_symbol["icon-ignore-placement"]),"icon-optional":new S(Ze.layout_symbol["icon-optional"]),"icon-rotation-alignment":new S(Ze.layout_symbol["icon-rotation-alignment"]),"icon-size":new A(Ze.layout_symbol["icon-size"]),"icon-text-fit":new S(Ze.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new S(Ze.layout_symbol["icon-text-fit-padding"]),"icon-image":new A(Ze.layout_symbol["icon-image"]),"icon-rotate":new A(Ze.layout_symbol["icon-rotate"]),"icon-padding":new S(Ze.layout_symbol["icon-padding"]),"icon-keep-upright":new S(Ze.layout_symbol["icon-keep-upright"]),"icon-offset":new A(Ze.layout_symbol["icon-offset"]),"icon-anchor":new A(Ze.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new S(Ze.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new S(Ze.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new S(Ze.layout_symbol["text-rotation-alignment"]),"text-field":new A(Ze.layout_symbol["text-field"]),"text-font":new A(Ze.layout_symbol["text-font"]),"text-size":new A(Ze.layout_symbol["text-size"]),"text-max-width":new A(Ze.layout_symbol["text-max-width"]),"text-line-height":new A(Ze.layout_symbol["text-line-height"]),"text-letter-spacing":new A(Ze.layout_symbol["text-letter-spacing"]),"text-justify":new A(Ze.layout_symbol["text-justify"]),"text-radial-offset":new A(Ze.layout_symbol["text-radial-offset"]),"text-variable-anchor":new S(Ze.layout_symbol["text-variable-anchor"]),"text-anchor":new A(Ze.layout_symbol["text-anchor"]),"text-max-angle":new S(Ze.layout_symbol["text-max-angle"]),"text-writing-mode":new S(Ze.layout_symbol["text-writing-mode"]),"text-rotate":new A(Ze.layout_symbol["text-rotate"]),"text-padding":new S(Ze.layout_symbol["text-padding"]),"text-keep-upright":new S(Ze.layout_symbol["text-keep-upright"]),"text-transform":new A(Ze.layout_symbol["text-transform"]),"text-offset":new A(Ze.layout_symbol["text-offset"]),"text-allow-overlap":new S(Ze.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new S(Ze.layout_symbol["text-ignore-placement"]),"text-optional":new S(Ze.layout_symbol["text-optional"])});var Xf={paint:new V({"icon-opacity":new A(Ze.paint_symbol["icon-opacity"]),"icon-color":new A(Ze.paint_symbol["icon-color"]),"icon-halo-color":new A(Ze.paint_symbol["icon-halo-color"]),"icon-halo-width":new A(Ze.paint_symbol["icon-halo-width"]),"icon-halo-blur":new A(Ze.paint_symbol["icon-halo-blur"]),"icon-translate":new S(Ze.paint_symbol["icon-translate"]),"icon-translate-anchor":new S(Ze.paint_symbol["icon-translate-anchor"]),"text-opacity":new A(Ze.paint_symbol["text-opacity"]),"text-color":new A(Ze.paint_symbol["text-color"],{runtimeType:Wa,getOverride:a=>a.textColor,hasOverride:a=>!!a.textColor}),"text-halo-color":new A(Ze.paint_symbol["text-halo-color"]),"text-halo-width":new A(Ze.paint_symbol["text-halo-width"]),"text-halo-blur":new A(Ze.paint_symbol["text-halo-blur"]),"text-translate":new S(Ze.paint_symbol["text-translate"]),"text-translate-anchor":new S(Ze.paint_symbol["text-translate-anchor"])}),layout:D_};class zp{constructor(t){this.type=t.property.overrides?t.property.overrides.runtimeType:as,this.defaultValue=t}evaluate(t){if(t.formattedSection){const s=this.defaultValue.property.overrides;if(s&&s.hasOverride(t.formattedSection))return s.getOverride(t.formattedSection)}return t.feature&&t.featureState?this.defaultValue.evaluate(t.feature,t.featureState):this.defaultValue.property.specification.default}eachChild(t){this.defaultValue.isConstant()||t(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Dt(zp,"FormatSectionOverride",{omit:["defaultValue"]});class zh extends Bn{constructor(t){super(t,Xf)}recalculate(t,s){super.recalculate(t,s),"auto"===this.layout.get("icon-rotation-alignment")&&(this.layout._values["icon-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-rotation-alignment")&&(this.layout._values["text-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-pitch-alignment")&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),"auto"===this.layout.get("icon-pitch-alignment")&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const l=this.layout.get("text-writing-mode");if(l){const h=[];for(const p of l)h.indexOf(p)<0&&h.push(p);this.layout._values["text-writing-mode"]=h}else this.layout._values["text-writing-mode"]="point"===this.layout.get("symbol-placement")?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getValueAndResolveTokens(t,s,l,h){const p=this.layout.get(t).evaluate(s,{},l,h),g=this._unevaluatedLayout._values[t];return g.isDataDriven()||us(g.value)||!p?p:(v=s.properties,p.replace(/{([^{}]+)}/g,(k,M)=>M in v?String(v[M]):""));var v}createBucket(t){return new to(t)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const t of Xf.paint.overridableProperties){if(!zh.hasPaintOverride(this.layout,t))continue;const s=this.paint.get(t),l=new zp(s),h=new gu(l,s.property.specification);let p=null;p="constant"===s.value.kind||"source"===s.value.kind?new xu("source",h):new nh("composite",h,s.value.zoomStops,s.value._interpolationType),this.paint._values[t]=new w(s.property,p,s.parameters)}}_handleOverridablePaintPropertyUpdate(t,s,l){return!(!this.layout||s.isDataDriven()||l.isDataDriven())&&zh.hasPaintOverride(this.layout,t)}static hasPaintOverride(t,s){const l=t.get("text-field"),h=Xf.paint.properties[s];let p=!1;const g=v=>{for(const E of v)if(h.overrides&&h.overrides.hasOverride(E))return void(p=!0)};if("constant"===l.value.kind&&l.value.value instanceof Oi)g(l.value.value.sections);else if("source"===l.value.kind){const v=k=>{p||(k instanceof ri&&lr(k.value)===fl?g(k.value.sections):k instanceof Qi?g(k.sections):k.eachChild(v))},E=l.value;E._styleExpression&&v(E._styleExpression.expression)}return p}getProgramConfiguration(t){return new Xo(this,t)}}var Bh={paint:new V({"background-color":new S(Ze.paint_background["background-color"]),"background-pattern":new O(Ze.paint_background["background-pattern"]),"background-opacity":new S(Ze.paint_background["background-opacity"])})},P_={paint:new V({"raster-opacity":new S(Ze.paint_raster["raster-opacity"]),"raster-hue-rotate":new S(Ze.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new S(Ze.paint_raster["raster-brightness-min"]),"raster-brightness-max":new S(Ze.paint_raster["raster-brightness-max"]),"raster-saturation":new S(Ze.paint_raster["raster-saturation"]),"raster-contrast":new S(Ze.paint_raster["raster-contrast"]),"raster-resampling":new S(Ze.paint_raster["raster-resampling"]),"raster-fade-duration":new S(Ze.paint_raster["raster-fade-duration"])})};class L_ extends Bn{constructor(t){super(t,{}),this.implementation=t}is3D(){return"3d"===this.implementation.renderingMode}hasOffscreenPass(){return void 0!==this.implementation.prerender}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(t){this.implementation.onAdd&&this.implementation.onAdd(t,t.painter.context.gl)}onRemove(t){this.implementation.onRemove&&this.implementation.onRemove(t,t.painter.context.gl)}}var R_={paint:new V({"sky-type":new S(Ze.paint_sky["sky-type"]),"sky-atmosphere-sun":new S(Ze.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new S(Ze.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new S(Ze.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new S(Ze.paint_sky["sky-gradient-radius"]),"sky-gradient":new L(Ze.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new S(Ze.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new S(Ze.paint_sky["sky-atmosphere-color"]),"sky-opacity":new S(Ze.paint_sky["sky-opacity"])})};function Yd(a,t,s){const l=[0,0,1],h=N0([]);return function(p,g,v){v*=.5;var E=g[0],k=g[1],M=g[2],D=g[3],R=Math.sin(v),z=Math.cos(v);p[0]=E*z-M*R,p[1]=k*z+D*R,p[2]=M*z+E*R,p[3]=D*z-k*R}(h,h,s?-Pr(a)+Math.PI:Pr(a)),U0(h,h,-Pr(t)),z0(l,l,h),Du(l,l)}const O_={circle:class extends Bn{constructor(a){super(a,Im)}createBucket(a){return new Sf(a)}queryRadius(a){const t=a;return Pc("circle-radius",this,t)+Pc("circle-stroke-width",this,t)+wh(this.paint.get("circle-translate"))}queryIntersectsFeature(a,t,s,l,h,p,g,v){const E=Cf(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),p.angle,a.pixelToTileUnitsFactor),k=this.paint.get("circle-radius").evaluate(t,s)+this.paint.get("circle-stroke-width").evaluate(t,s);return Ad(a,l,p,g,v,"map"===this.paint.get("circle-pitch-alignment"),"map"===this.paint.get("circle-pitch-scale"),E,k)}getProgramIds(){return["circle"]}getProgramConfiguration(a){return new Xo(this,a)}},heatmap:class extends Bn{createBucket(a){return new Es(a)}constructor(a){super(a,Fm),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(a){"heatmap-color"===a&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=Pu({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(a){return Pc("heatmap-radius",this,a)}queryIntersectsFeature(a,t,s,l,h,p,g,v){const E=this.paint.get("heatmap-radius").evaluate(t,s);return Ad(a,l,p,g,v,!0,!0,new ut(0,0),E)}hasOffscreenPass(){return 0!==this.paint.get("heatmap-opacity")&&"none"!==this.visibility}getProgramIds(){return["heatmap","heatmapTexture"]}getProgramConfiguration(a){return new Xo(this,a)}},hillshade:class extends Bn{constructor(a){super(a,G0)}hasOffscreenPass(){return 0!==this.paint.get("hillshade-exaggeration")&&"none"!==this.visibility}getProgramIds(){return["hillshade","hillshadePrepare"]}},fill:class extends Bn{constructor(a){super(a,Gm)}getProgramIds(){const a=this.paint.get("fill-pattern"),t=a&&a.constantOr(1),s=[t?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&s.push(t&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),s}getProgramConfiguration(a){return new Xo(this,a)}recalculate(a,t){super.recalculate(a,t);const s=this.paint._values["fill-outline-color"];"constant"===s.value.kind&&void 0===s.value.value&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(a){return new zf(a)}queryRadius(){return wh(this.paint.get("fill-translate"))}queryIntersectsFeature(a,t,s,l,h,p){return!a.queryGeometry.isAboveHorizon&&M0(yd(a.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),p.angle,a.pixelToTileUnitsFactor),l)}isTileClipped(){return!0}},"fill-extrusion":class extends Bn{constructor(a){super(a,Jm)}createBucket(a){return new Ou(a)}queryRadius(){return wh(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}getProgramConfiguration(a){return new Xo(this,a)}queryIntersectsFeature(a,t,s,l,h,p,g,v,E){const k=Cf(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),p.angle,a.pixelToTileUnitsFactor),M=this.paint.get("fill-extrusion-height").evaluate(t,s),D=this.paint.get("fill-extrusion-base").evaluate(t,s),R=[0,0],z=v&&p.elevation,q=p.elevation?p.elevation.exaggeration():1,K=a.tile.getBucket(this);if(z&&K instanceof Ou){const ve=K.centroidVertexArray,Ae=E+1;if(Ae<ve.length){const Me=ve.get(Ae);R[0]=Me.a_centroid_pos0,R[1]=Me.a_centroid_pos1}}if(0===R[0]&&1===R[1])return!1;const ee=(ve=l,Ae=D,Me=M,De=k,Pe=g,(Xe=z?v:null)?function($e,rt,pt,vt,_t,wt,cr,vr,ur){const dr=[],qt=[],Ft=[0,0,0,1];for(const kr of $e){const Vr=[],Wi=[];for(const oi of kr){const Xi=oi.x+vt.x,jr=oi.y+vt.y,Ir=Qm(Xi,jr,rt,pt,wt,cr,vr,ur);Ft[0]=Xi,Ft[1]=jr,Ft[2]=Ir.base,Ft[3]=1,Oc(Ft,Ft,_t),Ft[3]=Math.max(Ft[3],1e-5);const ei=op([Ft[0]/Ft[3],Ft[1]/Ft[3],Ft[2]/Ft[3]]);Ft[0]=Xi,Ft[1]=jr,Ft[2]=Ir.top,Ft[3]=1,Oc(Ft,Ft,_t),Ft[3]=Math.max(Ft[3],1e-5);const Ai=op([Ft[0]/Ft[3],Ft[1]/Ft[3],Ft[2]/Ft[3]]);Vr.push(ei),Wi.push(Ai)}dr.push(Vr),qt.push(Wi)}return[dr,qt]}(ve,Ae,Me,De,Pe,Xe,R,q,p.center.lat):function($e,rt,pt,vt,_t){const wt=[],cr=[],vr=_t[8]*rt,ur=_t[9]*rt,dr=_t[10]*rt,qt=_t[11]*rt,Ft=_t[8]*pt,kr=_t[9]*pt,Vr=_t[10]*pt,Wi=_t[11]*pt;for(const oi of $e){const Xi=[],jr=[];for(const Ir of oi){const ei=Ir.x+vt.x,Ai=Ir.y+vt.y,Mi=_t[0]*ei+_t[4]*Ai+_t[12],Vi=_t[1]*ei+_t[5]*Ai+_t[13],nn=_t[2]*ei+_t[6]*Ai+_t[14],Aa=_t[3]*ei+_t[7]*Ai+_t[15],pa=Mi+vr,Gr=Vi+ur,an=nn+dr,ka=Math.max(Aa+qt,1e-5),mn=Mi+Ft,sn=Vi+kr,fi=nn+Vr,si=Math.max(Aa+Wi,1e-5),li=new ut(pa/ka,Gr/ka);li.z=an/ka,Xi.push(li);const ra=new ut(mn/si,sn/si);ra.z=fi/si,jr.push(ra)}wt.push(Xi),cr.push(jr)}return[wt,cr]}(ve,Ae,Me,De,Pe)),ne=a.queryGeometry;var ve,Ae,Me,De,Pe,Xe;return function(ve,Ae,Me){let De=1/0;M0(Me,Ae)&&(De=sp(Me,Ae[0]));for(let Pe=0;Pe<Ae.length;Pe++){const Xe=Ae[Pe],He=ve[Pe];for(let st=0;st<Xe.length-1;st++){const ht=Xe[st],$e=[ht,Xe[st+1],He[st+1],He[st],ht];C0(Me,$e)&&(De=Math.min(De,sp(Me,$e)))}}return De!==1/0&&De}(ee[0],ee[1],ne.isPointQuery()?ne.screenBounds:ne.screenGeometry)}},line:class extends Bn{constructor(a){super(a,lp),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(a){if("line-gradient"===a){const t=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=t._styleExpression&&t._styleExpression.expression instanceof fc,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(a,t){super.recalculate(a,t),this.paint._values["line-floorwidth"]=cp.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,a)}createBucket(a){return new Nf(a)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getProgramConfiguration(a){return new Xo(this,a)}queryRadius(a){const t=a,s=up(Pc("line-width",this,t),Pc("line-gap-width",this,t)),l=Pc("line-offset",this,t);return s/2+Math.abs(l)+wh(this.paint.get("line-translate"))}queryIntersectsFeature(a,t,s,l,h,p){if(a.queryGeometry.isAboveHorizon)return!1;const g=yd(a.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),p.angle,a.pixelToTileUnitsFactor),v=a.pixelToTileUnitsFactor/2*up(this.paint.get("line-width").evaluate(t,s),this.paint.get("line-gap-width").evaluate(t,s)),E=this.paint.get("line-offset").evaluate(t,s);return E&&(l=function(k,M){const D=[],R=new ut(0,0);for(let z=0;z<k.length;z++){const q=k[z],K=[];for(let ee=0;ee<q.length;ee++){const ne=q[ee-1],ve=q[ee],Ae=q[ee+1],Me=0===ee?R:ve.sub(ne)._unit()._perp(),De=ee===q.length-1?R:Ae.sub(ve)._unit()._perp(),Pe=Me._add(De)._unit();Pe._mult(1/(Pe.x*De.x+Pe.y*De.y)),K.push(Pe._mult(M)._add(ve))}D.push(K)}return D}(l,E*a.pixelToTileUnitsFactor)),function(k,M,D){for(let R=0;R<M.length;R++){const z=M[R];if(k.length>=3)for(let q=0;q<z.length;q++)if(Mu(k,z[q]))return!0;if(Am(k,z,D))return!0}return!1}(g,l,v)}isTileClipped(){return!0}},symbol:zh,background:class extends Bn{constructor(a){super(a,Bh)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}},raster:class extends Bn{constructor(a){super(a,P_)}getProgramIds(){return["raster"]}},sky:class extends Bn{constructor(a){super(a,R_),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(a){"sky-gradient"===a?this._updateColorRamp():"sky-atmosphere-sun"!==a&&"sky-atmosphere-halo-color"!==a&&"sky-atmosphere-color"!==a&&"sky-atmosphere-sun-intensity"!==a||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=Pu({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(a){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const t=a.style.light.properties.get("position");return this._lightPosition.azimuthal!==t.azimuthal||this._lightPosition.polar!==t.polar}return!1}getCenter(a,t){if("atmosphere"===this.paint.get("sky-type")){const l=this.paint.get("sky-atmosphere-sun"),h=!l,p=a.style.light,g=p.properties.get("position");return h&&"viewport"===p.properties.get("anchor")&&Rr("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),h?Yd(g.azimuthal,90-g.polar,t):Yd(l[0],90-l[1],t)}const s=this.paint.get("sky-gradient-center");return Yd(s[0],90-s[1],t)}is3D(){return!1}isSky(){return!0}markSkyboxValid(a){this._skyboxInvalidated=!1,this._lightPosition=a.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const a=this.paint.get("sky-type");return"atmosphere"===a?["skyboxCapture","skybox"]:"gradient"===a?["skyboxGradient"]:null}}};class Nh{constructor(t,s,l,h){this.context=t,this.format=l,this.texture=t.gl.createTexture(),this.update(s,h)}update(t,s,l){const{width:h,height:p}=t,{context:g}=this,{gl:v}=g,{HTMLImageElement:E,HTMLCanvasElement:k,HTMLVideoElement:M,ImageData:D,ImageBitmap:R}=Zt;if(v.bindTexture(v.TEXTURE_2D,this.texture),g.pixelStoreUnpackFlipY.set(!1),g.pixelStoreUnpack.set(1),g.pixelStoreUnpackPremultiplyAlpha.set(this.format===v.RGBA&&(!s||!1!==s.premultiply)),l||this.size&&this.size[0]===h&&this.size[1]===p){const{x:z,y:q}=l||{x:0,y:0};t instanceof E||t instanceof k||t instanceof M||t instanceof D||R&&t instanceof R?v.texSubImage2D(v.TEXTURE_2D,0,z,q,v.RGBA,v.UNSIGNED_BYTE,t):v.texSubImage2D(v.TEXTURE_2D,0,z,q,h,p,v.RGBA,v.UNSIGNED_BYTE,t.data)}else this.size=[h,p],t instanceof E||t instanceof k||t instanceof M||t instanceof D||R&&t instanceof R?v.texImage2D(v.TEXTURE_2D,0,this.format,this.format,v.UNSIGNED_BYTE,t):v.texImage2D(v.TEXTURE_2D,0,this.format,h,p,0,this.format,v.UNSIGNED_BYTE,t.data);this.useMipmap=Boolean(s&&s.useMipmap&&this.isSizePowerOfTwo()),this.useMipmap&&v.generateMipmap(v.TEXTURE_2D)}bind(t,s){const{context:l}=this,{gl:h}=l;h.bindTexture(h.TEXTURE_2D,this.texture),t!==this.filter&&(h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MAG_FILTER,t),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MIN_FILTER,this.useMipmap?t===h.NEAREST?h.NEAREST_MIPMAP_NEAREST:h.LINEAR_MIPMAP_NEAREST:t),this.filter=t),s!==this.wrap&&(h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_S,s),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_T,s),this.wrap=s)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:t}=this.context;t.deleteTexture(this.texture),this.texture=null}}class Kd{constructor(t,s){this.width=t,this.height=s,this.nextRow=0,this.image=new Jo({width:t,height:s}),this.positions={},this.uploaded=!1}getDash(t,s){const l=this.getKey(t,s);return this.positions[l]}trim(){const t=this.width,s=this.height=Jc(this.nextRow);this.image.resize({width:t,height:s})}getKey(t,s){return t.join(",")+s}getDashRanges(t,s,l){const h=[];let p=t.length%2==1?-t[t.length-1]*l:0,g=t[0]*l,v=!0;h.push({left:p,right:g,isDash:v,zeroLength:0===t[0]});let E=t[0];for(let k=1;k<t.length;k++){v=!v;const M=t[k];p=E*l,E+=M,g=E*l,h.push({left:p,right:g,isDash:v,zeroLength:0===M})}return h}addRoundDash(t,s,l){const h=s/2;for(let p=-l;p<=l;p++){const g=this.width*(this.nextRow+l+p);let v=0,E=t[v];for(let k=0;k<this.width;k++){k/E.right>1&&(E=t[++v]);const M=Math.abs(k-E.left),D=Math.abs(k-E.right),R=Math.min(M,D);let z;const q=p/l*(h+1);if(E.isDash){const K=h-Math.abs(q);z=Math.sqrt(R*R+K*K)}else z=h-Math.sqrt(R*R+q*q);this.image.data[g+k]=Math.max(0,Math.min(255,z+128))}}}addRegularDash(t,s){for(let E=t.length-1;E>=0;--E){const k=t[E],M=t[E+1];k.zeroLength?t.splice(E,1):M&&M.isDash===k.isDash&&(M.left=k.left,t.splice(E,1))}const l=t[0],h=t[t.length-1];l.isDash===h.isDash&&(l.left=h.left-this.width,h.right=l.right+this.width);const p=this.width*this.nextRow;let g=0,v=t[g];for(let E=0;E<this.width;E++){E/v.right>1&&(v=t[++g]);const k=Math.abs(E-v.left),M=Math.abs(E-v.right),D=Math.min(k,M);this.image.data[p+E]=Math.max(0,Math.min(255,(v.isDash?D:-D)+s+128))}}addDash(t,s){const l=this.getKey(t,s);if(this.positions[l])return this.positions[l];const h="round"===s,p=h?7:0,g=2*p+1;if(this.nextRow+g>this.height)return Rr("LineAtlas out of space"),null;0===t.length&&t.push(1);let v=0;for(let M=0;M<t.length;M++)t[M]<0&&(Rr("Negative value is found in line dasharray, replacing values with 0"),t[M]=0),v+=t[M];if(0!==v){const M=this.width/v,D=this.getDashRanges(t,this.width,M);h?this.addRoundDash(D,M,p):this.addRegularDash(D,"square"===s?.5*M:0)}const E=this.nextRow+p;this.nextRow+=g;const k={tl:[E,p],br:[v,0]};return this.positions[l]=k,k}}Dt(Kd,"LineAtlas");class z_{constructor(t){this._callback=t,this._triggered=!1,"undefined"!=typeof MessageChannel&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}const B_=Zt.performance;function Bp(a){const t=a?a.url.toString():void 0;return B_.getEntriesByName(t)}class N_{constructor(){this.tasks={},this.taskQueue=[],nl(["process"],this),this.invoker=new z_(this.process),this.nextId=0}add(t,s){const l=this.nextId++,h=function({type:p,isSymbolTile:g,zoom:v}){return v=v||0,"message"===p?0:"maybePrepare"!==p||g?"parseTile"!==p||g?"parseTile"===p&&g?300-v:"maybePrepare"===p&&g?400-v:500:200-v:100-v}(s);if(0===h){Da();try{t()}finally{}return{cancel:()=>{}}}return this.tasks[l]={fn:t,metadata:s,priority:h,id:l},this.taskQueue.push(l),this.invoker.trigger(),{cancel:()=>{delete this.tasks[l]}}}process(){Da();try{if(this.taskQueue=this.taskQueue.filter(l=>!!this.tasks[l]),!this.taskQueue.length)return;const t=this.pick();if(null===t)return;const s=this.tasks[t];if(delete this.tasks[t],this.taskQueue.length&&this.invoker.trigger(),!s)return;s.fn()}finally{}}pick(){let t=null,s=1/0;for(let h=0;h<this.taskQueue.length;h++){const p=this.tasks[this.taskQueue[h]];p.priority<s&&(s=p.priority,t=h)}if(null===t)return null;const l=this.taskQueue[t];return this.taskQueue.splice(t,1),l}remove(){this.invoker.remove()}}const U_=se([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_merc_pos",components:2},{type:"Float32",name:"a_uv",components:2}]),Z_=se([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:Np}=U_,V_=se([{name:"a_pos_3",components:3,type:"Int16"}]);var Uh=se([{name:"a_pos",type:"Int16",components:2}]);const Vu=hr/Math.PI/2,Ea=-Vu,Sa=Vu,j_=[new ea([Ea,Ea,Ea],[Sa,Sa,Sa]),new ea([Ea,Ea,Ea],[0,0,Sa]),new ea([0,Ea,Ea],[Sa,0,Sa]),new ea([Ea,0,Ea],[0,Sa,Sa]),new ea([0,0,Ea],[Sa,Sa,Sa])];class q_{constructor(t,s,l){this.a=ts([],t,l),this.b=ts([],s,l),this.center=l;const h=Du([],this.a),p=Du([],this.b);this.angle=Math.acos(bh(h,p))}}function Jd(a,t){if(0===a.angle)return null;let s;return s=0===a.a[t]?1/a.angle*.5*Math.PI:1/a.angle*Math.atan(a.b[t]/a.a[t]/Math.sin(a.angle)-1/Math.tan(a.angle)),s<0||s>1?null:function(l,h,p,g){const v=Math.sin(p);return l*(Math.sin((1-g)*p)/v)+h*(Math.sin(g*p)/v)}(a.a[t],a.b[t],a.angle,wr(s,0,1))+a.center[t]}function Zh(a){if(a.z<=1)return j_[a.z+2*a.y+a.x];const[t,s]=Qd(a),l=[As(t[0],t[1]),As(t[0],s[1]),As(s[0],t[1]),As(s[0],s[1])],h=[Sa,Sa,Sa],p=[Ea,Ea,Ea];for(const g of l)h[0]=Math.min(h[0],g[0]),h[1]=Math.min(h[1],g[1]),h[2]=Math.min(h[2],g[2]),p[0]=Math.max(p[0],g[0]),p[1]=Math.max(p[1],g[1]),p[2]=Math.max(p[2],g[2]);return new ea(h,p)}function Qd(a){const t=1<<a.z,s=a.x/t,l=(a.x+1)/t,h=(a.y+1)/t;return[[En(a.y/t),es(s)],[En(h),es(l)]]}function e0(a,t,s,l=Vu){return s=Pr(s),[a*Math.sin(s)*l,-t*l,a*Math.cos(s)*l]}function As(a,t,s){return e0(Math.cos(Pr(a)),Math.sin(Pr(a)),t,s)}function Up(a,t,s){const l=Math.pow(2,s.z),h=(a/hr+s.x)/l;return As(En((t/hr+s.y)/l),es(h))}function t0(a){return 16383/Math.max(...ts([],a.max,a.min))}function Zp(a){const t=ws(new Float64Array(16)),s=t0(a);var l,h;return bs(t,t,[s,s,s]),Lc(t,t,((l=[])[0]=-(h=a.min)[0],l[1]=-h[1],l[2]=-h[2],l)),t}function Vp(a,t,s,l,h){const p=function(E){const k=hr/(2*Math.PI);return E/(2*Math.PI)/k}(s),g=[a,t,-s/(2*Math.PI)],v=ws(new Float64Array(16));return Lc(v,v,g),bs(v,v,[p,p,p]),Mf(v,v,Pr(-h)),Ff(v,v,Pr(-l)),v}function jp(a){const{x:t,y:s}=a.point,{lng:l,lat:h}=a._center;return Vp(t,s,a.worldSize,l,h)}const qp=Pr(85),$_=Math.cos(qp),W_=Math.sin(qp);function Gp(a,t,s){var l=2*Math.PI*6378137/256/Math.pow(2,s);return[a*l-2*Math.PI*6378137/2,t*l-2*Math.PI*6378137/2]}class Hf{constructor(t,s,l){this.z=t,this.x=s,this.y=l,this.key=Vh(0,t,t,s,l)}equals(t){return this.z===t.z&&this.x===t.x&&this.y===t.y}url(t,s){const l=(g=this.y,v=this.z,E=Gp(256*(p=this.x),256*(g=Math.pow(2,v)-g-1),v),k=Gp(256*(p+1),256*(g+1),v),E[0]+","+E[1]+","+k[0]+","+k[1]),h=function(p,g,v){let E,k="";for(let M=p;M>0;M--)E=1<<M-1,k+=(g&E?1:0)+(v&E?2:0);return k}(this.z,this.x,this.y);var p,g,v,E,k;return t[(this.x+this.y)%t.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace("{z}",String(this.z)).replace("{x}",String(this.x)).replace("{y}",String("tms"===s?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",h).replace("{bbox-epsg-3857}",l)}toString(){return`${this.z}/${this.x}/${this.y}`}}class $p{constructor(t,s){this.wrap=t,this.canonical=s,this.key=Vh(t,s.z,s.z,s.x,s.y)}}class ta{constructor(t,s,l,h,p){this.overscaledZ=t,this.wrap=s,this.canonical=new Hf(l,+h,+p),this.key=0===s&&t===l?this.canonical.key:Vh(s,t,l,h,p)}equals(t){return this.overscaledZ===t.overscaledZ&&this.wrap===t.wrap&&this.canonical.equals(t.canonical)}scaledTo(t){const s=this.canonical.z-t;return t>this.canonical.z?new ta(t,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new ta(t,this.wrap,t,this.canonical.x>>s,this.canonical.y>>s)}calculateScaledKey(t,s=!0){if(this.overscaledZ===t&&s)return this.key;if(t>this.canonical.z)return Vh(this.wrap*+s,t,this.canonical.z,this.canonical.x,this.canonical.y);{const l=this.canonical.z-t;return Vh(this.wrap*+s,t,t,this.canonical.x>>l,this.canonical.y>>l)}}isChildOf(t){if(t.wrap!==this.wrap)return!1;const s=this.canonical.z-t.canonical.z;return 0===t.overscaledZ||t.overscaledZ<this.overscaledZ&&t.canonical.x===this.canonical.x>>s&&t.canonical.y===this.canonical.y>>s}children(t){if(this.overscaledZ>=t)return[new ta(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const s=this.canonical.z+1,l=2*this.canonical.x,h=2*this.canonical.y;return[new ta(s,this.wrap,s,l,h),new ta(s,this.wrap,s,l+1,h),new ta(s,this.wrap,s,l,h+1),new ta(s,this.wrap,s,l+1,h+1)]}isLessThan(t){return this.wrap<t.wrap||!(this.wrap>t.wrap)&&(this.overscaledZ<t.overscaledZ||!(this.overscaledZ>t.overscaledZ)&&(this.canonical.x<t.canonical.x||!(this.canonical.x>t.canonical.x)&&this.canonical.y<t.canonical.y))}wrapped(){return new ta(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(t){return new ta(this.overscaledZ,t,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new $p(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function Vh(a,t,s,l,h){const p=1<<Math.min(s,22);let g=p*(h%p)+l%p;return a&&s<22&&(g+=p*p*((a<0?-2*a-1:2*a)%(1<<2*(22-s)))),16*(32*g+s)+(t-s)}function Vc(a,t){if(!t.isReprojectedInTileSpace)return{scale:1<<a.z,x:a.x,y:a.y,x2:a.x+1,y2:a.y+1,projection:t};const s=Math.pow(2,-a.z),l=a.x*s,h=(a.x+1)*s,p=a.y*s,g=(a.y+1)*s,v=es(l),E=es(h),k=En(p),M=En(g),D=t.project(v,k),R=t.project(E,k),z=t.project(E,M),q=t.project(v,M);let K=Math.min(D.x,R.x,z.x,q.x),ee=Math.min(D.y,R.y,z.y,q.y),ne=Math.max(D.x,R.x,z.x,q.x),ve=Math.max(D.y,R.y,z.y,q.y);const Ae=s/16;function Me(Pe,Xe,He,st,ht,$e){const rt=(He+ht)/2,pt=(st+$e)/2,vt=t.project(es(rt),En(pt)),_t=Math.max(0,K-vt.x,ee-vt.y,vt.x-ne,vt.y-ve);K=Math.min(K,vt.x),ne=Math.max(ne,vt.x),ee=Math.min(ee,vt.y),ve=Math.max(ve,vt.y),_t>Ae&&(Me(Pe,vt,He,st,rt,pt),Me(vt,Xe,rt,pt,ht,$e))}Me(D,R,l,p,h,p),Me(R,z,h,p,h,g),Me(z,q,h,g,l,g),Me(q,D,l,g,l,p),K-=Ae,ee-=Ae,ne+=Ae,ve+=Ae;const De=1/Math.max(ne-K,ve-ee);return{scale:De,x:K*De,y:ee*De,x2:ne*De,y2:ve*De,projection:t}}Dt(Hf,"CanonicalTileID"),Dt(ta,"OverscaledTileID",{omit:["projMatrix"]});class Wp{constructor(t){this._stringToNumber={},this._numberToString=[];for(let s=0;s<t.length;s++){const l=t[s];this._stringToNumber[l]=s,this._numberToString[s]=l}}encode(t){return this._stringToNumber[t]}decode(t){return this._numberToString[t]}}const X_=["tile","layer","source","sourceLayer","state"];class Xp{constructor(t,s,l,h,p){this.type="Feature",this._vectorTileFeature=t,this._z=s,this._x=l,this._y=h,this.properties=t.properties,this.id=p}get geometry(){return void 0===this._geometry&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(t){this._geometry=t}toJSON(){const t={type:"Feature",geometry:this.geometry,properties:this.properties};void 0!==this.id&&(t.id=this.id);for(const s of X_)void 0!==this[s]&&(t[s]=this[s]);return t}}const jl=new Uint16Array(8184);for(let a=0;a<2046;a++){let t=a+2,s=0,l=0,h=0,p=0,g=0,v=0;for(1&t?h=p=g=32:s=l=v=32;(t>>=1)>1;){const k=s+h>>1,M=l+p>>1;1&t?(h=s,p=l,s=g,l=v):(s=h,l=p,h=g,p=v),g=k,v=M}const E=4*a;jl[E+0]=s,jl[E+1]=l,jl[E+2]=h,jl[E+3]=p}const ro=new Uint16Array(2178),ql=new Uint8Array(1089),r0=new Uint16Array(1089);function Hp(a){return 0===a?-.03125:32===a?.03125:0}var Yp=se([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);const jc={type:2,extent:hr,loadGeometry:()=>[[new ut(0,0),new ut(8193,0),new ut(8193,8193),new ut(0,8193),new ut(0,0)]]};class Yf{constructor(t,s,l,h,p){this.tileID=t,this.uid=il(),this.uses=0,this.tileSize=s,this.tileZoom=l,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=p,this.expiredRequestCount=0,this.state="loading",h&&h.transform&&(this.projection=h.transform.projection)}registerFadeDuration(t){const s=t+this.timeAdded;s<$n.now()||this.fadeEndTime&&s<this.fadeEndTime||(this.fadeEndTime=s)}wasRequested(){return"errored"===this.state||"loaded"===this.state||"reloading"===this.state}get tileTransform(){return this._tileTransform||(this._tileTransform=Vc(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(t,s,l){if(this.unloadVectorData(),this.state="loaded",t){t.featureIndex&&(this.latestFeatureIndex=t.featureIndex,t.rawTileData?(this.latestRawTileData=t.rawTileData,this.latestFeatureIndex.rawTileData=t.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=t.collisionBoxArray,this.buckets=function(h,p){const g={};if(!p)return g;for(const v of h){const E=v.layerIds.map(k=>p.getLayer(k)).filter(Boolean);if(0!==E.length){v.layers=E,v.stateDependentLayerIds&&(v.stateDependentLayers=v.stateDependentLayerIds.map(k=>E.filter(M=>M.id===k)[0]));for(const k of E)g[k.id]=v}}return g}(t.buckets,s.style),this.hasSymbolBuckets=!1;for(const h in this.buckets){const p=this.buckets[h];if(p instanceof to){if(this.hasSymbolBuckets=!0,!l)break;p.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const h in this.buckets){const p=this.buckets[h];if(p instanceof to&&p.hasRTLText){this.hasRTLText=!0,ai.isLoading()||ai.isLoaded()||"deferred"!==xa()||Pl();break}}this.queryPadding=0;for(const h in this.buckets){const p=this.buckets[h];this.queryPadding=Math.max(this.queryPadding,s.style.getLayer(h).queryRadius(p))}t.imageAtlas&&(this.imageAtlas=t.imageAtlas),t.glyphAtlasImage&&(this.glyphAtlasImage=t.glyphAtlasImage),t.lineAtlas&&(this.lineAtlas=t.lineAtlas)}else this.collisionBoxArray=new Rn}unloadVectorData(){if(this.hasData()){for(const t in this.buckets)this.buckets[t].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugIndexBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}getBucket(t){return this.buckets[t.id]}upload(t){for(const l in this.buckets){const h=this.buckets[l];h.uploadPending()&&h.upload(t)}const s=t.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new Nh(t,this.imageAtlas.image,s.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new Nh(t,this.glyphAtlasImage,s.ALPHA),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new Nh(t,this.lineAtlas.image,s.ALPHA),this.lineAtlas.uploaded=!0)}prepare(t){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(t,this.imageAtlasTexture)}queryRenderedFeatures(t,s,l,h,p,g,v,E){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({tileResult:h,pixelPosMatrix:v,transform:g,params:p,tileTransform:this.tileTransform},t,s,l):{}}querySourceFeatures(t,s){const l=this.latestFeatureIndex;if(!l||!l.rawTileData)return;const h=l.loadVTLayers(),p=s?s.sourceLayer:"",g=h._geojsonTileLayer||h[p];if(!g)return;const v=la(s&&s.filter),{z:E,x:k,y:M}=this.tileID.canonical,D={z:E,x:k,y:M};for(let R=0;R<g.length;R++){const z=g.feature(R);if(v.needGeometry){const ee=Rl(z,!0);if(!v.filter(new qr(this.tileID.overscaledZ),ee,this.tileID.canonical))continue}else if(!v.filter(new qr(this.tileID.overscaledZ),z))continue;const q=l.getId(z,p),K=new Xp(z,E,k,M,q);K.tile=D,t.push(K)}}hasData(){return"loaded"===this.state||"reloading"===this.state||"expired"===this.state}patternsLoaded(){return!!this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(t){const s=this.expirationTime;if(t.cacheControl){const l=al(t.cacheControl);l["max-age"]&&(this.expirationTime=Date.now()+1e3*l["max-age"])}else t.expires&&(this.expirationTime=new Date(t.expires).getTime());if(this.expirationTime){const l=Date.now();let h=!1;if(this.expirationTime>l)h=!1;else if(s)if(this.expirationTime<s)h=!0;else{const p=this.expirationTime-s;p?this.expirationTime=l+Math.max(p,3e4):h=!0}else h=!0;h?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-(new Date).getTime(),Math.pow(2,31)-1)}setFeatureState(t,s){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||0===Object.keys(t).length||!s)return;const l=this.latestFeatureIndex.loadVTLayers(),h=s.style.listImages();for(const p in this.buckets){if(!s.style.hasLayer(p))continue;const g=this.buckets[p],v=g.layers[0].sourceLayer||"_geojsonTileLayer",E=l[v],k=t[v];if(!E||!k||0===Object.keys(k).length)continue;if(g.update(k,E,h,this.imageAtlas&&this.imageAtlas.patternPositions||{}),g instanceof Nf||g instanceof zf){const D=s.style._getSourceCache(g.layers[0].source);s._terrain&&s._terrain.enabled&&D&&g.programConfigurations.needsUpload&&s._terrain._clearRenderCacheForTile(D.id,this.tileID)}const M=s&&s.style&&s.style.getLayer(p);M&&(this.queryPadding=Math.max(this.queryPadding,M.queryRadius(g)))}}holdingForFade(){return void 0!==this.symbolFadeHoldUntil}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<$n.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(t){this.symbolFadeHoldUntil=$n.now()+t}setTexture(t,s){const l=s.context,h=l.gl;this.texture=s.getTileTexture(t.width),this.texture?this.texture.update(t,{useMipmap:!0}):(this.texture=new Nh(l,t,h.RGBA,{useMipmap:!0}),this.texture.bind(h.LINEAR,h.CLAMP_TO_EDGE),l.extTextureFilterAnisotropic&&h.texParameterf(h.TEXTURE_2D,l.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,l.extTextureFilterAnisotropicMax))}setDependencies(t,s){const l={};for(const h of s)l[h]=!0;this.dependencies[t]=l}hasDependency(t,s){for(const l of t){const h=this.dependencies[l];if(h)for(const p of s)if(h[p])return!0}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(t,s){if(!s||"mercator"===s.name||this._tileDebugBuffer)return;const l=vs(jc,this.tileID.canonical,this.tileTransform)[0],h=new he,p=new Dr;for(let g=0;g<l.length;g++){const{x:v,y:E}=l[g];h.emplaceBack(v,E),p.emplaceBack(g)}p.emplaceBack(0),this._tileDebugIndexBuffer=t.createIndexBuffer(p),this._tileDebugBuffer=t.createVertexBuffer(h,Uh.members),this._tileDebugSegments=wi.simpleSegment(0,0,h.length,p.length)}_makeTileBoundsBuffers(t,s){if(this._tileBoundsBuffer||!s||"mercator"===s.name)return;const l=vs(jc,this.tileID.canonical,this.tileTransform)[0];let h,p;if(this.isRaster){const g=function(v,E){const k=Vc(v,E),M=Math.pow(2,v.z);for(let ee=0;ee<33;ee++)for(let ne=0;ne<33;ne++){const ve=es((v.x+(ne+Hp(ne))/32)/M),Ae=En((v.y+(ee+Hp(ee))/32)/M),Me=E.project(ve,Ae),De=33*ee+ne;ro[2*De+0]=Math.round((Me.x*k.scale-k.x)*hr),ro[2*De+1]=Math.round((Me.y*k.scale-k.y)*hr)}ql.fill(0),r0.fill(0);for(let ee=2045;ee>=0;ee--){const ne=4*ee,ve=jl[ne+0],Ae=jl[ne+1],Me=jl[ne+2],De=jl[ne+3],Pe=ve+Me>>1,Xe=Ae+De>>1,He=Pe+Xe-Ae,st=Xe+ve-Pe,ht=33*Ae+ve,$e=33*De+Me,rt=33*Xe+Pe,pt=Math.hypot((ro[2*ht+0]+ro[2*$e+0])/2-ro[2*rt+0],(ro[2*ht+1]+ro[2*$e+1])/2-ro[2*rt+1])>=16;if(ql[rt]=ql[rt]||(pt?1:0),ee<1022){const vt=33*(Ae+st>>1)+(ve+He>>1),_t=33*(De+st>>1)+(Me+He>>1);ql[rt]=ql[rt]||ql[vt]||ql[_t]}}const D=new ce,R=new Mt;let z=0;function q(ee,ne){const ve=33*ne+ee;return 0===r0[ve]&&(D.emplaceBack(ro[2*ve+0],ro[2*ve+1],ee*hr/32,ne*hr/32),r0[ve]=++z),r0[ve]-1}function K(ee,ne,ve,Ae,Me,De){const Pe=ee+ve>>1,Xe=ne+Ae>>1;if(Math.abs(ee-Me)+Math.abs(ne-De)>1&&ql[33*Xe+Pe])K(Me,De,ee,ne,Pe,Xe),K(ve,Ae,Me,De,Pe,Xe);else{const He=q(ee,ne),st=q(ve,Ae),ht=q(Me,De);R.emplaceBack(He,st,ht)}}return K(0,0,32,32,32,0),K(32,32,0,0,0,32),{vertices:D,indices:R}}(this.tileID.canonical,s);h=g.vertices,p=g.indices}else{h=new ce,p=new Mt;for(const{x:v,y:E}of l)h.emplaceBack(v,E,0,0);const g=Sh(h.int16,void 0,4);for(let v=0;v<g.length;v+=3)p.emplaceBack(g[v],g[v+1],g[v+2])}this._tileBoundsBuffer=t.createVertexBuffer(h,Yp.members),this._tileBoundsIndexBuffer=t.createIndexBuffer(p),this._tileBoundsSegments=wi.simpleSegment(0,0,h.length,p.length)}_makeGlobeTileDebugBuffers(t,s){if(this._globeTileDebugBorderBuffer||this._globeTileDebugTextBuffer||!s||"globe"!==s.name)return;const l=this.tileID.canonical,h=Zp(Zh(l));this._makeGlobeTileDebugBorderBuffer(t,l,h),this._makeGlobeTileDebugTextBuffer(t,l,h)}_makeGlobeTileDebugBorderBuffer(t,s,l){const h=new he,p=new Dr,g=new de,v=(k,M,D,R,z)=>{const q=(D-k)/(z-1),K=(R-M)/(z-1),ee=h.length;for(let ne=0;ne<z;ne++){const ve=k+ne*q,Ae=M+ne*K;h.emplaceBack(ve,Ae);const Me=Up(ve,Ae,s),De=Ts(Me,Me,l);g.emplaceBack(De[0],De[1],De[2]),p.emplaceBack(ee+ne)}},E=hr;v(0,0,E,0,16),v(E,0,E,E,16),v(E,E,0,E,16),v(0,E,0,0,16),this._tileDebugIndexBuffer=t.createIndexBuffer(p),this._tileDebugBuffer=t.createVertexBuffer(h,Uh.members),this._globeTileDebugBorderBuffer=t.createVertexBuffer(g,V_.members),this._tileDebugSegments=wi.simpleSegment(0,0,h.length,p.length)}_makeGlobeTileDebugTextBuffer(t,s,l){const h=new he,p=new Mt,g=new de,v=25;p.reserve(32),h.reserve(v),g.reserve(v);const E=(k,M)=>v*k+M;for(let k=0;k<v;k++){const M=2048*k;for(let D=0;D<v;D++){const R=2048*D;h.emplaceBack(R,M);const z=Up(R,M,s),q=Ts(z,z,l);g.emplaceBack(q[0],q[1],q[2])}}for(let k=0;k<4;k++)for(let M=0;M<4;M++){const D=E(k,M),R=E(k,M+1),z=E(k+1,M),q=E(k+1,M+1);p.emplaceBack(D,R,z),p.emplaceBack(z,R,q)}this._tileDebugTextIndexBuffer=t.createIndexBuffer(p),this._tileDebugTextBuffer=t.createVertexBuffer(h,Uh.members),this._globeTileDebugTextBuffer=t.createVertexBuffer(g,V_.members),this._tileDebugTextSegments=wi.simpleSegment(0,0,v,32)}}class Kp{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(t,s,l){const h=String(s);if(this.stateChanges[t]=this.stateChanges[t]||{},this.stateChanges[t][h]=this.stateChanges[t][h]||{},Gi(this.stateChanges[t][h],l),null===this.deletedStates[t]){this.deletedStates[t]={};for(const p in this.state[t])p!==h&&(this.deletedStates[t][p]=null)}else if(this.deletedStates[t]&&null===this.deletedStates[t][h]){this.deletedStates[t][h]={};for(const p in this.state[t][h])l[p]||(this.deletedStates[t][h][p]=null)}else for(const p in l)this.deletedStates[t]&&this.deletedStates[t][h]&&null===this.deletedStates[t][h][p]&&delete this.deletedStates[t][h][p]}removeFeatureState(t,s,l){if(null===this.deletedStates[t])return;const h=String(s);if(this.deletedStates[t]=this.deletedStates[t]||{},l&&void 0!==s)null!==this.deletedStates[t][h]&&(this.deletedStates[t][h]=this.deletedStates[t][h]||{},this.deletedStates[t][h][l]=null);else if(void 0!==s)if(this.stateChanges[t]&&this.stateChanges[t][h])for(l in this.deletedStates[t][h]={},this.stateChanges[t][h])this.deletedStates[t][h][l]=null;else this.deletedStates[t][h]=null;else this.deletedStates[t]=null}getState(t,s){const l=String(s),h=Gi({},(this.state[t]||{})[l],(this.stateChanges[t]||{})[l]);if(null===this.deletedStates[t])return{};if(this.deletedStates[t]){const p=this.deletedStates[t][s];if(null===p)return{};for(const g in p)delete h[g]}return h}initializeTileState(t,s){t.setFeatureState(this.state,s)}coalesceChanges(t,s){const l={};for(const h in this.stateChanges){this.state[h]=this.state[h]||{};const p={};for(const g in this.stateChanges[h])this.state[h][g]||(this.state[h][g]={}),Gi(this.state[h][g],this.stateChanges[h][g]),p[g]=this.state[h][g];l[h]=p}for(const h in this.deletedStates){this.state[h]=this.state[h]||{};const p={};if(null===this.deletedStates[h])for(const g in this.state[h])p[g]={},this.state[h][g]={};else for(const g in this.deletedStates[h]){if(null===this.deletedStates[h][g])this.state[h][g]={};else for(const v of Object.keys(this.deletedStates[h][g]))delete this.state[h][g][v];p[g]=this.state[h][g]}l[h]=l[h]||{},Gi(l[h],p)}if(this.stateChanges={},this.deletedStates={},0!==Object.keys(l).length)for(const h in t)t[h].setFeatureState(l,s)}}class Jp{constructor(t){this.size=t,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(t,s){const l=this.toIdx(t,s);return{min:this.minimums[l],max:this.maximums[l]}}isLeaf(t,s){return this.leaves[this.toIdx(t,s)]}toIdx(t,s){return s*this.size+t}}function i0(a,t,s,l){let h=0,p=Number.MAX_VALUE;for(let g=0;g<3;g++)if(Math.abs(l[g])<1e-15){if(s[g]<a[g]||s[g]>t[g])return null}else{const v=1/l[g];let E=(a[g]-s[g])*v,k=(t[g]-s[g])*v;if(E>k){const M=E;E=k,k=M}if(E>h&&(h=E),k<p&&(p=k),h>p)return null}return h}function Qp(a,t,s,l,h,p,g,v,E,k,M){const D=l-a,R=h-t,z=p-s,q=g-a,K=v-t,ee=E-s,ne=M[1]*ee-M[2]*K,ve=M[2]*q-M[0]*ee,Ae=M[0]*K-M[1]*q,Me=D*ne+R*ve+z*Ae;if(Math.abs(Me)<1e-15)return null;const De=1/Me,Pe=k[0]-a,Xe=k[1]-t,He=k[2]-s,st=(Pe*ne+Xe*ve+He*Ae)*De;if(st<0||st>1)return null;const ht=Xe*z-He*R,$e=He*D-Pe*z,rt=Pe*R-Xe*D,pt=(M[0]*ht+M[1]*$e+M[2]*rt)*De;return pt<0||st+pt>1?null:(q*ht+K*$e+ee*rt)*De}function em(a,t,s){return(a-t)/(s-t)}function tm(a,t,s,l,h,p,g,v,E){const k=1<<s,M=p-l,D=g-h,R=(a+1)/k*M+l,z=(t+0)/k*D+h,q=(t+1)/k*D+h;v[0]=(a+0)/k*M+l,v[1]=z,E[0]=R,E[1]=q}class rm{constructor(t){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=t,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const s=function(p){const g=Math.ceil(Math.log2(p.dim/8)),v=[];let E=Math.ceil(Math.pow(2,g));const k=1/E,M=(z,q,K,ee,ne)=>{const ve=ee?1:0,Ae=(z+1)*K-ve,Me=q*K,De=(q+1)*K-ve;ne[0]=z*K,ne[1]=Me,ne[2]=Ae,ne[3]=De};let D=new Jp(E);const R=[];for(let z=0;z<E*E;z++){M(z%E,Math.floor(z/E),k,!1,R);const q=Gl(R[0],R[1],p),K=Gl(R[2],R[1],p),ee=Gl(R[2],R[3],p),ne=Gl(R[0],R[3],p);D.minimums.push(Math.min(q,K,ee,ne)),D.maximums.push(Math.max(q,K,ee,ne)),D.leaves.push(1)}for(v.push(D),E/=2;E>=1;E/=2){const z=v[v.length-1];D=new Jp(E);for(let q=0;q<E*E;q++){M(q%E,Math.floor(q/E),2,!0,R);const K=z.getElevation(R[0],R[1]),ee=z.getElevation(R[2],R[1]),ne=z.getElevation(R[2],R[3]),ve=z.getElevation(R[0],R[3]),Ae=z.isLeaf(R[0],R[1]),Me=z.isLeaf(R[2],R[1]),De=z.isLeaf(R[2],R[3]),Pe=z.isLeaf(R[0],R[3]),Xe=Math.min(K.min,ee.min,ne.min,ve.min),He=Math.max(K.max,ee.max,ne.max,ve.max),st=Ae&&Me&&De&&Pe;D.maximums.push(He),D.minimums.push(Xe),D.leaves.push(He-Xe<=5&&st?1:0)}v.push(D)}return v}(this.dem),l=s.length-1,h=s[l];this._addNode(h.minimums[0],h.maximums[0],h.leaves[0]),this._construct(s,0,0,l,0)}raycastRoot(t,s,l,h,p,g,v=1){return i0([t,s,-100],[l,h,this.maximums[0]*v],p,g)}raycast(t,s,l,h,p,g,v=1){if(!this.nodeCount)return null;const E=this.raycastRoot(t,s,l,h,p,g,v);if(null==E)return null;const k=[],M=[],D=[],R=[],z=[{idx:0,t:E,nodex:0,nodey:0,depth:0}];for(;z.length>0;){const{idx:q,t:K,nodex:ee,nodey:ne,depth:ve}=z.pop();if(this.leaves[q]){tm(ee,ne,ve,t,s,l,h,D,R);const Me=1<<ve,De=(ee+0)/Me,Pe=(ee+1)/Me,Xe=(ne+0)/Me,He=(ne+1)/Me,st=Gl(De,Xe,this.dem)*v,ht=Gl(Pe,Xe,this.dem)*v,$e=Gl(Pe,He,this.dem)*v,rt=Gl(De,He,this.dem)*v,pt=Qp(D[0],D[1],st,R[0],D[1],ht,R[0],R[1],$e,p,g),vt=Qp(R[0],R[1],$e,D[0],R[1],rt,D[0],D[1],st,p,g),_t=Math.min(null!==pt?pt:Number.MAX_VALUE,null!==vt?vt:Number.MAX_VALUE);if(_t!==Number.MAX_VALUE)return _t;{const wt=wa([],p,g,K);if(im(st,ht,rt,$e,em(wt[0],D[0],R[0]),em(wt[1],D[1],R[1]))>=wt[2])return K}continue}let Ae=0;for(let Me=0;Me<this._siblingOffset.length;Me++){tm((ee<<1)+this._siblingOffset[Me][0],(ne<<1)+this._siblingOffset[Me][1],ve+1,t,s,l,h,D,R),D[2]=-100,R[2]=this.maximums[this.childOffsets[q]+Me]*v;const De=i0(D,R,p,g);if(null!=De){const Pe=De;k[Me]=Pe;let Xe=!1;for(let He=0;He<Ae&&!Xe;He++)Pe>=k[M[He]]&&(M.splice(He,0,Me),Xe=!0);Xe||(M[Ae]=Me),Ae++}}for(let Me=0;Me<Ae;Me++){const De=M[Me];z.push({idx:this.childOffsets[q]+De,t:k[De],nodex:(ee<<1)+this._siblingOffset[De][0],nodey:(ne<<1)+this._siblingOffset[De][1],depth:ve+1})}}return null}_addNode(t,s,l){return this.minimums.push(t),this.maximums.push(s),this.leaves.push(l),this.childOffsets.push(0),this.nodeCount++}_construct(t,s,l,h,p){if(1===t[h].isLeaf(s,l))return;this.childOffsets[p]||(this.childOffsets[p]=this.nodeCount);const g=h-1,v=t[g];let E=0,k=0;for(let M=0;M<this._siblingOffset.length;M++){const D=2*s+this._siblingOffset[M][0],R=2*l+this._siblingOffset[M][1],z=v.getElevation(D,R),q=v.isLeaf(D,R),K=this._addNode(z.min,z.max,q);q&&(E|=1<<M),k||(k=K)}for(let M=0;M<this._siblingOffset.length;M++)E&1<<M||this._construct(t,2*s+this._siblingOffset[M][0],2*l+this._siblingOffset[M][1],g,k+M)}}function im(a,t,s,l,h,p){return Qt(Qt(a,s,p),Qt(t,l,p),h)}function Gl(a,t,s){const l=s.dim,h=wr(a*l-.5,0,l-1),p=wr(t*l-.5,0,l-1),g=Math.floor(h),v=Math.floor(p),E=Math.min(g+1,l-1),k=Math.min(v+1,l-1);return im(s.get(g,v),s.get(E,v),s.get(g,k),s.get(E,k),h-g,p-v)}const nm={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};class Kf{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(t,s,l,h=!1,p=!1){if(this.uid=t,s.height!==s.width)throw new RangeError("DEM tiles must be square");if(l&&"mapbox"!==l&&"terrarium"!==l)return Rr(`"${l}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=s.height;const g=this.dim=s.height-2,v=new Uint32Array(s.data.buffer);if(this.pixels=new Uint8Array(s.data.buffer),this.encoding=l||"mapbox",this.borderReady=h,!h){for(let E=0;E<g;E++)v[this._idx(-1,E)]=v[this._idx(0,E)],v[this._idx(g,E)]=v[this._idx(g-1,E)],v[this._idx(E,-1)]=v[this._idx(E,0)],v[this._idx(E,g)]=v[this._idx(E,g-1)];v[this._idx(-1,-1)]=v[this._idx(0,0)],v[this._idx(g,-1)]=v[this._idx(g-1,0)],v[this._idx(-1,g)]=v[this._idx(0,g-1)],v[this._idx(g,g)]=v[this._idx(g-1,g-1)],p&&this._buildQuadTree()}}_buildQuadTree(){this._tree=new rm(this)}get(t,s,l=!1){l&&(t=wr(t,-1,this.dim),s=wr(s,-1,this.dim));const h=4*this._idx(t,s);return("terrarium"===this.encoding?this._unpackTerrarium:this._unpackMapbox)(this.pixels[h],this.pixels[h+1],this.pixels[h+2])}static getUnpackVector(t){return nm[t]}get unpackVector(){return nm[this.encoding]}_idx(t,s){if(t<-1||t>=this.dim+1||s<-1||s>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(s+1)*this.stride+(t+1)}_unpackMapbox(t,s,l){return(256*t*256+256*s+l)/10-1e4}_unpackTerrarium(t,s,l){return 256*t+s+l/256-32768}static pack(t,s){const l=[0,0,0,0],h=Kf.getUnpackVector(s);let p=Math.floor((t+h[3])/h[2]);return l[2]=p%256,p=Math.floor(p/256),l[1]=p%256,p=Math.floor(p/256),l[0]=p,l}getPixels(){return new da({width:this.stride,height:this.stride},this.pixels)}backfillBorder(t,s,l){if(this.dim!==t.dim)throw new Error("dem dimension mismatch");let h=s*this.dim,p=s*this.dim+this.dim,g=l*this.dim,v=l*this.dim+this.dim;switch(s){case-1:h=p-1;break;case 1:p=h+1}switch(l){case-1:g=v-1;break;case 1:v=g+1}const E=-s*this.dim,k=-l*this.dim;for(let M=g;M<v;M++)for(let D=h;D<p;D++){const R=4*this._idx(D,M),z=4*this._idx(D+E,M+k);this.pixels[R+0]=t.pixels[z+0],this.pixels[R+1]=t.pixels[z+1],this.pixels[R+2]=t.pixels[z+2],this.pixels[R+3]=t.pixels[z+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}Dt(Kf,"DEMData"),Dt(rm,"DemMinMaxQuadTree",{omit:["dem"]});class H_{constructor(t,s){this.max=t,this.onRemove=s,this.reset()}reset(){for(const t in this.data)for(const s of this.data[t])s.timeout&&clearTimeout(s.timeout),this.onRemove(s.value);return this.data={},this.order=[],this}add(t,s,l){const h=t.wrapped().key;void 0===this.data[h]&&(this.data[h]=[]);const p={value:s,timeout:void 0};if(void 0!==l&&(p.timeout=setTimeout(()=>{this.remove(t,p)},l)),this.data[h].push(p),this.order.push(h),this.order.length>this.max){const g=this._getAndRemoveByKey(this.order[0]);g&&this.onRemove(g)}return this}has(t){return t.wrapped().key in this.data}getAndRemove(t){return this.has(t)?this._getAndRemoveByKey(t.wrapped().key):null}_getAndRemoveByKey(t){const s=this.data[t].shift();return s.timeout&&clearTimeout(s.timeout),0===this.data[t].length&&delete this.data[t],this.order.splice(this.order.indexOf(t),1),s.value}getByKey(t){const s=this.data[t];return s?s[0].value:null}get(t){return this.has(t)?this.data[t.wrapped().key][0].value:null}remove(t,s){if(!this.has(t))return this;const l=t.wrapped().key,h=void 0===s?0:this.data[l].indexOf(s),p=this.data[l][h];return this.data[l].splice(h,1),p.timeout&&clearTimeout(p.timeout),0===this.data[l].length&&delete this.data[l],this.onRemove(p.value),this.order.splice(this.order.indexOf(l),1),this}setMaxSize(t){for(this.max=t;this.order.length>this.max;){const s=this._getAndRemoveByKey(this.order[0]);s&&this.onRemove(s)}return this}filter(t){const s=[];for(const l in this.data)for(const h of this.data[l])t(h.value)||s.push(h);for(const l of s)this.remove(l.value.tileID,l)}}class ju{constructor(t,s,l){this.func=t,this.mask=s,this.range=l}}ju.ReadOnly=!1,ju.ReadWrite=!0,ju.disabled=new ju(519,ju.ReadOnly,[0,1]);class a0{constructor(t,s,l,h,p,g){this.test=t,this.ref=s,this.mask=l,this.fail=h,this.depthFail=p,this.pass=g}}a0.disabled=new a0({func:519,mask:0},0,0,7680,7680,7680);class io{constructor(t,s,l){this.blendFunction=t,this.blendColor=s,this.mask=l}}io.Replace=[1,0],io.disabled=new io(io.Replace,Fr.transparent,[!1,!1,!1,!1]),io.unblended=new io(io.Replace,Fr.transparent,[!0,!0,!0,!0]),io.alphaBlended=new io([1,771],Fr.transparent,[!0,!0,!0,!0]);class Cs{constructor(t,s,l){this.enable=t,this.mode=s,this.frontFace=l}}Cs.disabled=new Cs(!1,1029,2305),Cs.backCCW=new Cs(!0,1029,2305),Cs.backCW=new Cs(!0,1029,2304),Cs.frontCW=new Cs(!0,1028,2304),Cs.frontCCW=new Cs(!0,1028,2305);class qc extends nr{constructor(t,s,l){super(),this.id=t,this._onlySymbols=l,s.on("data",h=>{"source"===h.dataType&&"metadata"===h.sourceDataType&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&"source"===h.dataType&&"content"===h.sourceDataType&&(this.reload(),this.transform&&this.update(this.transform))}),s.on("error",()=>{this._sourceErrored=!0}),this._source=s,this._tiles={},this._cache=new H_(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=s.minTileCacheSize,this._maxTileCacheSize=s.maxTileCacheSize,this._loadedParentTiles={},this._coveredTiles={},this._state=new Kp,this._isRaster="raster"===this._source.type||"raster-dem"===this._source.type||"custom"===this._source.type&&"raster"===this._source._dataType}onAdd(t){this.map=t,this._minTileCacheSize=void 0===this._minTileCacheSize&&t?t._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=void 0===this._maxTileCacheSize&&t?t._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const t in this._tiles){const s=this._tiles[t];if("loaded"!==s.state&&"errored"!==s.state)return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const t=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,t&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(t,s){return t.isSymbolTile=this._onlySymbols,this._source.loadTile(t,s)}_unloadTile(t){if(this._source.unloadTile)return this._source.unloadTile(t,()=>{})}_abortTile(t){if(this._source.abortTile)return this._source.abortTile(t,()=>{})}serialize(){return this._source.serialize()}prepare(t){if(this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null),this._source.prepareTile)for(const s in this._tiles){const l=this._tiles[s];this._source.prepareTile(l)&&this.map.painter.terrain&&this.map.painter.terrain._clearRenderCacheForTile(this.id,l.tileID),l.upload(t),l.prepare(this.map.style.imageManager)}else for(const s in this._tiles){const l=this._tiles[s];l.upload(t),l.prepare(this.map.style.imageManager)}}getIds(){return ec(this._tiles).map(t=>t.tileID).sort(am).map(t=>t.key)}getRenderableIds(t){const s=[];for(const l in this._tiles)this._isIdRenderable(+l,t)&&s.push(this._tiles[l]);return t?s.sort((l,h)=>{const p=l.tileID,g=h.tileID,v=new ut(p.canonical.x,p.canonical.y)._rotate(this.transform.angle),E=new ut(g.canonical.x,g.canonical.y)._rotate(this.transform.angle);return p.overscaledZ-g.overscaledZ||E.y-v.y||E.x-v.x}).map(l=>l.tileID.key):s.map(l=>l.tileID).sort(am).map(l=>l.key)}hasRenderableParent(t){const s=this.findLoadedParent(t,0);return!!s&&this._isIdRenderable(s.tileID.key)}_isIdRenderable(t,s){return this._tiles[t]&&this._tiles[t].hasData()&&!this._coveredTiles[t]&&(s||!this._tiles[t].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const t in this._tiles)"errored"!==this._tiles[t].state&&this._reloadTile(+t,"reloading")}}_reloadTile(t,s){const l=this._tiles[t];l&&("loading"!==l.state&&(l.state=s),this._loadTile(l,this._tileLoaded.bind(this,l,t,s)))}_tileLoaded(t,s,l,h){if(h)if(t.state="errored",404!==h.status)this._source.fire(new Kt(h,{tile:t}));else if("raster-dem"===this._source.type&&this.usedForTerrain&&this.map.painter.terrain){const p=this.map.painter.terrain;this.update(this.transform,p.getScaledDemTileSize(),!0),p.resetTileLookupCache(this.id)}else this.update(this.transform);else t.timeAdded=$n.now(),"expired"===l&&(t.refreshedUponExpiration=!0),this._setTileReloadTimer(s,t),"raster-dem"===this._source.type&&t.dem&&this._backfillDEM(t),this._state.initializeTileState(t,this.map?this.map.painter:null),this._source.fire(new Yt("data",{dataType:"source",tile:t,coord:t.tileID,sourceCacheId:this.id}))}_backfillDEM(t){const s=this.getRenderableIds();for(let h=0;h<s.length;h++){const p=s[h];if(t.neighboringTiles&&t.neighboringTiles[p]){const g=this.getTileByID(p);l(t,g),l(g,t)}}function l(h,p){if(!h.dem||h.dem.borderReady)return;h.needsHillshadePrepare=!0,h.needsDEMTextureUpload=!0;let g=p.tileID.canonical.x-h.tileID.canonical.x;const v=p.tileID.canonical.y-h.tileID.canonical.y,E=Math.pow(2,h.tileID.canonical.z),k=p.tileID.key;0===g&&0===v||Math.abs(v)>1||(Math.abs(g)>1&&(1===Math.abs(g+E)?g+=E:1===Math.abs(g-E)&&(g-=E)),p.dem&&h.dem&&(h.dem.backfillBorder(p.dem,g,v),h.neighboringTiles&&h.neighboringTiles[k]&&(h.neighboringTiles[k].backfilled=!0)))}}getTile(t){return this.getTileByID(t.key)}getTileByID(t){return this._tiles[t]}_retainLoadedChildren(t,s,l,h){for(const p in this._tiles){let g=this._tiles[p];if(h[p]||!g.hasData()||g.tileID.overscaledZ<=s||g.tileID.overscaledZ>l)continue;let v=g.tileID;for(;g&&g.tileID.overscaledZ>s+1;){const k=g.tileID.scaledTo(g.tileID.overscaledZ-1);g=this._tiles[k.key],g&&g.hasData()&&(v=k)}let E=v;for(;E.overscaledZ>s;)if(E=E.scaledTo(E.overscaledZ-1),t[E.key]){h[v.key]=v;break}}}findLoadedParent(t,s){if(t.key in this._loadedParentTiles){const l=this._loadedParentTiles[t.key];return l&&l.tileID.overscaledZ>=s?l:null}for(let l=t.overscaledZ-1;l>=s;l--){const h=t.scaledTo(l),p=this._getLoadedTile(h);if(p)return p}}_getLoadedTile(t){const s=this._tiles[t.key];return s&&s.hasData()?s:this._cache.getByKey(this._source.reparseOverscaled?t.wrapped().key:t.canonical.key)}updateCacheSize(t,s){s=s||this._source.tileSize;const l=Math.ceil(t.width/s)+1,h=Math.ceil(t.height/s)+1,p=Math.floor(l*h*5),g="number"==typeof this._minTileCacheSize?Math.max(this._minTileCacheSize,p):p,v="number"==typeof this._maxTileCacheSize?Math.min(this._maxTileCacheSize,g):g;this._cache.setMaxSize(v)}handleWrapJump(t){const s=Math.round((t-(void 0===this._prevLng?t:this._prevLng))/360);if(this._prevLng=t,s){const l={};for(const h in this._tiles){const p=this._tiles[h];p.tileID=p.tileID.unwrapTo(p.tileID.wrap+s),l[p.tileID.key]=p}this._tiles=l;for(const h in this._timers)clearTimeout(this._timers[h]),delete this._timers[h];for(const h in this._tiles)this._setTileReloadTimer(+h,this._tiles[h])}}update(t,s,l){if(this.transform=t,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!l)return;let h;this.updateCacheSize(t,s),"globe"!==this.transform.projection.name&&this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?h=t.getVisibleUnwrappedCoordinates(this._source.tileID).map(v=>new ta(v.canonical.z,v.wrap,v.canonical.z,v.canonical.x,v.canonical.y)):(h=t.coveringTiles({tileSize:s||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!l,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain}),this._source.hasTile&&(h=h.filter(v=>this._source.hasTile(v)))):h=[];const p=this._updateRetainedTiles(h);if(Gc(this._source.type)&&0!==h.length){const v={},E={},k=Object.keys(p);for(const D of k){const R=p[D],z=this._tiles[D];if(!z||z.fadeEndTime&&z.fadeEndTime<=$n.now())continue;const q=this.findLoadedParent(R,Math.max(R.overscaledZ-qc.maxOverzooming,this._source.minzoom));q&&(this._addTile(q.tileID),v[q.tileID.key]=q.tileID),E[D]=R}const M=h[h.length-1].overscaledZ;for(const D in this._tiles){const R=this._tiles[D];if(p[D]||!R.hasData())continue;let z=R.tileID;for(;z.overscaledZ>M;){z=z.scaledTo(z.overscaledZ-1);const q=this._tiles[z.key];if(q&&q.hasData()&&E[z.key]){p[D]=R.tileID;break}}}for(const D in v)p[D]||(this._coveredTiles[D]=!0,p[D]=v[D])}for(const v in p)this._tiles[v].clearFadeHold();const g=function(v,E){const k=[];for(const M in v)M in E||k.push(M);return k}(this._tiles,p);for(const v of g){const E=this._tiles[v];E.hasSymbolBuckets&&!E.holdingForFade()?E.setHoldDuration(this.map._fadeDuration):E.hasSymbolBuckets&&!E.symbolFadeFinished()||this._removeTile(+v)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const t in this._tiles)this._tiles[t].holdingForFade()&&this._removeTile(+t)}_updateRetainedTiles(t){const s={};if(0===t.length)return s;const l={},h=t.reduce((k,M)=>Math.min(k,M.overscaledZ),1/0),p=t[0].overscaledZ,g=Math.max(p-qc.maxOverzooming,this._source.minzoom),v=Math.max(p+qc.maxUnderzooming,this._source.minzoom),E={};for(const k of t){const M=this._addTile(k);s[k.key]=k,M.hasData()||h<this._source.maxzoom&&(E[k.key]=k)}this._retainLoadedChildren(E,h,v,s);for(const k of t){let M=this._tiles[k.key];if(M.hasData())continue;if(k.canonical.z>=this._source.maxzoom){const R=k.children(this._source.maxzoom)[0],z=this.getTile(R);if(z&&z.hasData()){s[R.key]=R;continue}}else{const R=k.children(this._source.maxzoom);if(s[R[0].key]&&s[R[1].key]&&s[R[2].key]&&s[R[3].key])continue}let D=M.wasRequested();for(let R=k.overscaledZ-1;R>=g;--R){const z=k.scaledTo(R);if(l[z.key]||(l[z.key]=!0,M=this.getTile(z),!M&&D&&(M=this._addTile(z)),M&&(s[z.key]=z,D=M.wasRequested(),M.hasData())))break}}return s}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const t in this._tiles){const s=[];let l,h=this._tiles[t].tileID;for(;h.overscaledZ>0;){if(h.key in this._loadedParentTiles){l=this._loadedParentTiles[h.key];break}s.push(h.key);const p=h.scaledTo(h.overscaledZ-1);if(l=this._getLoadedTile(p),l)break;h=p}for(const p of s)this._loadedParentTiles[p]=l}}_addTile(t){let s=this._tiles[t.key];if(s)return this._source.prepareTile&&this._source.prepareTile(s),s;s=this._cache.getAndRemove(t),s&&(this._setTileReloadTimer(t.key,s),s.tileID=t,this._state.initializeTileState(s,this.map?this.map.painter:null),this._cacheTimers[t.key]&&(clearTimeout(this._cacheTimers[t.key]),delete this._cacheTimers[t.key],this._setTileReloadTimer(t.key,s)));const l=Boolean(s);if(!l){const h=this.map?this.map.painter:null;s=new Yf(t,this._source.tileSize*t.overscaleFactor(),this.transform.tileZoom,h,this._isRaster),this._source.prepareTile&&this._source.prepareTile(s)||this._loadTile(s,this._tileLoaded.bind(this,s,t.key,s.state))}return s?(s.uses++,this._tiles[t.key]=s,l||this._source.fire(new Yt("dataloading",{tile:s,coord:s.tileID,dataType:"source"})),s):null}_setTileReloadTimer(t,s){t in this._timers&&(clearTimeout(this._timers[t]),delete this._timers[t]);const l=s.getExpiryTimeout();l&&(this._timers[t]=setTimeout(()=>{this._reloadTile(t,"expired"),delete this._timers[t]},l))}_removeTile(t){const s=this._tiles[t];s&&(s.uses--,delete this._tiles[t],this._timers[t]&&(clearTimeout(this._timers[t]),delete this._timers[t]),s.uses>0||(s.hasData()&&"reloading"!==s.state?this._cache.add(s.tileID,s,s.getExpiryTimeout()):(s.aborted=!0,this._abortTile(s),this._unloadTile(s))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const t in this._tiles)this._removeTile(+t);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(t,s,l){const h=[],p=this.transform;if(!p)return h;for(const g in this._tiles){const v=this._tiles[g];if(l&&v.clearQueryDebugViz(),v.holdingForFade())continue;const E=t.containsTile(v,p,s);E&&h.push(E)}return h}getVisibleCoordinates(t){const s=this.getRenderableIds(t).map(l=>this._tiles[l].tileID);for(const l of s)l.projMatrix=this.transform.calculateProjMatrix(l.toUnwrapped());return s}hasTransition(){if(this._source.hasTransition())return!0;if(Gc(this._source.type))for(const t in this._tiles){const s=this._tiles[t];if(void 0!==s.fadeEndTime&&s.fadeEndTime>=$n.now())return!0}return!1}setFeatureState(t,s,l){this._state.updateState(t=t||"_geojsonTileLayer",s,l)}removeFeatureState(t,s,l){this._state.removeFeatureState(t=t||"_geojsonTileLayer",s,l)}getFeatureState(t,s){return this._state.getState(t=t||"_geojsonTileLayer",s)}setDependencies(t,s,l){const h=this._tiles[t];h&&h.setDependencies(s,l)}reloadTilesForDependencies(t,s){for(const l in this._tiles)this._tiles[l].hasDependency(t,s)&&this._reloadTile(+l,"reloading");this._cache.filter(l=>!l.hasDependency(t,s))}_preloadTiles(t,s){const l=new Map,h=Array.isArray(t)?t:[t],p=this.map.painter.terrain,g=this.usedForTerrain&&p?p.getScaledDemTileSize():this._source.tileSize;for(const v of h){const E=v.coveringTiles({tileSize:g,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const k of E)l.set(k.key,k);this.usedForTerrain&&v.updateElevation(!1)}rl(Array.from(l.values()),(v,E)=>{const k=new Yf(v,this._source.tileSize*v.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster);this._loadTile(k,M=>{"raster-dem"===this._source.type&&k.dem&&this._backfillDEM(k),E(M,k)})},s)}}function am(a,t){const s=Math.abs(2*a.wrap)-+(a.wrap<0),l=Math.abs(2*t.wrap)-+(t.wrap<0);return a.overscaledZ-t.overscaledZ||l-s||t.canonical.y-a.canonical.y||t.canonical.x-a.canonical.x}function Gc(a){return"raster"===a||"image"===a||"video"===a}qc.maxOverzooming=10,qc.maxUnderzooming=3;class qu{constructor(t,s,l){this._demTile=t,this._dem=this._demTile.dem,this._scale=s,this._offset=l}static create(t,s,l){const h=l||t.findDEMTileFor(s);if(!h||!h.dem)return;const p=h.dem,g=h.tileID,v=1<<s.canonical.z-g.canonical.z;return new qu(h,h.tileSize/hr/v,[(s.canonical.x/v-g.canonical.x)*p.dim,(s.canonical.y/v-g.canonical.y)*p.dim])}tileCoordToPixel(t,s){const l=s*this._scale+this._offset[1],h=Math.floor(t*this._scale+this._offset[0]),p=Math.floor(l);return new ut(h,p)}getElevationAt(t,s,l,h){const p=t*this._scale+this._offset[0],g=s*this._scale+this._offset[1],v=Math.floor(p),E=Math.floor(g),k=this._dem;return h=!!h,l?Qt(Qt(k.get(v,E,h),k.get(v,E+1,h),g-E),Qt(k.get(v+1,E,h),k.get(v+1,E+1,h),g-E),p-v):k.get(v,E,h)}getElevationAtPixel(t,s,l){return this._dem.get(t,s,!!l)}getMeterToDEM(t){return(1<<this._demTile.tileID.canonical.z)*Wr(1,t)*this._dem.stride}}class Qf{constructor(t,s){this.tileID=t,this.x=t.canonical.x,this.y=t.canonical.y,this.z=t.canonical.z,this.grid=new ds(hr,16,0),this.featureIndexArray=new hi,this.promoteId=s}insert(t,s,l,h,p,g=0){const v=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(l,h,p,g);const E=this.grid;for(let k=0;k<s.length;k++){const M=s[k],D=[1/0,1/0,-1/0,-1/0];for(let R=0;R<M.length;R++){const z=M[R];D[0]=Math.min(D[0],z.x),D[1]=Math.min(D[1],z.y),D[2]=Math.max(D[2],z.x),D[3]=Math.max(D[3],z.y)}D[0]<hr&&D[1]<hr&&D[2]>=0&&D[3]>=0&&E.insert(v,D[0],D[1],D[2],D[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new Bl.VectorTile(new Rh(this.rawTileData)).layers,this.sourceLayerCoder=new Wp(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const t in this.vtLayers)this.vtFeatures[t]=[]}return this.vtLayers}query(t,s,l,h){this.loadVTLayers();const p=t.params||{},g=la(p.filter),v=t.tileResult,E=t.transform,k=v.bufferedTilespaceBounds,M=this.grid.query(k.min.x,k.min.y,k.max.x,k.max.y,(q,K,ee,ne)=>kf(v.bufferedTilespaceGeometry,q,K,ee,ne));M.sort(Ig);let D=null;E.elevation&&M.length>0&&(D=qu.create(E.elevation,this.tileID));const R={};let z;for(let q=0;q<M.length;q++){const K=M[q];if(K===z)continue;z=K;const ee=this.featureIndexArray.get(K);let ne=null;this.loadMatchingFeature(R,ee,g,p.layers,p.availableImages,s,l,h,(ve,Ae,Me,De=0)=>(ne||(ne=vs(ve,this.tileID.canonical,t.tileTransform)),Ae.queryIntersectsFeature(v,ve,Me,ne,this.z,t.transform,t.pixelPosMatrix,D,De)))}return R}loadMatchingFeature(t,s,l,h,p,g,v,E,k){const{featureIndex:M,bucketIndex:D,sourceLayerIndex:R,layoutVertexArrayOffset:z}=s,q=this.bucketLayerIDs[D];if(h&&!function(ve,Ae){for(let Me=0;Me<ve.length;Me++)if(Ae.indexOf(ve[Me])>=0)return!0;return!1}(h,q))return;const K=this.sourceLayerCoder.decode(R),ee=this.vtLayers[K].feature(M);if(l.needGeometry){const ve=Rl(ee,!0);if(!l.filter(new qr(this.tileID.overscaledZ),ve,this.tileID.canonical))return}else if(!l.filter(new qr(this.tileID.overscaledZ),ee))return;const ne=this.getId(ee,K);for(let ve=0;ve<q.length;ve++){const Ae=q[ve];if(h&&h.indexOf(Ae)<0)continue;const Me=g[Ae];if(!Me)continue;let De={};void 0!==ne&&E&&(De=E.getState(Me.sourceLayer||"_geojsonTileLayer",ne));const Pe=Gi({},v[Ae]);Pe.paint=o0(Pe.paint,Me.paint,ee,De,p),Pe.layout=o0(Pe.layout,Me.layout,ee,De,p);const Xe=!k||k(ee,Me,De,z);if(!Xe)continue;const He=new Xp(ee,this.z,this.x,this.y,ne);He.layer=Pe;let st=t[Ae];void 0===st&&(st=t[Ae]=[]),st.push({featureIndex:M,feature:He,intersectionZ:Xe})}}lookupSymbolFeatures(t,s,l,h,p,g,v,E){const k={};this.loadVTLayers();const M=la(p);for(const D of t)this.loadMatchingFeature(k,{bucketIndex:l,sourceLayerIndex:h,featureIndex:D,layoutVertexArrayOffset:0},M,g,v,E,s);return k}loadFeature(t){const{featureIndex:s,sourceLayerIndex:l}=t;this.loadVTLayers();const h=this.sourceLayerCoder.decode(l),p=this.vtFeatures[h];if(p[s])return p[s];const g=this.vtLayers[h].feature(s);return p[s]=g,g}hasLayer(t){for(const s of this.bucketLayerIDs)for(const l of s)if(t===l)return!0;return!1}getId(t,s){let l=t.id;return this.promoteId&&(l=t.properties["string"==typeof this.promoteId?this.promoteId:this.promoteId[s]],"boolean"==typeof l&&(l=Number(l))),l}}function o0(a,t,s,l,h){return Rs(a,(p,g)=>{const v=t instanceof b?t.get(g):null;return v&&v.evaluate?v.evaluate(s,l,h):v})}function Ig(a,t){return t-a}Dt(Qf,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});class sm{constructor(t){const s={},l=[];for(const v in t){const E=t[v],k=s[v]={};for(const M in E.glyphs){const D=E.glyphs[+M];if(!D||0===D.bitmap.width||0===D.bitmap.height)continue;const R=D.metrics.localGlyph?2:1,z={x:0,y:0,w:D.bitmap.width+2*R,h:D.bitmap.height+2*R};l.push(z),k[M]=z}}const{w:h,h:p}=zd(l),g=new Jo({width:h||1,height:p||1});for(const v in t){const E=t[v];for(const k in E.glyphs){const M=E.glyphs[+k];if(!M||0===M.bitmap.width||0===M.bitmap.height)continue;const D=s[v][k],R=M.metrics.localGlyph?2:1;Jo.copy(M.bitmap,g,{x:0,y:0},{x:D.x+R,y:D.y+R},M.bitmap)}}this.image=g,this.positions=s}}Dt(sm,"GlyphAtlas");class Mg{constructor(t){this.tileID=new ta(t.tileID.overscaledZ,t.tileID.wrap,t.tileID.canonical.z,t.tileID.canonical.x,t.tileID.canonical.y),this.tileZoom=t.tileZoom,this.uid=t.uid,this.zoom=t.zoom,this.canonical=t.tileID.canonical,this.pixelRatio=t.pixelRatio,this.tileSize=t.tileSize,this.source=t.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=t.showCollisionBoxes,this.collectResourceTiming=!!t.collectResourceTiming,this.returnDependencies=!!t.returnDependencies,this.promoteId=t.promoteId,this.enableTerrain=!!t.enableTerrain,this.isSymbolTile=t.isSymbolTile,this.tileTransform=Vc(t.tileID.canonical,t.projection),this.projection=t.projection}parse(t,s,l,h,p){this.status="parsing",this.data=t,this.collisionBoxArray=new Rn;const g=new Wp(Object.keys(t.layers).sort()),v=new Qf(this.tileID,this.promoteId);v.bucketLayerIDs=[];const E={},k=new Kd(256,256),M={featureIndex:v,iconDependencies:{},patternDependencies:{},glyphDependencies:{},lineAtlas:k,availableImages:l},D=s.familiesBySource[this.source];for(const De in D){const Pe=t.layers[De];if(!Pe)continue;let Xe=!1,He=!1;for(const $e of D[De])"symbol"===$e[0].type?Xe=!0:He=!0;if(!0===this.isSymbolTile&&!Xe||!1===this.isSymbolTile&&!He)continue;1===Pe.version&&Rr(`Vector tile source "${this.source}" layer "${De}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const st=g.encode(De),ht=[];for(let $e=0;$e<Pe.length;$e++){const rt=Pe.feature($e),pt=v.getId(rt,De);ht.push({feature:rt,id:pt,index:$e,sourceLayerIndex:st})}for(const $e of D[De]){const rt=$e[0];void 0!==this.isSymbolTile&&"symbol"===rt.type!==this.isSymbolTile||rt.minzoom&&this.zoom<Math.floor(rt.minzoom)||rt.maxzoom&&this.zoom>=rt.maxzoom||"none"!==rt.visibility&&($i($e,this.zoom,l),(E[rt.id]=rt.createBucket({index:v.bucketLayerIDs.length,layers:$e,zoom:this.zoom,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:st,sourceID:this.source,enableTerrain:this.enableTerrain,projection:this.projection.name,availableImages:l})).populate(ht,M,this.tileID.canonical,this.tileTransform),v.bucketLayerIDs.push($e.map(pt=>pt.id)))}}let R,z,q,K;k.trim();const ee={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},ne=Rs(M.glyphDependencies,De=>Object.keys(De).map(Number));Object.keys(ne).length?h.send("getGlyphs",{uid:this.uid,stacks:ne},(De,Pe)=>{R||(R=De,z=Pe,Me.call(this))},void 0,!1,ee):z={};const ve=Object.keys(M.iconDependencies);ve.length?h.send("getImages",{icons:ve,source:this.source,tileID:this.tileID,type:"icons"},(De,Pe)=>{R||(R=De,q=Pe,Me.call(this))},void 0,!1,ee):q={};const Ae=Object.keys(M.patternDependencies);function Me(){if(R)return p(R);if(z&&q&&K){const De=new sm(z),Pe=new xp(q,K);for(const Xe in E){const He=E[Xe];He instanceof to?($i(He.layers,this.zoom,l),kg(He,z,De.positions,q,Pe.iconPositions,this.showCollisionBoxes,l,this.tileID.canonical,this.tileZoom,this.projection)):He.hasPattern&&(He instanceof Nf||He instanceof zf||He instanceof Ou)&&($i(He.layers,this.zoom,l),He.addFeatures(M,this.tileID.canonical,Pe.patternPositions,l,this.tileTransform))}this.status="done",p(null,{buckets:ec(E).filter(Xe=>!Xe.isEmpty()),featureIndex:v,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:De.image,lineAtlas:k,imageAtlas:Pe,glyphMap:this.returnDependencies?z:null,iconMap:this.returnDependencies?q:null,glyphPositions:this.returnDependencies?De.positions:null})}}Ae.length?h.send("getImages",{icons:Ae,source:this.source,tileID:this.tileID,type:"patterns"},(De,Pe)=>{R||(R=De,K=Pe,Me.call(this))},void 0,!1,ee):K={},Me.call(this)}}function $i(a,t,s){const l=new qr(t);for(const h of a)h.recalculate(l,s)}class el{constructor(t){this.entries={},this.scheduler=t}request(t,s,l,h){const p=this.entries[t]=this.entries[t]||{callbacks:[]};if(p.result){const[g,v]=p.result;return this.scheduler?this.scheduler.add(()=>{h(g,v)},s):h(g,v),()=>{}}return p.callbacks.push(h),p.cancel||(p.cancel=l((g,v)=>{p.result=[g,v];for(const E of p.callbacks)this.scheduler?this.scheduler.add(()=>{E(g,v)},s):E(g,v);setTimeout(()=>delete this.entries[t],3e3)})),()=>{p.result||(p.callbacks=p.callbacks.filter(g=>g!==h),p.callbacks.length||(p.cancel(),delete this.entries[t]))}}}function l0(a,t,s){const l=JSON.stringify(a.request);return a.data&&(this.deduped.entries[l]={result:[null,a.data]}),this.deduped.request(l,{type:"parseTile",isSymbolTile:a.isSymbolTile,zoom:a.tileZoom},h=>{const p=pe(a.request,(g,v,E,k)=>{g?h(g):v&&h(null,{vectorTile:s?void 0:new Bl.VectorTile(new Rh(v)),rawData:v,cacheControl:E,expires:k})});return()=>{p.cancel(),h()}},t)}const om=ws(new Float32Array(16));class $l{constructor(t){this.name=t.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(t,s){return{x:0,y:0,z:0}}unproject(t,s){return new Jr(0,0)}projectTilePoint(t,s,l){return{x:t,y:s,z:0}}locationPoint(t,s){return t._coordinatePoint(t.locationCoordinate(s),!1)}pixelsPerMeter(t,s){return Wr(1,t)*s}farthestPixelDistance(t){return function(s,l){const h=s.fovAboveCenter,p=s.elevation?s.elevation.getMinElevationBelowMSL()*l:0,g=(s._camera.position[2]*s.worldSize-p)/Math.cos(s._pitch),v=Math.sin(h)*g/Math.sin(Math.max(Math.PI/2-s._pitch-h,.01)),E=Math.sin(s._pitch)*v+g;return Math.min(1.01*E,g*(1/s._horizonShift))}(t,t.pixelsPerMeter)}pointCoordinate(t,s,l,h){const p=t.horizonLineFromTop(!1),g=new ut(s,Math.max(p,l));return t.rayIntersectionCoordinate(t.pointRayIntersection(g,h))}createInversionMatrix(t,s){return om}createTileMatrix(t,s,l){let h,p,g;const v=l.canonical,E=ws(new Float64Array(16));if(this.isReprojectedInTileSpace){const k=Vc(v,this);h=1,p=k.x+l.wrap*k.scale,g=k.y,bs(E,E,[h/k.scale,h/k.scale,t.pixelsPerMeter/s])}else h=s/t.zoomScale(v.z),p=(v.x+Math.pow(2,v.z)*l.wrap)*h,g=v.y*h;return Lc(E,E,[p,g,0]),bs(E,E,[h/hr,h/hr,1]),E}upVector(t,s,l){return[0,0,1]}upVectorScale(t,s,l){return{metersToTile:1,metersToLabelSpace:1}}}class lm extends $l{constructor(t){super(t),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(t,s){return{x:Yo(t),y:gs(s),z:0}}unproject(t,s){const l=es(t),h=En(s);return new Jr(l,h)}}class Y_ extends $l{constructor(t){super(t),this.range=[4,7],this.center=t.center||[-96,37.5];const[s,l]=this.parallels=t.parallels||[29.5,45.5],h=Math.sin(Pr(s));this.n=(h+Math.sin(Pr(l)))/2,this.c=1+h*(2*this.n-h),this.r0=Math.sqrt(this.c)/this.n}project(t,s){const{n:l,c:h,r0:p}=this,g=Pr(t-this.center[0]),v=Pr(s),E=Math.sqrt(h-2*l*Math.sin(v))/l;return{x:E*Math.sin(g*l),y:E*Math.cos(g*l)-p,z:0}}unproject(t,s){const{n:l,c:h,r0:p}=this,g=p+s;let v=Math.atan2(t,Math.abs(g))*Math.sign(g);g*l<0&&(v-=Math.PI*Math.sign(t)*Math.sign(g));const E=Pr(this.center[0])*l;v=Ma(v,-Math.PI-E,Math.PI-E);const k=Gn(v/l)+this.center[0],M=Math.asin(wr((h-(t*t+g*g)*l*l)/(2*l),-1,1)),D=wr(Gn(M),-85.051129,xs);return new Jr(k,D)}}const jh=1.340264,qh=-.081106,Gh=893e-6,$h=.003796,ed=Math.sqrt(3)/2;class K_ extends $l{project(t,s){s=s/180*Math.PI,t=t/180*Math.PI;const l=Math.asin(ed*Math.sin(s)),h=l*l,p=h*h*h;return{x:.5*(t*Math.cos(l)/(ed*(jh+3*qh*h+p*(7*Gh+9*$h*h)))/Math.PI+.5),y:1-.5*(l*(jh+qh*h+p*(Gh+$h*h))/Math.PI+1),z:0}}unproject(t,s){t=(2*t-.5)*Math.PI;let l=s=(2*(1-s)-1)*Math.PI,h=l*l,p=h*h*h;for(let M,D,R,z=0;z<12&&(D=l*(jh+qh*h+p*(Gh+$h*h))-s,R=jh+3*qh*h+p*(7*Gh+9*$h*h),M=D/R,l=wr(l-M,-Math.PI/3,Math.PI/3),h=l*l,p=h*h*h,!(Math.abs(M)<1e-12));++z);const g=ed*t*(jh+3*qh*h+p*(7*Gh+9*$h*h))/Math.cos(l),v=Math.asin(Math.sin(l)/ed),E=wr(180*g/Math.PI,-180,180),k=wr(180*v/Math.PI,-85.051129,xs);return new Jr(E,k)}}class J_ extends $l{constructor(t){super(t),this.wrap=!0,this.supportsWorldCopies=!0}project(t,s){return{x:.5+t/360,y:.5-s/360,z:0}}unproject(t,s){const l=360*(t-.5),h=wr(360*(.5-s),-85.051129,xs);return new Jr(l,h)}}const Gu=Math.PI/2;function td(a){return Math.tan((Gu+a)/2)}class cm extends $l{constructor(t){super(t),this.center=t.center||[0,30];const[s,l]=this.parallels=t.parallels||[30,30],h=Pr(s),p=Pr(l),g=Math.cos(h);this.n=h===p?Math.sin(h):Math.log(g/Math.cos(p))/Math.log(td(p)/td(h)),this.f=g*Math.pow(td(h),this.n)/this.n}project(t,s){s=Pr(s),t=Pr(t-this.center[0]);const l=1e-6,{n:h,f:p}=this;p>0?s<-Gu+l&&(s=-Gu+l):s>Gu-l&&(s=Gu-l);const g=p/Math.pow(td(s),h),v=g*Math.sin(h*t),E=p-g*Math.cos(h*t);return{x:.5*(v/Math.PI+.5),y:1-.5*(E/Math.PI+.5),z:0}}unproject(t,s){t=(2*t-.5)*Math.PI,s=(2*(1-s)-.5)*Math.PI;const{n:l,f:h}=this,p=h-s,g=Math.sign(p),v=Math.sign(l)*Math.sqrt(t*t+p*p);let E=Math.atan2(t,Math.abs(p))*g;p*l<0&&(E-=Math.PI*Math.sign(t)*g);const k=wr(Gn(E/l)+this.center[0],-180,180),M=wr(Gn(2*Math.atan(Math.pow(h/v,1/l))-Gu),-85.051129,xs);return new Jr(k,M)}}const um=Pr(xs);class Q_ extends $l{project(t,s){const l=(s=Pr(s))*s,h=l*l;return{x:.5*((t=Pr(t))*(.8707-.131979*l+h*(h*(.003971*l-.001529*h)-.013791))/Math.PI+.5),y:1-.5*(s*(1.007226+l*(.015085+h*(.028874*l-.044475-.005916*h)))/Math.PI+1),z:0}}unproject(t,s){t=(2*t-.5)*Math.PI;let l=s=(2*(1-s)-1)*Math.PI,h=25,p=0,g=l*l;do{g=l*l;const k=g*g;p=(l*(1.007226+g*(.015085+k*(.028874*g-.044475-.005916*k)))-s)/(1.007226+g*(.045255+k*(.259866*g-.311325-.005916*11*k))),l=wr(l-p,-um,um)}while(Math.abs(p)>1e-6&&--h>0);g=l*l;const v=wr(Gn(t/(.8707+g*(g*(g*g*g*(.003971-.001529*g)-.013791)-.131979))),-180,180),E=Gn(l);return new Jr(v,E)}}const hm=Pr(xs);class eg extends $l{project(t,s){s=Pr(s),t=Pr(t);const l=Math.cos(s),h=2/Math.PI,p=Math.acos(l*Math.cos(t/2)),g=Math.sin(p)/p,v=.5*(t*h+2*l*Math.sin(t/2)/g)||0,E=.5*(s+Math.sin(s)/g)||0;return{x:.5*(v/Math.PI+.5),y:1-.5*(E/Math.PI+1),z:0}}unproject(t,s){let l=t=(2*t-.5)*Math.PI,h=s=(2*(1-s)-1)*Math.PI,p=25;const g=1e-6;let v=0,E=0;do{const k=Math.cos(h),M=Math.sin(h),D=2*M*k,R=M*M,z=k*k,q=Math.cos(l/2),K=Math.sin(l/2),ee=2*q*K,ne=K*K,ve=1-z*q*q,Ae=ve?1/ve:0,Me=ve?Math.acos(k*q)*Math.sqrt(1/ve):0,De=.5*(2*Me*k*K+2*l/Math.PI)-t,Pe=.5*(Me*M+h)-s,Xe=.5*Ae*(z*ne+Me*k*q*R)+1/Math.PI,He=Ae*(ee*D/4-Me*M*K),st=.125*Ae*(D*K-Me*M*z*ee),ht=.5*Ae*(R*q+Me*ne*k)+.5,$e=He*st-ht*Xe;v=(Pe*He-De*ht)/$e,E=(De*st-Pe*Xe)/$e,l=wr(l-v,-Math.PI,Math.PI),h=wr(h-E,-hm,hm)}while((Math.abs(v)>g||Math.abs(E)>g)&&--p>0);return new Jr(Gn(l),Gn(h))}}class fm extends $l{constructor(t){super(t),this.center=t.center||[0,0],this.parallels=t.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(Pr(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(t,s){const{scale:l,cosPhi:h}=this;return{x:Pr(t)*h*l+.5,y:-Math.sin(Pr(s))/h*l+.5,z:0}}unproject(t,s){const{scale:l,cosPhi:h}=this,p=-(s-.5)/l,g=wr(Gn((t-.5)/l)/h,-180,180),v=Math.asin(wr(p*h,-1,1)),E=wr(Gn(v),-85.051129,xs);return new Jr(g,E)}}f.ARRAY_TYPE=va,f.AUTH_ERR_MSG=yo,f.Aabb=ea,f.Actor=class{constructor(a,t,s){this.target=a,this.parent=t,this.mapId=s,this.callbacks={},this.cancelCallbacks={},nl(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.globalScope=Da()?a:Zt,this.scheduler=new N_}send(a,t,s,l,h=!1,p){const g=Math.round(1e18*Math.random()).toString(36).substring(0,10);s&&(s.metadata=p,this.callbacks[g]=s);const v=kn(this.globalScope)?void 0:[];return this.target.postMessage({id:g,type:a,hasCallback:!!s,targetMapId:l,mustQueue:h,sourceMapId:this.mapId,data:Al(t,v)},v),{cancel:()=>{s&&delete this.callbacks[g],this.target.postMessage({id:g,type:"<cancel>",targetMapId:l,sourceMapId:this.mapId})}}}receive(a){const t=a.data,s=t.id;if(s&&(!t.targetMapId||this.mapId===t.targetMapId))if("<cancel>"===t.type){const l=this.cancelCallbacks[s];delete this.cancelCallbacks[s],l&&l.cancel()}else if(t.mustQueue||Da()){const l=this.callbacks[s];this.cancelCallbacks[s]=this.scheduler.add(()=>this.processTask(s,t),l&&l.metadata||{type:"message"})}else this.processTask(s,t)}processTask(a,t){if("<response>"===t.type){const s=this.callbacks[a];delete this.callbacks[a],s&&(t.error?s(Zo(t.error)):s(null,Zo(t.data)))}else{const s=kn(this.globalScope)?void 0:[],l=t.hasCallback?(p,g)=>{delete this.cancelCallbacks[a],this.target.postMessage({id:a,type:"<response>",sourceMapId:this.mapId,error:p?Al(p):null,data:Al(g,s)},s)}:p=>{},h=Zo(t.data);if(this.parent[t.type])this.parent[t.type](t.sourceMapId,h,l);else if(this.parent.getWorkerSource){const p=t.type.split(".");this.parent.getWorkerSource(t.sourceMapId,p[0],h.source)[p[1]](h,l)}else l(new Error(`Could not find function ${t.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}},f.CanonicalTileID=Hf,f.Color=Fr,f.ColorMode=io,f.CullFaceMode=Cs,f.DEMData=Kf,f.DataConstantProperty=S,f.DedupedRequest=el,f.DepthMode=ju,f.EXTENT=hr,f.Elevation=class{isDataAvailableAtPoint(a){const t=this._source();if(!t||a.y<0||a.y>1)return!1;const s=t.getSource().maxzoom,l=1<<s,h=Math.floor(a.x),p=Math.floor((a.x-h)*l),g=Math.floor(a.y*l),v=this.findDEMTileFor(new ta(s,h,s,p,g));return!(!v||!v.dem)}getAtPointOrZero(a,t=0){return this.getAtPoint(a,t)||0}getAtPoint(a,t,s=!0){null==t&&(t=null);const l=this._source();if(!l||a.y<0||a.y>1)return t;const h=l.getSource().maxzoom,p=1<<h,g=Math.floor(a.x),v=a.x-g,E=new ta(h,g,h,Math.floor(v*p),Math.floor(a.y*p)),k=this.findDEMTileFor(E);if(!k||!k.dem)return t;const M=k.dem,D=1<<k.tileID.canonical.z,R=(v*D-k.tileID.canonical.x)*M.dim,z=(a.y*D-k.tileID.canonical.y)*M.dim,q=Math.floor(R),K=Math.floor(z);return(s?this.exaggeration():1)*Qt(Qt(M.get(q,K),M.get(q,K+1),z-K),Qt(M.get(q+1,K),M.get(q+1,K+1),z-K),R-q)}getAtTileOffset(a,t,s){const l=1<<a.canonical.z;return this.getAtPointOrZero(new Ef(a.wrap+(a.canonical.x+t/hr)/l,(a.canonical.y+s/hr)/l))}getAtTileOffsetFunc(a,t,s,l){return h=>{const p=this.getAtTileOffset(a,h.x,h.y),g=l.upVector(a.canonical,h.x,h.y);return Li(g,g,p*l.upVectorScale(a.canonical,t,s).metersToTile),g}}getForTilePoints(a,t,s,l){const h=qu.create(this,a,l);return!!h&&(t.forEach(p=>{p[2]=this.exaggeration()*h.getElevationAt(p[0],p[1],s)}),!0)}getMinMaxForTile(a){const t=this.findDEMTileFor(a);if(!t||!t.dem)return null;const s=t.dem.tree,l=t.tileID,h=1<<a.canonical.z-l.canonical.z;let p=a.canonical.x/h-l.canonical.x,g=a.canonical.y/h-l.canonical.y,v=0;for(let E=0;E<a.canonical.z-l.canonical.z&&!s.leaves[v];E++){p*=2,g*=2;const k=2*Math.floor(g)+Math.floor(p);v=s.childOffsets[v]+k,p%=1,g%=1}return{min:this.exaggeration()*s.minimums[v],max:this.exaggeration()*s.maximums[v]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(a,t,s){throw new Error("Pure virtual method called.")}pointCoordinate(a){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(a){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}},f.ErrorEvent=Kt,f.EvaluationParameters=qr,f.Event=Yt,f.Evented=nr,f.FillExtrusionBucket=Ou,f.Frustum=Sd,f.GLOBE_RADIUS=Vu,f.GlobeSharedBuffers=class{constructor(a){this._createGrid(a),this._createPoles(a),this._createAtmosphere(a)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const a of this._poleSegments)a.destroy();this._gridSegments.destroy(),this.atmosphereVertexBuffer.destroy(),this.atmosphereIndexBuffer.destroy(),this.atmosphereSegments.destroy(),this._wireframeIndexBuffer&&(this._wireframeIndexBuffer.destroy(),this._wireframeSegments.destroy())}_createGrid(a){const t=new he,s=new Mt,l=65;for(let h=0;h<l;h++)for(let p=0;p<l;p++)t.emplaceBack(p,h);for(let h=0;h<64;h++)for(let p=0;p<64;p++){const g=h*l+p;s.emplaceBack(g+1,g,g+l),s.emplaceBack(g+l,g+l+1,g+1)}this._gridBuffer=a.createVertexBuffer(t,Uh.members),this._gridIndexBuffer=a.createIndexBuffer(s,!0),this._gridSegments=wi.simpleSegment(0,0,4225,8192)}_createPoles(a){const t=new Mt;for(let h=0;h<=64;h++)t.emplaceBack(0,h+1,h+2);this._poleIndexBuffer=a.createIndexBuffer(t,!0);const s=new Ot,l=new Ot;this._poleSegments=[];for(let h=0,p=0;h<5;h++){const g=1<<h,v=512*g/Math.PI/2,E=360/g;s.emplaceBack(0,-v,0,0,0,.5,0),l.emplaceBack(0,-v,0,0,0,.5,1);for(let k=0;k<=64;k++){const M=k/64,D=Qt(0,E,M),[R,z,q]=e0($_,W_,D,v);s.emplaceBack(R,z,q,0,0,M,0),l.emplaceBack(R,z,q,0,0,M,1)}this._poleSegments.push(wi.simpleSegment(p,0,66,64)),p+=66}this._poleNorthVertexBuffer=a.createVertexBuffer(s,Np,!1),this._poleSouthVertexBuffer=a.createVertexBuffer(l,Np,!1)}_createAtmosphere(a){const t=new fr;t.emplaceBack(-1,1,1,0,0),t.emplaceBack(1,1,1,1,0),t.emplaceBack(1,-1,1,1,1),t.emplaceBack(-1,-1,1,0,1);const s=new Mt;s.emplaceBack(0,1,2),s.emplaceBack(2,3,0),this.atmosphereVertexBuffer=a.createVertexBuffer(t,Z_.members),this.atmosphereIndexBuffer=a.createIndexBuffer(s),this.atmosphereSegments=wi.simpleSegment(0,0,4,2)}getGridBuffers(){return[this._gridBuffer,this._gridIndexBuffer,this._gridSegments]}getPoleBuffers(a){return[this._poleNorthVertexBuffer,this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[a]]}getWirefameBuffers(a){if(!this._wireframeSegments){const t=new rr,s=64,l=s+1;for(let h=0;h<s;h++)for(let p=0;p<s;p++){const g=h*l+p;t.emplaceBack(g,g+1),t.emplaceBack(g,g+l),t.emplaceBack(g,g+l+1)}this._wireframeIndexBuffer=a.createIndexBuffer(t),this._wireframeSegments=wi.simpleSegment(0,0,s*s,t.length)}return[this._gridBuffer,this._wireframeIndexBuffer,this._wireframeSegments]}},f.GlyphManager=zc,f.ImagePosition=Bd,f.LineAtlas=Kd,f.LngLat=Jr,f.LngLatBounds=Js,f.LocalGlyphMode=Zu,f.MAX_MERCATOR_LATITUDE=xs,f.MercatorCoordinate=Ef,f.ONE_EM=24,f.OverscaledTileID=ta,f.Properties=V,f.RGBAImage=da,f.Ray=class{constructor(a,t){this.pos=a,this.dir=t}intersectsPlane(a,t,s){const l=bh(t,this.dir);if(Math.abs(l)<1e-6)return!1;const h=((a[0]-this.pos[0])*t[0]+(a[1]-this.pos[1])*t[1]+(a[2]-this.pos[2])*t[2])/l;return s[0]=this.pos[0]+this.dir[0]*h,s[1]=this.pos[1]+this.dir[1]*h,s[2]=this.pos[2]+this.dir[2]*h,!0}closestPointOnSphere(a,t,s){if(q=(R=this.pos)[0],K=R[1],ee=R[2],ne=(z=a)[0],ve=z[1],Ae=z[2],Math.abs(q-ne)<=vd*Math.max(1,Math.abs(q),Math.abs(ne))&&Math.abs(K-ve)<=vd*Math.max(1,Math.abs(K),Math.abs(ve))&&Math.abs(ee-Ae)<=vd*Math.max(1,Math.abs(ee),Math.abs(Ae))||0===t)return s[0]=s[1]=s[2]=0,!1;var R,z,q,K,ee,ne,ve,Ae;const[l,h,p]=this.dir,g=this.pos[0]-a[0],v=this.pos[1]-a[1],E=this.pos[2]-a[2],k=l*l+h*h+p*p,M=2*(g*l+v*h+E*p),D=M*M-4*k*(g*g+v*v+E*E-t*t);if(D<0){const R=Math.max(-M/2,0),z=g+l*R,q=v+h*R,K=E+p*R,ee=Math.hypot(z,q,K);return s[0]=z*t/ee,s[1]=q*t/ee,s[2]=K*t/ee,!1}{const R=(-M-Math.sqrt(D))/(2*k);if(R<0){const z=Math.hypot(g,v,E);return s[0]=g*t/z,s[1]=v*t/z,s[2]=E*t/z,!1}return s[0]=g+l*R,s[1]=v+h*R,s[2]=E+p*R,!0}}},f.RequestManager=class{constructor(a,t,s){this._transformRequestFn=a,this._customAccessToken=t,this._silenceAuthErrors=!!s,this._createSkuToken()}_createSkuToken(){const a=function(){let t="";for(let s=0;s<10;s++)t+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",ol,t].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=a.token,this._skuTokenExpiresAt=a.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(a,t){return this._transformRequestFn&&this._transformRequestFn(a,t)||{url:a}}normalizeStyleURL(a,t){if(!Pa(a))return a;const s=Ra(a);return s.path=`/styles/v1${s.path}`,this._makeAPIURL(s,this._customAccessToken||t)}normalizeGlyphsURL(a,t){if(!Pa(a))return a;const s=Ra(a);return s.path=`/fonts/v1${s.path}`,this._makeAPIURL(s,this._customAccessToken||t)}normalizeSourceURL(a,t){if(!Pa(a))return a;const s=Ra(a);return s.path=`/v4/${s.authority}.json`,s.params.push("secure"),this._makeAPIURL(s,this._customAccessToken||t)}normalizeSpriteURL(a,t,s,l){const h=Ra(a);return Pa(a)?(h.path=`/styles/v1${h.path}/sprite${t}${s}`,this._makeAPIURL(h,this._customAccessToken||l)):(h.path+=`${t}${s}`,Us(h))}normalizeTileURL(a,t,s){if(this._isSkuTokenExpired()&&this._createSkuToken(),a&&!Pa(a))return a;const l=Ra(a);l.path=l.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${t||s&&"raster"!==l.authority&&512===s?"@2x":""}${Ns.supported?".webp":"$1"}`),"raster"===l.authority?l.path=`/${Br.RASTER_URL_PREFIX}${l.path}`:(l.path=l.path.replace(/^.+\/v4\//,"/"),l.path=`/${Br.TILE_URL_VERSION}${l.path}`);const h=this._customAccessToken||function(p){for(const g of p){const v=g.match(/^access_token=(.*)$/);if(v)return v[1]}return null}(l.params)||Br.ACCESS_TOKEN;return Br.REQUIRE_ACCESS_TOKEN&&h&&this._skuToken&&l.params.push(`sku=${this._skuToken}`),this._makeAPIURL(l,h)}canonicalizeTileURL(a,t){const s=Ra(a);if(!s.path.match(/^(\/v4\/|\/raster\/v1\/)/)||!s.path.match(/\.[\w]+$/))return a;let l="mapbox://";s.path.match(/^\/raster\/v1\//)?l+=`raster/${s.path.replace(`/${Br.RASTER_URL_PREFIX}/`,"")}`:l+=`tiles/${s.path.replace(`/${Br.TILE_URL_VERSION}/`,"")}`;let h=s.params;return t&&(h=h.filter(p=>!p.match(/^access_token=/))),h.length&&(l+=`?${h.join("&")}`),l}canonicalizeTileset(a,t){const s=!!t&&Pa(t),l=[];for(const h of a.tiles||[])vo(h)?l.push(this.canonicalizeTileURL(h,s)):l.push(h);return l}_makeAPIURL(a,t){const s="See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes",l=Ra(Br.API_URL);if(a.protocol=l.protocol,a.authority=l.authority,"http"===a.protocol){const h=a.params.indexOf("secure");h>=0&&a.params.splice(h,1)}if("/"!==l.path&&(a.path=`${l.path}${a.path}`),!Br.REQUIRE_ACCESS_TOKEN)return Us(a);if(t=t||Br.ACCESS_TOKEN,!this._silenceAuthErrors){if(!t)throw new Error(`An API access token is required to use Mapbox GL. ${s}`);if("s"===t[0])throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${s}`)}return a.params=a.params.filter(h=>-1===h.indexOf("access_token")),a.params.push(`access_token=${t||""}`),Us(a)}},f.ResourceType=ae,f.SegmentVector=wi,f.SourceCache=qc,f.StencilMode=a0,f.StructArrayLayout1ui2=Dr,f.StructArrayLayout2f1f2i16=It,f.StructArrayLayout2i4=he,f.StructArrayLayout2ui4=rr,f.StructArrayLayout3f12=Qe,f.StructArrayLayout3ui6=Mt,f.StructArrayLayout4i8=ce,f.Texture=Nh,f.Tile=Yf,f.Transitionable=d,f.Uniform1f=zn,f.Uniform1i=class extends ms{constructor(a,t){super(a,t),this.current=0}set(a){this.current!==a&&(this.current=a,this.gl.uniform1i(this.location,a))}},f.Uniform2f=class extends ms{constructor(a,t){super(a,t),this.current=[0,0]}set(a){a[0]===this.current[0]&&a[1]===this.current[1]||(this.current=a,this.gl.uniform2f(this.location,a[0],a[1]))}},f.Uniform3f=class extends ms{constructor(a,t){super(a,t),this.current=[0,0,0]}set(a){a[0]===this.current[0]&&a[1]===this.current[1]&&a[2]===this.current[2]||(this.current=a,this.gl.uniform3f(this.location,a[0],a[1],a[2]))}},f.Uniform4f=_h,f.UniformColor=fd,f.UniformMatrix2f=class extends ms{constructor(a,t){super(a,t),this.current=bf}set(a){for(let t=0;t<4;t++)if(a[t]!==this.current[t]){this.current=a,this.gl.uniformMatrix2fv(this.location,!1,a);break}}},f.UniformMatrix3f=class extends ms{constructor(a,t){super(a,t),this.current=Sg}set(a){for(let t=0;t<9;t++)if(a[t]!==this.current[t]){this.current=a,this.gl.uniformMatrix3fv(this.location,!1,a);break}}},f.UniformMatrix4f=class extends ms{constructor(a,t){super(a,t),this.current=wf}set(a){if(a[12]!==this.current[12]||a[0]!==this.current[0])return this.current=a,void this.gl.uniformMatrix4fv(this.location,!1,a);for(let t=1;t<16;t++)if(a[t]!==this.current[t]){this.current=a,this.gl.uniformMatrix4fv(this.location,!1,a);break}}},f.UnwrappedTileID=$p,f.ValidationError=Ct,f.VectorTileWorkerSource=class extends nr{constructor(a,t,s,l,h){super(),this.actor=a,this.layerIndex=t,this.availableImages=s,this.loadVectorData=h||l0,this.loading={},this.loaded={},this.deduped=new el(a.scheduler),this.isSpriteLoaded=l,this.scheduler=a.scheduler}loadTile(a,t){const s=a.uid,l=a&&a.request,h=l&&l.collectResourceTiming,p=this.loading[s]=new Mg(a);p.abort=this.loadVectorData(a,(g,v)=>{const E=!this.loading[s];if(delete this.loading[s],E||g||!v)return p.status="done",E||(this.loaded[s]=p),t(g);const k=v.rawData,M={};v.expires&&(M.expires=v.expires),v.cacheControl&&(M.cacheControl=v.cacheControl),p.vectorTile=v.vectorTile||new Bl.VectorTile(new Rh(k));const D=()=>{p.parse(p.vectorTile,this.layerIndex,this.availableImages,this.actor,(R,z)=>{if(R||!z)return t(R);const q={};if(h){const K=Bp(l);K.length>0&&(q.resourceTiming=JSON.parse(JSON.stringify(K)))}t(null,Gi({rawTileData:k.slice(0)},z,M,q))})};this.isSpriteLoaded?D():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(D,{type:"parseTile",isSymbolTile:a.isSymbolTile,zoom:a.tileZoom}):D()}),this.loaded=this.loaded||{},this.loaded[s]=p})}reloadTile(a,t){const s=this.loaded,l=a.uid,h=this;if(s&&s[l]){const p=s[l];p.showCollisionBoxes=a.showCollisionBoxes,p.enableTerrain=!!a.enableTerrain,p.projection=a.projection,p.tileTransform=Vc(a.tileID.canonical,a.projection);const g=(v,E)=>{const k=p.reloadCallback;k&&(delete p.reloadCallback,p.parse(p.vectorTile,h.layerIndex,this.availableImages,h.actor,k)),t(v,E)};"parsing"===p.status?p.reloadCallback=g:"done"===p.status&&(p.vectorTile?p.parse(p.vectorTile,this.layerIndex,this.availableImages,this.actor,g):g())}}abortTile(a,t){const s=a.uid,l=this.loading[s];l&&(l.abort&&l.abort(),delete this.loading[s]),t()}removeTile(a,t){const s=this.loaded,l=a.uid;s&&s[l]&&delete s[l],t()}},f.WritingMode=Ta,f.ZoomHistory=kl,f.add=Ko,f.addDynamicAttributes=Wd,f.adjoint=function(a,t){var s=t[0],l=t[1],h=t[2],p=t[3],g=t[4],v=t[5],E=t[6],k=t[7],M=t[8];return a[0]=g*M-v*k,a[1]=h*k-l*M,a[2]=l*v-h*g,a[3]=v*E-p*M,a[4]=s*M-h*E,a[5]=h*p-s*v,a[6]=p*k-g*E,a[7]=l*E-s*k,a[8]=s*g-l*p,a},f.asyncAll=rl,f.bezier=po,f.bindAll=nl,f.boundsAttributes=Yp,f.bufferConvexPolygon=function(a,t){const s=[];for(let l=0;l<a.length;l++){const h=Ma(l-1,-1,a.length-1),p=Ma(l+1,-1,a.length-1),g=a[l],v=a[p],E=a[h].sub(g).unit(),k=v.sub(g).unit(),M=k.angleWithSep(E.x,E.y),D=E.add(k).unit().mult(-1*t/Math.sin(M/2));s.push(g.add(D))}return s},f.cacheEntryPossiblyAdded=function(a){hl++,hl>To&&(a.getActor().send("enforceCacheSizeLimit",Vs),hl=0)},f.calculateGlobeLabelMatrix=function(a,t){const{lng:s,lat:l}=a._center,h=Vp(0,0,a.worldSize/a._projectionScaler,s,l);return If(h,h,function(p){const g=ws(new Float64Array(16)),v=1/t0(p);return Lc(g,g,p.min),bs(g,g,[v,v,v]),g}(Zh(t)))},f.calculateGlobeMatrix=jp,f.calculateGlobeMercatorMatrix=function(a){const t=a.worldSize,s=a.point,l=Wr(1,a.center.lat)*t,h=a.pixelsPerMeter,p=t/(l/a.pixelsPerMeter),g=ws(new Float64Array(16));return Lc(g,g,[s.x,s.y,0]),bs(g,g,[p,p,h]),Float32Array.from(g)},f.circumferenceAtLatitude=Dc,f.clamp=wr,f.clearTileCache=function(a){const t=Zt.caches.delete(iu);a&&t.catch(a).then(()=>a())},f.clipLine=Cp,f.clone=function(a){var t=new va(16);return t[0]=a[0],t[1]=a[1],t[2]=a[2],t[3]=a[3],t[4]=a[4],t[5]=a[5],t[6]=a[6],t[7]=a[7],t[8]=a[8],t[9]=a[9],t[10]=a[10],t[11]=a[11],t[12]=a[12],t[13]=a[13],t[14]=a[14],t[15]=a[15],t},f.clone$1=ma,f.collisionCircleLayout=u_,f.config=Br,f.conjugate=function(a,t){return a[0]=-t[0],a[1]=-t[1],a[2]=-t[2],a[3]=t[3],a},f.create=function(){var a=new va(16);return va!=Float32Array&&(a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[11]=0,a[12]=0,a[13]=0,a[14]=0),a[0]=1,a[5]=1,a[10]=1,a[15]=1,a},f.create$1=P0,f.createExpression=Di,f.createLayout=se,f.createStyleLayer=function(a){return"custom"===a.type?new L_(a):new O_[a.type](a)},f.cross=Ed,f.degToRad=Pr,f.div=function(a,t,s){return a[0]=t[0]/s[0],a[1]=t[1]/s[1],a[2]=t[2]/s[2],a},f.dot=bh,f.earthRadius=_d,f.ease=Ia,f.easeCubicInOut=fo,f.emitValidationErrors=uh,f.endsWith=Fa,f.enforceCacheSizeLimit=function(a){ul(),Oa&&Oa.then(t=>{t.keys().then(s=>{for(let l=0;l<s.length-a;l++)t.delete(s[l])})})},f.evaluateSizeForFeature=Uf,f.evaluateSizeForZoom=zu,f.evaluateVariableOffset=Dp,f.evented=Ys,f.exactEquals=function(a,t){return a[0]===t[0]&&a[1]===t[1]&&a[2]===t[2]&&a[3]===t[3]},f.exactEquals$1=function(a,t){return a[0]===t[0]&&a[1]===t[1]&&a[2]===t[2]},f.exported=$n,f.exported$1=Ns,f.extend=Gi,f.extend$1=Nr,f.filterObject=rc,f.fromMat4=function(a,t){return a[0]=t[0],a[1]=t[1],a[2]=t[2],a[3]=t[4],a[4]=t[5],a[5]=t[6],a[6]=t[8],a[7]=t[9],a[8]=t[10],a},f.fromQuat=function(a,t){var s=t[0],l=t[1],h=t[2],p=t[3],g=s+s,v=l+l,E=h+h,k=s*g,M=l*g,D=l*v,R=h*g,z=h*v,q=h*E,K=p*g,ee=p*v,ne=p*E;return a[0]=1-D-q,a[1]=M+ne,a[2]=R-ee,a[3]=0,a[4]=M-ne,a[5]=1-k-q,a[6]=z+K,a[7]=0,a[8]=R+ee,a[9]=z-K,a[10]=1-k-D,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a},f.fromRotation=function(a,t){var s=Math.sin(t),l=Math.cos(t);return a[0]=l,a[1]=s,a[2]=0,a[3]=-s,a[4]=l,a[5]=0,a[6]=0,a[7]=0,a[8]=1,a},f.fromScaling=function(a,t){return a[0]=t[0],a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=t[1],a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=t[2],a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a},f.furthestTileCorner=function(a){const t=Math.round((a+45+360)%360/90)%4;return ho[t]},f.getAABBPointSquareDist=function(a,t,s){let l=0;for(let h=0;h<2;++h){const p=s?s[h]:0;a[h]>p&&(l+=(a[h]-p)*(a[h]-p)),t[h]<p&&(l+=(p-t[h])*(p-t[h]))}return l},f.getAnchorAlignment=Vd,f.getAnchorJustification=Pp,f.getBounds=function(a){let t=1/0,s=1/0,l=-1/0,h=-1/0;for(const p of a)t=Math.min(t,p.x),s=Math.min(s,p.y),l=Math.max(l,p.x),h=Math.max(h,p.y);return{min:new ut(t,s),max:new ut(l,h)}},f.getColumn=function(a,t){return[a[4*t],a[4*t+1],a[4*t+2],a[4*t+3]]},f.getGridMatrix=function(a,t){const[s,l]=t,h=.015625;return[0,(l[1]-s[1])*h,1<<a.z,(l[0]-s[0])*h,0,a.y,s[0],s[1],h]},f.getImage=kt,f.getJSON=function(a,t){return re(Gi(a,{type:"json"}),t)},f.getMapSessionAPI=ru,f.getPerformanceMeasurement=Bp,f.getProjection=function(a){const t=a.parallels,s=!!t&&Math.abs(t[0]+t[1])<.01;switch(a.name){case"mercator":return new lm(a);case"equirectangular":return new J_(a);case"naturalEarth":return new Q_(a);case"equalEarth":return new K_(a);case"winkelTripel":return new eg(a);case"albers":return s?new fm(a):new Y_(a);case"lambertConformalConic":return s?new fm(a):new cm(a)}throw new Error(`Invalid projection name: ${a.name}`)},f.getRTLTextPluginStatus=xa,f.getReferrer=G,f.getTilePoint=function(a,{x:t,y:s},l=0){return new ut(((t-l)*a.scale-a.x)*hr,(s*a.scale-a.y)*hr)},f.getTileVec3=function(a,t,s=0){return Fu(((t.x-s)*a.scale-a.x)*hr,(t.y*a.scale-a.y)*hr,E0(t.z,t.y))},f.getVideo=function(a,t){const s=Zt.document.createElement("video");s.muted=!0,s.onloadstart=function(){t(null,s)};for(let l=0;l<a.length;l++){const h=Zt.document.createElement("source");Re(a[l])||(s.crossOrigin="Anonymous"),h.src=a[l],s.appendChild(h)}return{cancel:()=>{}}},f.globeECEFOrigin=function(a,t){const s=[0,0,0];return Ts(s,s,Zp(Zh(t.canonical))),Ts(s,s,a),s},f.globePixelsToTileUnits=function(a,t){return hr/(512*Math.pow(2,a))*t0(Zh(t))},f.globePoleMatrixForTile=function(a,t,s){const l=ws(new Float64Array(16)),h=1<<a,p=360*(t/h-.5),g=s.point,v=s.worldSize/(s.tileSize*h);return Lc(l,l,[g.x,g.y,-s.worldSize/Math.PI/2]),bs(l,l,[v,v,v]),Mf(l,l,Pr(-s._center.lat)),Ff(l,l,Pr(-s._center.lng+p)),Float32Array.from(l)},f.globeTileLatLngCorners=Qd,f.globeToMercatorTransition=function(a){return Ql(5,6,a)},f.identity=ws,f.identity$1=N0,f.invert=function(a,t){var s=t[0],l=t[1],h=t[2],p=t[3],g=t[4],v=t[5],E=t[6],k=t[7],M=t[8],D=t[9],R=t[10],z=t[11],q=t[12],K=t[13],ee=t[14],ne=t[15],ve=s*v-l*g,Ae=s*E-h*g,Me=s*k-p*g,De=l*E-h*v,Pe=l*k-p*v,Xe=h*k-p*E,He=M*K-D*q,st=M*ee-R*q,ht=M*ne-z*q,$e=D*ee-R*K,rt=D*ne-z*K,pt=R*ne-z*ee,vt=ve*pt-Ae*rt+Me*$e+De*ht-Pe*st+Xe*He;return vt?(a[0]=(v*pt-E*rt+k*$e)*(vt=1/vt),a[1]=(h*rt-l*pt-p*$e)*vt,a[2]=(K*Xe-ee*Pe+ne*De)*vt,a[3]=(R*Pe-D*Xe-z*De)*vt,a[4]=(E*ht-g*pt-k*st)*vt,a[5]=(s*pt-h*ht+p*st)*vt,a[6]=(ee*Me-q*Xe-ne*Ae)*vt,a[7]=(M*Xe-R*Me+z*Ae)*vt,a[8]=(g*rt-v*ht+k*He)*vt,a[9]=(l*ht-s*rt-p*He)*vt,a[10]=(q*Pe-K*Me+ne*ve)*vt,a[11]=(D*Me-M*Pe-z*ve)*vt,a[12]=(v*st-g*$e-E*He)*vt,a[13]=(s*$e-l*st+h*He)*vt,a[14]=(K*Ae-q*De-ee*ve)*vt,a[15]=(M*De-D*Ae+R*ve)*vt,a):null},f.isMapAuthenticated=function(a){return bo.has(a)},f.isMapboxURL=Pa,f.isSafariWithAntialiasingBug=function(a){const t=a.navigator?a.navigator.userAgent:null;return!!kn(a)&&t&&(t.match("Version/15.4")||t.match("Version/15.5")||t.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/))},f.latFromMercatorY=En,f.len=Rc,f.length=Td,f.length$1=function(a){return Math.hypot(a[0],a[1],a[2],a[3])},f.loadVectorTile=l0,f.makeRequest=re,f.mercatorXfromLng=Yo,f.mercatorYfromLat=gs,f.mercatorZfromAltitude=Wr,f.mul=L0,f.mul$1=Eh,f.multiply=function(a,t,s){var l=t[0],h=t[1],p=t[2],g=t[3],v=t[4],E=t[5],k=t[6],M=t[7],D=t[8],R=s[0],z=s[1],q=s[2],K=s[3],ee=s[4],ne=s[5],ve=s[6],Ae=s[7],Me=s[8];return a[0]=R*l+z*g+q*k,a[1]=R*h+z*v+q*M,a[2]=R*p+z*E+q*D,a[3]=K*l+ee*g+ne*k,a[4]=K*h+ee*v+ne*M,a[5]=K*p+ee*E+ne*D,a[6]=ve*l+Ae*g+Me*k,a[7]=ve*h+Ae*v+Me*M,a[8]=ve*p+Ae*E+Me*D,a},f.multiply$1=If,f.multiply$2=O0,f.nextPowerOfTwo=Jc,f.normalize=Du,f.normalize$1=function(a,t){var s=t[0],l=t[1],h=t[2],p=t[3],g=s*s+l*l+h*h+p*p;return g>0&&(g=1/Math.sqrt(g)),a[0]=s*g,a[1]=l*g,a[2]=h*g,a[3]=p*g,a},f.number=Qt,f.ortho=function(a,t,s,l,h,p,g){var v=1/(t-s),E=1/(l-h),k=1/(p-g);return a[0]=-2*v,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=-2*E,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=2*k,a[11]=0,a[12]=(t+s)*v,a[13]=(h+l)*E,a[14]=(g+p)*k,a[15]=1,a},f.pbf=Rh,f.perspective=function(a,t,s,l,h){var p,g=1/Math.tan(t/2);return a[0]=g/s,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=g,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[11]=-1,a[12]=0,a[13]=0,a[15]=0,null!=h&&h!==1/0?(a[10]=(h+l)*(p=1/(l-h)),a[14]=2*h*l*p):(a[10]=-1,a[14]=-2*l),a},f.pick=function(a,t){const s={};for(let l=0;l<t.length;l++){const h=t[l];h in a&&(s[h]=a[h])}return s},f.plugin=ai,f.pointGeometry=ut,f.polygonIntersectsBox=kf,f.polygonIntersectsPolygon=C0,f.polygonizeBounds=function(a,t,s=0,l=!0){const h=new ut(s,s),p=a.sub(h),g=t.add(h),v=[p,new ut(g.x,p.y),g,new ut(p.x,g.y)];return l&&v.push(p),v},f.posAttributes=Uh,f.postMapLoadEvent=tu,f.postTurnstileEvent=un,f.potpack=zd,f.prevPowerOfTwo=function(a){return a<=1?1:Math.pow(2,Math.floor(Math.log(a)/Math.LN2))},f.radToDeg=Gn,f.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],f.registerForPluginStateChange=function(a){return a({pluginStatus:Ln,pluginURL:bn}),Ys.on("pluginStateChange",a),a},f.removeAuthState=function(a){bo.delete(a)},f.renderColorRamp=Pu,f.rotateX=Mf,f.rotateX$1=U0,f.rotateY=Ff,f.rotateZ=function(a,t,s){var l=Math.sin(s),h=Math.cos(s),p=t[0],g=t[1],v=t[2],E=t[3],k=t[4],M=t[5],D=t[6],R=t[7];return t!==a&&(a[8]=t[8],a[9]=t[9],a[10]=t[10],a[11]=t[11],a[12]=t[12],a[13]=t[13],a[14]=t[14],a[15]=t[15]),a[0]=p*h+k*l,a[1]=g*h+M*l,a[2]=v*h+D*l,a[3]=E*h+R*l,a[4]=k*h-p*l,a[5]=M*h-g*l,a[6]=D*h-v*l,a[7]=R*h-E*l,a},f.rotateZ$1=function(a,t,s){s*=.5;var l=t[0],h=t[1],p=t[2],g=t[3],v=Math.sin(s),E=Math.cos(s);return a[0]=l*E+h*v,a[1]=h*E-l*v,a[2]=p*E+g*v,a[3]=g*E-p*v,a},f.scale=bs,f.scale$1=function(a,t,s){return a[0]=t[0]*s,a[1]=t[1]*s,a[2]=t[2]*s,a[3]=t[3]*s,a},f.scale$2=Li,f.scaleAndAdd=wa,f.setCacheLimits=function(a,t){Vs=a,To=t},f.setColumn=function(a,t,s){a[4*t+0]=s[0],a[4*t+1]=s[1],a[4*t+2]=s[2],a[4*t+3]=s[3]},f.setRTLTextPlugin=function(a,t,s=!1){if(Ln===Cu||Ln===qo||Ln===Iu)throw new Error("setRTLTextPlugin cannot be called multiple times.");bn=$n.resolveURL(a),Ln=Cu,Ic=t,Hs(),s||Pl()},f.smoothstep=Ql,f.spec=Ze,f.storeAuthState=function(a,t){t?bo.add(a):bo.delete(a)},f.sub=ts,f.subtract=R0,f.symbolSize=h_,f.tileAABB=function(a,t,s,l,h,p,g,v,E){if("globe"===E.name)return function G_(a,t,s){const l=t/a.worldSize,h=(rt,pt)=>{Li(rt,rt,l),Li(pt,pt,l)},p=Number.MAX_VALUE,g=[-p,-p,-p],v=[p,p,p],E=jp(a);if(s.z<=1){const rt=Zh(s).getCorners();for(let pt=0;pt<rt.length;pt++)Ts(rt[pt],rt[pt],E),Ui(v,v,rt[pt]),Nn(g,g,rt[pt]);return h(v,g),new ea(v,g)}const[k,M]=Qd(s),D=new Js;D.setSouthWest([k[1],M[0]]),D.setNorthEast([M[1],k[0]]);const R=[As(D.getSouth(),D.getWest()),As(D.getSouth(),D.getEast()),As(D.getNorth(),D.getEast()),As(D.getNorth(),D.getWest())];for(let rt=0;rt<R.length;rt++)Ts(R[rt],R[rt],E),Ui(v,v,R[rt]),Nn(g,g,R[rt]);if(D.contains(a.center))return g[2]=0,h(v,g),new ea(v,g);const z=[E[12],E[13],E[14]],q=a.center.lng,K=wr(a.center.lat,-85.051129,xs),ee=[Yo(q),gs(K)],ne=D.getCenter().lng,ve=wr(D.getCenter().lat,-85.051129,xs),Ae=[Yo(ne),gs(ve)];let Me=new Array(3),De=0;const Pe=ee[0]-Ae[0],Xe=ee[1]-Ae[1];if(Math.abs(Pe)>Math.abs(Xe))De=Pe>=0?1:3,Me=z;else{De=Xe>=0?0:2;const rt=[E[4],E[5],E[6]];let pt;pt=Xe>=0?-Math.sin(Pr(D.getSouth()))*Vu:-Math.sin(Pr(D.getNorth()))*Vu,Me=wa(Me,z,rt,pt)}const He=R[De],st=R[(De+1)%4],ht=new q_(He,st,Me),$e=[Jd(ht,0)||He[0],Jd(ht,1)||He[1],Jd(ht,2)||He[2]];return v[2]=Math.min(He[2],st[2]),Ui(v,v,$e),Nn(g,g,$e),h(v,g),new ea(v,g)}(a,t,new Hf(s,l,h));const k=Vc({z:s,x:l,y:h},E);return new ea([(p+k.x/k.scale)*t,t*(k.y/k.scale),g],[(p+k.x2/k.scale)*t,t*(k.y2/k.scale),v])},f.tileTransform=Vc,f.transformMat3=function(a,t,s){var l=t[0],h=t[1],p=t[2];return a[0]=l*s[0]+h*s[3]+p*s[6],a[1]=l*s[1]+h*s[4]+p*s[7],a[2]=l*s[2]+h*s[5]+p*s[8],a},f.transformMat4=Ts,f.transformMat4$1=Oc,f.transformQuat=z0,f.translate=Lc,f.transpose=function(a,t){if(a===t){var s=t[1],l=t[2],h=t[5];a[1]=t[3],a[2]=t[6],a[3]=s,a[5]=t[7],a[6]=l,a[7]=h}else a[0]=t[0],a[1]=t[3],a[2]=t[6],a[3]=t[1],a[4]=t[4],a[5]=t[7],a[6]=t[2],a[7]=t[5],a[8]=t[8];return a},f.triggerPluginCompletionEvent=Go,f.uniqueId=il,f.validateCustomStyleLayer=function(a){const t=[],s=a.id;return void 0===s&&t.push({message:`layers.${s}: missing required property "id"`}),void 0===a.render&&t.push({message:`layers.${s}: missing required method "render"`}),a.renderingMode&&"2d"!==a.renderingMode&&"3d"!==a.renderingMode&&t.push({message:`layers.${s}: property "renderingMode" must be either "2d" or "3d"`}),t},f.validateFilter=a=>Ya(Ha(a)),f.validateFog=a=>Ya(Za(a)),f.validateLayer=a=>Ya(ch(a)),f.validateLight=a=>Ya(pf(a)),f.validateSource=a=>Ya(df(a)),f.validateStyle=No,f.validateTerrain=a=>Ya(gr(a)),f.values=ec,f.vectorTile=Bl,f.version=_,f.warnOnce=Rr,f.window=Zt,f.wrap=Ma}),ti(0,function(f){function _(ae){if("number"==typeof ae||"boolean"==typeof ae||"string"==typeof ae||null==ae)return JSON.stringify(ae);if(Array.isArray(ae)){let G="[";for(const re of ae)G+=`${_(re)},`;return`${G}]`}let Z="{";for(const G of Object.keys(ae).sort())Z+=`${G}:${_(ae[G])},`;return`${Z}}`}function Ls(ae){let Z="";for(const G of f.refProperties)Z+=`/${_(ae[G])}`;return Z}class sa{constructor(Z){this.keyCache={},Z&&this.replace(Z)}replace(Z){this._layerConfigs={},this._layers={},this.update(Z,[])}update(Z,G){for(const pe of Z)this._layerConfigs[pe.id]=pe,(this._layers[pe.id]=f.createStyleLayer(pe)).compileFilter(),this.keyCache[pe.id]&&delete this.keyCache[pe.id];for(const pe of G)delete this.keyCache[pe],delete this._layerConfigs[pe],delete this._layers[pe];this.familiesBySource={};const re=function(pe,Ee){const Oe={};for(let Ce=0;Ce<pe.length;Ce++){const Ne=Ee&&Ee[pe[Ce].id]||Ls(pe[Ce]);Ee&&(Ee[pe[Ce].id]=Ne);let lt=Oe[Ne];lt||(lt=Oe[Ne]=[]),lt.push(pe[Ce])}const Re=[];for(const Ce in Oe)Re.push(Oe[Ce]);return Re}(f.values(this._layerConfigs),this.keyCache);for(const pe of re){const Ee=pe.map(kt=>this._layers[kt.id]),Oe=Ee[0];if("none"===Oe.visibility)continue;const Re=Oe.source||"";let Ce=this.familiesBySource[Re];Ce||(Ce=this.familiesBySource[Re]={});const Ne=Oe.sourceLayer||"_geojsonTileLayer";let lt=Ce[Ne];lt||(lt=Ce[Ne]=[]),lt.push(Ee)}}}class ut{loadTile(Z,G){const{uid:re,encoding:pe,rawImageData:Ee,padding:Oe,buildQuadTree:Re}=Z,Ce=f.window.ImageBitmap&&Ee instanceof f.window.ImageBitmap?this.getImageData(Ee,Oe):Ee;G(null,new f.DEMData(re,Ce,pe,Oe<1,Re))}getImageData(Z,G){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(Z.width,Z.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d")),this.offscreenCanvas.width=Z.width,this.offscreenCanvas.height=Z.height,this.offscreenCanvasContext.drawImage(Z,0,0,Z.width,Z.height);const re=this.offscreenCanvasContext.getImageData(-G,-G,Z.width+2*G,Z.height+2*G);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),re}}var Rt=function ae(Z,G){var re,pe=Z&&Z.type;if("FeatureCollection"===pe)for(re=0;re<Z.features.length;re++)ae(Z.features[re],G);else if("GeometryCollection"===pe)for(re=0;re<Z.geometries.length;re++)ae(Z.geometries[re],G);else if("Feature"===pe)ae(Z.geometry,G);else if("Polygon"===pe)Zt(Z.coordinates,G);else if("MultiPolygon"===pe)for(re=0;re<Z.coordinates.length;re++)Zt(Z.coordinates[re],G);return Z};function Zt(ae,Z){if(0!==ae.length){Ga(ae[0],Z);for(var G=1;G<ae.length;G++)Ga(ae[G],!Z)}}function Ga(ae,Z){for(var G=0,re=0,pe=0,Ee=ae.length,Oe=Ee-1;pe<Ee;Oe=pe++){var Re=(ae[pe][0]-ae[Oe][0])*(ae[Oe][1]+ae[pe][1]),Ce=G+Re;re+=Math.abs(G)>=Math.abs(Re)?G-Ce+Re:Re-Ce+G,G=Ce}G+re>=0!=!!Z&&ae.reverse()}const ki=f.vectorTile.VectorTileFeature.prototype.toGeoJSON;class Pr{constructor(Z){this._feature=Z,this.extent=f.EXTENT,this.type=Z.type,this.properties=Z.tags,"id"in Z&&!isNaN(Z.id)&&(this.id=parseInt(Z.id,10))}loadGeometry(){if(1===this._feature.type){const Z=[];for(const G of this._feature.geometry)Z.push([new f.pointGeometry(G[0],G[1])]);return Z}{const Z=[];for(const G of this._feature.geometry){const re=[];for(const pe of G)re.push(new f.pointGeometry(pe[0],pe[1]));Z.push(re)}return Z}}toGeoJSON(Z,G,re){return ki.call(this,Z,G,re)}}class Gn{constructor(Z){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=f.EXTENT,this.length=Z.length,this._features=Z}feature(Z){return new Pr(this._features[Z])}}var ho=f.vectorTile.VectorTileFeature,fo=po;function po(ae,Z){this.options=Z||{},this.features=ae,this.length=ae.length}function Ia(ae,Z){this.id="number"==typeof ae.id?ae.id:void 0,this.type=ae.type,this.rawGeometry=1===ae.type?[ae.geometry]:ae.geometry,this.properties=ae.tags,this.extent=Z||4096}po.prototype.feature=function(ae){return new Ia(this.features[ae],this.options.extent)},Ia.prototype.loadGeometry=function(){var ae=this.rawGeometry;this.geometry=[];for(var Z=0;Z<ae.length;Z++){for(var G=ae[Z],re=[],pe=0;pe<G.length;pe++)re.push(new f.pointGeometry(G[pe][0],G[pe][1]));this.geometry.push(re)}return this.geometry},Ia.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var ae=this.geometry,Z=1/0,G=-1/0,re=1/0,pe=-1/0,Ee=0;Ee<ae.length;Ee++)for(var Oe=ae[Ee],Re=0;Re<Oe.length;Re++){var Ce=Oe[Re];Z=Math.min(Z,Ce.x),G=Math.max(G,Ce.x),re=Math.min(re,Ce.y),pe=Math.max(pe,Ce.y)}return[Z,re,G,pe]},Ia.prototype.toGeoJSON=ho.prototype.toGeoJSON;var wr=Ma,Ql=fo;function Ma(ae){var Z=new f.pbf;return function(G,re){for(var pe in G.layers)re.writeMessage(3,rl,G.layers[pe])}(ae,Z),Z.finish()}function rl(ae,Z){var G;Z.writeVarintField(15,ae.version||1),Z.writeStringField(1,ae.name||""),Z.writeVarintField(5,ae.extent||4096);var re={keys:[],values:[],keycache:{},valuecache:{}};for(G=0;G<ae.length;G++)re.feature=ae.feature(G),Z.writeMessage(2,ec,re);var pe=re.keys;for(G=0;G<pe.length;G++)Z.writeStringField(3,pe[G]);var Ee=re.values;for(G=0;G<Ee.length;G++)Z.writeMessage(4,Jc,Ee[G])}function ec(ae,Z){var G=ae.feature;void 0!==G.id&&Z.writeVarintField(1,G.id),Z.writeMessage(2,Gi,ae),Z.writeVarintField(3,G.type),Z.writeMessage(4,Kc,G)}function Gi(ae,Z){var G=ae.feature,re=ae.keys,pe=ae.values,Ee=ae.keycache,Oe=ae.valuecache;for(var Re in G.properties){var Ce=G.properties[Re],Ne=Ee[Re];if(null!==Ce){void 0===Ne&&(re.push(Re),Ee[Re]=Ne=re.length-1),Z.writeVarint(Ne);var lt=typeof Ce;"string"!==lt&&"boolean"!==lt&&"number"!==lt&&(Ce=JSON.stringify(Ce));var kt=lt+":"+Ce,mt=Oe[kt];void 0===mt&&(pe.push(Ce),Oe[kt]=mt=pe.length-1),Z.writeVarint(mt)}}}function tc(ae,Z){return(Z<<3)+(7&ae)}function il(ae){return ae<<1^ae>>31}function Kc(ae,Z){for(var G=ae.loadGeometry(),re=ae.type,pe=0,Ee=0,Oe=G.length,Re=0;Re<Oe;Re++){var Ce=G[Re],Ne=1;1===re&&(Ne=Ce.length),Z.writeVarint(tc(1,Ne));for(var lt=3===re?Ce.length-1:Ce.length,kt=0;kt<lt;kt++){1===kt&&1!==re&&Z.writeVarint(tc(2,lt-1));var mt=Ce[kt].x-pe,tr=Ce[kt].y-Ee;Z.writeVarint(il(mt)),Z.writeVarint(il(tr)),pe+=mt,Ee+=tr}3===re&&Z.writeVarint(tc(7,1))}}function Jc(ae,Z){var G=typeof ae;"string"===G?Z.writeStringField(1,ae):"boolean"===G?Z.writeBooleanField(7,ae):"number"===G&&(ae%1!=0?Z.writeDoubleField(3,ae):ae<0?Z.writeSVarintField(6,ae):Z.writeVarintField(5,ae))}function mo(ae,Z,G,re,pe,Ee){if(pe-re<=G)return;const Oe=re+pe>>1;nl(ae,Z,Oe,re,pe,Ee%2),mo(ae,Z,G,re,Oe-1,Ee+1),mo(ae,Z,G,Oe+1,pe,Ee+1)}function nl(ae,Z,G,re,pe,Ee){for(;pe>re;){if(pe-re>600){const Ne=pe-re+1,lt=G-re+1,kt=Math.log(Ne),mt=.5*Math.exp(2*kt/3),tr=.5*Math.sqrt(kt*mt*(Ne-mt)/Ne)*(lt-Ne/2<0?-1:1);nl(ae,Z,G,Math.max(re,Math.floor(G-lt*mt/Ne+tr)),Math.min(pe,Math.floor(G+(Ne-lt)*mt/Ne+tr)),Ee)}const Oe=Z[2*G+Ee];let Re=re,Ce=pe;for(Fa(ae,Z,re,G),Z[2*pe+Ee]>Oe&&Fa(ae,Z,re,pe);Re<Ce;){for(Fa(ae,Z,Re,Ce),Re++,Ce--;Z[2*Re+Ee]<Oe;)Re++;for(;Z[2*Ce+Ee]>Oe;)Ce--}Z[2*re+Ee]===Oe?Fa(ae,Z,re,Ce):(Ce++,Fa(ae,Z,Ce,pe)),Ce<=G&&(re=Ce+1),G<=Ce&&(pe=Ce-1)}}function Fa(ae,Z,G,re){Rs(ae,G,re),Rs(Z,2*G,2*re),Rs(Z,2*G+1,2*re+1)}function Rs(ae,Z,G){const re=ae[Z];ae[Z]=ae[G],ae[G]=re}function rc(ae,Z,G,re){const pe=ae-G,Ee=Z-re;return pe*pe+Ee*Ee}wr.fromVectorTileJs=Ma,wr.fromGeojsonVt=function(ae,Z){Z=Z||{};var G={};for(var re in ae)G[re]=new fo(ae[re].features,Z),G[re].name=re,G[re].version=Z.version,G[re].extent=Z.extent;return Ma({layers:G})},wr.GeoJSONWrapper=Ql;const ma=ae=>ae[0],Qc=ae=>ae[1];class Rr{constructor(Z,G=ma,re=Qc,pe=64,Ee=Float64Array){this.nodeSize=pe,this.points=Z;const Oe=Z.length<65536?Uint16Array:Uint32Array,Re=this.ids=new Oe(Z.length),Ce=this.coords=new Ee(2*Z.length);for(let Ne=0;Ne<Z.length;Ne++)Re[Ne]=Ne,Ce[2*Ne]=G(Z[Ne]),Ce[2*Ne+1]=re(Z[Ne]);mo(Re,Ce,pe,0,Re.length-1,0)}range(Z,G,re,pe){return function(Ee,Oe,Re,Ce,Ne,lt,kt){const mt=[0,Ee.length-1,0],tr=[];let Yt,Kt;for(;mt.length;){const nr=mt.pop(),Ze=mt.pop(),Nr=mt.pop();if(Ze-Nr<=kt){for(let Ur=Nr;Ur<=Ze;Ur++)Yt=Oe[2*Ur],Kt=Oe[2*Ur+1],Yt>=Re&&Yt<=Ne&&Kt>=Ce&&Kt<=lt&&tr.push(Ee[Ur]);continue}const Vt=Math.floor((Nr+Ze)/2);Yt=Oe[2*Vt],Kt=Oe[2*Vt+1],Yt>=Re&&Yt<=Ne&&Kt>=Ce&&Kt<=lt&&tr.push(Ee[Vt]);const Or=(nr+1)%2;(0===nr?Re<=Yt:Ce<=Kt)&&(mt.push(Nr),mt.push(Vt-1),mt.push(Or)),(0===nr?Ne>=Yt:lt>=Kt)&&(mt.push(Vt+1),mt.push(Ze),mt.push(Or))}return tr}(this.ids,this.coords,Z,G,re,pe,this.nodeSize)}within(Z,G,re){return function(pe,Ee,Oe,Re,Ce,Ne){const lt=[0,pe.length-1,0],kt=[],mt=Ce*Ce;for(;lt.length;){const tr=lt.pop(),Yt=lt.pop(),Kt=lt.pop();if(Yt-Kt<=Ne){for(let Or=Kt;Or<=Yt;Or++)rc(Ee[2*Or],Ee[2*Or+1],Oe,Re)<=mt&&kt.push(pe[Or]);continue}const nr=Math.floor((Kt+Yt)/2),Ze=Ee[2*nr],Nr=Ee[2*nr+1];rc(Ze,Nr,Oe,Re)<=mt&&kt.push(pe[nr]);const Vt=(tr+1)%2;(0===tr?Oe-Ce<=Ze:Re-Ce<=Nr)&&(lt.push(Kt),lt.push(nr-1),lt.push(Vt)),(0===tr?Oe+Ce>=Ze:Re+Ce>=Nr)&&(lt.push(nr+1),lt.push(Yt),lt.push(Vt))}return kt}(this.ids,this.coords,Z,G,re,this.nodeSize)}}const cn={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:ae=>ae},Os=Math.fround||(Da=new Float32Array(1),ae=>(Da[0]=+ae,Da[0]));var Da;class al{constructor(Z){this.options=$n(Object.create(cn),Z),this.trees=new Array(this.options.maxZoom+1)}load(Z){const{log:G,minZoom:re,maxZoom:pe,nodeSize:Ee}=this.options;G&&console.time("total time");const Oe=`prepare ${Z.length} points`;G&&console.time(Oe),this.points=Z;let Re=[];for(let Ce=0;Ce<Z.length;Ce++)Z[Ce].geometry&&Re.push(ic(Z[Ce],Ce));this.trees[pe+1]=new Rr(Re,_o,Br,Ee,Float32Array),G&&console.timeEnd(Oe);for(let Ce=pe;Ce>=re;Ce--){const Ne=+Date.now();Re=this._cluster(Re,Ce),this.trees[Ce]=new Rr(Re,_o,Br,Ee,Float32Array),G&&console.log("z%d: %d clusters in %dms",Ce,Re.length,+Date.now()-Ne)}return G&&console.timeEnd("total time"),this}getClusters(Z,G){let re=((Z[0]+180)%360+360)%360-180;const pe=Math.max(-90,Math.min(90,Z[1]));let Ee=180===Z[2]?180:((Z[2]+180)%360+360)%360-180;const Oe=Math.max(-90,Math.min(90,Z[3]));if(Z[2]-Z[0]>=360)re=-180,Ee=180;else if(re>Ee){const lt=this.getClusters([re,pe,180,Oe],G),kt=this.getClusters([-180,pe,Ee,Oe],G);return lt.concat(kt)}const Re=this.trees[this._limitZoom(G)],Ce=Re.range(Tr(re),kn(Oe),Tr(Ee),kn(pe)),Ne=[];for(const lt of Ce){const kt=Re.points[lt];Ne.push(kt.numPoints?Bs(kt):this.points[kt.index])}return Ne}getChildren(Z){const G=this._getOriginId(Z),re=this._getOriginZoom(Z),pe="No cluster with the specified id.",Ee=this.trees[re];if(!Ee)throw new Error(pe);const Oe=Ee.points[G];if(!Oe)throw new Error(pe);const Re=this.options.radius/(this.options.extent*Math.pow(2,re-1)),Ce=Ee.within(Oe.x,Oe.y,Re),Ne=[];for(const lt of Ce){const kt=Ee.points[lt];kt.parentId===Z&&Ne.push(kt.numPoints?Bs(kt):this.points[kt.index])}if(0===Ne.length)throw new Error(pe);return Ne}getLeaves(Z,G,re){const pe=[];return this._appendLeaves(pe,Z,G=G||10,re=re||0,0),pe}getTile(Z,G,re){const pe=this.trees[this._limitZoom(Z)],Ee=Math.pow(2,Z),{extent:Oe,radius:Re}=this.options,Ce=Re/Oe,Ne=(re-Ce)/Ee,lt=(re+1+Ce)/Ee,kt={features:[]};return this._addTileFeatures(pe.range((G-Ce)/Ee,Ne,(G+1+Ce)/Ee,lt),pe.points,G,re,Ee,kt),0===G&&this._addTileFeatures(pe.range(1-Ce/Ee,Ne,1,lt),pe.points,Ee,re,Ee,kt),G===Ee-1&&this._addTileFeatures(pe.range(0,Ne,Ce/Ee,lt),pe.points,-1,re,Ee,kt),kt.features.length?kt:null}getClusterExpansionZoom(Z){let G=this._getOriginZoom(Z)-1;for(;G<=this.options.maxZoom;){const re=this.getChildren(Z);if(G++,1!==re.length)break;Z=re[0].properties.cluster_id}return G}_appendLeaves(Z,G,re,pe,Ee){const Oe=this.getChildren(G);for(const Re of Oe){const Ce=Re.properties;if(Ce&&Ce.cluster?Ee+Ce.point_count<=pe?Ee+=Ce.point_count:Ee=this._appendLeaves(Z,Ce.cluster_id,re,pe,Ee):Ee<pe?Ee++:Z.push(Re),Z.length===re)break}return Ee}_addTileFeatures(Z,G,re,pe,Ee,Oe){for(const Re of Z){const Ce=G[Re],Ne=Ce.numPoints;let lt,kt,mt;if(Ne)lt=$a(Ce),kt=Ce.x,mt=Ce.y;else{const Kt=this.points[Ce.index];lt=Kt.properties,kt=Tr(Kt.geometry.coordinates[0]),mt=kn(Kt.geometry.coordinates[1])}const tr={type:1,geometry:[[Math.round(this.options.extent*(kt*Ee-re)),Math.round(this.options.extent*(mt*Ee-pe))]],tags:lt};let Yt;Ne?Yt=Ce.id:this.options.generateId?Yt=Ce.index:this.points[Ce.index].id&&(Yt=this.points[Ce.index].id),void 0!==Yt&&(tr.id=Yt),Oe.features.push(tr)}}_limitZoom(Z){return Math.max(this.options.minZoom,Math.min(+Z,this.options.maxZoom+1))}_cluster(Z,G){const re=[],{radius:pe,extent:Ee,reduce:Oe,minPoints:Re}=this.options,Ce=pe/(Ee*Math.pow(2,G));for(let Ne=0;Ne<Z.length;Ne++){const lt=Z[Ne];if(lt.zoom<=G)continue;lt.zoom=G;const kt=this.trees[G+1],mt=kt.within(lt.x,lt.y,Ce),tr=lt.numPoints||1;let Yt=tr;for(const Kt of mt){const nr=kt.points[Kt];nr.zoom>G&&(Yt+=nr.numPoints||1)}if(Yt>tr&&Yt>=Re){let Kt=lt.x*tr,nr=lt.y*tr,Ze=Oe&&tr>1?this._map(lt,!0):null;const Nr=(Ne<<5)+(G+1)+this.points.length;for(const Vt of mt){const Or=kt.points[Vt];if(Or.zoom<=G)continue;Or.zoom=G;const Ur=Or.numPoints||1;Kt+=Or.x*Ur,nr+=Or.y*Ur,Or.parentId=Nr,Oe&&(Ze||(Ze=this._map(lt,!0)),Oe(Ze,this._map(Or)))}lt.parentId=Nr,re.push(zs(Kt/Yt,nr/Yt,Nr,Yt,Ze))}else if(re.push(lt),Yt>1)for(const Kt of mt){const nr=kt.points[Kt];nr.zoom<=G||(nr.zoom=G,re.push(nr))}}return re}_getOriginId(Z){return Z-this.points.length>>5}_getOriginZoom(Z){return(Z-this.points.length)%32}_map(Z,G){if(Z.numPoints)return G?$n({},Z.properties):Z.properties;const re=this.points[Z.index].properties,pe=this.options.map(re);return G&&pe===re?$n({},pe):pe}}function zs(ae,Z,G,re,pe){return{x:Os(ae),y:Os(Z),zoom:1/0,id:G,parentId:-1,numPoints:re,properties:pe}}function ic(ae,Z){const[G,re]=ae.geometry.coordinates;return{x:Os(Tr(G)),y:Os(kn(re)),zoom:1/0,index:Z,parentId:-1}}function Bs(ae){return{type:"Feature",id:ae.id,properties:$a(ae),geometry:{type:"Point",coordinates:[(Z=ae.x,360*(Z-.5)),eu(ae.y)]}};var Z}function $a(ae){const Z=ae.numPoints,G=Z>=1e4?`${Math.round(Z/1e3)}k`:Z>=1e3?Math.round(Z/100)/10+"k":Z;return $n($n({},ae.properties),{cluster:!0,cluster_id:ae.id,point_count:Z,point_count_abbreviated:G})}function Tr(ae){return ae/360+.5}function kn(ae){const Z=Math.sin(ae*Math.PI/180),G=.5-.25*Math.log((1+Z)/(1-Z))/Math.PI;return G<0?0:G>1?1:G}function eu(ae){const Z=(180-360*ae)*Math.PI/180;return 360*Math.atan(Math.exp(Z))/Math.PI-90}function $n(ae,Z){for(const G in Z)ae[G]=Z[G];return ae}function _o(ae){return ae.x}function Br(ae){return ae.y}function Ns(ae,Z,G,re){for(var pe,Ee=re,Oe=G-Z>>1,Re=G-Z,Ce=ae[Z],Ne=ae[Z+1],lt=ae[G],kt=ae[G+1],mt=Z+3;mt<G;mt+=3){var tr=go(ae[mt],ae[mt+1],Ce,Ne,lt,kt);if(tr>Ee)pe=mt,Ee=tr;else if(tr===Ee){var Yt=Math.abs(mt-Oe);Yt<Re&&(pe=mt,Re=Yt)}}Ee>re&&(pe-Z>3&&Ns(ae,Z,pe,re),ae[pe+2]=Ee,G-pe>3&&Ns(ae,pe,G,re))}function go(ae,Z,G,re,pe,Ee){var Oe=pe-G,Re=Ee-re;if(0!==Oe||0!==Re){var Ce=((ae-G)*Oe+(Z-re)*Re)/(Oe*Oe+Re*Re);Ce>1?(G=pe,re=Ee):Ce>0&&(G+=Oe*Ce,re+=Re*Ce)}return(Oe=ae-G)*Oe+(Re=Z-re)*Re}function _a(ae,Z,G,re){var pe={id:void 0===ae?null:ae,type:Z,geometry:G,tags:re,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(Ee){var Oe=Ee.geometry,Re=Ee.type;if("Point"===Re||"MultiPoint"===Re||"LineString"===Re)xo(Ee,Oe);else if("Polygon"===Re||"MultiLineString"===Re)for(var Ce=0;Ce<Oe.length;Ce++)xo(Ee,Oe[Ce]);else if("MultiPolygon"===Re)for(Ce=0;Ce<Oe.length;Ce++)for(var Ne=0;Ne<Oe[Ce].length;Ne++)xo(Ee,Oe[Ce][Ne])}(pe),pe}function xo(ae,Z){for(var G=0;G<Z.length;G+=3)ae.minX=Math.min(ae.minX,Z[G]),ae.minY=Math.min(ae.minY,Z[G+1]),ae.maxX=Math.max(ae.maxX,Z[G]),ae.maxY=Math.max(ae.maxY,Z[G+1])}function sl(ae,Z,G,re){if(Z.geometry){var pe=Z.geometry.coordinates,Ee=Z.geometry.type,Oe=Math.pow(G.tolerance/((1<<G.maxZoom)*G.extent),2),Re=[],Ce=Z.id;if(G.promoteId?Ce=Z.properties[G.promoteId]:G.generateId&&(Ce=re||0),"Point"===Ee)nc(pe,Re);else if("MultiPoint"===Ee)for(var Ne=0;Ne<pe.length;Ne++)nc(pe[Ne],Re);else if("LineString"===Ee)ol(pe,Re,Oe,!1);else if("MultiLineString"===Ee){if(G.lineMetrics){for(Ne=0;Ne<pe.length;Ne++)ol(pe[Ne],Re=[],Oe,!1),ae.push(_a(Ce,"LineString",Re,Z.properties));return}yo(pe,Re,Oe,!1)}else if("Polygon"===Ee)yo(pe,Re,Oe,!0);else{if("MultiPolygon"!==Ee){if("GeometryCollection"===Ee){for(Ne=0;Ne<Z.geometry.geometries.length;Ne++)sl(ae,{id:Ce,geometry:Z.geometry.geometries[Ne],properties:Z.properties},G,re);return}throw new Error("Input data is not a valid GeoJSON object.")}for(Ne=0;Ne<pe.length;Ne++){var lt=[];yo(pe[Ne],lt,Oe,!0),Re.push(lt)}}ae.push(_a(Ce,Ee,Re,Z.properties))}}function nc(ae,Z){Z.push(Pa(ae[0])),Z.push(vo(ae[1])),Z.push(0)}function ol(ae,Z,G,re){for(var pe,Ee,Oe=0,Re=0;Re<ae.length;Re++){var Ce=Pa(ae[Re][0]),Ne=vo(ae[Re][1]);Z.push(Ce),Z.push(Ne),Z.push(0),Re>0&&(Oe+=re?(pe*Ne-Ce*Ee)/2:Math.sqrt(Math.pow(Ce-pe,2)+Math.pow(Ne-Ee,2))),pe=Ce,Ee=Ne}var lt=Z.length-3;Z[2]=1,Ns(Z,0,lt,G),Z[lt+2]=1,Z.size=Math.abs(Oe),Z.start=0,Z.end=Z.size}function yo(ae,Z,G,re){for(var pe=0;pe<ae.length;pe++){var Ee=[];ol(ae[pe],Ee,G,re),Z.push(Ee)}}function Pa(ae){return ae/360+.5}function vo(ae){var Z=Math.sin(ae*Math.PI/180),G=.5-.25*Math.log((1+Z)/(1-Z))/Math.PI;return G<0?0:G>1?1:G}function La(ae,Z,G,re,pe,Ee,Oe,Re){if(re/=Z,Ee>=(G/=Z)&&Oe<re)return ae;if(Oe<G||Ee>=re)return null;for(var Ce=[],Ne=0;Ne<ae.length;Ne++){var lt=ae[Ne],kt=lt.geometry,mt=lt.type,tr=0===pe?lt.minX:lt.minY,Yt=0===pe?lt.maxX:lt.maxY;if(tr>=G&&Yt<re)Ce.push(lt);else if(!(Yt<G||tr>=re)){var Kt=[];if("Point"===mt||"MultiPoint"===mt)Ra(kt,Kt,G,re,pe);else if("LineString"===mt)Us(kt,Kt,G,re,pe,!1,Re.lineMetrics);else if("MultiLineString"===mt)wo(kt,Kt,G,re,pe,!1);else if("Polygon"===mt)wo(kt,Kt,G,re,pe,!0);else if("MultiPolygon"===mt)for(var nr=0;nr<kt.length;nr++){var Ze=[];wo(kt[nr],Ze,G,re,pe,!0),Ze.length&&Kt.push(Ze)}if(Kt.length){if(Re.lineMetrics&&"LineString"===mt){for(nr=0;nr<Kt.length;nr++)Ce.push(_a(lt.id,mt,Kt[nr],lt.tags));continue}"LineString"!==mt&&"MultiLineString"!==mt||(1===Kt.length?(mt="LineString",Kt=Kt[0]):mt="MultiLineString"),"Point"!==mt&&"MultiPoint"!==mt||(mt=3===Kt.length?"Point":"MultiPoint"),Ce.push(_a(lt.id,mt,Kt,lt.tags))}}}return Ce.length?Ce:null}function Ra(ae,Z,G,re,pe){for(var Ee=0;Ee<ae.length;Ee+=3){var Oe=ae[Ee+pe];Oe>=G&&Oe<=re&&(Z.push(ae[Ee]),Z.push(ae[Ee+1]),Z.push(ae[Ee+2]))}}function Us(ae,Z,G,re,pe,Ee,Oe){for(var Re,Ce,Ne=ac(ae),lt=0===pe?un:sc,kt=ae.start,mt=0;mt<ae.length-3;mt+=3){var tr=ae[mt],Yt=ae[mt+1],Kt=ae[mt+2],nr=ae[mt+3],Ze=ae[mt+4],Nr=0===pe?tr:Yt,Vt=0===pe?nr:Ze,Or=!1;Oe&&(Re=Math.sqrt(Math.pow(tr-nr,2)+Math.pow(Yt-Ze,2))),Nr<G?Vt>G&&(Ce=lt(Ne,tr,Yt,nr,Ze,G),Oe&&(Ne.start=kt+Re*Ce)):Nr>re?Vt<re&&(Ce=lt(Ne,tr,Yt,nr,Ze,re),Oe&&(Ne.start=kt+Re*Ce)):ll(Ne,tr,Yt,Kt),Vt<G&&Nr>=G&&(Ce=lt(Ne,tr,Yt,nr,Ze,G),Or=!0),Vt>re&&Nr<=re&&(Ce=lt(Ne,tr,Yt,nr,Ze,re),Or=!0),!Ee&&Or&&(Oe&&(Ne.end=kt+Re*Ce),Z.push(Ne),Ne=ac(ae)),Oe&&(kt+=Re)}var Ur=ae.length-3;tr=ae[Ur],Yt=ae[Ur+1],Kt=ae[Ur+2],(Nr=0===pe?tr:Yt)>=G&&Nr<=re&&ll(Ne,tr,Yt,Kt),Ur=Ne.length-3,Ee&&Ur>=3&&(Ne[Ur]!==Ne[0]||Ne[Ur+1]!==Ne[1])&&ll(Ne,Ne[0],Ne[1],Ne[2]),Ne.length&&Z.push(Ne)}function ac(ae){var Z=[];return Z.size=ae.size,Z.start=ae.start,Z.end=ae.end,Z}function wo(ae,Z,G,re,pe,Ee){for(var Oe=0;Oe<ae.length;Oe++)Us(ae[Oe],Z,G,re,pe,Ee,!1)}function ll(ae,Z,G,re){ae.push(Z),ae.push(G),ae.push(re)}function un(ae,Z,G,re,pe,Ee){var Oe=(Ee-Z)/(re-Z);return ae.push(Ee),ae.push(G+(pe-G)*Oe),ae.push(1),Oe}function sc(ae,Z,G,re,pe,Ee){var Oe=(Ee-G)/(pe-G);return ae.push(Z+(re-Z)*Oe),ae.push(Ee),ae.push(1),Oe}function tu(ae,Z){for(var G=[],re=0;re<ae.length;re++){var pe,Ee=ae[re],Oe=Ee.type;if("Point"===Oe||"MultiPoint"===Oe||"LineString"===Oe)pe=cl(Ee.geometry,Z);else if("MultiLineString"===Oe||"Polygon"===Oe){pe=[];for(var Re=0;Re<Ee.geometry.length;Re++)pe.push(cl(Ee.geometry[Re],Z))}else if("MultiPolygon"===Oe)for(pe=[],Re=0;Re<Ee.geometry.length;Re++){for(var Ce=[],Ne=0;Ne<Ee.geometry[Re].length;Ne++)Ce.push(cl(Ee.geometry[Re][Ne],Z));pe.push(Ce)}G.push(_a(Ee.id,Oe,pe,Ee.tags))}return G}function cl(ae,Z){var G=[];G.size=ae.size,void 0!==ae.start&&(G.start=ae.start,G.end=ae.end);for(var re=0;re<ae.length;re+=3)G.push(ae[re]+Z,ae[re+1],ae[re+2]);return G}function ru(ae,Z){if(ae.transformed)return ae;var G,re,pe,Ee=1<<ae.z,Oe=ae.x,Re=ae.y;for(G=0;G<ae.features.length;G++){var Ce=ae.features[G],Ne=Ce.geometry,lt=Ce.type;if(Ce.geometry=[],1===lt)for(re=0;re<Ne.length;re+=2)Ce.geometry.push(bo(Ne[re],Ne[re+1],Z,Ee,Oe,Re));else for(re=0;re<Ne.length;re++){var kt=[];for(pe=0;pe<Ne[re].length;pe+=2)kt.push(bo(Ne[re][pe],Ne[re][pe+1],Z,Ee,Oe,Re));Ce.geometry.push(kt)}}return ae.transformed=!0,ae}function bo(ae,Z,G,re,pe,Ee){return[Math.round(G*(ae*re-pe)),Math.round(G*(Z*re-Ee))]}function iu(ae,Z,G,re,pe){for(var Ee=Z===pe.maxZoom?0:pe.tolerance/((1<<Z)*pe.extent),Oe={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:G,y:re,z:Z,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},Re=0;Re<ae.length;Re++){Oe.numFeatures++,Oa(Oe,ae[Re],Ee,pe);var Ce=ae[Re].minX,Ne=ae[Re].minY,lt=ae[Re].maxX,kt=ae[Re].maxY;Ce<Oe.minX&&(Oe.minX=Ce),Ne<Oe.minY&&(Oe.minY=Ne),lt>Oe.maxX&&(Oe.maxX=lt),kt>Oe.maxY&&(Oe.maxY=kt)}return Oe}function Oa(ae,Z,G,re){var pe=Z.geometry,Ee=Z.type,Oe=[];if("Point"===Ee||"MultiPoint"===Ee)for(var Re=0;Re<pe.length;Re+=3)Oe.push(pe[Re]),Oe.push(pe[Re+1]),ae.numPoints++,ae.numSimplified++;else if("LineString"===Ee)Zs(Oe,pe,ae,G,!1,!1);else if("MultiLineString"===Ee||"Polygon"===Ee)for(Re=0;Re<pe.length;Re++)Zs(Oe,pe[Re],ae,G,"Polygon"===Ee,0===Re);else if("MultiPolygon"===Ee)for(var Ce=0;Ce<pe.length;Ce++){var Ne=pe[Ce];for(Re=0;Re<Ne.length;Re++)Zs(Oe,Ne[Re],ae,G,!0,0===Re)}if(Oe.length){var lt=Z.tags||null;if("LineString"===Ee&&re.lineMetrics){for(var kt in lt={},Z.tags)lt[kt]=Z.tags[kt];lt.mapbox_clip_start=pe.start/pe.size,lt.mapbox_clip_end=pe.end/pe.size}var mt={geometry:Oe,type:"Polygon"===Ee||"MultiPolygon"===Ee?3:"LineString"===Ee||"MultiLineString"===Ee?2:1,tags:lt};null!==Z.id&&(mt.id=Z.id),ae.features.push(mt)}}function Zs(ae,Z,G,re,pe,Ee){var Oe=re*re;if(re>0&&Z.size<(pe?Oe:re))G.numPoints+=Z.length/3;else{for(var Re=[],Ce=0;Ce<Z.length;Ce+=3)(0===re||Z[Ce+2]>Oe)&&(G.numSimplified++,Re.push(Z[Ce]),Re.push(Z[Ce+1])),G.numPoints++;pe&&function(Ne,lt){for(var kt=0,mt=0,tr=Ne.length,Yt=tr-2;mt<tr;Yt=mt,mt+=2)kt+=(Ne[mt]-Ne[Yt])*(Ne[mt+1]+Ne[Yt+1]);if(kt>0===lt)for(mt=0,tr=Ne.length;mt<tr/2;mt+=2){var Kt=Ne[mt],nr=Ne[mt+1];Ne[mt]=Ne[tr-2-mt],Ne[mt+1]=Ne[tr-1-mt],Ne[tr-2-mt]=Kt,Ne[tr-1-mt]=nr}}(Re,Ee),ae.push(Re)}}function Vs(ae,Z){var G=(Z=this.options=function(pe,Ee){for(var Oe in Ee)pe[Oe]=Ee[Oe];return pe}(Object.create(this.options),Z)).debug;if(G&&console.time("preprocess data"),Z.maxZoom<0||Z.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(Z.promoteId&&Z.generateId)throw new Error("promoteId and generateId cannot be used together.");var pe,Ee,Oe,Re,Ce,Ne,re=function(pe,Ee){var Oe=[];if("FeatureCollection"===pe.type)for(var Re=0;Re<pe.features.length;Re++)sl(Oe,pe.features[Re],Ee,Re);else sl(Oe,"Feature"===pe.type?pe:{geometry:pe},Ee);return Oe}(ae,Z);this.tiles={},this.tileCoords=[],G&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",Z.indexMaxZoom,Z.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),(pe=re,Ee=Z,Oe=Ee.buffer/Ee.extent,Re=pe,Ce=La(pe,1,-1-Oe,Oe,0,-1,2,Ee),Ne=La(pe,1,1-Oe,2+Oe,0,-1,2,Ee),(Ce||Ne)&&(Re=La(pe,1,-Oe,1+Oe,0,-1,2,Ee)||[],Ce&&(Re=tu(Ce,1).concat(Re)),Ne&&(Re=Re.concat(tu(Ne,-1)))),re=Re).length&&this.splitTile(re,0,0,0),G&&(re.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function To(ae,Z,G){return 32*((1<<ae)*G+Z)+ae}function ul(ae,Z){const G=ae.tileID.canonical;if(!this._geoJSONIndex)return Z(null,null);const re=this._geoJSONIndex.getTile(G.z,G.x,G.y);if(!re)return Z(null,null);const pe=new Gn(re.features);let Ee=wr(pe);0===Ee.byteOffset&&Ee.byteLength===Ee.buffer.byteLength||(Ee=new Uint8Array(Ee)),Z(null,{vectorTile:pe,rawData:Ee.buffer})}Vs.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},Vs.prototype.splitTile=function(ae,Z,G,re,pe,Ee,Oe){for(var Re=[ae,Z,G,re],Ce=this.options,Ne=Ce.debug;Re.length;){re=Re.pop(),G=Re.pop(),Z=Re.pop(),ae=Re.pop();var lt=1<<Z,kt=To(Z,G,re),mt=this.tiles[kt];if(!mt&&(Ne>1&&console.time("creation"),mt=this.tiles[kt]=iu(ae,Z,G,re,Ce),this.tileCoords.push({z:Z,x:G,y:re}),Ne)){Ne>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",Z,G,re,mt.numFeatures,mt.numPoints,mt.numSimplified),console.timeEnd("creation"));var tr="z"+Z;this.stats[tr]=(this.stats[tr]||0)+1,this.total++}if(mt.source=ae,pe){if(Z===Ce.maxZoom||Z===pe)continue;var Yt=1<<pe-Z;if(G!==Math.floor(Ee/Yt)||re!==Math.floor(Oe/Yt))continue}else if(Z===Ce.indexMaxZoom||mt.numPoints<=Ce.indexMaxPoints)continue;if(mt.source=null,0!==ae.length){Ne>1&&console.time("clipping");var Kt,nr,Ze,Nr,Vt,Or,Ur=.5*Ce.buffer/Ce.extent,Eo=.5-Ur,as=.5+Ur,Tt=1+Ur;Kt=nr=Ze=Nr=null,Vt=La(ae,lt,G-Ur,G+as,0,mt.minX,mt.maxX,Ce),Or=La(ae,lt,G+Eo,G+Tt,0,mt.minX,mt.maxX,Ce),ae=null,Vt&&(Kt=La(Vt,lt,re-Ur,re+as,1,mt.minY,mt.maxY,Ce),nr=La(Vt,lt,re+Eo,re+Tt,1,mt.minY,mt.maxY,Ce),Vt=null),Or&&(Ze=La(Or,lt,re-Ur,re+as,1,mt.minY,mt.maxY,Ce),Nr=La(Or,lt,re+Eo,re+Tt,1,mt.minY,mt.maxY,Ce),Or=null),Ne>1&&console.timeEnd("clipping"),Re.push(Kt||[],Z+1,2*G,2*re),Re.push(nr||[],Z+1,2*G,2*re+1),Re.push(Ze||[],Z+1,2*G+1,2*re),Re.push(Nr||[],Z+1,2*G+1,2*re+1)}}},Vs.prototype.getTile=function(ae,Z,G){var re=this.options,pe=re.extent,Ee=re.debug;if(ae<0||ae>24)return null;var Oe=1<<ae,Re=To(ae,Z=(Z%Oe+Oe)%Oe,G);if(this.tiles[Re])return ru(this.tiles[Re],pe);Ee>1&&console.log("drilling down to z%d-%d-%d",ae,Z,G);for(var Ce,Ne=ae,lt=Z,kt=G;!Ce&&Ne>0;)Ne--,lt=Math.floor(lt/2),kt=Math.floor(kt/2),Ce=this.tiles[To(Ne,lt,kt)];return Ce&&Ce.source?(Ee>1&&console.log("found parent tile z%d-%d-%d",Ne,lt,kt),Ee>1&&console.time("drilling down"),this.splitTile(Ce.source,Ne,lt,kt,ae,Z,G),Ee>1&&console.timeEnd("drilling down"),this.tiles[Re]?ru(this.tiles[Re],pe):null):null};class oc extends f.VectorTileWorkerSource{constructor(Z,G,re,pe,Ee){super(Z,G,re,pe,ul),Ee&&(this.loadGeoJSON=Ee)}loadData(Z,G){const re=Z&&Z.request,pe=re&&re.collectResourceTiming;this.loadGeoJSON(Z,(Ee,Oe)=>{if(Ee||!Oe)return G(Ee);if("object"!=typeof Oe)return G(new Error(`Input data given to '${Z.source}' is not a valid GeoJSON object.`));{Rt(Oe,!0);try{if(Z.filter){const Ce=f.createExpression(Z.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if("error"===Ce.result)throw new Error(Ce.value.map(lt=>`${lt.key}: ${lt.message}`).join(", "));const Ne=Oe.features.filter(lt=>Ce.value.evaluate({zoom:0},lt));Oe={type:"FeatureCollection",features:Ne}}this._geoJSONIndex=Z.cluster?new al(function({superclusterOptions:Ce,clusterProperties:Ne}){if(!Ne||!Ce)return Ce;const lt={},kt={},mt={accumulated:null,zoom:0},tr={properties:null},Yt=Object.keys(Ne);for(const Kt of Yt){const[nr,Ze]=Ne[Kt],Nr=f.createExpression(Ze),Vt=f.createExpression("string"==typeof nr?[nr,["accumulated"],["get",Kt]]:nr);lt[Kt]=Nr.value,kt[Kt]=Vt.value}return Ce.map=Kt=>{tr.properties=Kt;const nr={};for(const Ze of Yt)nr[Ze]=lt[Ze].evaluate(mt,tr);return nr},Ce.reduce=(Kt,nr)=>{tr.properties=nr;for(const Ze of Yt)mt.accumulated=Kt[Ze],Kt[Ze]=kt[Ze].evaluate(mt,tr)},Ce}(Z)).load(Oe.features):new Vs(Ce=Oe,Z.geojsonVtOptions)}catch(Ce){return G(Ce)}this.loaded={};const Re={};if(pe){const Ce=f.getPerformanceMeasurement(re);Ce&&(Re.resourceTiming={},Re.resourceTiming[Z.source]=JSON.parse(JSON.stringify(Ce)))}G(null,Re)}var Ce})}reloadTile(Z,G){const re=this.loaded;return re&&re[Z.uid]?super.reloadTile(Z,G):this.loadTile(Z,G)}loadGeoJSON(Z,G){if(Z.request)f.getJSON(Z.request,G);else{if("string"!=typeof Z.data)return G(new Error(`Input data given to '${Z.source}' is not a valid GeoJSON object.`));try{return G(null,JSON.parse(Z.data))}catch(re){return G(new Error(`Input data given to '${Z.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(Z,G){try{G(null,this._geoJSONIndex.getClusterExpansionZoom(Z.clusterId))}catch(re){G(re)}}getClusterChildren(Z,G){try{G(null,this._geoJSONIndex.getChildren(Z.clusterId))}catch(re){G(re)}}getClusterLeaves(Z,G){try{G(null,this._geoJSONIndex.getLeaves(Z.clusterId,Z.limit,Z.offset))}catch(re){G(re)}}}class hl{constructor(Z){this.self=Z,this.actor=new f.Actor(Z,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.projections={},this.defaultProjection=f.getProjection({name:"mercator"}),this.workerSourceTypes={vector:f.VectorTileWorkerSource,geojson:oc},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(G,re)=>{if(this.workerSourceTypes[G])throw new Error(`Worker source with name "${G}" already registered.`);this.workerSourceTypes[G]=re},this.self.registerRTLTextPlugin=G=>{if(f.plugin.isParsed())throw new Error("RTL text plugin already registered.");f.plugin.applyArabicShaping=G.applyArabicShaping,f.plugin.processBidirectionalText=G.processBidirectionalText,f.plugin.processStyledBidirectionalText=G.processStyledBidirectionalText}}clearCaches(Z,G,re){delete this.layerIndexes[Z],delete this.availableImages[Z],delete this.workerSources[Z],delete this.demWorkerSources[Z],re()}checkIfReady(Z,G,re){re()}setReferrer(Z,G){this.referrer=G}spriteLoaded(Z,G){this.isSpriteLoaded[Z]=G;for(const re in this.workerSources[Z]){const pe=this.workerSources[Z][re];for(const Ee in pe)pe[Ee]instanceof f.VectorTileWorkerSource&&(pe[Ee].isSpriteLoaded=G,pe[Ee].fire(new f.Event("isSpriteLoaded")))}}setImages(Z,G,re){this.availableImages[Z]=G;for(const pe in this.workerSources[Z]){const Ee=this.workerSources[Z][pe];for(const Oe in Ee)Ee[Oe].availableImages=G}re()}enableTerrain(Z,G,re){this.terrain=G,re()}setProjection(Z,G){this.projections[Z]=f.getProjection(G)}setLayers(Z,G,re){this.getLayerIndex(Z).replace(G),re()}updateLayers(Z,G,re){this.getLayerIndex(Z).update(G.layers,G.removedIds),re()}loadTile(Z,G,re){const pe=this.enableTerrain?f.extend({enableTerrain:this.terrain},G):G;pe.projection=this.projections[Z]||this.defaultProjection,this.getWorkerSource(Z,G.type,G.source).loadTile(pe,re)}loadDEMTile(Z,G,re){const pe=this.enableTerrain?f.extend({buildQuadTree:this.terrain},G):G;this.getDEMWorkerSource(Z,G.source).loadTile(pe,re)}reloadTile(Z,G,re){const pe=this.enableTerrain?f.extend({enableTerrain:this.terrain},G):G;pe.projection=this.projections[Z]||this.defaultProjection,this.getWorkerSource(Z,G.type,G.source).reloadTile(pe,re)}abortTile(Z,G,re){this.getWorkerSource(Z,G.type,G.source).abortTile(G,re)}removeTile(Z,G,re){this.getWorkerSource(Z,G.type,G.source).removeTile(G,re)}removeSource(Z,G,re){if(!this.workerSources[Z]||!this.workerSources[Z][G.type]||!this.workerSources[Z][G.type][G.source])return;const pe=this.workerSources[Z][G.type][G.source];delete this.workerSources[Z][G.type][G.source],void 0!==pe.removeSource?pe.removeSource(G,re):re()}loadWorkerSource(Z,G,re){try{this.self.importScripts(G.url),re()}catch(pe){re(pe.toString())}}syncRTLPluginState(Z,G,re){try{f.plugin.setState(G);const pe=f.plugin.getPluginURL();if(f.plugin.isLoaded()&&!f.plugin.isParsed()&&null!=pe){this.self.importScripts(pe);const Ee=f.plugin.isParsed();re(Ee?void 0:new Error(`RTL Text Plugin failed to import scripts from ${pe}`),Ee)}}catch(pe){re(pe.toString())}}getAvailableImages(Z){let G=this.availableImages[Z];return G||(G=[]),G}getLayerIndex(Z){let G=this.layerIndexes[Z];return G||(G=this.layerIndexes[Z]=new sa),G}getWorkerSource(Z,G,re){return this.workerSources[Z]||(this.workerSources[Z]={}),this.workerSources[Z][G]||(this.workerSources[Z][G]={}),this.workerSources[Z][G][re]||(this.workerSources[Z][G][re]=new this.workerSourceTypes[G]({send:(pe,Ee,Oe,Re,Ce,Ne)=>{this.actor.send(pe,Ee,Oe,Z,Ce,Ne)},scheduler:this.actor.scheduler},this.getLayerIndex(Z),this.getAvailableImages(Z),this.isSpriteLoaded[Z])),this.workerSources[Z][G][re]}getDEMWorkerSource(Z,G){return this.demWorkerSources[Z]||(this.demWorkerSources[Z]={}),this.demWorkerSources[Z][G]||(this.demWorkerSources[Z][G]=new ut),this.demWorkerSources[Z][G]}enforceCacheSizeLimit(Z,G){f.enforceCacheSizeLimit(G)}getWorkerPerformanceMetrics(Z,G,re){re(void 0,void 0)}}return"undefined"!=typeof WorkerGlobalScope&&"undefined"!=typeof self&&self instanceof WorkerGlobalScope&&(self.worker=new hl(self)),hl}),ti(0,function(f){var _=Ls;function Ls(d){return n=d,!("undefined"==typeof window||"undefined"==typeof document||!(Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray)||!Function.prototype||!Function.prototype.bind||!(Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions)||!("JSON"in window&&"parse"in JSON&&"stringify"in JSON)||!function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var m,w,b=new Blob([""],{type:"text/javascript"}),S=URL.createObjectURL(b);try{w=new Worker(S),m=!0}catch(A){m=!1}return w&&w.terminate(),URL.revokeObjectURL(S),m}()||!("Uint8ClampedArray"in window)||!ArrayBuffer.isView||!function(){var m=document.createElement("canvas");m.width=m.height=1;var w=m.getContext("2d");if(!w)return!1;var b=w.getImageData(0,0,1,1);return b&&b.width===m.width}()||(void 0===sa[u=n&&n.failIfMajorPerformanceCaveat]&&(sa[u]=function(m){var w,S,A,P,b=(S=m,A=document.createElement("canvas"),(P=Object.create(Ls.webGLContextAttributes)).failIfMajorPerformanceCaveat=S,A.getContext("webgl",P)||A.getContext("experimental-webgl",P));if(!b)return!1;try{w=b.createShader(b.VERTEX_SHADER)}catch(S){return!1}return!(!w||b.isContextLost())&&(b.shaderSource(w,"void main() {}"),b.compileShader(w),!0===b.getShaderParameter(w,b.COMPILE_STATUS))}(u)),!sa[u]||document.documentMode));var n,u}var sa={};function ut(d,n){if(Array.isArray(d)){if(!Array.isArray(n)||d.length!==n.length)return!1;for(let u=0;u<d.length;u++)if(!ut(d[u],n[u]))return!1;return!0}if("object"==typeof d&&null!==d&&null!==n){if("object"!=typeof n||Object.keys(d).length!==Object.keys(n).length)return!1;for(const u in d)if(!ut(d[u],n[u]))return!1;return!0}return d===n}function Rt(d,n,u){const m=f.window.document.createElement(d);return void 0!==n&&(m.className=n),u&&u.appendChild(m),m}function Zt(d,n,u){const m=f.window.document.createElementNS("http://www.w3.org/2000/svg",d);for(const w of Object.keys(n))m.setAttributeNS(null,w,n[w]);return u&&u.appendChild(m),m}Ls.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};const Ga=f.window.document&&f.window.document.documentElement.style,ki=Ga&&void 0!==Ga.userSelect?"userSelect":"WebkitUserSelect";let Pr;function Gn(){Ga&&ki&&(Pr=Ga[ki],Ga[ki]="none")}function ho(){Ga&&ki&&(Ga[ki]=Pr)}function fo(d){d.preventDefault(),d.stopPropagation(),f.window.removeEventListener("click",fo,!0)}function po(){f.window.addEventListener("click",fo,!0),f.window.setTimeout(()=>{f.window.removeEventListener("click",fo,!0)},0)}function Ia(d,n){const u=d.getBoundingClientRect();return Ma(d,u,n)}function wr(d,n){const u=d.getBoundingClientRect(),m=[];for(let w=0;w<n.length;w++)m.push(Ma(d,u,n[w]));return m}function Ql(d){return void 0!==f.window.InstallTrigger&&2===d.button&&d.ctrlKey&&f.window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:d.button}function Ma(d,n,u){const m=d.offsetWidth===n.width?1:d.offsetWidth/n.width;return new f.pointGeometry((u.clientX-n.left)*m,(u.clientY-n.top)*m)}function rl(d,n){var u=n[0],m=n[1],w=n[2],b=n[3],S=u*b-w*m;return S?(d[0]=b*(S=1/S),d[1]=-m*S,d[2]=-w*S,d[3]=u*S,d):null}function ec(d){const{userImage:n}=d;return!!(n&&n.render&&n.render())&&(d.data.replace(new Uint8Array(n.data.buffer)),!0)}class Gi extends f.Evented{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new f.RGBAImage({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(n){if(this.loaded!==n&&(this.loaded=n,n)){for(const{ids:u,callback:m}of this.requestors)this._notify(u,m);this.requestors=[]}}hasImage(n){return!!this.getImage(n)}getImage(n){return this.images[n]}addImage(n,u){this._validate(n,u)&&(this.images[n]=u)}_validate(n,u){let m=!0;return this._validateStretch(u.stretchX,u.data&&u.data.width)||(this.fire(new f.ErrorEvent(new Error(`Image "${n}" has invalid "stretchX" value`))),m=!1),this._validateStretch(u.stretchY,u.data&&u.data.height)||(this.fire(new f.ErrorEvent(new Error(`Image "${n}" has invalid "stretchY" value`))),m=!1),this._validateContent(u.content,u)||(this.fire(new f.ErrorEvent(new Error(`Image "${n}" has invalid "content" value`))),m=!1),m}_validateStretch(n,u){if(!n)return!0;let m=0;for(const w of n){if(w[0]<m||w[1]<w[0]||u<w[1])return!1;m=w[1]}return!0}_validateContent(n,u){return!(n&&(4!==n.length||n[0]<0||u.data.width<n[0]||n[1]<0||u.data.height<n[1]||n[2]<0||u.data.width<n[2]||n[3]<0||u.data.height<n[3]||n[2]<n[0]||n[3]<n[1]))}updateImage(n,u){u.version=this.images[n].version+1,this.images[n]=u,this.updatedImages[n]=!0}removeImage(n){const u=this.images[n];delete this.images[n],delete this.patterns[n],u.userImage&&u.userImage.onRemove&&u.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(n,u){let m=!0;if(!this.isLoaded())for(const w of n)this.images[w]||(m=!1);this.isLoaded()||m?this._notify(n,u):this.requestors.push({ids:n,callback:u})}_notify(n,u){const m={};for(const w of n){this.images[w]||this.fire(new f.Event("styleimagemissing",{id:w}));const b=this.images[w];b?m[w]={data:b.data.clone(),pixelRatio:b.pixelRatio,sdf:b.sdf,version:b.version,stretchX:b.stretchX,stretchY:b.stretchY,content:b.content,hasRenderCallback:Boolean(b.userImage&&b.userImage.render)}:f.warnOnce(`Image "${w}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}u(null,m)}getPixelSize(){const{width:n,height:u}=this.atlasImage;return{width:n,height:u}}getPattern(n){const u=this.patterns[n],m=this.getImage(n);if(!m)return null;if(u&&u.position.version===m.version)return u.position;if(u)u.position.version=m.version;else{const w={w:m.data.width+2,h:m.data.height+2,x:0,y:0},b=new f.ImagePosition(w,m);this.patterns[n]={bin:w,position:b}}return this._updatePatternAtlas(),this.patterns[n].position}bind(n){const u=n.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new f.Texture(n,this.atlasImage,u.RGBA),this.atlasTexture.bind(u.LINEAR,u.CLAMP_TO_EDGE)}_updatePatternAtlas(){const n=[];for(const b in this.patterns)n.push(this.patterns[b].bin);const{w:u,h:m}=f.potpack(n),w=this.atlasImage;w.resize({width:u||1,height:m||1});for(const b in this.patterns){const{bin:S}=this.patterns[b],A=S.x+1,P=S.y+1,O=this.images[b].data,L=O.width,V=O.height;f.RGBAImage.copy(O,w,{x:0,y:0},{x:A,y:P},{width:L,height:V}),f.RGBAImage.copy(O,w,{x:0,y:V-1},{x:A,y:P-1},{width:L,height:1}),f.RGBAImage.copy(O,w,{x:0,y:0},{x:A,y:P+V},{width:L,height:1}),f.RGBAImage.copy(O,w,{x:L-1,y:0},{x:A-1,y:P},{width:1,height:V}),f.RGBAImage.copy(O,w,{x:0,y:0},{x:A+L,y:P},{width:1,height:V})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(n){for(const u of n){if(this.callbackDispatchedThisFrame[u])continue;this.callbackDispatchedThisFrame[u]=!0;const m=this.images[u];ec(m)&&this.updateImage(u,m)}}}const tc=new f.Properties({anchor:new f.DataConstantProperty(f.spec.light.anchor),position:new class{constructor(){this.specification=f.spec.light.position}possiblyEvaluate(d,n){return function([u,m,w]){const b=f.degToRad(m+90),S=f.degToRad(w);return{x:u*Math.cos(b)*Math.sin(S),y:u*Math.sin(b)*Math.sin(S),z:u*Math.cos(S),azimuthal:m,polar:w}}(d.expression.evaluate(n))}interpolate(d,n,u){return{x:f.number(d.x,n.x,u),y:f.number(d.y,n.y,u),z:f.number(d.z,n.z,u),azimuthal:f.number(d.azimuthal,n.azimuthal,u),polar:f.number(d.polar,n.polar,u)}}},color:new f.DataConstantProperty(f.spec.light.color),intensity:new f.DataConstantProperty(f.spec.light.intensity)}),il="-transition";class Kc extends f.Evented{constructor(n){super(),this._transitionable=new f.Transitionable(tc),this.setLight(n),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(n,u={}){if(!this._validate(f.validateLight,n,u))for(const m in n){const w=n[m];f.endsWith(m,il)?this._transitionable.setTransition(m.slice(0,-il.length),w):this._transitionable.setValue(m,w)}}updateTransitions(n){this._transitioning=this._transitionable.transitioned(n,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(n){this.properties=this._transitioning.possiblyEvaluate(n)}_validate(n,u,m){return(!m||!1!==m.validate)&&f.emitValidationErrors(this,n.call(f.validateStyle,f.extend({value:u,style:{glyphs:!0,sprite:!0},styleSpec:f.spec})))}}const Jc=new f.Properties({source:new f.DataConstantProperty(f.spec.terrain.source),exaggeration:new f.DataConstantProperty(f.spec.terrain.exaggeration)}),mo="-transition";class nl extends f.Evented{constructor(n,u){super(),this._transitionable=new f.Transitionable(Jc),this.set(n),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=u}get(){return this._transitionable.serialize()}set(n){for(const u in n){const m=n[u];f.endsWith(u,mo)?this._transitionable.setTransition(u.slice(0,-mo.length),m):this._transitionable.setValue(u,m)}}updateTransitions(n){this._transitioning=this._transitionable.transitioned(n,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(n){this.properties=this._transitioning.possiblyEvaluate(n)}}function Fa(d,n,u,m){const w=f.smoothstep(45,65,u),[b,S]=Rs(d,m),A=f.length(n);let P=1-Math.min(1,Math.exp((A-b)/(S-b)*-6));return P*=P*P,P=Math.min(1,1.00747*P),P*w*d.alpha}function Rs(d,n){const u=.5/Math.tan(.5*n);return[d.range[0]+u,d.range[1]+u]}const rc=new f.Properties({range:new f.DataConstantProperty(f.spec.fog.range),color:new f.DataConstantProperty(f.spec.fog.color),"horizon-blend":new f.DataConstantProperty(f.spec.fog["horizon-blend"])}),ma="-transition";class Qc extends f.Evented{constructor(n,u){super(),this._transitionable=new f.Transitionable(rc),this.set(n),this._transitioning=this._transitionable.untransitioned(),this._transform=u}get state(){return{range:this.properties.get("range"),horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(n,u={}){if(!this._validate(f.validateFog,n,u))for(const m in n){const w=n[m];f.endsWith(m,ma)?this._transitionable.setTransition(m.slice(0,-ma.length),w):this._transitionable.setValue(m,w)}}getOpacity(n){if(!this._transform.projection.supportsFog)return 0;const u=this.properties&&this.properties.get("color")||1;return f.smoothstep(45,65,n)*u.a}getOpacityAtLatLng(n,u){return this._transform.projection.supportsFog?function(m,w,b){const S=f.MercatorCoordinate.fromLngLat(w),A=b.elevation?b.elevation.getAtPointOrZero(S):0,P=[S.x,S.y,A];return f.transformMat4(P,P,b.mercatorFogMatrix),Fa(m,P,b.pitch,b._fov)}(this.state,n,u):0}getFovAdjustedRange(n){return this._transform.projection.supportsFog?Rs(this.state,n):[0,1]}updateTransitions(n){this._transitioning=this._transitionable.transitioned(n,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(n){this.properties=this._transitioning.possiblyEvaluate(n)}_validate(n,u,m){return(!m||!1!==m.validate)&&f.emitValidationErrors(this,n.call(f.validateStyle,f.extend({value:u,style:{glyphs:!0,sprite:!0},styleSpec:f.spec})))}}class Rr{constructor(n,u){this.workerPool=n,this.actors=[],this.currentActor=0,this.id=f.uniqueId();const m=this.workerPool.acquire(this.id);for(let w=0;w<m.length;w++){const b=new Rr.Actor(m[w],u,this.id);b.name=`Worker ${w}`,this.actors.push(b)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(n,u,m){f.asyncAll(this.actors,(w,b)=>{w.send(n,u,b)},m=m||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(n=>{n.remove()}),this.actors=[],this.workerPool.release(this.id)}}function cn(d,n,u){return n*(f.EXTENT/(d.tileSize*Math.pow(2,u-d.tileID.overscaledZ)))}Rr.Actor=f.Actor;class Os{constructor(n,u,m,w){this.screenBounds=n,this.cameraPoint=u,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=m,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this.screenGeometry.map(b=>w.pointCoordinate3D(b)),this.cameraGeometry=this.bufferedCameraGeometry(0)}static createFromScreenPoints(n,u){let m,w;if(n instanceof f.pointGeometry||"number"==typeof n[0]){const b=f.pointGeometry.convert(n);m=[f.pointGeometry.convert(n)],w=u.isPointAboveHorizon(b)}else{const b=f.pointGeometry.convert(n[0]),S=f.pointGeometry.convert(n[1]);m=[b,S],w=f.polygonizeBounds(b,S).every(A=>u.isPointAboveHorizon(A))}return new Os(m,u.getCameraPoint(),w,u)}isPointQuery(){return 1===this.screenBounds.length}bufferedScreenGeometry(n){return f.polygonizeBounds(this.screenBounds[0],1===this.screenBounds.length?this.screenBounds[0]:this.screenBounds[1],n)}bufferedCameraGeometry(n){const u=this.screenBounds[0],m=1===this.screenBounds.length?this.screenBounds[0].add(new f.pointGeometry(1,1)):this.screenBounds[1],w=f.polygonizeBounds(u,m,0,!1);return this.cameraPoint.y>m.y&&(this.cameraPoint.x>u.x&&this.cameraPoint.x<m.x?w.splice(3,0,this.cameraPoint):this.cameraPoint.x>=m.x?w[2]=this.cameraPoint:this.cameraPoint.x<=u.x&&(w[3]=this.cameraPoint)),f.bufferConvexPolygon(w,n)}containsTile(n,u,m){const w=n.queryPadding+1,b=n.tileID.wrap,S=m?this._bufferedCameraMercator(w,u).map(J=>f.getTilePoint(n.tileTransform,J,b)):this._bufferedScreenMercator(w,u).map(J=>f.getTilePoint(n.tileTransform,J,b)),A=this.screenGeometryMercator.map(J=>f.getTileVec3(n.tileTransform,J,b)),P=A.map(J=>new f.pointGeometry(J[0],J[1])),O=u.getFreeCameraOptions().position||new f.MercatorCoordinate(0,0,0),L=f.getTileVec3(n.tileTransform,O,b),V=A.map(J=>{const H=f.sub(J,J,L);return f.normalize(H,H),new f.Ray(L,H)}),Y=cn(n,1,u.zoom);if(f.polygonIntersectsBox(S,0,0,f.EXTENT,f.EXTENT))return{queryGeometry:this,tilespaceGeometry:P,tilespaceRays:V,bufferedTilespaceGeometry:S,bufferedTilespaceBounds:(te=f.getBounds(S),te.min.x=f.clamp(te.min.x,0,f.EXTENT),te.min.y=f.clamp(te.min.y,0,f.EXTENT),te.max.x=f.clamp(te.max.x,0,f.EXTENT),te.max.y=f.clamp(te.max.y,0,f.EXTENT),te),tile:n,tileID:n.tileID,pixelToTileUnitsFactor:Y};var te}_bufferedScreenMercator(n,u){const m=Da(n);if(this._screenRaycastCache[m])return this._screenRaycastCache[m];{const w=this.bufferedScreenGeometry(n).map(b=>u.pointCoordinate3D(b));return this._screenRaycastCache[m]=w,w}}_bufferedCameraMercator(n,u){const m=Da(n);if(this._cameraRaycastCache[m])return this._cameraRaycastCache[m];{const w=this.bufferedCameraGeometry(n).map(b=>u.pointCoordinate3D(b));return this._cameraRaycastCache[m]=w,w}}}function Da(d){return 100*d|0}function al(d,n,u){const m=function(w,b){if(w)return u(w);if(b){const S=f.pick(f.extend(b,d),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);b.vector_layers&&(S.vectorLayers=b.vector_layers,S.vectorLayerIds=S.vectorLayers.map(A=>A.id)),S.tiles=n.canonicalizeTileset(S,d.url),u(null,S)}};return d.url?f.getJSON(n.transformRequest(n.normalizeSourceURL(d.url),f.ResourceType.Source),m):f.exported.frame(()=>m(null,d))}class zs{constructor(n,u,m){this.bounds=f.LngLatBounds.convert(this.validateBounds(n)),this.minzoom=u||0,this.maxzoom=m||24}validateBounds(n){return Array.isArray(n)&&4===n.length?[Math.max(-180,n[0]),Math.max(-90,n[1]),Math.min(180,n[2]),Math.min(90,n[3])]:[-180,-90,180,90]}contains(n){const u=Math.pow(2,n.z),m=Math.floor(f.mercatorXfromLng(this.bounds.getWest())*u),w=Math.floor(f.mercatorYfromLat(this.bounds.getNorth())*u),b=Math.ceil(f.mercatorXfromLng(this.bounds.getEast())*u),S=Math.ceil(f.mercatorYfromLat(this.bounds.getSouth())*u);return n.x>=m&&n.x<b&&n.y>=w&&n.y<S}}class ic{constructor(n,u,m){this.context=n;const w=n.gl;this.buffer=w.createBuffer(),this.dynamicDraw=Boolean(m),this.context.unbindVAO(),n.bindElementBuffer.set(this.buffer),w.bufferData(w.ELEMENT_ARRAY_BUFFER,u.arrayBuffer,this.dynamicDraw?w.DYNAMIC_DRAW:w.STATIC_DRAW),this.dynamicDraw||u.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(n){const u=this.context.gl;this.context.unbindVAO(),this.bind(),u.bufferSubData(u.ELEMENT_ARRAY_BUFFER,0,n.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const Bs={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class $a{constructor(n,u,m,w){this.length=u.length,this.attributes=m,this.itemSize=u.bytesPerElement,this.dynamicDraw=w,this.context=n;const b=n.gl;this.buffer=b.createBuffer(),n.bindVertexBuffer.set(this.buffer),b.bufferData(b.ARRAY_BUFFER,u.arrayBuffer,this.dynamicDraw?b.DYNAMIC_DRAW:b.STATIC_DRAW),this.dynamicDraw||u.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(n){const u=this.context.gl;this.bind(),u.bufferSubData(u.ARRAY_BUFFER,0,n.arrayBuffer)}enableAttributes(n,u){for(let m=0;m<this.attributes.length;m++){const w=u.attributes[this.attributes[m].name];void 0!==w&&n.enableVertexAttribArray(w)}}setVertexAttribPointers(n,u,m){for(let w=0;w<this.attributes.length;w++){const b=this.attributes[w],S=u.attributes[b.name];void 0!==S&&n.vertexAttribPointer(S,b.components,n[Bs[b.type]],!1,this.itemSize,b.offset+this.itemSize*(m||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class Tr{constructor(n){this.gl=n.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(n){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class kn extends Tr{getDefault(){return f.Color.transparent}set(n){const u=this.current;(n.r!==u.r||n.g!==u.g||n.b!==u.b||n.a!==u.a||this.dirty)&&(this.gl.clearColor(n.r,n.g,n.b,n.a),this.current=n,this.dirty=!1)}}class eu extends Tr{getDefault(){return 1}set(n){(n!==this.current||this.dirty)&&(this.gl.clearDepth(n),this.current=n,this.dirty=!1)}}class $n extends Tr{getDefault(){return 0}set(n){(n!==this.current||this.dirty)&&(this.gl.clearStencil(n),this.current=n,this.dirty=!1)}}class _o extends Tr{getDefault(){return[!0,!0,!0,!0]}set(n){const u=this.current;(n[0]!==u[0]||n[1]!==u[1]||n[2]!==u[2]||n[3]!==u[3]||this.dirty)&&(this.gl.colorMask(n[0],n[1],n[2],n[3]),this.current=n,this.dirty=!1)}}class Br extends Tr{getDefault(){return!0}set(n){(n!==this.current||this.dirty)&&(this.gl.depthMask(n),this.current=n,this.dirty=!1)}}class Ns extends Tr{getDefault(){return 255}set(n){(n!==this.current||this.dirty)&&(this.gl.stencilMask(n),this.current=n,this.dirty=!1)}}class go extends Tr{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(n){const u=this.current;(n.func!==u.func||n.ref!==u.ref||n.mask!==u.mask||this.dirty)&&(this.gl.stencilFunc(n.func,n.ref,n.mask),this.current=n,this.dirty=!1)}}class _a extends Tr{getDefault(){const n=this.gl;return[n.KEEP,n.KEEP,n.KEEP]}set(n){const u=this.current;(n[0]!==u[0]||n[1]!==u[1]||n[2]!==u[2]||this.dirty)&&(this.gl.stencilOp(n[0],n[1],n[2]),this.current=n,this.dirty=!1)}}class xo extends Tr{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const u=this.gl;n?u.enable(u.STENCIL_TEST):u.disable(u.STENCIL_TEST),this.current=n,this.dirty=!1}}class sl extends Tr{getDefault(){return[0,1]}set(n){const u=this.current;(n[0]!==u[0]||n[1]!==u[1]||this.dirty)&&(this.gl.depthRange(n[0],n[1]),this.current=n,this.dirty=!1)}}class nc extends Tr{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const u=this.gl;n?u.enable(u.DEPTH_TEST):u.disable(u.DEPTH_TEST),this.current=n,this.dirty=!1}}class ol extends Tr{getDefault(){return this.gl.LESS}set(n){(n!==this.current||this.dirty)&&(this.gl.depthFunc(n),this.current=n,this.dirty=!1)}}class yo extends Tr{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const u=this.gl;n?u.enable(u.BLEND):u.disable(u.BLEND),this.current=n,this.dirty=!1}}class Pa extends Tr{getDefault(){const n=this.gl;return[n.ONE,n.ZERO]}set(n){const u=this.current;(n[0]!==u[0]||n[1]!==u[1]||this.dirty)&&(this.gl.blendFunc(n[0],n[1]),this.current=n,this.dirty=!1)}}class vo extends Tr{getDefault(){return f.Color.transparent}set(n){const u=this.current;(n.r!==u.r||n.g!==u.g||n.b!==u.b||n.a!==u.a||this.dirty)&&(this.gl.blendColor(n.r,n.g,n.b,n.a),this.current=n,this.dirty=!1)}}class La extends Tr{getDefault(){return this.gl.FUNC_ADD}set(n){(n!==this.current||this.dirty)&&(this.gl.blendEquation(n),this.current=n,this.dirty=!1)}}class Ra extends Tr{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const u=this.gl;n?u.enable(u.CULL_FACE):u.disable(u.CULL_FACE),this.current=n,this.dirty=!1}}class Us extends Tr{getDefault(){return this.gl.BACK}set(n){(n!==this.current||this.dirty)&&(this.gl.cullFace(n),this.current=n,this.dirty=!1)}}class ac extends Tr{getDefault(){return this.gl.CCW}set(n){(n!==this.current||this.dirty)&&(this.gl.frontFace(n),this.current=n,this.dirty=!1)}}class wo extends Tr{getDefault(){return null}set(n){(n!==this.current||this.dirty)&&(this.gl.useProgram(n),this.current=n,this.dirty=!1)}}class ll extends Tr{getDefault(){return this.gl.TEXTURE0}set(n){(n!==this.current||this.dirty)&&(this.gl.activeTexture(n),this.current=n,this.dirty=!1)}}class un extends Tr{getDefault(){const n=this.gl;return[0,0,n.drawingBufferWidth,n.drawingBufferHeight]}set(n){const u=this.current;(n[0]!==u[0]||n[1]!==u[1]||n[2]!==u[2]||n[3]!==u[3]||this.dirty)&&(this.gl.viewport(n[0],n[1],n[2],n[3]),this.current=n,this.dirty=!1)}}class sc extends Tr{getDefault(){return null}set(n){if(n===this.current&&!this.dirty)return;const u=this.gl;u.bindFramebuffer(u.FRAMEBUFFER,n),this.current=n,this.dirty=!1}}class tu extends Tr{getDefault(){return null}set(n){if(n===this.current&&!this.dirty)return;const u=this.gl;u.bindRenderbuffer(u.RENDERBUFFER,n),this.current=n,this.dirty=!1}}class cl extends Tr{getDefault(){return null}set(n){if(n===this.current&&!this.dirty)return;const u=this.gl;u.bindTexture(u.TEXTURE_2D,n),this.current=n,this.dirty=!1}}class ru extends Tr{getDefault(){return null}set(n){if(n===this.current&&!this.dirty)return;const u=this.gl;u.bindBuffer(u.ARRAY_BUFFER,n),this.current=n,this.dirty=!1}}class bo extends Tr{getDefault(){return null}set(n){const u=this.gl;u.bindBuffer(u.ELEMENT_ARRAY_BUFFER,n),this.current=n,this.dirty=!1}}class iu extends Tr{constructor(n){super(n),this.vao=n.extVertexArrayObject}getDefault(){return null}set(n){this.vao&&(n!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(n),this.current=n,this.dirty=!1)}}class Oa extends Tr{getDefault(){return 4}set(n){if(n===this.current&&!this.dirty)return;const u=this.gl;u.pixelStorei(u.UNPACK_ALIGNMENT,n),this.current=n,this.dirty=!1}}class Zs extends Tr{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const u=this.gl;u.pixelStorei(u.UNPACK_PREMULTIPLY_ALPHA_WEBGL,n),this.current=n,this.dirty=!1}}class Vs extends Tr{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const u=this.gl;u.pixelStorei(u.UNPACK_FLIP_Y_WEBGL,n),this.current=n,this.dirty=!1}}class To extends Tr{constructor(n,u){super(n),this.context=n,this.parent=u}getDefault(){return null}}class ul extends To{setDirty(){this.dirty=!0}set(n){if(n===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const u=this.gl;u.framebufferTexture2D(u.FRAMEBUFFER,u.COLOR_ATTACHMENT0,u.TEXTURE_2D,n,0),this.current=n,this.dirty=!1}}class oc extends To{attachment(){return this.gl.DEPTH_ATTACHMENT}set(n){if(n===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const u=this.gl;u.framebufferRenderbuffer(u.FRAMEBUFFER,this.attachment(),u.RENDERBUFFER,n),this.current=n,this.dirty=!1}}class hl extends oc{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}class ae{constructor(n,u,m,w){this.context=n,this.width=u,this.height=m;const b=this.framebuffer=n.gl.createFramebuffer();this.colorAttachment=new ul(n,b),w&&(this.depthAttachment=new oc(n,b))}destroy(){const n=this.context.gl,u=this.colorAttachment.get();if(u&&n.deleteTexture(u),this.depthAttachment){const m=this.depthAttachment.get();m&&n.deleteRenderbuffer(m)}n.deleteFramebuffer(this.framebuffer)}}class Z{constructor(n){this.gl=n,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),this.clearColor=new kn(this),this.clearDepth=new eu(this),this.clearStencil=new $n(this),this.colorMask=new _o(this),this.depthMask=new Br(this),this.stencilMask=new Ns(this),this.stencilFunc=new go(this),this.stencilOp=new _a(this),this.stencilTest=new xo(this),this.depthRange=new sl(this),this.depthTest=new nc(this),this.depthFunc=new ol(this),this.blend=new yo(this),this.blendFunc=new Pa(this),this.blendColor=new vo(this),this.blendEquation=new La(this),this.cullFace=new Ra(this),this.cullFaceSide=new Us(this),this.frontFace=new ac(this),this.program=new wo(this),this.activeTexture=new ll(this),this.viewport=new un(this),this.bindFramebuffer=new sc(this),this.bindRenderbuffer=new tu(this),this.bindTexture=new cl(this),this.bindVertexBuffer=new ru(this),this.bindElementBuffer=new bo(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new iu(this),this.pixelStoreUnpack=new Oa(this),this.pixelStoreUnpackPremultiplyAlpha=new Zs(this),this.pixelStoreUnpackFlipY=new Vs(this),this.extTextureFilterAnisotropic=n.getExtension("EXT_texture_filter_anisotropic")||n.getExtension("MOZ_EXT_texture_filter_anisotropic")||n.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=n.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureFilterAnisotropicForceOff=!1,this.extTextureHalfFloat=n.getExtension("OES_texture_half_float"),this.extTextureHalfFloat&&(n.getExtension("OES_texture_half_float_linear"),this.extRenderToTextureHalfFloat=n.getExtension("EXT_color_buffer_half_float")),this.extTimerQuery=n.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=n.getParameter(n.MAX_TEXTURE_SIZE)}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(n,u){return new ic(this,n,u)}createVertexBuffer(n,u,m){return new $a(this,n,u,m)}createRenderbuffer(n,u,m){const w=this.gl,b=w.createRenderbuffer();return this.bindRenderbuffer.set(b),w.renderbufferStorage(w.RENDERBUFFER,n,u,m),this.bindRenderbuffer.set(null),b}createFramebuffer(n,u,m){return new ae(this,n,u,m)}clear({color:n,depth:u,stencil:m}){const w=this.gl;let b=0;n&&(b|=w.COLOR_BUFFER_BIT,this.clearColor.set(n),this.colorMask.set([!0,!0,!0,!0])),void 0!==u&&(b|=w.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(u),this.depthMask.set(!0)),void 0!==m&&(b|=w.STENCIL_BUFFER_BIT,this.clearStencil.set(m),this.stencilMask.set(255)),w.clear(b)}setCullFace(n){!1===n.enable?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(n.mode),this.frontFace.set(n.frontFace))}setDepthMode(n){n.func!==this.gl.ALWAYS||n.mask?(this.depthTest.set(!0),this.depthFunc.set(n.func),this.depthMask.set(n.mask),this.depthRange.set(n.range)):this.depthTest.set(!1)}setStencilMode(n){n.test.func!==this.gl.ALWAYS||n.mask?(this.stencilTest.set(!0),this.stencilMask.set(n.mask),this.stencilOp.set([n.fail,n.depthFail,n.pass]),this.stencilFunc.set({func:n.test.func,ref:n.ref,mask:n.test.mask})):this.stencilTest.set(!1)}setColorMode(n){ut(n.blendFunction,f.ColorMode.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(n.blendFunction),this.blendColor.set(n.blendColor)),this.colorMask.set(n.mask)}unbindVAO(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)}}class G extends f.Evented{constructor(n,u,m,w){super(),this.id=n,this.dispatcher=m,this.setEventedParent(w),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=f.extend({type:"raster"},u),f.extend(this,f.pick(u,["url","scheme","tileSize"]))}load(){this._loaded=!1,this.fire(new f.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=al(this._options,this.map._requestManager,(n,u)=>{this._tileJSONRequest=null,this._loaded=!0,n?this.fire(new f.ErrorEvent(n)):u&&(f.extend(this,u),u.bounds&&(this.tileBounds=new zs(u.bounds,this.minzoom,this.maxzoom)),f.postTurnstileEvent(u.tiles),this.fire(new f.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new f.Event("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}onAdd(n){this.map=n,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return f.extend({},this._options)}hasTile(n){return!this.tileBounds||this.tileBounds.contains(n.canonical)}loadTile(n,u){const m=f.exported.devicePixelRatio>=2,w=this.map._requestManager.normalizeTileURL(n.tileID.canonical.url(this.tiles,this.scheme),m,this.tileSize);n.request=f.getImage(this.map._requestManager.transformRequest(w,f.ResourceType.Tile),(b,S,A,P)=>(delete n.request,n.aborted?(n.state="unloaded",u(null)):b?(n.state="errored",u(b)):S?(this.map._refreshExpiredTiles&&n.setExpiryData({cacheControl:A,expires:P}),n.setTexture(S,this.map.painter),n.state="loaded",f.cacheEntryPossiblyAdded(this.dispatcher),void u(null)):u(null)))}static loadTileData(n,u,m){n.setTexture(u,m)}static unloadTileData(n,u){n.texture&&u.saveTileTexture(n.texture)}abortTile(n,u){n.request&&(n.request.cancel(),delete n.request),u()}unloadTile(n,u){n.texture&&this.map.painter.saveTileTexture(n.texture),u()}hasTransition(){return!1}}let re;function pe(d,n,u,m,w,b,S,A){const P=[d,u,w,n,m,b,1,1,1],O=[S,A,1],L=f.adjoint([],P),[V,Y,te]=f.transformMat3(O,O,f.transpose(L,L));return f.multiply(P,[V,0,0,0,Y,0,0,0,te],P)}class Ee extends f.Evented{constructor(n,u,m,w){super(),this.id=n,this.dispatcher=m,this.coordinates=u.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(w),this.options=u}load(n){this._loaded=!1,this.fire(new f.Event("dataloading",{dataType:"source"})),this.url=this.options.url,f.getImage(this.map._requestManager.transformRequest(this.url,f.ResourceType.Image),(u,m)=>{if(this._loaded=!0,u)this.fire(new f.ErrorEvent(u));else if(m){const{HTMLImageElement:w}=f.window;this.image=m instanceof w?f.exported.getImageData(m):m,this.width=this.image.width,this.height=this.image.height,n&&(this.coordinates=n),this._finishLoading()}})}loaded(){return this._loaded}updateImage(n){return this.image&&n.url?(this.options.url=n.url,this.load(n.coordinates),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new f.Event("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(n){this.map=n,this.load()}onRemove(){this.texture&&this.texture.destroy()}setCoordinates(n){this.coordinates=n,this._boundsArray=void 0;const u=n.map(f.MercatorCoordinate.fromLngLat);return this.tileID=function(m){let w=1/0,b=1/0,S=-1/0,A=-1/0;for(const V of m)w=Math.min(w,V.x),b=Math.min(b,V.y),S=Math.max(S,V.x),A=Math.max(A,V.y);const P=Math.max(S-w,A-b),O=Math.max(0,Math.floor(-Math.log(P)/Math.LN2)),L=Math.pow(2,O);return new f.CanonicalTileID(O,Math.floor((w+S)/2*L),Math.floor((b+A)/2*L))}(u),this.minzoom=this.maxzoom=this.tileID.z,this.fire(new f.Event("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){this._boundsArray=void 0}_prepareData(n){for(const P in this.tiles){const O=this.tiles[P];"loaded"!==O.state&&(O.state="loaded",O.texture=this.texture)}if(this._boundsArray)return;const u=f.tileTransform(this.tileID,this.map.transform.projection),[m,w,b,S]=this.coordinates.map(P=>{const O=u.projection.project(P[0],P[1]);return f.getTilePoint(u,O)._round()});this.perspectiveTransform=function(P,O,L,V,Y,te,J,H,se,ie){const he=pe(0,0,P,0,0,O,P,O),de=pe(L,V,Y,te,J,H,se,ie);return f.multiply(de,f.adjoint(he,he),de),[de[6]/de[8]*P/f.EXTENT,de[7]/de[8]*O/f.EXTENT]}(this.width,this.height,m.x,m.y,w.x,w.y,S.x,S.y,b.x,b.y);const A=this._boundsArray=new f.StructArrayLayout4i8;A.emplaceBack(m.x,m.y,0,0),A.emplaceBack(w.x,w.y,f.EXTENT,0),A.emplaceBack(S.x,S.y,0,f.EXTENT),A.emplaceBack(b.x,b.y,f.EXTENT,f.EXTENT),this.boundsBuffer&&this.boundsBuffer.destroy(),this.boundsBuffer=n.createVertexBuffer(A,f.boundsAttributes.members),this.boundsSegments=f.SegmentVector.simpleSegment(0,0,4,2)}prepare(){if(0===Object.keys(this.tiles).length||!this.image)return;const n=this.map.painter.context,u=n.gl;this.texture?this.texture.update(this.image):(this.texture=new f.Texture(n,this.image,u.RGBA),this.texture.bind(u.LINEAR,u.CLAMP_TO_EDGE)),this._prepareData(n)}loadTile(n,u){this.tileID&&this.tileID.equals(n.tileID.canonical)?(this.tiles[String(n.tileID.wrap)]=n,n.buckets={},u(null)):(n.state="errored",u(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}const Oe={vector:class extends f.Evented{constructor(d,n,u,m){if(super(),this.id=d,this.dispatcher=u,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,f.extend(this,f.pick(n,["url","scheme","tileSize","promoteId"])),this._options=f.extend({type:"vector"},n),this._collectResourceTiming=n.collectResourceTiming,512!==this.tileSize)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(m),this._tileWorkers={},this._deduped=new f.DedupedRequest}load(){this._loaded=!1,this.fire(new f.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=al(this._options,this.map._requestManager,(d,n)=>{this._tileJSONRequest=null,this._loaded=!0,d?this.fire(new f.ErrorEvent(d)):n&&(f.extend(this,n),n.bounds&&(this.tileBounds=new zs(n.bounds,this.minzoom,this.maxzoom)),f.postTurnstileEvent(n.tiles,this.map._requestManager._customAccessToken),this.fire(new f.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new f.Event("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}hasTile(d){return!this.tileBounds||this.tileBounds.contains(d.canonical)}onAdd(d){this.map=d,this.load()}setSourceProperty(d){this._tileJSONRequest&&this._tileJSONRequest.cancel(),d();const n=this.map.style._getSourceCaches(this.id);for(const u of n)u.clearTiles();this.load()}setTiles(d){return this.setSourceProperty(()=>{this._options.tiles=d}),this}setUrl(d){return this.setSourceProperty(()=>{this.url=d,this._options.url=d}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return f.extend({},this._options)}loadTile(d,n){const u=this.map._requestManager.normalizeTileURL(d.tileID.canonical.url(this.tiles,this.scheme)),m={request:this.map._requestManager.transformRequest(u,f.ResourceType.Tile),data:void 0,uid:d.uid,tileID:d.tileID,tileZoom:d.tileZoom,zoom:d.tileID.overscaledZ,tileSize:this.tileSize*d.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:f.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:d.isSymbolTile};if(m.request.collectResourceTiming=this._collectResourceTiming,d.actor&&"expired"!==d.state)"loading"===d.state?d.reloadCallback=n:d.request=d.actor.send("reloadTile",m,w.bind(this));else if(d.actor=this._tileWorkers[u]=this._tileWorkers[u]||this.dispatcher.getActor(),this.dispatcher.ready)d.request=d.actor.send("loadTile",m,w.bind(this),void 0,!0);else{const b=f.loadVectorTile.call({deduped:this._deduped},m,(S,A)=>{S||!A?w.call(this,S):(m.data={cacheControl:A.cacheControl,expires:A.expires,rawData:A.rawData.slice(0)},d.actor&&d.actor.send("loadTile",m,w.bind(this),void 0,!0))},!0);d.request={cancel:b}}function w(b,S){return delete d.request,d.aborted?n(null):b&&404!==b.status?n(b):(S&&S.resourceTiming&&(d.resourceTiming=S.resourceTiming),this.map._refreshExpiredTiles&&S&&d.setExpiryData(S),d.loadVectorData(S,this.map.painter),f.cacheEntryPossiblyAdded(this.dispatcher),n(null),void(d.reloadCallback&&(this.loadTile(d,d.reloadCallback),d.reloadCallback=null)))}}abortTile(d){d.request&&(d.request.cancel(),delete d.request),d.actor&&d.actor.send("abortTile",{uid:d.uid,type:this.type,source:this.id})}unloadTile(d){d.unloadVectorData(),d.actor&&d.actor.send("removeTile",{uid:d.uid,type:this.type,source:this.id})}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}},raster:G,"raster-dem":class extends G{constructor(d,n,u,m){super(d,n,u,m),this.type="raster-dem",this.maxzoom=22,this._options=f.extend({type:"raster-dem"},n),this.encoding=n.encoding||"mapbox"}loadTile(d,n){const u=this.map._requestManager.normalizeTileURL(d.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function m(w,b){w&&(d.state="errored",n(w)),b&&(d.dem=b,d.dem.onDeserialize(),d.needsHillshadePrepare=!0,d.needsDEMTextureUpload=!0,d.state="loaded",n(null))}d.request=f.getImage(this.map._requestManager.transformRequest(u,f.ResourceType.Tile),function(w,b,S,A){if(delete d.request,d.aborted)d.state="unloaded",n(null);else if(w)d.state="errored",n(w);else if(b){this.map._refreshExpiredTiles&&d.setExpiryData({cacheControl:S,expires:A});const P=f.window.ImageBitmap&&b instanceof f.window.ImageBitmap&&(null==re&&(re=f.window.OffscreenCanvas&&new f.window.OffscreenCanvas(1,1).getContext("2d")&&"function"==typeof f.window.createImageBitmap),re),O=1-(b.width-f.prevPowerOfTwo(b.width))/2;O<1||d.neighboringTiles||(d.neighboringTiles=this._getNeighboringTiles(d.tileID));const L=P?b:f.exported.getImageData(b,O),V={uid:d.uid,coord:d.tileID,source:this.id,rawImageData:L,encoding:this.encoding,padding:O};d.actor&&"expired"!==d.state||(d.actor=this.dispatcher.getActor(),d.actor.send("loadDEMTile",V,m.bind(this),void 0,!0))}}.bind(this))}_getNeighboringTiles(d){const n=d.canonical,u=Math.pow(2,n.z),m=(n.x-1+u)%u,w=0===n.x?d.wrap-1:d.wrap,b=(n.x+1+u)%u,S=n.x+1===u?d.wrap+1:d.wrap,A={};return A[new f.OverscaledTileID(d.overscaledZ,w,n.z,m,n.y).key]={backfilled:!1},A[new f.OverscaledTileID(d.overscaledZ,S,n.z,b,n.y).key]={backfilled:!1},n.y>0&&(A[new f.OverscaledTileID(d.overscaledZ,w,n.z,m,n.y-1).key]={backfilled:!1},A[new f.OverscaledTileID(d.overscaledZ,d.wrap,n.z,n.x,n.y-1).key]={backfilled:!1},A[new f.OverscaledTileID(d.overscaledZ,S,n.z,b,n.y-1).key]={backfilled:!1}),n.y+1<u&&(A[new f.OverscaledTileID(d.overscaledZ,w,n.z,m,n.y+1).key]={backfilled:!1},A[new f.OverscaledTileID(d.overscaledZ,d.wrap,n.z,n.x,n.y+1).key]={backfilled:!1},A[new f.OverscaledTileID(d.overscaledZ,S,n.z,b,n.y+1).key]={backfilled:!1}),A}unloadTile(d){d.demTexture&&this.map.painter.saveTileTexture(d.demTexture),d.fbo&&(d.fbo.destroy(),delete d.fbo),d.dem&&delete d.dem,delete d.neighboringTiles,d.state="unloaded"}},geojson:class extends f.Evented{constructor(d,n,u,m){super(),this.id=d,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=u.getActor(),this.setEventedParent(m),this._data=n.data,this._options=f.extend({},n),this._collectResourceTiming=n.collectResourceTiming,void 0!==n.maxzoom&&(this.maxzoom=n.maxzoom),n.type&&(this.type=n.type),n.attribution&&(this.attribution=n.attribution),this.promoteId=n.promoteId;const w=f.EXTENT/this.tileSize;this.workerOptions=f.extend({source:this.id,cluster:n.cluster||!1,geojsonVtOptions:{buffer:(void 0!==n.buffer?n.buffer:128)*w,tolerance:(void 0!==n.tolerance?n.tolerance:.375)*w,extent:f.EXTENT,maxZoom:this.maxzoom,lineMetrics:n.lineMetrics||!1,generateId:n.generateId||!1},superclusterOptions:{maxZoom:void 0!==n.clusterMaxZoom?n.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,n.clusterMinPoints||2),extent:f.EXTENT,radius:(void 0!==n.clusterRadius?n.clusterRadius:50)*w,log:!1,generateId:n.generateId||!1},clusterProperties:n.clusterProperties,filter:n.filter},n.workerOptions)}onAdd(d){this.map=d,this.setData(this._data)}setData(d){return this._data=d,this._updateWorkerData(),this}getClusterExpansionZoom(d,n){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:d,source:this.id},n),this}getClusterChildren(d,n){return this.actor.send("geojson.getClusterChildren",{clusterId:d,source:this.id},n),this}getClusterLeaves(d,n,u,m){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:d,limit:n,offset:u},m),this}_updateWorkerData(){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new f.Event("dataloading",{dataType:"source"})),this._loaded=!1;const d=f.extend({},this.workerOptions),n=this._data;"string"==typeof n?(d.request=this.map._requestManager.transformRequest(f.exported.resolveURL(n),f.ResourceType.Source),d.request.collectResourceTiming=this._collectResourceTiming):d.data=JSON.stringify(n),this._pendingLoad=this.actor.send(`${this.type}.loadData`,d,(u,m)=>{if(this._loaded=!0,this._pendingLoad=null,u)this.fire(new f.ErrorEvent(u));else{const w={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&m&&m.resourceTiming&&m.resourceTiming[this.id]&&(w.resourceTiming=m.resourceTiming[this.id]),this.fire(new f.Event("data",w)),this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(),this._coalesce=!1)})}loaded(){return this._loaded}loadTile(d,n){const u=d.actor?"reloadTile":"loadTile";d.actor=this.actor,d.request=this.actor.send(u,{type:this.type,uid:d.uid,tileID:d.tileID,tileZoom:d.tileZoom,zoom:d.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:f.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId},(m,w)=>(delete d.request,d.unloadVectorData(),d.aborted?n(null):m?n(m):(d.loadVectorData(w,this.map.painter,"reloadTile"===u),n(null))),void 0,"loadTile"===u)}abortTile(d){d.request&&(d.request.cancel(),delete d.request),d.aborted=!0}unloadTile(d){d.unloadVectorData(),this.actor.send("removeTile",{uid:d.uid,type:this.type,source:this.id})}onRemove(){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return f.extend({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends Ee{constructor(d,n,u,m){super(d,n,u,m),this.roundZoom=!0,this.type="video",this.options=n}load(){this._loaded=!1;const d=this.options;this.urls=[];for(const n of d.urls)this.urls.push(this.map._requestManager.transformRequest(n,f.ResourceType.Source).url);f.getVideo(this.urls,(n,u)=>{this._loaded=!0,n?this.fire(new f.ErrorEvent(n)):u&&(this.video=u,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(d){if(this.video){const n=this.video.seekable;d<n.start(0)||d>n.end(0)?this.fire(new f.ErrorEvent(new f.ValidationError(`sources.${this.id}`,null,`Playback for this video can be set only between the ${n.start(0)} and ${n.end(0)}-second mark.`))):this.video.currentTime=d}}getVideo(){return this.video}onAdd(d){this.map||(this.map=d,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(0===Object.keys(this.tiles).length||this.video.readyState<2)return;const d=this.map.painter.context,n=d.gl;this.texture?this.video.paused||(this.texture.bind(n.LINEAR,n.CLAMP_TO_EDGE),n.texSubImage2D(n.TEXTURE_2D,0,0,0,n.RGBA,n.UNSIGNED_BYTE,this.video)):(this.texture=new f.Texture(d,this.video,n.RGBA),this.texture.bind(n.LINEAR,n.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(d)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:Ee,canvas:class extends Ee{constructor(d,n,u,m){super(d,n,u,m),n.coordinates?Array.isArray(n.coordinates)&&4===n.coordinates.length&&!n.coordinates.some(w=>!Array.isArray(w)||2!==w.length||w.some(b=>"number"!=typeof b))||this.fire(new f.ErrorEvent(new f.ValidationError(`sources.${d}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new f.ErrorEvent(new f.ValidationError(`sources.${d}`,null,'missing required property "coordinates"'))),n.animate&&"boolean"!=typeof n.animate&&this.fire(new f.ErrorEvent(new f.ValidationError(`sources.${d}`,null,'optional "animate" property must be a boolean value'))),n.canvas?"string"==typeof n.canvas||n.canvas instanceof f.window.HTMLCanvasElement||this.fire(new f.ErrorEvent(new f.ValidationError(`sources.${d}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new f.ErrorEvent(new f.ValidationError(`sources.${d}`,null,'missing required property "canvas"'))),this.options=n,this.animate=void 0===n.animate||n.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof f.window.HTMLCanvasElement?this.options.canvas:f.window.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new f.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(d){this.map=d,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let d=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,d=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,d=!0),this._hasInvalidDimensions()||0===Object.keys(this.tiles).length)return;const n=this.map.painter.context;this.texture?(d||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new f.Texture(n,this.canvas,n.gl.RGBA,{premultiply:!0}),this._prepareData(n)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const d of[this.canvas.width,this.canvas.height])if(isNaN(d)||d<=0)return!0;return!1}},custom:class extends f.Evented{constructor(d,n,u,m){super(),this.id=d,this.type="custom",this._dataType="raster",this._dispatcher=u,this._implementation=n,this.setEventedParent(m),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new f.ErrorEvent(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new f.ErrorEvent(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new zs(this._implementation.bounds,this.minzoom,this.maxzoom)),n.update=this._update.bind(this),n.coveringTiles=this._coveringTiles.bind(this),f.extend(this,f.pick(n,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return f.pick(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new f.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new f.Event("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(d){this._map=d,this._loaded=!1,this.fire(new f.Event("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(d),this.load()}onRemove(d){this._implementation.onRemove&&this._implementation.onRemove(d)}hasTile(d){if(this._implementation.hasTile){const{x:n,y:u,z:m}=d.canonical;return this._implementation.hasTile({x:n,y:u,z:m})}return!this.tileBounds||this.tileBounds.contains(d.canonical)}loadTile(d,n){const{x:u,y:m,z:w}=d.tileID.canonical,b=new f.window.AbortController,S=this._implementation.loadTile({x:u,y:m,z:w},{signal:b.signal});if(!S)return this.loadTileData(d,{width:this.tileSize,height:this.tileSize,data:null}),d.state="loaded",n(null);S.cancel=()=>b.abort(),d.request=S.then(function(A){return delete d.request,d.aborted?(d.state="unloaded",n(null)):A?(P=A)instanceof f.window.ImageData||P instanceof f.window.ImageBitmap||P instanceof f.window.HTMLCanvasElement?(this.loadTileData(d,A),d.state="loaded",void n(null)):(d.state="errored",n(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`))):(this.loadTileData(d,{width:this.tileSize,height:this.tileSize,data:null}),d.state="loaded",n(null));var P}.bind(this)).catch(A=>{20!==A.code&&(d.state="errored",n(A))})}loadTileData(d,n){G.loadTileData(d,n,this._map.painter)}unloadTileData(d){G.unloadTileData(d,this._map.painter)}prepareTile(d){if(!this._implementation.prepareTile)return null;const{x:n,y:u,z:m}=d.tileID.canonical,w=this._implementation.prepareTile({x:n,y:u,z:m});return w?(this.loadTileData(d,w),d.state="loaded",w):null}unloadTile(d,n){if(this.unloadTileData(d),this._implementation.unloadTile){const{x:u,y:m,z:w}=d.tileID.canonical;this._implementation.unloadTile({x:u,y:m,z:w})}n()}abortTile(d,n){d.request&&d.request.cancel&&(d.request.cancel(),delete d.request),n()}hasTransition(){return!1}_coveringTiles(){return this._map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(d=>({x:d.canonical.x,y:d.canonical.y,z:d.canonical.z}))}_update(){this.fire(new f.Event("data",{dataType:"source",sourceDataType:"content"}))}}},Re=function(d,n,u,m){const w=new Oe[n.type](d,n,u,m);if(w.id!==d)throw new Error(`Expected Source id to be ${d} instead of ${w.id}`);return f.bindAll(["load","abort","unload","serialize","prepare"],w),w};function Ce(d,n){const u=f.identity([]);return f.scale(u,u,[.5*d.width,.5*-d.height,1]),f.translate(u,u,[1,-1,0]),f.multiply$1(u,u,d.calculateProjMatrix(n.toUnwrapped())),Float32Array.from(u)}function Ne(d,n,u,m,w,b,S,A=!1){const P=d.tilesIn(m,S,A);P.sort(kt);const O=[];for(const V of P)O.push({wrappedTileID:V.tile.tileID.wrapped().key,queryResults:V.tile.queryRenderedFeatures(n,u,d._state,V,w,b,Ce(d.transform,V.tile.tileID),A)});const L=function(V){const Y={},te={};for(const J of V){const H=J.queryResults,se=J.wrappedTileID,ie=te[se]=te[se]||{};for(const he in H){const de=H[he],ce=ie[he]=ie[he]||{},le=Y[he]=Y[he]||[];for(const we of de)ce[we.featureIndex]||(ce[we.featureIndex]=!0,le.push(we))}}return Y}(O);for(const V in L)L[V].forEach(Y=>{const te=Y.feature,J=te.layer;J&&"background"!==J.type&&"sky"!==J.type&&(te.source=J.source,J["source-layer"]&&(te.sourceLayer=J["source-layer"]),te.state=void 0!==te.id?d.getFeatureState(J["source-layer"],te.id):{})});return L}function lt(d,n){const u=d.getRenderableIds().map(b=>d.getTileByID(b)),m=[],w={};for(let b=0;b<u.length;b++){const S=u[b],A=S.tileID.canonical.key;w[A]||(w[A]=!0,S.querySourceFeatures(m,n))}return m}function kt(d,n){const u=d.tileID,m=n.tileID;return u.overscaledZ-m.overscaledZ||u.canonical.y-m.canonical.y||u.wrap-m.wrap||u.canonical.x-m.canonical.x}function mt(){return null!=Ja.workerClass?new Ja.workerClass:new f.window.Worker(Ja.workerUrl)}const tr="mapboxgl_preloaded_worker_pool";class Yt{constructor(){this.active={}}acquire(n){if(!this.workers)for(this.workers=[];this.workers.length<Yt.workerCount;)this.workers.push(new mt);return this.active[n]=!0,this.workers.slice()}release(n){delete this.active[n],0===this.numActive()&&(this.workers.forEach(u=>{u.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[tr]}numActive(){return Object.keys(this.active).length}}let Kt;function nr(){return Kt||(Kt=new Yt),Kt}function Ze(d,n){const u={};for(const m in d)"ref"!==m&&(u[m]=d[m]);return f.refProperties.forEach(m=>{m in n&&(u[m]=n[m])}),u}function Nr(d){d=d.slice();const n=Object.create(null);for(let u=0;u<d.length;u++)n[d[u].id]=d[u];for(let u=0;u<d.length;u++)"ref"in d[u]&&(d[u]=Ze(d[u],n[d[u].ref]));return d}Yt.workerCount=2;const Vt={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setProjection:"setProjection"};function Or(d,n,u){u.push({command:Vt.addSource,args:[d,n[d]]})}function Ur(d,n,u){n.push({command:Vt.removeSource,args:[d]}),u[d]=!0}function Eo(d,n,u,m){Ur(d,u,m),Or(d,n,u)}function as(d,n,u){let m;for(m in d[u])if(d[u].hasOwnProperty(m)&&"data"!==m&&!ut(d[u][m],n[u][m]))return!1;for(m in n[u])if(n[u].hasOwnProperty(m)&&"data"!==m&&!ut(d[u][m],n[u][m]))return!1;return!0}function Tt(d,n,u,m,w,b){let S;for(S in n=n||{},d=d||{})d.hasOwnProperty(S)&&(ut(d[S],n[S])||u.push({command:b,args:[m,S,n[S],w]}));for(S in n)n.hasOwnProperty(S)&&!d.hasOwnProperty(S)&&(ut(d[S],n[S])||u.push({command:b,args:[m,S,n[S],w]}))}function Cr(d){return d.id}function yr(d,n){return d[n.id]=n,d}class Wa{constructor(n,u){this.reset(n,u)}reset(n,u){this.points=n||[],this._distances=[0];for(let m=1;m<this.points.length;m++)this._distances[m]=this._distances[m-1]+this.points[m].dist(this.points[m-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(u||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(n){if(1===this.points.length)return this.points[0];n=f.clamp(n,0,1);let u=1,m=this._distances[u];const w=n*this.paddedLength+this.padding;for(;m<w&&u<this._distances.length;)m=this._distances[++u];const b=u-1,S=this._distances[b],A=m-S,P=A>0?(w-S)/A:0;return this.points[b].mult(1-P).add(this.points[u].mult(P))}}class So{constructor(n,u,m){const w=this.boxCells=[],b=this.circleCells=[];this.xCellCount=Math.ceil(n/m),this.yCellCount=Math.ceil(u/m);for(let S=0;S<this.xCellCount*this.yCellCount;S++)w.push([]),b.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=n,this.height=u,this.xScale=this.xCellCount/n,this.yScale=this.yCellCount/u,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(n,u,m,w,b){this._forEachCell(u,m,w,b,this._insertBoxCell,this.boxUid++),this.boxKeys.push(n),this.bboxes.push(u),this.bboxes.push(m),this.bboxes.push(w),this.bboxes.push(b)}insertCircle(n,u,m,w){this._forEachCell(u-w,m-w,u+w,m+w,this._insertCircleCell,this.circleUid++),this.circleKeys.push(n),this.circles.push(u),this.circles.push(m),this.circles.push(w)}_insertBoxCell(n,u,m,w,b,S){this.boxCells[b].push(S)}_insertCircleCell(n,u,m,w,b,S){this.circleCells[b].push(S)}_query(n,u,m,w,b,S){if(m<0||n>this.width||w<0||u>this.height)return!b&&[];const A=[];if(n<=0&&u<=0&&this.width<=m&&this.height<=w){if(b)return!0;for(let P=0;P<this.boxKeys.length;P++)A.push({key:this.boxKeys[P],x1:this.bboxes[4*P],y1:this.bboxes[4*P+1],x2:this.bboxes[4*P+2],y2:this.bboxes[4*P+3]});for(let P=0;P<this.circleKeys.length;P++){const O=this.circles[3*P],L=this.circles[3*P+1],V=this.circles[3*P+2];A.push({key:this.circleKeys[P],x1:O-V,y1:L-V,x2:O+V,y2:L+V})}return S?A.filter(S):A}return this._forEachCell(n,u,m,w,this._queryCell,A,{hitTest:b,seenUids:{box:{},circle:{}}},S),b?A.length>0:A}_queryCircle(n,u,m,w,b){const S=n-m,A=n+m,P=u-m,O=u+m;if(A<0||S>this.width||O<0||P>this.height)return!w&&[];const L=[];return this._forEachCell(S,P,A,O,this._queryCellCircle,L,{hitTest:w,circle:{x:n,y:u,radius:m},seenUids:{box:{},circle:{}}},b),w?L.length>0:L}query(n,u,m,w,b){return this._query(n,u,m,w,!1,b)}hitTest(n,u,m,w,b){return this._query(n,u,m,w,!0,b)}hitTestCircle(n,u,m,w){return this._queryCircle(n,u,m,!0,w)}_queryCell(n,u,m,w,b,S,A,P){const O=A.seenUids,L=this.boxCells[b];if(null!==L){const Y=this.bboxes;for(const te of L)if(!O.box[te]){O.box[te]=!0;const J=4*te;if(n<=Y[J+2]&&u<=Y[J+3]&&m>=Y[J+0]&&w>=Y[J+1]&&(!P||P(this.boxKeys[te]))){if(A.hitTest)return S.push(!0),!0;S.push({key:this.boxKeys[te],x1:Y[J],y1:Y[J+1],x2:Y[J+2],y2:Y[J+3]})}}}const V=this.circleCells[b];if(null!==V){const Y=this.circles;for(const te of V)if(!O.circle[te]){O.circle[te]=!0;const J=3*te;if(this._circleAndRectCollide(Y[J],Y[J+1],Y[J+2],n,u,m,w)&&(!P||P(this.circleKeys[te]))){if(A.hitTest)return S.push(!0),!0;{const H=Y[J],se=Y[J+1],ie=Y[J+2];S.push({key:this.circleKeys[te],x1:H-ie,y1:se-ie,x2:H+ie,y2:se+ie})}}}}}_queryCellCircle(n,u,m,w,b,S,A,P){const O=A.circle,L=A.seenUids,V=this.boxCells[b];if(null!==V){const te=this.bboxes;for(const J of V)if(!L.box[J]){L.box[J]=!0;const H=4*J;if(this._circleAndRectCollide(O.x,O.y,O.radius,te[H+0],te[H+1],te[H+2],te[H+3])&&(!P||P(this.boxKeys[J])))return S.push(!0),!0}}const Y=this.circleCells[b];if(null!==Y){const te=this.circles;for(const J of Y)if(!L.circle[J]){L.circle[J]=!0;const H=3*J;if(this._circlesCollide(te[H],te[H+1],te[H+2],O.x,O.y,O.radius)&&(!P||P(this.circleKeys[J])))return S.push(!0),!0}}}_forEachCell(n,u,m,w,b,S,A,P){const O=this._convertToXCellCoord(n),L=this._convertToYCellCoord(u),V=this._convertToXCellCoord(m),Y=this._convertToYCellCoord(w);for(let te=O;te<=V;te++)for(let J=L;J<=Y;J++)if(b.call(this,n,u,m,w,this.xCellCount*J+te,S,A,P))return}_convertToXCellCoord(n){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(n*this.xScale)))}_convertToYCellCoord(n){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(n*this.yScale)))}_circlesCollide(n,u,m,w,b,S){const A=w-n,P=b-u,O=m+S;return O*O>A*A+P*P}_circleAndRectCollide(n,u,m,w,b,S,A){const P=(S-w)/2,O=Math.abs(n-(w+P));if(O>P+m)return!1;const L=(A-b)/2,V=Math.abs(u-(b+L));if(V>L+m)return!1;if(O<=P||V<=L)return!0;const Y=O-P,te=V-L;return Y*Y+te*te<=m*m}}const br=Math.tan(85*Math.PI/180);function Ao(d,n,u,m,w,b){const S=f.create();if(u){if("globe"===w.projection.name)f.multiply$1(S,S,f.calculateGlobeLabelMatrix(w,n));else{const A=rl([],b);S[0]=A[0],S[1]=A[1],S[4]=A[2],S[5]=A[3]}m||f.rotateZ(S,S,w.angle)}else f.multiply$1(S,w.labelPlaneMatrix,d);return S}function fl(d,n,u,m,w,b){if(u){if("globe"===w.projection.name){const S=Ao(d,n,u,m,w,b);return f.invert(S,S),f.multiply$1(S,d,S),S}{const S=f.clone(d),A=f.identity([]);return A[0]=b[0],A[1]=b[1],A[4]=b[2],A[5]=b[3],f.multiply$1(S,S,A),m||f.rotateZ(S,S,-w.angle),S}}return w.glCoordMatrix}function Cn(d,n,u=0){const m=[d.x,d.y,u,1];u?f.transformMat4$1(m,m,n):Ji(m,m,n);const w=m[3];return{point:new f.pointGeometry(m[0]/w,m[1]/w),signedDistanceFromCamera:w}}function yn(d,n){const u=[d[0],d[1],d[2],1];f.transformMat4$1(u,u,n);const m=u[3];return{point:new f.pointGeometry(u[0]/m,u[1]/m),signedDistanceFromCamera:m}}function Lr(d,n){return Math.min(.5+d/n*.5,1.5)}function ko(d,n){const u=d[0]/d[3],m=d[1]/d[3];return u>=-n[0]&&u<=n[0]&&m>=-n[1]&&m<=n[1]}function lc(d,n,u,m,w,b,S,A,P,O){const L=u.transform,V=m?d.textSizeData:d.iconSizeData,Y=f.evaluateSizeForZoom(V,u.transform.zoom),te=[256/u.width*2+1,256/u.height*2+1],J=m?d.text.dynamicLayoutVertexArray:d.icon.dynamicLayoutVertexArray;J.clear();const H=d.lineVertexArray,se=m?d.text.placedSymbolArray:d.icon.placedSymbolArray,ie=u.transform.width/u.transform.height;let he=!1;for(let de=0;de<se.length;de++){const ce=se.get(de);if(ce.writingMode!==f.WritingMode.vertical||he||0!==de&&se.get(de-1).writingMode===f.WritingMode.horizontal||(he=!0),(ce.hidden||ce.writingMode===f.WritingMode.vertical)&&!he){Oi(ce.numGlyphs,J);continue}he=!1;const le=new f.pointGeometry(ce.tileAnchorX,ce.tileAnchorY),we=P?P(le):[0,0,0],ze=L.projection.projectTilePoint(le.x,le.y,O.canonical),Be=[ze.x+we[0],ze.y+we[1],ze.z+we[2]],Le=[...Be,1];if(f.transformMat4$1(Le,Le,n),!ko(Le,te)){Oi(ce.numGlyphs,J);continue}const qe=Lr(u.transform.cameraToCenterDistance,Le[3]),Qe=f.evaluateSizeForFeature(V,Y,ce),ke=S?Qe/qe:Qe*qe,gt=Cn(new f.pointGeometry(Be[0],Be[1]),w,Be[2]);if(gt.signedDistanceFromCamera<=0){Oi(ce.numGlyphs,J);continue}let dt={};const It=S?null:P,et=nu(ce,ke,!1,A,n,w,b,d.glyphOffsetArray,H,J,gt.point,le,dt,ie,It,L.projection,O);he=et.useVertical,It&&et.needsFlipping&&(dt={}),(et.notEnoughRoom||he||et.needsFlipping&&nu(ce,ke,!0,A,n,w,b,d.glyphOffsetArray,H,J,gt.point,le,dt,ie,It,L.projection,O).notEnoughRoom)&&Oi(ce.numGlyphs,J)}m?d.text.dynamicLayoutVertexBuffer.updateData(J):d.icon.dynamicLayoutVertexBuffer.updateData(J)}function dl(d,n,u,m,w,b,S,A,P,O,L,V,Y,te,J){const H=A.glyphStartIndex+A.numGlyphs,se=A.lineStartIndex,ie=A.lineStartIndex+A.lineLength,he=n.getoffsetX(A.glyphStartIndex),de=n.getoffsetX(H-1),ce=os(d*he,u,m,w,b,S,A.segment,se,ie,P,O,L,V,Y,!0,te,J);if(!ce)return null;const le=os(d*de,u,m,w,b,S,A.segment,se,ie,P,O,L,V,Y,!0,te,J);return le?{first:ce,last:le}:null}function ss(d,n,u,m){return d.writingMode===f.WritingMode.horizontal&&Math.abs(u.y-n.y)>Math.abs(u.x-n.x)*m?{useVertical:!0}:d.writingMode===f.WritingMode.vertical?n.y<u.y?{needsFlipping:!0}:null:0!==d.flipState&&function(w,b,S){const A=(b.x-w.x)*S;return 0===A||Math.abs((b.y-w.y)/A)>br}(n,u,m)?1===d.flipState?{needsFlipping:!0}:null:n.x>u.x?{needsFlipping:!0}:null}function nu(d,n,u,m,w,b,S,A,P,O,L,V,Y,te,J,H,se){const ie=n/24,he=d.lineOffsetX*ie,de=d.lineOffsetY*ie;let ce;if(d.numGlyphs>1){const le=d.glyphStartIndex+d.numGlyphs,we=d.lineStartIndex,ze=d.lineStartIndex+d.lineLength,Be=dl(ie,A,he,de,u,L,V,d,P,b,Y,J,!1,H,se);if(!Be)return{notEnoughRoom:!0};const Le=Cn(Be.first.point,S).point,qe=Cn(Be.last.point,S).point;if(m&&!u){const Qe=ss(d,Le,qe,te);if(d.flipState=Qe&&Qe.needsFlipping?1:2,Qe)return Qe}ce=[Be.first];for(let Qe=d.glyphStartIndex+1;Qe<le-1;Qe++)ce.push(os(ie*A.getoffsetX(Qe),he,de,u,L,V,d.segment,we,ze,P,b,Y,J,!1,!1,H,se));ce.push(Be.last)}else{if(m&&!u){const we=Cn(V,w).point,ze=d.lineStartIndex+d.segment+1,Be=new f.pointGeometry(P.getx(ze),P.gety(ze)),Le=Cn(Be,w),qe=ss(d,we,Le.signedDistanceFromCamera>0?Le.point:Fr(V,Be,we,1,w,void 0,H,se.canonical),te);if(d.flipState=qe&&qe.needsFlipping?1:2,qe)return qe}const le=os(ie*A.getoffsetX(d.glyphStartIndex),he,de,u,L,V,d.segment,d.lineStartIndex,d.lineStartIndex+d.lineLength,P,b,Y,J,!1,!1,H,se);if(!le)return{notEnoughRoom:!0};ce=[le]}for(const le of ce)f.addDynamicAttributes(O,le.point,le.angle);return{}}function Wn(d,n,u,m,w){const b=m.projectTilePoint(d.x,d.y,n);if(!w)return Cn(b,u,b.z);const S=w(d);return Cn(new f.pointGeometry(b.x+S[0],b.y+S[1]),u,b.z+S[2])}function Fr(d,n,u,m,w,b,S,A){const P=Wn(d.add(d.sub(n)._unit()),A,w,S,b).point,O=u.sub(P);return u.add(O._mult(m/O.mag()))}function os(d,n,u,m,w,b,S,A,P,O,L,V,Y,te,J,H,se){const ie=m?d-n:d+n;let he=ie>0?1:-1,de=0;m&&(he*=-1,de=Math.PI),he<0&&(de+=Math.PI);let ce=he>0?A+S:A+S+1,le=w,we=w,ze=0,Be=0;const Le=Math.abs(ie),qe=[],Qe=[];let ke=b;const gt=()=>{const Et=ce-he;return 0===ze?b:new f.pointGeometry(O.getx(Et),O.gety(Et))},dt=()=>Fr(gt(),ke,we,Le-ze+1,L,Y,H,se.canonical);for(;ze+Be<=Le;){if(ce+=he,ce<A||ce>=P)return null;if(we=le,qe.push(le),te&&Qe.push(ke||gt()),le=V[ce],void 0===le){ke=new f.pointGeometry(O.getx(ce),O.gety(ce));const Et=Wn(ke,se.canonical,L,H,Y);le=Et.signedDistanceFromCamera>0?V[ce]=Et.point:dt()}else ke=null;ze+=Be,Be=we.dist(le)}J&&Y&&(ke=ke||new f.pointGeometry(O.getx(ce),O.gety(ce)),V[ce]=le=void 0===V[ce]?le:dt(),Be=we.dist(le));const It=(Le-ze)/Be,et=le.sub(we),Mt=et.mult(It)._add(we);u&&Mt._add(et._unit()._perp()._mult(u*he));const Jt=de+Math.atan2(le.y-we.y,le.x-we.x);return qe.push(Mt),te&&(ke=ke||new f.pointGeometry(O.getx(ce),O.gety(ce)),Qe.push(function(Et,bt,Ot){const fr=1-Ot;return new f.pointGeometry(Et.x*fr+bt.x*Ot,Et.y*fr+bt.y*Ot)}(Qe.length>0?Qe[Qe.length-1]:ke,ke,It))),{point:Mt,angle:Jt,path:qe,tilePath:Qe}}const Hu=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function Oi(d,n){for(let u=0;u<d;u++){const m=n.length;n.resize(m+4),n.float32.set(Hu,3*m)}}function Ji(d,n,u){const m=n[0],w=n[1];return d[0]=u[0]*m+u[4]*w+u[12],d[1]=u[1]*m+u[5]*w+u[13],d[3]=u[3]*m+u[7]*w+u[15],d}const In=100;class pl{constructor(n,u,m=new So(n.width+200,n.height+200,25),w=new So(n.width+200,n.height+200,25)){this.transform=n,this.grid=m,this.ignoredGrid=w,this.pitchfactor=Math.cos(n._pitch)*n.cameraToCenterDistance,this.screenRightBoundary=n.width+In,this.screenBottomBoundary=n.height+In,this.gridRightBoundary=n.width+200,this.gridBottomBoundary=n.height+200,this.fogState=u}placeCollisionBox(n,u,m,w,b,S,A){let P=u.projectedAnchorX,O=u.projectedAnchorY,L=u.projectedAnchorZ;const V=u.elevation,Y=u.tileID;if(V&&Y){const ce=this.transform.projection.upVector(Y.canonical,u.tileAnchorX,u.tileAnchorY),le=this.transform.projection.upVectorScale(Y.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;P+=ce[0]*V*le,O+=ce[1]*V*le,L+=ce[2]*V*le}const te=this.projectAndGetPerspectiveRatio(S,[P,O,L],u.tileID,"globe"===this.transform.projection.name||!!V||this.transform.pitch>0),J=b*te.perspectiveRatio,H=(u.x1*n+m.x-u.padding)*J+te.point.x,se=(u.y1*n+m.y-u.padding)*J+te.point.y,ie=(u.x2*n+m.x+u.padding)*J+te.point.x,he=(u.y2*n+m.y+u.padding)*J+te.point.y,de=te.perspectiveRatio<=.55||te.occluded;return!this.isInsideGrid(H,se,ie,he)||!w&&this.grid.hitTest(H,se,ie,he,A)||de?{box:[],offscreen:!1,occluded:te.occluded}:{box:[H,se,ie,he],offscreen:this.isOffscreen(H,se,ie,he),occluded:!1}}placeCollisionCircles(n,u,m,w,b,S,A,P,O,L,V,Y,te,J){const H=[],se=this.transform.elevation,ie=se?se.getAtTileOffsetFunc(J,this.transform.center.lat,this.transform.worldSize,this.transform.projection):dt=>[0,0,0],he=new f.pointGeometry(u.tileAnchorX,u.tileAnchorY),de=this.transform.projection.projectTilePoint(u.tileAnchorX,u.tileAnchorY,J.canonical),ce=ie(he),le=[de.x+ce[0],de.y+ce[1],de.z+ce[2]],we=this.projectAndGetPerspectiveRatio(S,[le[0],le[1],le[2]],J,"globe"===this.transform.projection.name||!!se||this.transform.pitch>0),{perspectiveRatio:ze}=we,Be=(L?b/ze:b*ze)/f.ONE_EM,Le=Cn(new f.pointGeometry(le[0],le[1]),A,le[2]).point,qe=we.signedDistanceFromCamera>0?dl(Be,w,u.lineOffsetX*Be,u.lineOffsetY*Be,!1,Le,he,u,m,A,{},se&&!L?ie:null,L&&!!se,this.transform.projection,J):null;let Qe=!1,ke=!1,gt=!0;if(qe&&!we.occluded){const dt=.5*Y*ze+te,It=new f.pointGeometry(-100,-100),et=new f.pointGeometry(this.screenRightBoundary,this.screenBottomBoundary),Mt=new Wa,Jt=qe.first,Et=qe.last;let bt=[];for(let Ht=Jt.path.length-1;Ht>=1;Ht--)bt.push(Jt.path[Ht]);for(let Ht=1;Ht<Et.path.length;Ht++)bt.push(Et.path[Ht]);const Ot=2.5*dt;if(P){const Ht=bt.map(se?(rr,Dr)=>{const vi=ie(Dr<Jt.path.length-1?Jt.tilePath[Jt.path.length-1-Dr]:Et.tilePath[Dr-Jt.path.length+2]);return Cn(rr,P,vi[2])}:rr=>Cn(rr,P));bt=Ht.some(rr=>rr.signedDistanceFromCamera<=0)?[]:Ht.map(rr=>rr.point)}let fr=[];if(bt.length>0){const Ht=bt[0].clone(),rr=bt[0].clone();for(let Dr=1;Dr<bt.length;Dr++)Ht.x=Math.min(Ht.x,bt[Dr].x),Ht.y=Math.min(Ht.y,bt[Dr].y),rr.x=Math.max(rr.x,bt[Dr].x),rr.y=Math.max(rr.y,bt[Dr].y);fr=Ht.x>=It.x&&rr.x<=et.x&&Ht.y>=It.y&&rr.y<=et.y?[bt]:rr.x<It.x||Ht.x>et.x||rr.y<It.y||Ht.y>et.y?[]:f.clipLine([bt],It.x,It.y,et.x,et.y)}for(const Ht of fr){Mt.reset(Ht,.25*dt);let rr=0;rr=Mt.length<=.5*dt?1:Math.ceil(Mt.paddedLength/Ot)+1;for(let Dr=0;Dr<rr;Dr++){const vi=Dr/Math.max(rr-1,1),Tn=Mt.lerp(vi),ui=Tn.x+In,Ki=Tn.y+In;H.push(ui,Ki,dt,0);const pn=ui-dt,Rn=Ki-dt,Ks=ui+dt,Qa=Ki+dt;if(gt=gt&&this.isOffscreen(pn,Rn,Ks,Qa),ke=ke||this.isInsideGrid(pn,Rn,Ks,Qa),!n&&this.grid.hitTestCircle(ui,Ki,dt,V)&&(Qe=!0,!O))return{circles:[],offscreen:!1,collisionDetected:Qe,occluded:!1}}}}return{circles:!O&&Qe||!ke?[]:H,offscreen:gt,collisionDetected:Qe,occluded:we.occluded}}queryRenderedSymbols(n){if(0===n.length||0===this.grid.keysLength()&&0===this.ignoredGrid.keysLength())return{};const u=[];let m=1/0,w=1/0,b=-1/0,S=-1/0;for(const L of n){const V=new f.pointGeometry(L.x+In,L.y+In);m=Math.min(m,V.x),w=Math.min(w,V.y),b=Math.max(b,V.x),S=Math.max(S,V.y),u.push(V)}const A=this.grid.query(m,w,b,S).concat(this.ignoredGrid.query(m,w,b,S)),P={},O={};for(const L of A){const V=L.key;if(void 0===P[V.bucketInstanceId]&&(P[V.bucketInstanceId]={}),P[V.bucketInstanceId][V.featureIndex])continue;const Y=[new f.pointGeometry(L.x1,L.y1),new f.pointGeometry(L.x2,L.y1),new f.pointGeometry(L.x2,L.y2),new f.pointGeometry(L.x1,L.y2)];f.polygonIntersectsPolygon(u,Y)&&(P[V.bucketInstanceId][V.featureIndex]=!0,void 0===O[V.bucketInstanceId]&&(O[V.bucketInstanceId]=[]),O[V.bucketInstanceId].push(V.featureIndex))}return O}insertCollisionBox(n,u,m,w,b){(u?this.ignoredGrid:this.grid).insert({bucketInstanceId:m,featureIndex:w,collisionGroupID:b},n[0],n[1],n[2],n[3])}insertCollisionCircles(n,u,m,w,b){const S=u?this.ignoredGrid:this.grid,A={bucketInstanceId:m,featureIndex:w,collisionGroupID:b};for(let P=0;P<n.length;P+=4)S.insertCircle(A,n[P],n[P+1],n[P+2])}projectAndGetPerspectiveRatio(n,u,m,w){const b=[u[0],u[1],u[2],1];let S=!1;return u[2]||this.transform.pitch>0?(f.transformMat4$1(b,b,n),this.fogState&&m&&(S=function(A,P,O,L,V,Y){const te=Y.calculateFogTileMatrix(V),J=[P,O,L];return f.transformMat4(J,J,te),Fa(A,J,Y.pitch,Y._fov)}(this.fogState,u[0],u[1],u[2],m.toUnwrapped(),this.transform)>.9)):Ji(b,b,n),{point:new f.pointGeometry((b[0]/b[3]+1)/2*this.transform.width+In,(-b[1]/b[3]+1)/2*this.transform.height+In),perspectiveRatio:Math.min(.5+this.transform.cameraToCenterDistance/b[3]*.5,1.5),signedDistanceFromCamera:b[3],occluded:w&&b[2]>b[3]||S}}isOffscreen(n,u,m,w){return m<In||n>=this.screenRightBoundary||w<In||u>this.screenBottomBoundary}isInsideGrid(n,u,m,w){return m>=0&&n<this.gridRightBoundary&&w>=0&&u<this.gridBottomBoundary}getViewportMatrix(){const n=f.identity([]);return f.translate(n,n,[-100,-100,0]),n}}class lr{constructor(n,u,m,w){this.opacity=n?Math.max(0,Math.min(1,n.opacity+(n.placed?u:-u))):w&&m?1:0,this.placed=m}isHidden(){return 0===this.opacity&&!this.placed}}class js{constructor(n,u,m,w,b,S=!1){this.text=new lr(n?n.text:null,u,m,b),this.icon=new lr(n?n.icon:null,u,w,b),this.clipped=S}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class ri{constructor(n,u,m,w=!1){this.text=n,this.icon=u,this.skipFade=m,this.clipped=w}}class zi{constructor(){this.invProjMatrix=f.create(),this.viewportMatrix=f.create(),this.circles=[]}}class Xa{constructor(n,u,m,w,b){this.bucketInstanceId=n,this.featureIndex=u,this.sourceLayerIndex=m,this.bucketIndex=w,this.tileID=b}}class Mn{constructor(n){this.crossSourceCollisions=n,this.maxGroupID=0,this.collisionGroups={}}get(n){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[n]){const u=++this.maxGroupID;this.collisionGroups[n]={ID:u,predicate:m=>m.collisionGroupID===u}}return this.collisionGroups[n]}}function Qi(d,n,u,m,w){const{horizontalAlign:b,verticalAlign:S}=f.getAnchorAlignment(d),A=-(b-.5)*n,P=-(S-.5)*u,O=f.evaluateVariableOffset(d,m);return new f.pointGeometry(A+O[0]*w,P+O[1]*w)}function _r(d,n,u,m,w){const b=new f.pointGeometry(d,n);return u&&b._rotate(m?w:-w),b}class ls{constructor(n,u,m,w,b){this.transform=n.clone(),this.collisionIndex=new pl(this.transform,b),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=u,this.retainedQueryData={},this.collisionGroups=new Mn(m),this.collisionCircleArrays={},this.prevPlacement=w,w&&(w.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(n,u,m,w){const b=m.getBucket(u),S=m.latestFeatureIndex;if(!b||!S||u.id!==b.layerIds[0])return;const A=b.layers[0].layout,P=m.collisionBoxArray,O=Math.pow(2,this.transform.zoom-m.tileID.overscaledZ),L=m.tileSize/f.EXTENT,V=m.tileID.toUnwrapped(),Y=this.transform.calculateProjMatrix(V),te="map"===A.get("text-pitch-alignment"),J="map"===A.get("text-rotation-alignment");u.compileFilter();const H=u.dynamicFilter(),se=u.dynamicFilterNeedsFeature(),ie=this.transform.calculatePixelsToTileUnitsMatrix(m),he=Ao(Y,m.tileID.canonical,te,J,this.transform,ie);let de=null;if(te){const we=fl(Y,m.tileID.canonical,te,J,this.transform,ie);de=f.multiply$1([],this.transform.labelPlaneMatrix,we)}let ce=null;H&&m.latestFeatureIndex&&(ce={unwrappedTileID:V,dynamicFilter:H,dynamicFilterNeedsFeature:se,featureIndex:m.latestFeatureIndex}),this.retainedQueryData[b.bucketInstanceId]=new Xa(b.bucketInstanceId,S,b.sourceLayerIndex,b.index,m.tileID);const le={bucket:b,layout:A,posMatrix:Y,textLabelPlaneMatrix:he,labelToScreenMatrix:de,clippingData:ce,scale:O,textPixelRatio:L,holdingForFade:m.holdingForFade(),collisionBoxArray:P,partiallyEvaluatedTextSize:f.evaluateSizeForZoom(b.textSizeData,this.transform.zoom),partiallyEvaluatedIconSize:f.evaluateSizeForZoom(b.iconSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(b.sourceID)};if(w)for(const we of b.sortKeyRanges){const{sortKey:ze,symbolInstanceStart:Be,symbolInstanceEnd:Le}=we;n.push({sortKey:ze,symbolInstanceStart:Be,symbolInstanceEnd:Le,parameters:le})}else n.push({symbolInstanceStart:0,symbolInstanceEnd:b.symbolInstances.length,parameters:le})}attemptAnchorPlacement(n,u,m,w,b,S,A,P,O,L,V,Y,te,J,H,se,ie,he){const de=[Y.textOffset0,Y.textOffset1],ce=Qi(n,m,w,de,b),le=this.collisionIndex.placeCollisionBox(b,u,_r(ce.x,ce.y,S,A,this.transform.angle),V,P,O,L.predicate);if((!se||0!==this.collisionIndex.placeCollisionBox(J.getSymbolInstanceIconSize(he,this.transform.zoom,te),se,_r(ce.x,ce.y,S,A,this.transform.angle),V,P,O,L.predicate).box.length)&&le.box.length>0){let we;return this.prevPlacement&&this.prevPlacement.variableOffsets[Y.crossTileID]&&this.prevPlacement.placements[Y.crossTileID]&&this.prevPlacement.placements[Y.crossTileID].text&&(we=this.prevPlacement.variableOffsets[Y.crossTileID].anchor),this.variableOffsets[Y.crossTileID]={textOffset:de,width:m,height:w,anchor:n,textScale:b,prevAnchor:we},this.markUsedJustification(J,n,Y,H),J.allowVerticalPlacement&&(this.markUsedOrientation(J,H,Y),this.placedOrientations[Y.crossTileID]=H),{shift:ce,placedGlyphBoxes:le}}}placeLayerBucketPart(n,u,m,w){const{bucket:b,layout:S,posMatrix:A,textLabelPlaneMatrix:P,labelToScreenMatrix:O,clippingData:L,textPixelRatio:V,holdingForFade:Y,collisionBoxArray:te,partiallyEvaluatedTextSize:J,partiallyEvaluatedIconSize:H,collisionGroup:se}=n.parameters,ie=S.get("text-optional"),he=S.get("icon-optional"),de=S.get("text-allow-overlap"),ce=S.get("icon-allow-overlap"),le="map"===S.get("text-rotation-alignment"),we="map"===S.get("text-pitch-alignment"),ze="none"!==S.get("icon-text-fit"),Be="viewport-y"===S.get("symbol-z-order");let Le=de&&(ce||!b.hasIconData()||he),qe=ce&&(de||!b.hasTextData()||ie);!b.collisionArrays&&te&&b.deserializeCollisionBoxes(te),m&&w&&b.updateCollisionDebugBuffers(this.transform.zoom,te);const Qe=(ke,gt,dt)=>{if(L){const pi={zoom:this.transform.zoom,pitch:this.transform.pitch};let mi=null;if(L.dynamicFilterNeedsFeature){const Zr=this.retainedQueryData[b.bucketInstanceId];mi=L.featureIndex.loadFeature({featureIndex:ke.featureIndex,bucketIndex:Zr.bucketIndex,sourceLayerIndex:Zr.sourceLayerIndex,layoutVertexArrayOffset:0})}if(!(0,L.dynamicFilter)(pi,mi,this.retainedQueryData[b.bucketInstanceId].tileID.canonical,new f.pointGeometry(ke.tileAnchorX,ke.tileAnchorY),this.transform.calculateDistanceTileData(L.unwrappedTileID)))return this.placements[ke.crossTileID]=new ri(!1,!1,!1,!0),void(u[ke.crossTileID]=!0)}if(u[ke.crossTileID])return;if(Y)return void(this.placements[ke.crossTileID]=new ri(!1,!1,!1));let It=!1,et=!1,Mt=!0,Jt=!1,Et=!1,bt=null,Ot={box:null,offscreen:null,occluded:null},fr={box:null,offscreen:null,occluded:null},Ht=null,rr=null,Dr=null,vi=0,Tn=0,ui=0;dt.textFeatureIndex?vi=dt.textFeatureIndex:ke.useRuntimeCollisionCircles&&(vi=ke.featureIndex),dt.verticalTextFeatureIndex&&(Tn=dt.verticalTextFeatureIndex);const Ki=pi=>{pi.tileID=this.retainedQueryData[b.bucketInstanceId].tileID,(this.transform.elevation||pi.elevation)&&(pi.elevation=this.transform.elevation?this.transform.elevation.getAtTileOffset(this.retainedQueryData[b.bucketInstanceId].tileID,pi.tileAnchorX,pi.tileAnchorY):0)},pn=dt.textBox;if(pn){Ki(pn);const pi=Zr=>{let Ci=f.WritingMode.horizontal;if(b.allowVerticalPlacement&&!Zr&&this.prevPlacement){const On=this.prevPlacement.placedOrientations[ke.crossTileID];On&&(this.placedOrientations[ke.crossTileID]=On,Ci=On,this.markUsedOrientation(b,Ci,ke))}return Ci},mi=(Zr,Ci)=>{if(b.allowVerticalPlacement&&ke.numVerticalGlyphVertices>0&&dt.verticalTextBox){for(const On of b.writingModes)if(On===f.WritingMode.vertical?(Ot=Ci(),fr=Ot):Ot=Zr(),Ot&&Ot.box&&Ot.box.length)break}else Ot=Zr()};if(S.get("text-variable-anchor")){let Zr=S.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[ke.crossTileID]){const hi=this.prevPlacement.variableOffsets[ke.crossTileID];Zr.indexOf(hi.anchor)>0&&(Zr=Zr.filter(ua=>ua!==hi.anchor),Zr.unshift(hi.anchor))}const Ci=(hi,ua,Ll)=>{const ha=b.getSymbolInstanceTextSize(J,ke,this.transform.zoom,gt),fa=(hi.x2-hi.x1)*ha+2*hi.padding,$o=(hi.y2-hi.y1)*ha+2*hi.padding,rn=ze&&!ce?ua:null;rn&&Ki(rn);let ya={box:[],offscreen:!1,occluded:!1};const cd=de?2*Zr.length:Zr.length;for(let Va=0;Va<cd;++Va){const mh=this.attemptAnchorPlacement(Zr[Va%Zr.length],hi,fa,$o,ha,le,we,V,A,se,Va>=Zr.length,ke,gt,b,Ll,rn,J,H);if(mh&&(ya=mh.placedGlyphBoxes,ya&&ya.box&&ya.box.length)){It=!0,bt=mh.shift;break}}return ya};mi(()=>Ci(pn,dt.iconBox,f.WritingMode.horizontal),()=>{const hi=dt.verticalTextBox;return hi&&Ki(hi),b.allowVerticalPlacement&&!(Ot&&Ot.box&&Ot.box.length)&&ke.numVerticalGlyphVertices>0&&hi?Ci(hi,dt.verticalIconBox,f.WritingMode.vertical):{box:null,offscreen:null,occluded:null}}),Ot&&(It=Ot.box,Mt=Ot.offscreen,Jt=Ot.occluded);const On=pi(Ot&&Ot.box);if(!It&&this.prevPlacement){const hi=this.prevPlacement.variableOffsets[ke.crossTileID];hi&&(this.variableOffsets[ke.crossTileID]=hi,this.markUsedJustification(b,hi.anchor,ke,On))}}else{const Zr=(Ci,On)=>{const hi=b.getSymbolInstanceTextSize(J,ke,this.transform.zoom,gt),ua=this.collisionIndex.placeCollisionBox(hi,Ci,new f.pointGeometry(0,0),de,V,A,se.predicate);return ua&&ua.box&&ua.box.length&&(this.markUsedOrientation(b,On,ke),this.placedOrientations[ke.crossTileID]=On),ua};mi(()=>Zr(pn,f.WritingMode.horizontal),()=>{const Ci=dt.verticalTextBox;return b.allowVerticalPlacement&&ke.numVerticalGlyphVertices>0&&Ci?(Ki(Ci),Zr(Ci,f.WritingMode.vertical)):{box:null,offscreen:null,occluded:null}}),pi(Ot&&Ot.box&&Ot.box.length)}}if(Ht=Ot,It=Ht&&Ht.box&&Ht.box.length>0,Mt=Ht&&Ht.offscreen,Jt=Ht&&Ht.occluded,ke.useRuntimeCollisionCircles){const pi=b.text.placedSymbolArray.get(ke.centerJustifiedTextSymbolIndex>=0?ke.centerJustifiedTextSymbolIndex:ke.verticalPlacedTextSymbolIndex),mi=f.evaluateSizeForFeature(b.textSizeData,J,pi),Zr=S.get("text-padding");rr=this.collisionIndex.placeCollisionCircles(de,pi,b.lineVertexArray,b.glyphOffsetArray,mi,A,P,O,m,we,se.predicate,ke.collisionCircleDiameter*mi/f.ONE_EM,Zr,this.retainedQueryData[b.bucketInstanceId].tileID),It=de||rr.circles.length>0&&!rr.collisionDetected,Mt=Mt&&rr.offscreen,Jt=rr.occluded}if(dt.iconFeatureIndex&&(ui=dt.iconFeatureIndex),dt.iconBox){const pi=mi=>{Ki(mi);const Zr=ze&&bt?_r(bt.x,bt.y,le,we,this.transform.angle):new f.pointGeometry(0,0),Ci=b.getSymbolInstanceIconSize(H,this.transform.zoom,gt);return this.collisionIndex.placeCollisionBox(Ci,mi,Zr,ce,V,A,se.predicate)};fr&&fr.box&&fr.box.length&&dt.verticalIconBox?(Dr=pi(dt.verticalIconBox),et=Dr.box.length>0):(Dr=pi(dt.iconBox),et=Dr.box.length>0),Mt=Mt&&Dr.offscreen,Et=Dr.occluded}const Rn=ie||0===ke.numHorizontalGlyphVertices&&0===ke.numVerticalGlyphVertices,Ks=he||0===ke.numIconVertices;if(Rn||Ks?Ks?Rn||(et=et&&It):It=et&&It:et=It=et&&It,It&&Ht&&Ht.box&&this.collisionIndex.insertCollisionBox(Ht.box,S.get("text-ignore-placement"),b.bucketInstanceId,fr&&fr.box&&Tn?Tn:vi,se.ID),et&&Dr&&this.collisionIndex.insertCollisionBox(Dr.box,S.get("icon-ignore-placement"),b.bucketInstanceId,ui,se.ID),rr&&(It&&this.collisionIndex.insertCollisionCircles(rr.circles,S.get("text-ignore-placement"),b.bucketInstanceId,vi,se.ID),m)){const pi=b.bucketInstanceId;let mi=this.collisionCircleArrays[pi];void 0===mi&&(mi=this.collisionCircleArrays[pi]=new zi);for(let Zr=0;Zr<rr.circles.length;Zr+=4)mi.circles.push(rr.circles[Zr+0]),mi.circles.push(rr.circles[Zr+1]),mi.circles.push(rr.circles[Zr+2]),mi.circles.push(rr.collisionDetected?1:0)}const Qa="globe"!==this.transform.projection.name;Le=Le&&(Qa||!Jt),qe=qe&&(Qa||!Et),this.placements[ke.crossTileID]=new ri(It||Le,et||qe,Mt||b.justReloaded),u[ke.crossTileID]=!0};if(Be){const ke=b.getSortedSymbolIndexes(this.transform.angle);for(let gt=ke.length-1;gt>=0;--gt){const dt=ke[gt];Qe(b.symbolInstances.get(dt),dt,b.collisionArrays[dt])}}else for(let ke=n.symbolInstanceStart;ke<n.symbolInstanceEnd;ke++)Qe(b.symbolInstances.get(ke),ke,b.collisionArrays[ke]);if(m&&b.bucketInstanceId in this.collisionCircleArrays){const ke=this.collisionCircleArrays[b.bucketInstanceId];f.invert(ke.invProjMatrix,A),ke.viewportMatrix=this.collisionIndex.getViewportMatrix()}b.justReloaded=!1}markUsedJustification(n,u,m,w){let b;b=w===f.WritingMode.vertical?m.verticalPlacedTextSymbolIndex:{left:m.leftJustifiedTextSymbolIndex,center:m.centerJustifiedTextSymbolIndex,right:m.rightJustifiedTextSymbolIndex}[f.getAnchorJustification(u)];const S=[m.leftJustifiedTextSymbolIndex,m.centerJustifiedTextSymbolIndex,m.rightJustifiedTextSymbolIndex,m.verticalPlacedTextSymbolIndex];for(const A of S)A>=0&&(n.text.placedSymbolArray.get(A).crossTileID=b>=0&&A!==b?0:m.crossTileID)}markUsedOrientation(n,u,m){const w=u===f.WritingMode.horizontal||u===f.WritingMode.horizontalOnly?u:0,b=u===f.WritingMode.vertical?u:0,S=[m.leftJustifiedTextSymbolIndex,m.centerJustifiedTextSymbolIndex,m.rightJustifiedTextSymbolIndex];for(const A of S)n.text.placedSymbolArray.get(A).placedOrientation=w;m.verticalPlacedTextSymbolIndex&&(n.text.placedSymbolArray.get(m.verticalPlacedTextSymbolIndex).placedOrientation=b)}commit(n){this.commitTime=n,this.zoomAtLastRecencyCheck=this.transform.zoom;const u=this.prevPlacement;let m=!1;this.prevZoomAdjustment=u?u.zoomAdjustment(this.transform.zoom):0;const w=u?u.symbolFadeChange(n):1,b=u?u.opacities:{},S=u?u.variableOffsets:{},A=u?u.placedOrientations:{};for(const P in this.placements){const O=this.placements[P],L=b[P];L?(this.opacities[P]=new js(L,w,O.text,O.icon,null,O.clipped),m=m||O.text!==L.text.placed||O.icon!==L.icon.placed):(this.opacities[P]=new js(null,w,O.text,O.icon,O.skipFade,O.clipped),m=m||O.text||O.icon)}for(const P in b){const O=b[P];if(!this.opacities[P]){const L=new js(O,w,!1,!1);L.isHidden()||(this.opacities[P]=L,m=m||O.text.placed||O.icon.placed)}}for(const P in S)this.variableOffsets[P]||!this.opacities[P]||this.opacities[P].isHidden()||(this.variableOffsets[P]=S[P]);for(const P in A)this.placedOrientations[P]||!this.opacities[P]||this.opacities[P].isHidden()||(this.placedOrientations[P]=A[P]);m?this.lastPlacementChangeTime=n:"number"!=typeof this.lastPlacementChangeTime&&(this.lastPlacementChangeTime=u?u.lastPlacementChangeTime:n)}updateLayerOpacities(n,u){const m={};for(const w of u){const b=w.getBucket(n);b&&w.latestFeatureIndex&&n.id===b.layerIds[0]&&this.updateBucketOpacities(b,m,w.collisionBoxArray)}}updateBucketOpacities(n,u,m){n.hasTextData()&&n.text.opacityVertexArray.clear(),n.hasIconData()&&n.icon.opacityVertexArray.clear(),n.hasIconCollisionBoxData()&&n.iconCollisionBox.collisionVertexArray.clear(),n.hasTextCollisionBoxData()&&n.textCollisionBox.collisionVertexArray.clear();const w=n.layers[0].layout,b=!!n.layers[0].dynamicFilter(),S=new js(null,0,!1,!1,!0),A=w.get("text-allow-overlap"),P=w.get("icon-allow-overlap"),O=w.get("text-variable-anchor"),L="map"===w.get("text-rotation-alignment"),V="map"===w.get("text-pitch-alignment"),Y="none"!==w.get("icon-text-fit"),te=new js(null,0,A&&(P||!n.hasIconData()||w.get("icon-optional")),P&&(A||!n.hasTextData()||w.get("text-optional")),!0);!n.collisionArrays&&m&&(n.hasIconCollisionBoxData()||n.hasTextCollisionBoxData())&&n.deserializeCollisionBoxes(m);const J=(se,ie,he)=>{for(let de=0;de<ie/4;de++)se.opacityVertexArray.emplaceBack(he)};let H=0;for(let se=0;se<n.symbolInstances.length;se++){const ie=n.symbolInstances.get(se),{numHorizontalGlyphVertices:he,numVerticalGlyphVertices:de,crossTileID:ce}=ie;let le=this.opacities[ce];u[ce]?le=S:le||(le=te,this.opacities[ce]=le),u[ce]=!0;const we=he>0||de>0,ze=ie.numIconVertices>0,Be=this.placedOrientations[ie.crossTileID],Le=Be===f.WritingMode.vertical,qe=Be===f.WritingMode.horizontal||Be===f.WritingMode.horizontalOnly;if(!we&&!ze||le.isHidden()||H++,we){const Qe=tf(le.text);J(n.text,he,Le?Hi:Qe),J(n.text,de,qe?Hi:Qe);const ke=le.text.isHidden();[ie.rightJustifiedTextSymbolIndex,ie.centerJustifiedTextSymbolIndex,ie.leftJustifiedTextSymbolIndex].forEach(It=>{It>=0&&(n.text.placedSymbolArray.get(It).hidden=ke||Le?1:0)}),ie.verticalPlacedTextSymbolIndex>=0&&(n.text.placedSymbolArray.get(ie.verticalPlacedTextSymbolIndex).hidden=ke||qe?1:0);const gt=this.variableOffsets[ie.crossTileID];gt&&this.markUsedJustification(n,gt.anchor,ie,Be);const dt=this.placedOrientations[ie.crossTileID];dt&&(this.markUsedJustification(n,"left",ie,dt),this.markUsedOrientation(n,dt,ie))}if(ze){const Qe=tf(le.icon);ie.placedIconSymbolIndex>=0&&(J(n.icon,ie.numIconVertices,Le?Hi:Qe),n.icon.placedSymbolArray.get(ie.placedIconSymbolIndex).hidden=le.icon.isHidden()),ie.verticalPlacedIconSymbolIndex>=0&&(J(n.icon,ie.numVerticalIconVertices,qe?Hi:Qe),n.icon.placedSymbolArray.get(ie.verticalPlacedIconSymbolIndex).hidden=le.icon.isHidden())}if(n.hasIconCollisionBoxData()||n.hasTextCollisionBoxData()){const Qe=n.collisionArrays[se];if(Qe){let ke=new f.pointGeometry(0,0),gt=!0;if(Qe.textBox||Qe.verticalTextBox){if(O){const It=this.variableOffsets[ce];It?(ke=Qi(It.anchor,It.width,It.height,It.textOffset,It.textScale),L&&ke._rotate(V?this.transform.angle:-this.transform.angle)):gt=!1}b&&(gt=!le.clipped),Qe.textBox&&en(n.textCollisionBox.collisionVertexArray,le.text.placed,!gt||Le,ke.x,ke.y),Qe.verticalTextBox&&en(n.textCollisionBox.collisionVertexArray,le.text.placed,!gt||qe,ke.x,ke.y)}const dt=gt&&Boolean(!qe&&Qe.verticalIconBox);Qe.iconBox&&en(n.iconCollisionBox.collisionVertexArray,le.icon.placed,dt,Y?ke.x:0,Y?ke.y:0),Qe.verticalIconBox&&en(n.iconCollisionBox.collisionVertexArray,le.icon.placed,!dt,Y?ke.x:0,Y?ke.y:0)}}}if(n.fullyClipped=0===H,n.sortFeatures(this.transform.angle),this.retainedQueryData[n.bucketInstanceId]&&(this.retainedQueryData[n.bucketInstanceId].featureSortOrder=n.featureSortOrder),n.hasTextData()&&n.text.opacityVertexBuffer&&n.text.opacityVertexBuffer.updateData(n.text.opacityVertexArray),n.hasIconData()&&n.icon.opacityVertexBuffer&&n.icon.opacityVertexBuffer.updateData(n.icon.opacityVertexArray),n.hasIconCollisionBoxData()&&n.iconCollisionBox.collisionVertexBuffer&&n.iconCollisionBox.collisionVertexBuffer.updateData(n.iconCollisionBox.collisionVertexArray),n.hasTextCollisionBoxData()&&n.textCollisionBox.collisionVertexBuffer&&n.textCollisionBox.collisionVertexBuffer.updateData(n.textCollisionBox.collisionVertexArray),n.bucketInstanceId in this.collisionCircleArrays){const se=this.collisionCircleArrays[n.bucketInstanceId];n.placementInvProjMatrix=se.invProjMatrix,n.placementViewportMatrix=se.viewportMatrix,n.collisionCircleArray=se.circles,delete this.collisionCircleArrays[n.bucketInstanceId]}}symbolFadeChange(n){return 0===this.fadeDuration?1:(n-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(n){return Math.max(0,(this.transform.zoom-n)/1.5)}hasTransitions(n){return this.stale||n-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(n,u){const m=this.zoomAtLastRecencyCheck===u?1-this.zoomAdjustment(u):1;return this.zoomAtLastRecencyCheck=u,this.commitTime+this.fadeDuration*m>n}setStale(){this.stale=!0}}function en(d,n,u,m,w){d.emplaceBack(n?1:0,u?1:0,m||0,w||0),d.emplaceBack(n?1:0,u?1:0,m||0,w||0),d.emplaceBack(n?1:0,u?1:0,m||0,w||0),d.emplaceBack(n?1:0,u?1:0,m||0,w||0)}const ef=Math.pow(2,25),Xn=Math.pow(2,24),hn=Math.pow(2,17),za=Math.pow(2,16),qs=Math.pow(2,9),cc=Math.pow(2,8),Bi=Math.pow(2,1);function tf(d){if(0===d.opacity&&!d.placed)return 0;if(1===d.opacity&&d.placed)return 4294967295;const n=d.placed?1:0,u=Math.floor(127*d.opacity);return u*ef+n*Xn+u*hn+n*za+u*qs+n*cc+u*Bi+n}const Hi=0;class Co{constructor(n){this._sortAcrossTiles="viewport-y"!==n.layout.get("symbol-z-order")&&void 0!==n.layout.get("symbol-sort-key").constantOr(1),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(n,u,m,w,b){const S=this._bucketParts;for(;this._currentTileIndex<n.length;)if(u.getBucketParts(S,w,n[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,b())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,S.sort((A,P)=>A.sortKey-P.sortKey));this._currentPartIndex<S.length;){const A=S[this._currentPartIndex];if(u.placeLayerBucketPart(A,this._seenCrossTileIDs,m,0===A.symbolInstanceStart),this._currentPartIndex++,b())return!0}return!1}}class ml{constructor(n,u,m,w,b,S,A,P){this.placement=new ls(n,b,S,A,P),this._currentPlacementIndex=u.length-1,this._forceFullPlacement=m,this._showCollisionBoxes=w,this._done=!1}isDone(){return this._done}continuePlacement(n,u,m){const w=f.exported.now(),b=()=>{const S=f.exported.now()-w;return!this._forceFullPlacement&&S>2};for(;this._currentPlacementIndex>=0;){const S=u[n[this._currentPlacementIndex]],A=this.placement.collisionIndex.transform.zoom;if("symbol"===S.type&&(!S.minzoom||S.minzoom<=A)&&(!S.maxzoom||S.maxzoom>A)){if(this._inProgressLayer||(this._inProgressLayer=new Co(S)),this._inProgressLayer.continuePlacement(m[S.source],this.placement,this._showCollisionBoxes,S,b))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(n){return this.placement.commit(n),this.placement}}const ga=512/f.EXTENT/2;class Yu{constructor(n,u,m){this.tileID=n,this.indexedSymbolInstances={},this.bucketInstanceId=m;for(let w=0;w<u.length;w++){const b=u.get(w),S=b.key;this.indexedSymbolInstances[S]||(this.indexedSymbolInstances[S]=[]),this.indexedSymbolInstances[S].push({crossTileID:b.crossTileID,coord:this.getScaledCoordinates(b,n)})}}getScaledCoordinates(n,u){const m=ga/Math.pow(2,u.canonical.z-this.tileID.canonical.z);return{x:Math.floor((u.canonical.x*f.EXTENT+n.tileAnchorX)*m),y:Math.floor((u.canonical.y*f.EXTENT+n.tileAnchorY)*m)}}findMatches(n,u,m){const w=this.tileID.canonical.z<u.canonical.z?1:Math.pow(2,this.tileID.canonical.z-u.canonical.z);for(let b=0;b<n.length;b++){const S=n.get(b);if(S.crossTileID)continue;const A=this.indexedSymbolInstances[S.key];if(!A)continue;const P=this.getScaledCoordinates(S,u);for(const O of A)if(Math.abs(O.coord.x-P.x)<=w&&Math.abs(O.coord.y-P.y)<=w&&!m[O.crossTileID]){m[O.crossTileID]=!0,S.crossTileID=O.crossTileID;break}}}}class uc{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class ad{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(n){const u=Math.round((n-this.lng)/360);if(0!==u)for(const m in this.indexes){const w=this.indexes[m],b={};for(const S in w){const A=w[S];A.tileID=A.tileID.unwrapTo(A.tileID.wrap+u),b[A.tileID.key]=A}this.indexes[m]=b}this.lng=n}addBucket(n,u,m){if(this.indexes[n.overscaledZ]&&this.indexes[n.overscaledZ][n.key]){if(this.indexes[n.overscaledZ][n.key].bucketInstanceId===u.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(n.overscaledZ,this.indexes[n.overscaledZ][n.key])}for(let b=0;b<u.symbolInstances.length;b++)u.symbolInstances.get(b).crossTileID=0;this.usedCrossTileIDs[n.overscaledZ]||(this.usedCrossTileIDs[n.overscaledZ]={});const w=this.usedCrossTileIDs[n.overscaledZ];for(const b in this.indexes){const S=this.indexes[b];if(Number(b)>n.overscaledZ)for(const A in S){const P=S[A];P.tileID.isChildOf(n)&&P.findMatches(u.symbolInstances,n,w)}else{const A=S[n.scaledTo(Number(b)).key];A&&A.findMatches(u.symbolInstances,n,w)}}for(let b=0;b<u.symbolInstances.length;b++){const S=u.symbolInstances.get(b);S.crossTileID||(S.crossTileID=m.generate(),w[S.crossTileID]=!0)}return void 0===this.indexes[n.overscaledZ]&&(this.indexes[n.overscaledZ]={}),this.indexes[n.overscaledZ][n.key]=new Yu(n,u.symbolInstances,u.bucketInstanceId),!0}removeBucketCrossTileIDs(n,u){for(const m in u.indexedSymbolInstances)for(const w of u.indexedSymbolInstances[m])delete this.usedCrossTileIDs[n][w.crossTileID]}removeStaleBuckets(n){let u=!1;for(const m in this.indexes){const w=this.indexes[m];for(const b in w)n[w[b].bucketInstanceId]||(this.removeBucketCrossTileIDs(m,w[b]),delete w[b],u=!0)}return u}}class au{constructor(){this.layerIndexes={},this.crossTileIDs=new uc,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(n,u,m,w){let b=this.layerIndexes[n.id];void 0===b&&(b=this.layerIndexes[n.id]=new ad);let S=!1;const A={};"globe"!==w.name&&b.handleWrapJump(m);for(const P of u){const O=P.getBucket(n);O&&n.id===O.layerIds[0]&&(O.bucketInstanceId||(O.bucketInstanceId=++this.maxBucketInstanceId),b.addBucket(P.tileID,O,this.crossTileIDs)&&(S=!0),A[O.bucketInstanceId]=!0)}return b.removeStaleBuckets(A)&&(S=!0),S}pruneUnusedLayers(n){const u={};n.forEach(m=>{u[m]=!0});for(const m in this.layerIndexes)u[m]||delete this.layerIndexes[m]}}const _l=(d,n)=>f.emitValidationErrors(d,n&&n.filter(u=>"source.canvas"!==u.identifier)),Io=f.pick(Vt,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setProjection"]),hc=f.pick(Vt,["setCenter","setZoom","setBearing","setPitch"]),Ku={version:8,layers:[],sources:{}},cs={fill:!0,line:!0,background:!0,hillshade:!0,raster:!0};class Hn extends f.Evented{constructor(n,u={}){super(),this.map=n,this.dispatcher=new Rr(nr(),this),this.imageManager=new Gi,this.imageManager.setEventedParent(this),this.glyphManager=new f.GlyphManager(n._requestManager,u.localFontFamily?f.LocalGlyphMode.all:u.localIdeographFontFamily?f.LocalGlyphMode.ideographs:f.LocalGlyphMode.none,u.localFontFamily||u.localIdeographFontFamily),this.lineAtlas=new f.LineAtlas(256,512),this.crossTileSymbolIndex=new au,this._layers={},this._num3DLayers=0,this._numSymbolLayers=0,this._numCircleLayers=0,this._serializedLayers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this.zoomHistory=new f.ZoomHistory,this._loaded=!1,this._availableImages=[],this._order=[],this._drapedFirstOrder=[],this._markersNeedUpdate=!1,this._resetUpdates(),this.dispatcher.broadcast("setReferrer",f.getReferrer());const m=this;this._rtlTextPluginCallback=Hn.registerForPluginStateChange(w=>{m.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:w.pluginStatus,pluginURL:w.pluginURL},(b,S)=>{if(f.triggerPluginCompletionEvent(b),S&&S.every(A=>A))for(const A in m._sourceCaches){const P=m._sourceCaches[A],O=P.getSource().type;"vector"!==O&&"geojson"!==O||P.reload()}})}),this.on("data",w=>{if("source"!==w.dataType||"metadata"!==w.sourceDataType)return;const b=this.getSource(w.sourceId);if(b&&b.vectorLayerIds)for(const S in this._layers){const A=this._layers[S];A.source===b.id&&this._validateLayer(A)}})}loadURL(n,u={}){this.fire(new f.Event("dataloading",{dataType:"style"}));const m="boolean"==typeof u.validate?u.validate:!f.isMapboxURL(n);n=this.map._requestManager.normalizeStyleURL(n,u.accessToken);const w=this.map._requestManager.transformRequest(n,f.ResourceType.Style);this._request=f.getJSON(w,(b,S)=>{this._request=null,b?this.fire(new f.ErrorEvent(b)):S&&this._load(S,m)})}loadJSON(n,u={}){this.fire(new f.Event("dataloading",{dataType:"style"})),this._request=f.exported.frame(()=>{this._request=null,this._load(n,!1!==u.validate)})}loadEmpty(){this.fire(new f.Event("dataloading",{dataType:"style"})),this._load(Ku,!1)}_updateLayerCount(n,u){const m=u?1:-1;n.is3D()&&(this._num3DLayers+=m),"circle"===n.type&&(this._numCircleLayers+=m),"symbol"===n.type&&(this._numSymbolLayers+=m)}_load(n,u){if(u&&_l(this,f.validateStyle(n)))return;this._loaded=!0,this.stylesheet=n,this._updateMapProjection();for(const w in n.sources)this.addSource(w,n.sources[w],{validate:!1});this._changed=!1,n.sprite?this._loadSprite(n.sprite):(this.imageManager.setLoaded(!0),this.dispatcher.broadcast("spriteLoaded",!0)),this.glyphManager.setURL(n.glyphs);const m=Nr(this.stylesheet.layers);this._order=m.map(w=>w.id),this._layers={},this._serializedLayers={};for(let w of m)w=f.createStyleLayer(w),w.setEventedParent(this,{layer:{id:w.id}}),this._layers[w.id]=w,this._serializedLayers[w.id]=w.serialize(),this._updateLayerCount(w,!0);this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new Kc(this.stylesheet.light),this.stylesheet.terrain&&!this.terrainSetForDrapingOnly()&&this._createTerrain(this.stylesheet.terrain,1),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this._updateDrapeFirstLayers(),this.fire(new f.Event("data",{dataType:"style"})),this.fire(new f.Event("style.load"))}terrainSetForDrapingOnly(){return!!this.terrain&&0===this.terrain.drapeRenderMode}setProjection(n){n?this.stylesheet.projection=n:delete this.stylesheet.projection,this.map._explicitProjection||this.map._updateProjection()}_updateMapProjection(){this.map._explicitProjection?this.applyProjectionUpdate():this.map._updateProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?this.getTerrain()||this.stylesheet.terrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null))}_loadSprite(n){this._spriteRequest=function(u,m,w){let b,S,A;const P=f.exported.devicePixelRatio>1?"@2x":"";let O=f.getJSON(m.transformRequest(m.normalizeSpriteURL(u,P,".json"),f.ResourceType.SpriteJSON),(Y,te)=>{O=null,A||(A=Y,b=te,V())}),L=f.getImage(m.transformRequest(m.normalizeSpriteURL(u,P,".png"),f.ResourceType.SpriteImage),(Y,te)=>{L=null,A||(A=Y,S=te,V())});function V(){if(A)w(A);else if(b&&S){const Y=f.exported.getImageData(S),te={};for(const J in b){const{width:H,height:se,x:ie,y:he,sdf:de,pixelRatio:ce,stretchX:le,stretchY:we,content:ze}=b[J],Be=new f.RGBAImage({width:H,height:se});f.RGBAImage.copy(Y,Be,{x:ie,y:he},{x:0,y:0},{width:H,height:se}),te[J]={data:Be,pixelRatio:ce,sdf:de,stretchX:le,stretchY:we,content:ze}}w(null,te)}}return{cancel(){O&&(O.cancel(),O=null),L&&(L.cancel(),L=null)}}}(n,this.map._requestManager,(u,m)=>{if(this._spriteRequest=null,u)this.fire(new f.ErrorEvent(u));else if(m)for(const w in m)this.imageManager.addImage(w,m[w]);this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),this.dispatcher.broadcast("setImages",this._availableImages),this.dispatcher.broadcast("spriteLoaded",!0),this.fire(new f.Event("data",{dataType:"style"}))})}_validateLayer(n){const u=this.getSource(n.source);if(!u)return;const m=n.sourceLayer;m&&("geojson"===u.type||u.vectorLayerIds&&-1===u.vectorLayerIds.indexOf(m))&&this.fire(new f.ErrorEvent(new Error(`Source layer "${m}" does not exist on source "${u.id}" as specified by style layer "${n.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const n in this._sourceCaches)if(!this._sourceCaches[n].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeLayers(n){const u=[];for(const m of n){const w=this._layers[m];"custom"!==w.type&&u.push(w.serialize())}return u}hasTransitions(){if(this.light&&this.light.hasTransition()||this.fog&&this.fog.hasTransition())return!0;for(const n in this._sourceCaches)if(this._sourceCaches[n].hasTransition())return!0;for(const n in this._layers)if(this._layers[n].hasTransition())return!0;return!1}get order(){return this.map._optimizeForTerrain&&this.terrain?this._drapedFirstOrder:this._order}isLayerDraped(n){return!!this.terrain&&cs[n.type]}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}update(n){if(!this._loaded)return;const u=this._changed;if(this._changed){const w=Object.keys(this._updatedLayers),b=Object.keys(this._removedLayers);(w.length||b.length)&&this._updateWorkerLayers(w,b);for(const S in this._updatedSources){const A=this._updatedSources[S];"reload"===A?this._reloadSource(S):"clear"===A&&this._clearSource(S)}this._updateTilesForChangedImages();for(const S in this._updatedPaintProps)this._layers[S].updateTransitions(n);this.light.updateTransitions(n),this.fog&&this.fog.updateTransitions(n),this._resetUpdates()}const m={};for(const w in this._sourceCaches){const b=this._sourceCaches[w];m[w]=b.used,b.used=!1}for(const w of this._order){const b=this._layers[w];if(b.recalculate(n,this._availableImages),!b.isHidden(n.zoom)){const A=this._getLayerSourceCache(b);A&&(A.used=!0)}const S=this.map.painter;if(S){const A=b.getProgramIds();if(!A)continue;const P=b.getProgramConfiguration(n.zoom);for(const O of A)S.useProgram(O,P)}}for(const w in m){const b=this._sourceCaches[w];m[w]!==b.used&&b.getSource().fire(new f.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:b.getSource().id}))}this.light.recalculate(n),this.terrain&&this.terrain.recalculate(n),this.fog&&this.fog.recalculate(n),this.z=n.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),u&&this.fire(new f.Event("data",{dataType:"style"}))}_updateTilesForChangedImages(){const n=Object.keys(this._changedImages);if(n.length){for(const u in this._sourceCaches)this._sourceCaches[u].reloadTilesForDependencies(["icons","patterns"],n);this._changedImages={}}}_updateWorkerLayers(n,u){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(n),removedIds:u})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}}setState(n){if(this._checkLoaded(),_l(this,f.validateStyle(n)))return!1;(n=f.clone$1(n)).layers=Nr(n.layers);const u=function(w,b){if(!w)return[{command:Vt.setStyle,args:[b]}];let S=[];try{if(!ut(w.version,b.version))return[{command:Vt.setStyle,args:[b]}];ut(w.center,b.center)||S.push({command:Vt.setCenter,args:[b.center]}),ut(w.zoom,b.zoom)||S.push({command:Vt.setZoom,args:[b.zoom]}),ut(w.bearing,b.bearing)||S.push({command:Vt.setBearing,args:[b.bearing]}),ut(w.pitch,b.pitch)||S.push({command:Vt.setPitch,args:[b.pitch]}),ut(w.sprite,b.sprite)||S.push({command:Vt.setSprite,args:[b.sprite]}),ut(w.glyphs,b.glyphs)||S.push({command:Vt.setGlyphs,args:[b.glyphs]}),ut(w.transition,b.transition)||S.push({command:Vt.setTransition,args:[b.transition]}),ut(w.light,b.light)||S.push({command:Vt.setLight,args:[b.light]}),ut(w.fog,b.fog)||S.push({command:Vt.setFog,args:[b.fog]}),ut(w.projection,b.projection)||S.push({command:Vt.setProjection,args:[b.projection]});const A={},P=[];!function(V,Y,te,J){let H;for(H in Y=Y||{},V=V||{})V.hasOwnProperty(H)&&(Y.hasOwnProperty(H)||Ur(H,te,J));for(H in Y)Y.hasOwnProperty(H)&&(V.hasOwnProperty(H)?ut(V[H],Y[H])||("geojson"===V[H].type&&"geojson"===Y[H].type&&as(V,Y,H)?te.push({command:Vt.setGeoJSONSourceData,args:[H,Y[H].data]}):Eo(H,Y,te,J)):Or(H,Y,te))}(w.sources,b.sources,P,A);const O=[];w.layers&&w.layers.forEach(V=>{V.source&&A[V.source]?S.push({command:Vt.removeLayer,args:[V.id]}):O.push(V)});let L=w.terrain;L&&A[L.source]&&(S.push({command:Vt.setTerrain,args:[void 0]}),L=void 0),S=S.concat(P),ut(L,b.terrain)||S.push({command:Vt.setTerrain,args:[b.terrain]}),function(V,Y,te){Y=Y||[];const J=(V=V||[]).map(Cr),H=Y.map(Cr),se=V.reduce(yr,{}),ie=Y.reduce(yr,{}),he=J.slice(),de=Object.create(null);let ce,le,we,ze,Be,Le,qe;for(ce=0,le=0;ce<J.length;ce++)we=J[ce],ie.hasOwnProperty(we)?le++:(te.push({command:Vt.removeLayer,args:[we]}),he.splice(he.indexOf(we,le),1));for(ce=0,le=0;ce<H.length;ce++)we=H[H.length-1-ce],he[he.length-1-ce]!==we&&(se.hasOwnProperty(we)?(te.push({command:Vt.removeLayer,args:[we]}),he.splice(he.lastIndexOf(we,he.length-le),1)):le++,Le=he[he.length-ce],te.push({command:Vt.addLayer,args:[ie[we],Le]}),he.splice(he.length-ce,0,we),de[we]=!0);for(ce=0;ce<H.length;ce++)if(we=H[ce],ze=se[we],Be=ie[we],!de[we]&&!ut(ze,Be))if(ut(ze.source,Be.source)&&ut(ze["source-layer"],Be["source-layer"])&&ut(ze.type,Be.type)){for(qe in Tt(ze.layout,Be.layout,te,we,null,Vt.setLayoutProperty),Tt(ze.paint,Be.paint,te,we,null,Vt.setPaintProperty),ut(ze.filter,Be.filter)||te.push({command:Vt.setFilter,args:[we,Be.filter]}),ut(ze.minzoom,Be.minzoom)&&ut(ze.maxzoom,Be.maxzoom)||te.push({command:Vt.setLayerZoomRange,args:[we,Be.minzoom,Be.maxzoom]}),ze)ze.hasOwnProperty(qe)&&"layout"!==qe&&"paint"!==qe&&"filter"!==qe&&"metadata"!==qe&&"minzoom"!==qe&&"maxzoom"!==qe&&(0===qe.indexOf("paint.")?Tt(ze[qe],Be[qe],te,we,qe.slice(6),Vt.setPaintProperty):ut(ze[qe],Be[qe])||te.push({command:Vt.setLayerProperty,args:[we,qe,Be[qe]]}));for(qe in Be)Be.hasOwnProperty(qe)&&!ze.hasOwnProperty(qe)&&"layout"!==qe&&"paint"!==qe&&"filter"!==qe&&"metadata"!==qe&&"minzoom"!==qe&&"maxzoom"!==qe&&(0===qe.indexOf("paint.")?Tt(ze[qe],Be[qe],te,we,qe.slice(6),Vt.setPaintProperty):ut(ze[qe],Be[qe])||te.push({command:Vt.setLayerProperty,args:[we,qe,Be[qe]]}))}else te.push({command:Vt.removeLayer,args:[we]}),Le=he[he.lastIndexOf(we)+1],te.push({command:Vt.addLayer,args:[Be,Le]})}(O,b.layers,S)}catch(A){console.warn("Unable to compute style diff:",A),S=[{command:Vt.setStyle,args:[b]}]}return S}(this.serialize(),n).filter(w=>!(w.command in hc));if(0===u.length)return!1;const m=u.filter(w=>!(w.command in Io));if(m.length>0)throw new Error(`Unimplemented: ${m.map(w=>w.command).join(", ")}.`);return u.forEach(w=>{"setTransition"!==w.command&&this[w.command].apply(this,w.args)}),this.stylesheet=n,this._updateMapProjection(),!0}addImage(n,u){return this.getImage(n)?this.fire(new f.ErrorEvent(new Error("An image with this name already exists."))):(this.imageManager.addImage(n,u),this._afterImageUpdated(n),this)}updateImage(n,u){this.imageManager.updateImage(n,u)}getImage(n){return this.imageManager.getImage(n)}removeImage(n){return this.getImage(n)?(this.imageManager.removeImage(n),this._afterImageUpdated(n),this):this.fire(new f.ErrorEvent(new Error("No image with this name exists.")))}_afterImageUpdated(n){this._availableImages=this.imageManager.listImages(),this._changedImages[n]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new f.Event("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addSource(n,u,m={}){if(this._checkLoaded(),void 0!==this.getSource(n))throw new Error("There is already a source with this ID");if(!u.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(u).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(u.type)>=0&&this._validate(f.validateSource,`sources.${n}`,u,null,m))return;this.map&&this.map._collectResourceTiming&&(u.collectResourceTiming=!0);const w=Re(n,u,this.dispatcher,this);w.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(n),source:w.serialize(),sourceId:n}));const b=S=>{const A=(S?"symbol:":"other:")+n,P=this._sourceCaches[A]=new f.SourceCache(A,w,S);(S?this._symbolSourceCaches:this._otherSourceCaches)[n]=P,P.style=this,P.onAdd(this.map)};b(!1),"vector"!==u.type&&"geojson"!==u.type||b(!0),w.onAdd&&w.onAdd(this.map),this._changed=!0}removeSource(n){this._checkLoaded();const u=this.getSource(n);if(!u)throw new Error("There is no source with this ID");for(const w in this._layers)if(this._layers[w].source===n)return this.fire(new f.ErrorEvent(new Error(`Source "${n}" cannot be removed while layer "${w}" is using it.`)));if(this.terrain&&this.terrain.get().source===n)return this.fire(new f.ErrorEvent(new Error(`Source "${n}" cannot be removed while terrain is using it.`)));const m=this._getSourceCaches(n);for(const w of m)delete this._sourceCaches[w.id],delete this._updatedSources[w.id],w.fire(new f.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:w.getSource().id})),w.setEventedParent(null),w.clearTiles();return delete this._otherSourceCaches[n],delete this._symbolSourceCaches[n],u.setEventedParent(null),u.onRemove&&u.onRemove(this.map),this._changed=!0,this}setGeoJSONSourceData(n,u){this._checkLoaded(),this.getSource(n).setData(u),this._changed=!0}getSource(n){const u=this._getSourceCache(n);return u&&u.getSource()}addLayer(n,u,m={}){this._checkLoaded();const w=n.id;if(this.getLayer(w))return void this.fire(new f.ErrorEvent(new Error(`Layer with id "${w}" already exists on this map`)));let b;if("custom"===n.type){if(_l(this,f.validateCustomStyleLayer(n)))return;b=f.createStyleLayer(n)}else{if("object"==typeof n.source&&(this.addSource(w,n.source),n=f.clone$1(n),n=f.extend(n,{source:w})),this._validate(f.validateLayer,`layers.${w}`,n,{arrayIndex:-1},m))return;b=f.createStyleLayer(n),this._validateLayer(b),b.setEventedParent(this,{layer:{id:w}}),this._serializedLayers[b.id]=b.serialize(),this._updateLayerCount(b,!0)}const S=u?this._order.indexOf(u):this._order.length;if(u&&-1===S)return void this.fire(new f.ErrorEvent(new Error(`Layer with id "${u}" does not exist on this map.`)));this._order.splice(S,0,w),this._layerOrderChanged=!0,this._layers[w]=b;const A=this._getLayerSourceCache(b);if(this._removedLayers[w]&&b.source&&A&&"custom"!==b.type){const P=this._removedLayers[w];delete this._removedLayers[w],P.type!==b.type?this._updatedSources[b.source]="clear":(this._updatedSources[b.source]="reload",A.pause())}this._updateLayer(b),b.onAdd&&b.onAdd(this.map),this._updateDrapeFirstLayers()}moveLayer(n,u){if(this._checkLoaded(),this._changed=!0,!this._layers[n])return void this.fire(new f.ErrorEvent(new Error(`The layer '${n}' does not exist in the map's style and cannot be moved.`)));if(n===u)return;const m=this._order.indexOf(n);this._order.splice(m,1);const w=u?this._order.indexOf(u):this._order.length;u&&-1===w?this.fire(new f.ErrorEvent(new Error(`Layer with id "${u}" does not exist on this map.`))):(this._order.splice(w,0,n),this._layerOrderChanged=!0,this._updateDrapeFirstLayers())}removeLayer(n){this._checkLoaded();const u=this._layers[n];if(!u)return void this.fire(new f.ErrorEvent(new Error(`The layer '${n}' does not exist in the map's style and cannot be removed.`)));u.setEventedParent(null),this._updateLayerCount(u,!1);const m=this._order.indexOf(n);this._order.splice(m,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[n]=u,delete this._layers[n],delete this._serializedLayers[n],delete this._updatedLayers[n],delete this._updatedPaintProps[n],u.onRemove&&u.onRemove(this.map),this._updateDrapeFirstLayers()}getLayer(n){return this._layers[n]}hasLayer(n){return n in this._layers}hasLayerType(n){for(const u in this._layers)if(this._layers[u].type===n)return!0;return!1}setLayerZoomRange(n,u,m){this._checkLoaded();const w=this.getLayer(n);w?w.minzoom===u&&w.maxzoom===m||(null!=u&&(w.minzoom=u),null!=m&&(w.maxzoom=m),this._updateLayer(w)):this.fire(new f.ErrorEvent(new Error(`The layer '${n}' does not exist in the map's style and cannot have zoom extent.`)))}setFilter(n,u,m={}){this._checkLoaded();const w=this.getLayer(n);if(w){if(!ut(w.filter,u))return null==u?(w.filter=void 0,void this._updateLayer(w)):void(this._validate(f.validateFilter,`layers.${w.id}.filter`,u,{layerType:w.type},m)||(w.filter=f.clone$1(u),this._updateLayer(w)))}else this.fire(new f.ErrorEvent(new Error(`The layer '${n}' does not exist in the map's style and cannot be filtered.`)))}getFilter(n){const u=this.getLayer(n);return u&&f.clone$1(u.filter)}setLayoutProperty(n,u,m,w={}){this._checkLoaded();const b=this.getLayer(n);b?ut(b.getLayoutProperty(u),m)||(b.setLayoutProperty(u,m,w),this._updateLayer(b)):this.fire(new f.ErrorEvent(new Error(`The layer '${n}' does not exist in the map's style and cannot be styled.`)))}getLayoutProperty(n,u){const m=this.getLayer(n);if(m)return m.getLayoutProperty(u);this.fire(new f.ErrorEvent(new Error(`The layer '${n}' does not exist in the map's style.`)))}setPaintProperty(n,u,m,w={}){this._checkLoaded();const b=this.getLayer(n);b?ut(b.getPaintProperty(u),m)||(b.setPaintProperty(u,m,w)&&this._updateLayer(b),this._changed=!0,this._updatedPaintProps[n]=!0):this.fire(new f.ErrorEvent(new Error(`The layer '${n}' does not exist in the map's style and cannot be styled.`)))}getPaintProperty(n,u){const m=this.getLayer(n);return m&&m.getPaintProperty(u)}setFeatureState(n,u){this._checkLoaded();const m=n.source,w=n.sourceLayer,b=this.getSource(m);if(!b)return void this.fire(new f.ErrorEvent(new Error(`The source '${m}' does not exist in the map's style.`)));const S=b.type;if("geojson"===S&&w)return void this.fire(new f.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if("vector"===S&&!w)return void this.fire(new f.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));void 0===n.id&&this.fire(new f.ErrorEvent(new Error("The feature id parameter must be provided.")));const A=this._getSourceCaches(m);for(const P of A)P.setFeatureState(w,n.id,u)}removeFeatureState(n,u){this._checkLoaded();const m=n.source,w=this.getSource(m);if(!w)return void this.fire(new f.ErrorEvent(new Error(`The source '${m}' does not exist in the map's style.`)));const b=w.type,S="vector"===b?n.sourceLayer:void 0;if("vector"===b&&!S)return void this.fire(new f.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));if(u&&"string"!=typeof n.id&&"number"!=typeof n.id)return void this.fire(new f.ErrorEvent(new Error("A feature id is required to remove its specific state property.")));const A=this._getSourceCaches(m);for(const P of A)P.removeFeatureState(S,n.id,u)}getFeatureState(n){this._checkLoaded();const u=n.source,m=n.sourceLayer,w=this.getSource(u);if(w){if("vector"!==w.type||m)return void 0===n.id&&this.fire(new f.ErrorEvent(new Error("The feature id parameter must be provided."))),this._getSourceCaches(u)[0].getFeatureState(m,n.id);this.fire(new f.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new f.ErrorEvent(new Error(`The source '${u}' does not exist in the map's style.`)))}getTransition(){return f.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){const n={};for(const u in this._sourceCaches){const m=this._sourceCaches[u].getSource();n[m.id]||(n[m.id]=m.serialize())}return f.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,terrain:this.stylesheet.terrain,fog:this.stylesheet.fog,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:n,layers:this._serializeLayers(this._order)},u=>void 0!==u)}_updateLayer(n){this._updatedLayers[n.id]=!0;const u=this._getLayerSourceCache(n);n.source&&!this._updatedSources[n.source]&&u&&"raster"!==u.getSource().type&&(this._updatedSources[n.source]="reload",u.pause()),this._changed=!0,n.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(n){const u=S=>"fill-extrusion"===this._layers[S].type,m={},w=[];for(let S=this._order.length-1;S>=0;S--){const A=this._order[S];if(u(A)){m[A]=S;for(const P of n){const O=P[A];if(O)for(const L of O)w.push(L)}}}w.sort((S,A)=>A.intersectionZ-S.intersectionZ);const b=[];for(let S=this._order.length-1;S>=0;S--){const A=this._order[S];if(u(A))for(let P=w.length-1;P>=0;P--){const O=w[P].feature;if(m[O.layer.id]<S)break;b.push(O),w.pop()}else for(const P of n){const O=P[A];if(O)for(const L of O)b.push(L.feature)}}return b}queryRenderedFeatures(n,u,m){u&&u.filter&&this._validate(f.validateFilter,"queryRenderedFeatures.filter",u.filter,null,u);const w={};if(u&&u.layers){if(!Array.isArray(u.layers))return this.fire(new f.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(const P of u.layers){const O=this._layers[P];if(!O)return this.fire(new f.ErrorEvent(new Error(`The layer '${P}' does not exist in the map's style and cannot be queried for features.`))),[];w[O.source]=!0}}const b=[];u.availableImages=this._availableImages;const S=u&&u.layers?u.layers.some(P=>{const O=this.getLayer(P);return O&&O.is3D()}):this.has3DLayers(),A=Os.createFromScreenPoints(n,m);for(const P in this._sourceCaches){const O=this._sourceCaches[P].getSource().id;u.layers&&!w[O]||b.push(Ne(this._sourceCaches[P],this._layers,this._serializedLayers,A,u,m,S,!!this.map._showQueryGeometry))}return this.placement&&b.push(function(P,O,L,V,Y,te,J){const H={},se=te.queryRenderedSymbols(V),ie=[];for(const he of Object.keys(se).map(Number))ie.push(J[he]);ie.sort(kt);for(const he of ie){const de=he.featureIndex.lookupSymbolFeatures(se[he.bucketInstanceId],O,he.bucketIndex,he.sourceLayerIndex,Y.filter,Y.layers,Y.availableImages,P);for(const ce in de){const le=H[ce]=H[ce]||[],we=de[ce];we.sort((ze,Be)=>{const Le=he.featureSortOrder;if(Le){const qe=Le.indexOf(ze.featureIndex);return Le.indexOf(Be.featureIndex)-qe}return Be.featureIndex-ze.featureIndex});for(const ze of we)le.push(ze)}}for(const he in H)H[he].forEach(de=>{const ce=de.feature,le=L(P[he]).getFeatureState(ce.layer["source-layer"],ce.id);ce.source=ce.layer.source,ce.layer["source-layer"]&&(ce.sourceLayer=ce.layer["source-layer"]),ce.state=le});return H}(this._layers,this._serializedLayers,this._getLayerSourceCache.bind(this),A.screenGeometry,u,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(b)}querySourceFeatures(n,u){u&&u.filter&&this._validate(f.validateFilter,"querySourceFeatures.filter",u.filter,null,u);const m=this._getSourceCaches(n);let w=[];for(const b of m)w=w.concat(lt(b,u));return w}addSourceType(n,u,m){return Hn.getSourceType(n)?m(new Error(`A source type called "${n}" already exists.`)):(Hn.setSourceType(n,u),u.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:n,url:u.workerSourceURL},m):m(null,null))}getLight(){return this.light.getLight()}setLight(n,u={}){this._checkLoaded();const m=this.light.getLight();let w=!1;for(const S in n)if(!ut(n[S],m[S])){w=!0;break}if(!w)return;const b={now:f.exported.now(),transition:f.extend({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(n,u),this.light.updateTransitions(b)}getTerrain(){return this.terrain&&1===this.terrain.drapeRenderMode?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}setTerrain(n,u=1){if(this._checkLoaded(),!n)return delete this.terrain,delete this.stylesheet.terrain,this.dispatcher.broadcast("enableTerrain",!1),this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);if(1===u){if("object"==typeof n.source){const m="terrain-dem-src";this.addSource(m,n.source),n=f.clone$1(n),n=f.extend(n,{source:m})}if(this._validate(f.validateTerrain,"terrain",n))return}if(!this.terrain||this.terrain&&u!==this.terrain.drapeRenderMode)this._createTerrain(n,u);else{const m=this.terrain,w=m.get();for(const b in n)if(!ut(n[b],w[b])){m.set(n),this.stylesheet.terrain=n;const S={now:f.exported.now(),transition:f.extend({duration:0},this.stylesheet.transition)};m.updateTransitions(S);break}}this._updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(n){const u=this.fog=new Qc(n,this.map.transform);this.stylesheet.fog=n;const m={now:f.exported.now(),transition:f.extend({duration:0},this.stylesheet.transition)};u.updateTransitions(m)}_updateMarkersOpacity(){0!==this.map._markers.length&&this.map._requestDomTask(()=>{for(const n of this.map._markers)n._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(n){if(this._checkLoaded(),!n)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const u=this.fog,m=u.get();for(const w in n)if(!ut(n[w],m[w])){u.set(n),this.stylesheet.fog=n;const b={now:f.exported.now(),transition:f.extend({duration:0},this.stylesheet.transition)};u.updateTransitions(b);break}}else this._createFog(n);this._markersNeedUpdate=!0}_updateDrapeFirstLayers(){if(!this.map._optimizeForTerrain||!this.terrain)return;const n=this._order.filter(m=>this.isLayerDraped(this._layers[m])),u=this._order.filter(m=>!this.isLayerDraped(this._layers[m]));this._drapedFirstOrder=[],this._drapedFirstOrder.push(...n),this._drapedFirstOrder.push(...u)}_createTerrain(n,u){const m=this.terrain=new nl(n,u);this.stylesheet.terrain=n,this.dispatcher.broadcast("enableTerrain",!this.terrainSetForDrapingOnly()),this._force3DLayerUpdate();const w={now:f.exported.now(),transition:f.extend({duration:0},this.stylesheet.transition)};m.updateTransitions(w)}_force3DLayerUpdate(){for(const n in this._layers){const u=this._layers[n];"fill-extrusion"===u.type&&this._updateLayer(u)}}_forceSymbolLayerUpdate(){for(const n in this._layers){const u=this._layers[n];"symbol"===u.type&&this._updateLayer(u)}}_validate(n,u,m,w,b={}){return(!b||!1!==b.validate)&&_l(this,n.call(f.validateStyle,f.extend({key:u,style:this.serialize(),value:m,styleSpec:f.spec},w)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),f.evented.off("pluginStateChange",this._rtlTextPluginCallback);for(const n in this._layers)this._layers[n].setEventedParent(null);for(const n in this._sourceCaches)this._sourceCaches[n].clearTiles(),this._sourceCaches[n].setEventedParent(null);this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()}_clearSource(n){const u=this._getSourceCaches(n);for(const m of u)m.clearTiles()}_reloadSource(n){const u=this._getSourceCaches(n);for(const m of u)m.resume(),m.reload()}_updateSources(n){for(const u in this._sourceCaches)this._sourceCaches[u].update(n)}_generateCollisionBoxes(){for(const n in this._sourceCaches){const u=this._sourceCaches[n];u.resume(),u.reload()}}_updatePlacement(n,u,m,w,b=!1){let S=!1,A=!1;const P={};for(const O of this._order){const L=this._layers[O];if("symbol"!==L.type)continue;if(!P[L.source]){const Y=this._getLayerSourceCache(L);if(!Y)continue;P[L.source]=Y.getRenderableIds(!0).map(te=>Y.getTileByID(te)).sort((te,J)=>J.tileID.overscaledZ-te.tileID.overscaledZ||(te.tileID.isLessThan(J.tileID)?-1:1))}const V=this.crossTileSymbolIndex.addLayer(L,P[L.source],n.center.lng,n.projection);S=S||V}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),b=b||this._layerOrderChanged||0===m,this._layerOrderChanged&&this.fire(new f.Event("neworder")),(b||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(f.exported.now(),n.zoom))&&(this.pauseablePlacement=new ml(n,this._order,b,u,m,w,this.placement,this.fog&&n.projection.supportsFog?this.fog.state:null),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,P),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(f.exported.now()),A=!0),S&&this.pauseablePlacement.placement.setStale()),A||S)for(const O of this._order){const L=this._layers[O];"symbol"===L.type&&this.placement.updateLayerOpacities(L,P[L.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(f.exported.now())}_releaseSymbolFadeTiles(){for(const n in this._sourceCaches)this._sourceCaches[n].releaseSymbolFadeTiles()}getImages(n,u,m){this.imageManager.getImages(u.icons,m),this._updateTilesForChangedImages();const w=b=>{b&&b.setDependencies(u.tileID.key,u.type,u.icons)};w(this._otherSourceCaches[u.source]),w(this._symbolSourceCaches[u.source])}getGlyphs(n,u,m){this.glyphManager.getGlyphs(u.stacks,m)}getResource(n,u,m){return f.makeRequest(u,m)}_getSourceCache(n){return this._otherSourceCaches[n]}_getLayerSourceCache(n){return"symbol"===n.type?this._symbolSourceCaches[n.source]:this._otherSourceCaches[n.source]}_getSourceCaches(n){const u=[];return this._otherSourceCaches[n]&&u.push(this._otherSourceCaches[n]),this._symbolSourceCaches[n]&&u.push(this._symbolSourceCaches[n]),u}_isSourceCacheLoaded(n){const u=this._getSourceCaches(n);return 0===u.length?(this.fire(new f.ErrorEvent(new Error(`There is no source with ID '${n}'`))),!1):u.every(m=>m.loaded())}has3DLayers(){return this._num3DLayers>0}hasSymbolLayers(){return this._numSymbolLayers>0}hasCircleLayers(){return this._numCircleLayers>0}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}Hn.getSourceType=function(d){return Oe[d]},Hn.setSourceType=function(d,n){Oe[d]=n},Hn.registerForPluginStateChange=f.registerForPluginStateChange;var or="\n#define EPSILON 0.0000001\n#define PI 3.141592653589793\n#define EXTENT 8192.0\n#define HALF_PI PI/2.0\n#define QUARTER_PI PI/4.0\n#define RAD_TO_DEG 180.0/PI\n#define DEG_TO_RAD PI/180.0\n#define GLOBE_RADIUS EXTENT/PI/2.0\n#ifdef FOG\nuniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;varying vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}\n#endif",gl="attribute highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;varying highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}";let Mo={},Ba={};Mo=Qt("","\n#define ELEVATION_SCALE 7.0\n#define ELEVATION_OFFSET 450.0\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(\nmix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}\n#else\nvec3 elevationVector(vec2 pos) { return vec3(0,0,1); }\n#endif\n#ifdef TERRAIN\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nuniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;\n#else\nuniform sampler2D u_dem;uniform sampler2D u_dem_prev;\n#endif\nuniform vec4 u_dem_unpack;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;uniform sampler2D u_depth;uniform vec2 u_depth_size_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float decodeElevation(vec4 v) {return dot(vec4(v.xyz*255.0,-1.0),u_dem_unpack);}float currentElevation(vec2 apos) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nvec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem,pos).a;\n#else\nfloat dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem,pos));\n#ifdef TERRAIN_DEM_NEAREST_FILTER\nreturn u_exaggeration*tl;\n#endif\nfloat tr=decodeElevation(texture2D(u_dem,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);\n#endif\n}float prevElevation(vec2 apos) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nvec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem_prev,pos).a;\n#else\nfloat dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem_prev,pos));float tr=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem_prev,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);\n#endif\n}\n#ifdef TERRAIN_VERTEX_MORPHING\nfloat elevation(vec2 apos) {float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}\n#else\nfloat elevation(vec2 apos) {return currentElevation(apos);}\n#endif\nfloat unpack_depth(vec4 rgba_depth)\n{const vec4 bit_shift=vec4(1.0/(256.0*256.0*256.0),1.0/(256.0*256.0),1.0/256.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;float depth=unpack_depth(texture2D(u_depth,(coord.xy+1.0)*0.5));return coord.z > depth+0.0005;}float occlusionFade(vec4 frag) {vec3 coord=frag.xyz/frag.w;vec3 df=vec3(5.0*u_depth_size_inv,0.0);vec2 uv=0.5*coord.xy+0.5;vec4 depth=vec4(\nunpack_depth(texture2D(u_depth,uv-df.xz)),unpack_depth(texture2D(u_depth,uv+df.xz)),unpack_depth(texture2D(u_depth,uv-df.zy)),unpack_depth(texture2D(u_depth,uv+df.zy))\n);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z-0.001)-depth),0.0,1.0));}vec4 fourSample(vec2 pos,vec2 off) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nfloat tl=texture2D(u_dem,pos).a;float tr=texture2D(u_dem,pos+vec2(off.x,0.0)).a;float bl=texture2D(u_dem,pos+vec2(0.0,off.y)).a;float br=texture2D(u_dem,pos+off).a;\n#else\nvec4 demtl=vec4(texture2D(u_dem,pos).xyz*255.0,-1.0);float tl=dot(demtl,u_dem_unpack);vec4 demtr=vec4(texture2D(u_dem,pos+vec2(off.x,0.0)).xyz*255.0,-1.0);float tr=dot(demtr,u_dem_unpack);vec4 dembl=vec4(texture2D(u_dem,pos+vec2(0.0,off.y)).xyz*255.0,-1.0);float bl=dot(dembl,u_dem_unpack);vec4 dembr=vec4(texture2D(u_dem,pos+off).xyz*255.0,-1.0);float br=dot(dembr,u_dem_unpack);\n#endif\nreturn vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;vec4 bounds=vec4(d,vec2(1.0)-d);h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}\n#else\nfloat elevation(vec2 pos) { return 0.0; }bool isOccluded(vec4 frag) { return false; }float occlusionFade(vec4 frag) { return 1.0; }\n#endif",!0),Ba=Qt("#ifdef FOG\nuniform float u_fog_temporal_offset;float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);return mix(color,u_fog_color.rgb,opacity);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec3 fog_dither(vec3 color) {vec2 dither_seed=gl_FragCoord.xy+u_fog_temporal_offset;return dither(color,dither_seed);}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}\n#endif","#ifdef FOG\nuniform mat4 u_fog_matrix;vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}\n#endif",!0);const Na=Qt("\nhighp vec3 hash(highp vec2 p) {highp vec3 p3=fract(p.xyx*vec3(443.8975,397.2973,491.1871));p3+=dot(p3,p3.yxz+19.19);return fract((p3.xxy+p3.yzz)*p3.zyx);}vec3 dither(vec3 color,highp vec2 seed) {vec3 rnd=hash(seed)+hash(seed+0.59374)-0.5;return color+rnd/255.0;}\n#ifdef TERRAIN\nhighp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(256.0*256.0*256.0,256.0*256.0,256.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/256.0,1.0/256.0,1.0/256.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}\n#endif","\nfloat wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {\n#ifndef PROJECTED_POS_ON_VIEWPORT\nfloat tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;\n#else\nreturn vec3(0.0);\n#endif\n}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}\n#endif\nvec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(\nunpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0\n);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);//Normalized device coordinate that is not rendered."),xl=or;var fc={background:Qt("uniform vec4 u_color;uniform float u_opacity;void main() {vec4 out_color=u_color;\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),backgroundPattern:Qt("uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 out_color=mix(color1,color2,u_mix);\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),circle:Qt("varying vec3 v_data;varying float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(\nantialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)\n);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);\n#ifdef FOG\nout_color=fog_apply_premultiplied(out_color,v_fog_pos);\n#endif\ngl_FragColor=out_color*(v_visibility*opacity_t);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","#define NUM_VISIBILITY_RINGS 2\n#define INV_SQRT2 0.70710678\n#define ELEVATION_BIAS 0.0001\n#define NUM_SAMPLES_PER_RING 16\nuniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;attribute float a_scale;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;\n#endif\nvarying vec3 v_data;varying float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {\n#if defined(TERRAIN)\nreturn elevation(pos)+ELEVATION_BIAS;\n#else\nreturn 0.0;\n#endif\n}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);\n#ifdef PITCH_WITH_MAP\n#ifdef PROJECTION_GLOBE_VIEW\nreturn u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );\n#else\nreturn u_matrix*( world_center+vec4(sample_offset,0,0) );\n#endif\n#else\nreturn projected_center+vec4(sample_offset,0,0);\n#endif\n}float get_sample_step() {\n#ifdef PITCH_WITH_MAP\nreturn 2.0*PI/float(NUM_SAMPLES_PER_RING);\n#else\nreturn PI/float(NUM_SAMPLES_PER_RING);\n#endif\n}void main(void) {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);\n#ifdef PROJECTION_GLOBE_VIEW\nvec2 scaled_extrude=extrude*a_scale;vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=scaled_extrude.x*surface_vectors[0]+scaled_extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);vec4 world_center=vec4(pos,1);\n#else \nmat3 surface_vectors=mat3(1.0);float height=circle_elevation(circle_center);vec4 world_center=vec4(circle_center,height,1);\n#endif\nvec4 projected_center=u_matrix*world_center;float view_scale=0.0;\n#ifdef PITCH_WITH_MAP\n#ifdef SCALE_WITH_MAP\nview_scale=1.0;\n#else\nview_scale=projected_center.w/u_camera_to_center_distance;\n#endif\n#else\n#ifdef SCALE_WITH_MAP\nview_scale=u_camera_to_center_distance;\n#else\nview_scale=projected_center.w;\n#endif\n#endif\n#if defined(SCALE_WITH_MAP) && defined(PROJECTION_GLOBE_VIEW)\nview_scale*=a_scale;\n#endif\ngl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;\n#ifdef TERRAIN\nfloat step=get_sample_step();\n#ifdef PITCH_WITH_MAP\nfloat cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);vec4 occlusion_world_center=vec4(circle_center,cantilevered_height,1);vec4 occlusion_projected_center=u_matrix*occlusion_world_center;\n#else\nvec4 occlusion_world_center=world_center;vec4 occlusion_projected_center=projected_center;\n#endif\nfor(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);\n#else\nvisibility=1.0;\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nvisibility=1.0;\n#endif\nv_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);\n#ifdef FOG\nv_fog_pos=fog_position(world_center.xyz);\n#endif\n}"),clippingMask:Qt("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:Qt("uniform highp float u_intensity;varying vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#define GAUSS_COEF 0.3989422804014327\nvoid main() {\n#pragma mapbox: initialize highp float weight\nfloat d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);\n#ifdef FOG\ngl_FragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;attribute float a_scale;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;\n#endif\nvarying vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#pragma mapbox: define mediump float radius\nconst highp float ZERO=1.0/255.0/16.0;\n#define GAUSS_COEF 0.3989422804014327\nvoid main(void) {\n#pragma mapbox: initialize highp float weight\n#pragma mapbox: initialize mediump float radius\nvec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);\n#ifdef PROJECTION_GLOBE_VIEW\nextrude*=a_scale;vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#else\nvec3 pos=vec3(tilePos+extrude,elevation(tilePos));\n#endif\ngl_Position=u_matrix*vec4(pos,1);\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),heatmapTexture:Qt("uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(0.0);\n#endif\n}","attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:Qt("varying float v_placed;varying float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);gl_FragColor =mix(red,blue,step(0.5,v_placed))*0.5;gl_FragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}","attribute vec3 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;attribute float a_size_scale;attribute vec2 a_padding;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*elevation(a_anchor_pos),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(\n0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:Qt("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos_2f;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(\nmix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(\n0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:Qt("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;\n#endif\nvarying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;\n#ifdef PROJECTION_GLOBE_VIEW\ngl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);\n#else\ngl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);\n#endif\n}"),fill:Qt("#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\nvec4 out_color=color;\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillOutline:Qt("varying vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillOutlinePattern:Qt("uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=mix(color1,color2,u_fade);\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillPattern:Qt("uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 out_color=mix(color1,color2,u_fade);\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillExtrusion:Qt("varying vec4 v_color;void main() {vec4 color=v_color;\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ngl_FragColor=color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;\n#endif\nvarying vec4 v_color;\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\n#pragma mapbox: define highp vec4 color\nvoid main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\n#pragma mapbox: initialize highp vec4 color\nvec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\n#ifdef TERRAIN\nbool flat_roof=centroid_pos.x !=0.0 && t > 0.0;float ele=elevation(pos_nx.xy);float c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;float h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);vec3 pos=vec3(pos_nx.xy,h);\n#else\nvec3 pos=vec3(pos_nx.xy,t > 0.0 ? height : base);\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nfloat lift=float((t+base) > 0.0)*u_height_lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(pos.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#endif\nfloat hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=(\n(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.rgb+=clamp(color.rgb*directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),fillExtrusionPattern:Qt("uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float base\n#pragma mapbox: initialize lowp float height\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 out_color=mix(color1,color2,u_fade);out_color=out_color*v_lighting;\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;\n#endif\nvarying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float base\n#pragma mapbox: initialize lowp float height\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\n#ifdef TERRAIN\nbool flat_roof=centroid_pos.x !=0.0 && t > 0.0;float ele=elevation(pos_nx.xy);float c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;float h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);vec3 p=vec3(pos_nx.xy,h);\n#else\nvec3 p=vec3(pos_nx.xy,z);\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nfloat lift=float((t+base) > 0.0)*u_height_lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#endif\nfloat hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0\n? pos_nx.xy\n: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=(\n(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;\n#ifdef FOG\nv_fog_pos=fog_position(p);\n#endif\n}"),hillshadePrepare:Qt("#ifdef GL_ES\nprecision highp float;\n#endif\nuniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nreturn texture2D(u_image,coord).a/4.0;\n#else\nvec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;\n#endif\n}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos);float f=getElevation(v_pos+vec2(epsilon.x,0));float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float h=getElevation(v_pos+vec2(0,epsilon.y));float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(\n(c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c)\n)/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(\nderiv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Qt("uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;\n#ifdef FOG\ngl_FragColor=fog_dither(fog_apply_premultiplied(gl_FragColor,v_fog_pos));\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),line:Qt("uniform lowp float u_device_pixel_ratio;uniform float u_alpha_discard_threshold;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;\n#ifdef RENDER_LINE_DASH\nuniform sampler2D u_dash_image;uniform float u_mix;uniform vec3 u_scale;varying vec2 v_tex_a;varying vec2 v_tex_b;\n#endif\n#ifdef RENDER_LINE_GRADIENT\nuniform sampler2D u_gradient_image;varying highp vec2 v_uv;\n#endif\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 dash_from\n#pragma mapbox: define lowp vec4 dash_to\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize lowp vec4 dash_from\n#pragma mapbox: initialize lowp vec4 dash_to\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);\n#ifdef RENDER_LINE_DASH\nfloat sdfdist_a=texture2D(u_dash_image,v_tex_a).a;float sdfdist_b=texture2D(u_dash_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);float sdfwidth=min(dash_from.z*u_scale.y,dash_to.z*u_scale.z);float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/sdfwidth;alpha*=smoothstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);\n#endif\n#ifdef RENDER_LINE_GRADIENT\nvec4 out_color=texture2D(u_gradient_image,v_uv);\n#else\nvec4 out_color=color;\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\n#ifdef RENDER_LINE_ALPHA_DISCARD\nif (alpha < u_alpha_discard_threshold) {discard;}\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define EXTRUDE_SCALE 0.015873016\nattribute vec2 a_pos_normal;attribute vec4 a_data;\n#ifdef RENDER_LINE_GRADIENT\nattribute vec3 a_packed;\n#else\nattribute float a_linesofar;\n#endif\nuniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;\n#ifdef RENDER_LINE_DASH\nuniform vec2 u_texsize;uniform mediump vec3 u_scale;varying vec2 v_tex_a;varying vec2 v_tex_b;\n#endif\n#ifdef RENDER_LINE_GRADIENT\nuniform float u_image_height;varying highp vec2 v_uv;\n#endif\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 dash_from\n#pragma mapbox: define lowp vec4 dash_to\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize lowp vec4 dash_from\n#pragma mapbox: initialize lowp vec4 dash_to\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;\n#ifndef RENDER_TO_TEXTURE\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#else\nv_gamma_scale=1.0;\n#endif\n#ifdef RENDER_LINE_GRADIENT\nfloat a_uv_x=a_packed[0];float a_split_index=a_packed[1];float a_linesofar=a_packed[2];highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);\n#endif\n#ifdef RENDER_LINE_DASH\nfloat tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;float scaleA=dash_from.z==0.0 ? 0.0 : tileZoomRatio/(dash_from.z*fromScale);float scaleB=dash_to.z==0.0 ? 0.0 : tileZoomRatio/(dash_to.z*toScale);float heightA=dash_from.y;float heightB=dash_to.y;v_tex_a=vec2(a_linesofar*scaleA/floorwidth,(-normal.y*heightA+dash_from.x+0.5)/u_texsize.y);v_tex_b=vec2(a_linesofar*scaleB/floorwidth,(-normal.y*heightB+dash_to.x+0.5)/u_texsize.y);\n#endif\nv_width2=vec2(outset,inset);\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),linePattern:Qt("uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ngl_FragColor=color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define scale 0.015873016\nattribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_linesofar;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;\n#ifndef RENDER_TO_TEXTURE\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#else\nv_gamma_scale=1.0;\n#endif\nv_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),raster:Qt("uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(\ndot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);\n#ifdef FOG\nout_color=fog_dither(fog_apply(out_color,v_fog_pos));\n#endif\ngl_FragColor=vec4(out_color*color.a,color.a);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {float w=1.0+dot(a_texture_pos,u_perspective_transform);gl_Position=u_matrix*vec4(a_pos*w,0,w);v_pos0=a_texture_pos/8192.0;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),symbolIcon:Qt("uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\nlowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_z_tile_anchor;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;\n#endif\nvarying vec2 v_tex;varying float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}float anchor_z=a_z_tile_anchor.x;vec2 tile_anchor=a_z_tile_anchor.yz;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);vec3 world_pos=mix_globe_mercator(vec3(a_pos,anchor_z)+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;float globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nvec3 world_pos=vec3(a_pos,anchor_z)+h;float globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjected_point=u_matrix*vec4(a_pos+vec2(1,0),anchor_z,1);vec2 a=projected_point.xy/projected_point.w;vec2 b=offsetProjected_point.xy/offsetProjected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 proj_pos=mix_globe_mercator(vec3(a_projected_pos.xy,anchor_z),mercator_pos,u_zoom_transition);\n#else\nvec3 proj_pos=vec3(a_projected_pos.xy,anchor_z);\n#endif\n#ifdef PROJECTED_POS_ON_VIEWPORT\nvec4 projected_pos=u_label_plane_matrix*vec4(proj_pos.xy,0.0,1.0);\n#else\nvec4 projected_pos=u_label_plane_matrix*vec4(proj_pos.xyz+h,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\nfloat occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));float projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nv_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change))*projection_transition_fade;}"),symbolSDF:Qt("#define SDF_PX 8.0\nuniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nfloat EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_z_tile_anchor;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;\n#endif\nvarying vec2 v_data0;varying vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}float anchor_z=a_z_tile_anchor.x;vec2 tile_anchor=a_z_tile_anchor.yz;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);vec3 world_pos=mix_globe_mercator(vec3(a_pos,anchor_z)+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;float globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nvec3 world_pos=vec3(a_pos,anchor_z)+h;float globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point=u_matrix*vec4(a_pos+vec2(1,0),anchor_z,1);vec2 a=projected_point.xy/projected_point.w;vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 proj_pos=mix_globe_mercator(vec3(a_projected_pos.xy,anchor_z),mercator_pos,u_zoom_transition);\n#else\nvec3 proj_pos=vec3(a_projected_pos.xy,anchor_z);\n#endif\n#ifdef PROJECTED_POS_ON_VIEWPORT\nvec4 projected_pos=u_label_plane_matrix*vec4(proj_pos.xy,0.0,1.0);\n#else\nvec4 projected_pos=u_label_plane_matrix*vec4(proj_pos.xyz+h,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset);\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\nfloat occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));float gamma_scale=gl_Position.w;float projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nvec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade);}"),symbolTextAndIcon:Qt("#define SDF_PX 8.0\n#define SDF 1.0\n#define ICON 0.0\nuniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nfloat fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\nreturn;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_z_tile_anchor;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;\n#endif\nvarying vec4 v_data0;varying vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}float anchor_z=a_z_tile_anchor.x;vec2 tile_anchor=a_z_tile_anchor.yz;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);vec3 world_pos=mix_globe_mercator(vec3(a_pos,anchor_z)+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;float globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nvec3 world_pos=vec3(a_pos,anchor_z)+h;float globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offset_projected_point=u_matrix*vec4(a_pos+vec2(1,0),anchor_z,1);vec2 a=projected_point.xy/projected_point.w;vec2 b=offset_projected_point.xy/offset_projected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 proj_pos=mix_globe_mercator(vec3(a_projected_pos.xy,anchor_z),mercator_pos,u_zoom_transition);\n#else\nvec3 proj_pos=vec3(a_projected_pos.xy,anchor_z);\n#endif\n#ifdef PROJECTED_POS_ON_VIEWPORT\nvec4 projected_pos=u_label_plane_matrix*vec4(proj_pos.xy,0.0,1.0);\n#else\nvec4 projected_pos=u_label_plane_matrix*vec4(proj_pos.xyz+h,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*font_scale);\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\nfloat occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nv_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade,is_sdf);}"),terrainRaster:Qt("uniform sampler2D u_image0;varying vec2 v_pos0;\n#ifdef FOG\nvarying float v_fog_opacity;\n#endif\nvoid main() {vec4 color=texture2D(u_image0,v_pos0);\n#ifdef FOG\ncolor=fog_dither(fog_apply_from_vert(color,v_fog_opacity));\n#endif\ngl_FragColor=color;\n#ifdef TERRAIN_WIREFRAME\ngl_FragColor=vec4(1.0,0.0,0.0,0.8);\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform float u_skirt_height;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;\n#ifdef FOG\nvarying float v_fog_opacity;\n#endif\nconst float skirtOffset=24575.0;const float wireframeOffset=0.00015;void main() {v_pos0=a_texture_pos/8192.0;float skirt=float(a_pos.x >=skirtOffset);float elevation=elevation(a_texture_pos)-skirt*u_skirt_height;\n#ifdef TERRAIN_WIREFRAME\nelevation+=u_skirt_height*u_skirt_height*wireframeOffset;\n#endif\nvec2 decodedPos=a_pos-vec2(skirt*skirtOffset,0.0);gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);\n#ifdef FOG\nv_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));\n#endif\n}"),terrainDepth:Qt("#ifdef GL_ES\nprecision highp float;\n#endif\nvarying float v_depth;void main() {gl_FragColor=pack_depth(v_depth);}","uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying float v_depth;void main() {float elevation=elevation(a_texture_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}"),skybox:Qt("\nvarying lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(\ncos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=textureCube(u_cubemap,uv).rgb;\n#ifdef FOG\nsky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);\n#endif\nsky_color.rgb=dither(sky_color.rgb,gl_FragCoord.xy+u_temporal_offset);sky_color+=0.1*sun_disk(v_uv,u_sun_direction);gl_FragColor=vec4(sky_color*u_opacity,u_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}",gl),skyboxGradient:Qt("varying highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture2D(u_color_ramp,vec2(progress,0.5));\n#ifdef FOG\ncolor.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;\n#endif\ncolor*=u_opacity;color.rgb=dither(color.rgb,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}",gl),skyboxCapture:Qt("\nvarying highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;\n#ifdef GL_ES\nprecision highp float;\n#endif\n#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)\n#define BETA_M                  vec3(21e-6,21e-6,21e-6)\n#define MIE_G                   0.76\n#define DENSITY_HEIGHT_SCALE_R  8000.0\n#define DENSITY_HEIGHT_SCALE_M  1200.0\n#define PLANET_RADIUS           6360e3\n#define ATMOSPHERE_RADIUS       6420e3\n#define SAMPLE_STEPS            10\n#define DENSITY_STEPS           4\nfloat ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;gl_FragColor=vec4(color,1.0);}","attribute highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;varying highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:Qt("uniform sampler2D u_image0;varying vec2 v_pos0;void main() {gl_FragColor=texture2D(u_image0,v_pos0);\n#ifdef TERRAIN_WIREFRAME\ngl_FragColor=vec4(1.0,0.0,0.0,0.8);\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_proj_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;\n#ifdef GLOBE_POLES\nattribute vec3 a_globe_pos;attribute vec2 a_merc_pos;attribute vec2 a_uv;\n#else\nattribute vec2 a_pos;\n#endif\nvarying vec2 v_pos0;const float wireframeOffset=1e3;float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(QUARTER_PI+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}void main() {\n#ifdef GLOBE_POLES\nvec3 globe_pos=a_globe_pos;vec2 merc_pos=a_merc_pos;vec2 uv=a_uv;\n#else\nfloat tiles=u_grid_matrix[0][2];float idy=u_grid_matrix[1][2];float S=u_grid_matrix[2][2];vec3 latLng=u_grid_matrix*vec3(a_pos,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=a_pos[0]*S;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);\n#endif\nv_pos0=uv;uv=uv*EXTENT;vec4 up_vector=vec4(elevationVector(uv),1.0);float height=elevation(uv);\n#ifdef TERRAIN_WIREFRAME\nheight+=wireframeOffset;\n#endif\nvec4 globe=u_globe_matrix*vec4(globe_pos+up_vector.xyz*height,1.0);vec4 mercator=vec4(0.0);if (u_zoom_transition > 0.0) {mercator=vec4(merc_pos,height,1.0);mercator.xy-=u_merc_center;mercator.x=wrap(mercator.x,-0.5,0.5);mercator=u_merc_matrix*mercator;}vec3 position=mix(globe.xyz,mercator.xyz,u_zoom_transition);gl_Position=u_proj_matrix*vec4(position,1.0);}"),globeAtmosphere:Qt("uniform float u_opacity;uniform highp float u_fadeout_range;uniform vec3 u_start_color;uniform vec3 u_end_color;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;varying highp vec3 v_ray_dir;void main() {highp vec3 dir=normalize(v_ray_dir);highp vec3 closest_point=abs(dot(u_globe_pos,dir))*dir;float norm_dist_from_center=length(closest_point-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 1.0)\ndiscard;float t=clamp(1.0-sqrt(norm_dist_from_center-1.0)/u_fadeout_range,0.0,1.0);vec3 color=mix(u_start_color,u_end_color,1.0-t);gl_FragColor=vec4(color*t*u_opacity,u_opacity);}","attribute vec3 a_pos;attribute vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;varying highp vec3 v_ray_dir;void main() {v_ray_dir=mix(mix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);gl_Position=vec4(a_pos,1.0);}")};function Qt(d,n,u){const m=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,w=/uniform (highp |mediump |lowp )?([\w]+) ([\w]+)([\s]*)([\w]*)/g,b=n.match(/attribute (highp |mediump |lowp )?([\w]+) ([\w]+)/g),S=d.match(w),A=n.match(w),P=or.match(w);let O=A?A.concat(S):S;u||(Mo.staticUniforms&&(O=Mo.staticUniforms.concat(O)),Ba.staticUniforms&&(O=Ba.staticUniforms.concat(O))),O&&(O=O.concat(P));const L={};return{fragmentSource:d=d.replace(m,(V,Y,te,J,H)=>(L[H]=!0,"define"===Y?`\n#ifndef HAS_UNIFORM_u_${H}\nvarying ${te} ${J} ${H};\n#else\nuniform ${te} ${J} u_${H};\n#endif\n`:`\n#ifdef HAS_UNIFORM_u_${H}\n    ${te} ${J} ${H} = u_${H};\n#endif\n`)),vertexSource:n=n.replace(m,(V,Y,te,J,H)=>{const se="float"===J?"vec2":"vec4",ie=H.match(/color/)?"color":se;return L[H]?"define"===Y?`\n#ifndef HAS_UNIFORM_u_${H}\nuniform lowp float u_${H}_t;\nattribute ${te} ${se} a_${H};\nvarying ${te} ${J} ${H};\n#else\nuniform ${te} ${J} u_${H};\n#endif\n`:"vec4"===ie?`\n#ifndef HAS_UNIFORM_u_${H}\n    ${H} = a_${H};\n#else\n    ${te} ${J} ${H} = u_${H};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${H}\n    ${H} = unpack_mix_${ie}(a_${H}, u_${H}_t);\n#else\n    ${te} ${J} ${H} = u_${H};\n#endif\n`:"define"===Y?`\n#ifndef HAS_UNIFORM_u_${H}\nuniform lowp float u_${H}_t;\nattribute ${te} ${se} a_${H};\n#else\nuniform ${te} ${J} u_${H};\n#endif\n`:"vec4"===ie?`\n#ifndef HAS_UNIFORM_u_${H}\n    ${te} ${J} ${H} = a_${H};\n#else\n    ${te} ${J} ${H} = u_${H};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${H}\n    ${te} ${J} ${H} = unpack_mix_${ie}(a_${H}, u_${H}_t);\n#else\n    ${te} ${J} ${H} = u_${H};\n#endif\n`}),staticAttributes:b,staticUniforms:O}}class dc{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(n,u,m,w,b,S,A,P){this.context=n;let O=this.boundPaintVertexBuffers.length!==w.length;for(let L=0;!O&&L<w.length;L++)this.boundPaintVertexBuffers[L]!==w[L]&&(O=!0);n.extVertexArrayObject&&this.vao&&this.boundProgram===u&&this.boundLayoutVertexBuffer===m&&!O&&this.boundIndexBuffer===b&&this.boundVertexOffset===S&&this.boundDynamicVertexBuffer===A&&this.boundDynamicVertexBuffer2===P?(n.bindVertexArrayOES.set(this.vao),A&&A.bind(),b&&b.dynamicDraw&&b.bind(),P&&P.bind()):this.freshBind(u,m,w,b,S,A,P)}freshBind(n,u,m,w,b,S,A){let P;const O=n.numAttributes,L=this.context,V=L.gl;if(L.extVertexArrayObject)this.vao&&this.destroy(),this.vao=L.extVertexArrayObject.createVertexArrayOES(),L.bindVertexArrayOES.set(this.vao),P=0,this.boundProgram=n,this.boundLayoutVertexBuffer=u,this.boundPaintVertexBuffers=m,this.boundIndexBuffer=w,this.boundVertexOffset=b,this.boundDynamicVertexBuffer=S,this.boundDynamicVertexBuffer2=A;else{P=L.currentNumAttributes||0;for(let Y=O;Y<P;Y++)V.disableVertexAttribArray(Y)}u.enableAttributes(V,n);for(const Y of m)Y.enableAttributes(V,n);S&&S.enableAttributes(V,n),A&&A.enableAttributes(V,n),u.bind(),u.setVertexAttribPointers(V,n,b);for(const Y of m)Y.bind(),Y.setVertexAttribPointers(V,n,b);S&&(S.bind(),S.setVertexAttribPointers(V,n,b)),w&&w.bind(),A&&(A.bind(),A.setVertexAttribPointers(V,n,b)),L.currentNumAttributes=O}destroy(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)}}function su(d,n){const u=Math.pow(2,n.canonical.z),m=n.canonical.y;return[new f.MercatorCoordinate(0,m/u).toLngLat().lat,new f.MercatorCoordinate(0,(m+1)/u).toLngLat().lat]}function rf(d,n,u,m,w,b,S){const A=d.context,P=A.gl,O=u.fbo;if(!O)return;d.prepareDrawTile();const L=d.useProgram("hillshade");A.activeTexture.set(P.TEXTURE0),P.bindTexture(P.TEXTURE_2D,O.colorAttachment.get());const V=((H,se,ie,he)=>{const de=ie.paint.get("hillshade-shadow-color"),ce=ie.paint.get("hillshade-highlight-color"),le=ie.paint.get("hillshade-accent-color");let we=ie.paint.get("hillshade-illumination-direction")*(Math.PI/180);"viewport"===ie.paint.get("hillshade-illumination-anchor")&&(we-=H.transform.angle);const ze=!H.options.moving;return{u_matrix:he||H.transform.calculateProjMatrix(se.tileID.toUnwrapped(),ze),u_image:0,u_latrange:su(0,se.tileID),u_light:[ie.paint.get("hillshade-exaggeration"),we],u_shadow:de,u_highlight:ce,u_accent:le}})(d,u,m,d.terrain?n.projMatrix:null);d.prepareDrawProgram(A,L,n.toUnwrapped());const{tileBoundsBuffer:Y,tileBoundsIndexBuffer:te,tileBoundsSegments:J}=d.getTileBoundsBuffers(u);L.draw(A,P.TRIANGLES,w,b,S,f.CullFaceMode.disabled,V,m.id,Y,te,J)}function Ju(d,n,u){if(!n.needsDEMTextureUpload)return;const m=d.context,w=m.gl;m.pixelStoreUnpackPremultiplyAlpha.set(!1),n.demTexture=n.demTexture||d.getTileTexture(u.stride);const b=u.getPixels();n.demTexture?n.demTexture.update(b,{premultiply:!1}):n.demTexture=new f.Texture(m,b,w.RGBA,{premultiply:!1}),n.needsDEMTextureUpload=!1}function Qu(d,n,u,m,w,b){const S=d.context,A=S.gl;if(!n.dem)return;const P=n.dem;if(S.activeTexture.set(A.TEXTURE1),Ju(d,n,P),!n.demTexture)return;n.demTexture.bind(A.NEAREST,A.CLAMP_TO_EDGE);const O=P.dim;S.activeTexture.set(A.TEXTURE0);let L=n.fbo;if(!L){const J=new f.Texture(S,{width:O,height:O,data:null},A.RGBA);J.bind(A.LINEAR,A.CLAMP_TO_EDGE),L=n.fbo=S.createFramebuffer(O,O,!0),L.colorAttachment.set(J.texture)}S.bindFramebuffer.set(L.framebuffer),S.viewport.set([0,0,O,O]);const{tileBoundsBuffer:V,tileBoundsIndexBuffer:Y,tileBoundsSegments:te}=d.getMercatorTileBoundsBuffers();d.useProgram("hillshadePrepare").draw(S,A.TRIANGLES,m,w,b,f.CullFaceMode.disabled,((J,H)=>{const se=H.stride,ie=f.create();return f.ortho(ie,0,f.EXTENT,-f.EXTENT,0,0,1),f.translate(ie,ie,[0,-f.EXTENT,0]),{u_matrix:ie,u_image:1,u_dimension:[se,se],u_zoom:J.overscaledZ,u_unpack:H.unpackVector}})(n.tileID,P),u.id,V,Y,te),n.needsHillshadePrepare=!1}const Fo=(d,n)=>({u_matrix:new f.UniformMatrix4f(d,n.u_matrix),u_image0:new f.Uniform1i(d,n.u_image0),u_skirt_height:new f.Uniform1f(d,n.u_skirt_height)}),Gs=(d,n)=>({u_matrix:d,u_image0:0,u_skirt_height:n}),nf=(d,n,u,m,w,b)=>({u_proj_matrix:Float32Array.from(d),u_globe_matrix:n,u_merc_matrix:u,u_zoom_transition:m,u_merc_center:w,u_image0:0,u_grid_matrix:b?Float32Array.from(b):new Float32Array(9)});function ou(d,n){return null!=d&&null!=n&&!(!d.hasData()||!n.hasData())&&null!=d.demTexture&&null!=n.demTexture&&d.tileID.key!==n.tileID.key}const Fn=new class{constructor(){this.operations={}}newMorphing(d,n,u,m,w){if(d in this.operations){const b=this.operations[d];b.to.tileID.key!==u.tileID.key&&(b.queued=u)}else this.operations[d]={startTime:m,phase:0,duration:w,from:n,to:u,queued:null}}getMorphValuesForProxy(d){if(!(d in this.operations))return null;const n=this.operations[d];return{from:n.from,to:n.to,phase:n.phase}}update(d){for(const n in this.operations){const u=this.operations[n];for(u.phase=(d-u.startTime)/u.duration;u.phase>=1||!this._validOp(u);)if(!this._nextOp(u,d)){delete this.operations[n];break}}}_nextOp(d,n){return!!d.queued&&(d.from=d.to,d.to=d.queued,d.queued=null,d.phase=0,d.startTime=n,!0)}_validOp(d){return d.from.hasData()&&d.to.hasData()}},Do={0:null,1:"TERRAIN_VERTEX_MORPHING",2:"TERRAIN_WIREFRAME"};function eh(d,n){const u=1<<d.z;return!n&&(0===d.x||d.x===u-1)||0===d.y||d.y===u-1}const lu=d=>({u_matrix:d});function cu(d,n,u,m,w){if(w>0){const b=f.exported.now(),S=(b-d.timeAdded)/w,A=n?(b-n.timeAdded)/w:-1,P=u.getSource(),O=m.coveringZoomLevel({tileSize:P.tileSize,roundZoom:P.roundZoom}),L=!n||Math.abs(n.tileID.overscaledZ-O)>Math.abs(d.tileID.overscaledZ-O),V=L&&d.refreshedUponExpiration?1:f.clamp(L?S:1-A,0,1);return d.refreshedUponExpiration&&S>=1&&(d.refreshedUponExpiration=!1),n?{opacity:1,mix:1-V}:{opacity:V,mix:0}}return{opacity:1,mix:0}}const af=2*f.mercatorZfromAltitude(1,0)*f.GLOBE_RADIUS*Math.PI;class pc extends f.SourceCache{constructor(n){const u={type:"raster-dem",maxzoom:n.transform.maxZoom},m=new Rr(nr(),null),w=Re("mock-dem",u,m,n.style);super("mock-dem",w,!1),w.setEventedParent(this),this._sourceLoaded=!0}_loadTile(n,u){n.state="loaded",u(null)}}class mc extends f.SourceCache{constructor(n){const u=Re("proxy",{type:"geojson",maxzoom:n.transform.maxZoom},new Rr(nr(),null),n.style);super("proxy",u,!1),u.setEventedParent(this),this.map=this.getSource().map=n,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(n,u,m){if(n.freezeTileCoverage)return;this.transform=n;const w=n.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((b,S)=>{if(b[S.key]="",!this._tiles[S.key]){const A=new f.Tile(S,this._source.tileSize*S.overscaleFactor(),n.tileZoom);A.state="loaded",this._tiles[S.key]=A}return b},{});for(const b in this._tiles)b in w||(this.freeFBO(b),this._tiles[b].unloadVectorData(),delete this._tiles[b])}freeFBO(n){const u=this.proxyCachedFBO[n];if(void 0!==u){const m=Object.values(u);this.renderCachePool.push(...m),delete this.proxyCachedFBO[n]}}deallocRenderCache(){this.renderCache.forEach(n=>n.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class uu extends f.OverscaledTileID{constructor(n,u,m){super(n.overscaledZ,n.wrap,n.canonical.z,n.canonical.x,n.canonical.y),this.proxyTileKey=u,this.projMatrix=m}}class Yn extends f.Elevation{constructor(n,u){super(),this.painter=n,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[m,w,b]=function(P){const O=new f.StructArrayLayout4i8,L=new f.StructArrayLayout3ui6,V=131;O.reserve(17161),L.reserve(33800);const Y=f.EXTENT/128,te=f.EXTENT+Y/2,J=te+Y;for(let se=-Y;se<J;se+=Y)for(let ie=-Y;ie<J;ie+=Y){const he=ie<0||ie>te||se<0||se>te?24575:0,de=f.clamp(Math.round(ie),0,f.EXTENT),ce=f.clamp(Math.round(se),0,f.EXTENT);O.emplaceBack(de+he,ce,de,ce)}const H=(se,ie)=>{const he=ie*V+se;L.emplaceBack(he+1,he,he+V),L.emplaceBack(he+V,he+V+1,he+1)};for(let se=1;se<129;se++)for(let ie=1;ie<129;ie++)H(ie,se);return[0,129].forEach(se=>{for(let ie=0;ie<130;ie++)H(ie,se),H(se,ie)}),[O,L,32768]}(),S=n.context;this.gridBuffer=S.createVertexBuffer(m,f.boundsAttributes.members),this.gridIndexBuffer=S.createIndexBuffer(w),this.gridSegments=f.SegmentVector.simpleSegment(0,0,m.length,w.length),this.gridNoSkirtSegments=f.SegmentVector.simpleSegment(0,0,m.length,b),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new mc(u.map),this.orthoMatrix=f.create(),f.ortho(this.orthoMatrix,0,f.EXTENT,0,f.EXTENT,0,1);const A=S.gl;this._overlapStencilMode=new f.StencilMode({func:A.GEQUAL,mask:255},0,255,A.KEEP,A.KEEP,A.REPLACE),this._previousZoom=n.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=u,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new pc(u.map)}set style(n){n.on("data",this._onStyleDataEvent.bind(this)),n.on("neworder",this._checkRenderCacheEfficiency.bind(this)),this._style=n,this._checkRenderCacheEfficiency()}update(n,u,m){if(n&&n.terrain){this._style!==n&&(this.style=n),this.enabled=!0;const w=n.terrain.properties;this.sourceCache=0===n.terrain.drapeRenderMode?this._mockSourceCache:n._getSourceCache(w.get("source")),this._exaggeration=w.get("exaggeration");const b=()=>{this.sourceCache.used&&f.warnOnce(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.\nThis leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const S=this.getScaledDemTileSize();this.sourceCache.update(u,S,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,b(),this._initializing=!0),b(),u.updateElevation(!m),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(u),this._emptyDEMTextureDirty=!0}else this._disable()}resetTileLookupCache(n){this._findCoveringTileCache[n]={}}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_checkRenderCacheEfficiency(){const n=this.renderCacheEfficiency(this._style);this._style.map._optimizeForTerrain||100!==n.efficiency&&f.warnOnce(`Terrain render cache efficiency is not optimal (${n.efficiency}%) and performance\n                may be affected negatively, consider placing all background, fill and line layers before layer\n                with id '${n.firstUndrapedLayer}' or create a map using optimizeForTerrain: true option.`)}_onStyleDataEvent(n){n.coord&&"source"===n.dataType?this._clearRenderCacheForTile(n.sourceCacheId,n.coord):"style"===n.dataType&&(this._invalidateRenderCache=!0)}_disable(){if(this.enabled&&(this.enabled=!1,this._sharedDepthStencil=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const n in this._style._sourceCaches)this._style._sourceCaches[n].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this._emptyDepthBufferTexture&&this._emptyDepthBufferTexture.destroy(),this.pool.forEach(n=>n.fb.destroy()),this.pool=[],this._depthFBO&&(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0)}_source(){return this.enabled?this.sourceCache:null}exaggeration(){return this._exaggeration}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const n=2*this.proxySourceCache.getSource().tileSize;return[n,n]}set useVertexMorphing(n){this._useVertexMorphing=n}updateTileBinding(n){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const u=this.proxySourceCache,m=this.painter.transform;this._initializing&&(this._initializing=0===m._centerAltitude&&-1===this.getAtPointOrZero(f.MercatorCoordinate.fromLngLat(m.center),-1),this._emptyDEMTextureDirty=!this._initializing);const w=this.proxyCoords=u.getIds().map(P=>{const O=u.getTileByID(P).tileID;return O.projMatrix=m.calculateProjMatrix(O.toUnwrapped()),O});(function(P,O){const L=O.transform.pointCoordinate(O.transform.getCameraPoint()),V=new f.pointGeometry(L.x,L.y);P.sort((Y,te)=>{if(te.overscaledZ-Y.overscaledZ)return te.overscaledZ-Y.overscaledZ;const J=new f.pointGeometry(Y.canonical.x+(1<<Y.canonical.z)*Y.wrap,Y.canonical.y),H=new f.pointGeometry(te.canonical.x+(1<<te.canonical.z)*te.wrap,te.canonical.y),se=V.mult(1<<Y.canonical.z);return se.x-=.5,se.y-=.5,se.distSqr(J)-se.distSqr(H)})})(w,this.painter),this._previousZoom=m.zoom;const b=this.proxyToSource||{};this.proxyToSource={},w.forEach(P=>{this.proxyToSource[P.key]={}}),this.terrainTileForTile={};const S=this._style._sourceCaches;for(const P in S){const O=S[P];if(!O.used||(O!==this.sourceCache&&this.resetTileLookupCache(O.id),this._setupProxiedCoordsForOrtho(O,n[P],b),O.usedForTerrain))continue;const L=n[P];O.getSource().reparseOverscaled&&this._assignTerrainTiles(L)}this.proxiedCoords[u.id]=w.map(P=>new uu(P,P.key,this.orthoMatrix)),this._assignTerrainTiles(w),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(b),this.renderingToTexture=!1,this._updateTimestamp=f.exported.now();const A={};this._visibleDemTiles=[];for(const P of this.proxyCoords){const O=this.terrainTileForTile[P.key];if(!O)continue;const L=O.tileID.key;L in A||(this._visibleDemTiles.push(O),A[L]=L)}}_assignTerrainTiles(n){this._initializing||n.forEach(u=>{if(this.terrainTileForTile[u.key])return;const m=this._findTileCoveringTileID(u,this.sourceCache);m&&(this.terrainTileForTile[u.key]=m)})}_prepareDEMTextures(){const n=this.painter.context,u=n.gl;for(const m in this.terrainTileForTile){const w=this.terrainTileForTile[m],b=w.dem;!b||w.demTexture&&!w.needsDEMTextureUpload||(n.activeTexture.set(u.TEXTURE1),Ju(this.painter,w,b))}}_prepareDemTileUniforms(n,u,m,w){if(!u||null==u.demTexture)return!1;const b=n.tileID.canonical,S=Math.pow(2,u.tileID.canonical.z-b.z),A=w||"";return m[`u_dem_tl${A}`]=[b.x*S%1,b.y*S%1],m[`u_dem_scale${A}`]=S,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}get emptyDepthBufferTexture(){const n=this.painter.context,u=n.gl;if(!this._emptyDepthBufferTexture){const m=new f.RGBAImage({width:1,height:1},Uint8Array.of(255,255,255,255));this._emptyDepthBufferTexture=new f.Texture(n,m,u.RGBA,{premultiply:!1})}return this._emptyDepthBufferTexture}_getLoadedAreaMinimum(){let n=0;const u=this._visibleDemTiles.reduce((m,w)=>{if(!w.dem)return m;const b=w.dem.tree.minimums[0];return b>0&&n++,m+b},0);return n?u/n:0}_updateEmptyDEMTexture(){const n=this.painter.context,u=n.gl;n.activeTexture.set(u.TEXTURE2);const m=this._getLoadedAreaMinimum(),w=new f.RGBAImage({width:1,height:1},new Uint8Array(f.DEMData.pack(m,this.sourceCache.getSource().encoding)));this._emptyDEMTextureDirty=!1;let b=this._emptyDEMTexture;return b?b.update(w,{premultiply:!1}):b=this._emptyDEMTexture=new f.Texture(n,w,u.RGBA,{premultiply:!1}),b}setupElevationDraw(n,u,m){const w=this.painter.context,b=w.gl,S=(A=this.sourceCache.getSource().encoding,{u_dem:2,u_dem_prev:4,u_dem_unpack:f.DEMData.getUnpackVector(A),u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_exaggeration:0,u_tile_tl_up:[0,0,1],u_tile_tr_up:[0,0,1],u_tile_br_up:[0,0,1],u_tile_bl_up:[0,0,1],u_tile_up_scale:1});var A;S.u_dem_size=this.sourceCache.getSource().tileSize,S.u_exaggeration=this.exaggeration();const P=this.painter.transform,O=P.projection,L=n.tileID.canonical;S.u_tile_tl_up=O.upVector(L,0,0),S.u_tile_tr_up=O.upVector(L,f.EXTENT,0),S.u_tile_br_up=O.upVector(L,f.EXTENT,f.EXTENT),S.u_tile_bl_up=O.upVector(L,0,f.EXTENT),S.u_tile_up_scale=m&&m.useDenormalizedUpVectorScale?af:O.upVectorScale(L,P.center.lat,P.worldSize).metersToTile;let V=null,Y=null,te=1;if(m&&m.morphing&&this._useVertexMorphing){const J=m.morphing.srcDemTile,H=m.morphing.dstDemTile;te=m.morphing.phase,J&&H&&(this._prepareDemTileUniforms(n,J,S,"_prev")&&(Y=J),this._prepareDemTileUniforms(n,H,S)&&(V=H))}if(Y&&V?(w.activeTexture.set(b.TEXTURE2),V.demTexture.bind(b.NEAREST,b.CLAMP_TO_EDGE,b.NEAREST),w.activeTexture.set(b.TEXTURE4),Y.demTexture.bind(b.NEAREST,b.CLAMP_TO_EDGE,b.NEAREST),S.u_dem_lerp=te):(V=this.terrainTileForTile[n.tileID.key],w.activeTexture.set(b.TEXTURE2),(this._prepareDemTileUniforms(n,V,S)?V.demTexture:this.emptyDEMTexture).bind(b.NEAREST,b.CLAMP_TO_EDGE)),w.activeTexture.set(b.TEXTURE3),m&&m.useDepthForOcclusion?(this._depthTexture&&this._depthTexture.bind(b.NEAREST,b.CLAMP_TO_EDGE),this._depthFBO&&(S.u_depth_size_inv=[1/this._depthFBO.width,1/this._depthFBO.height])):(this.emptyDepthBufferTexture.bind(b.NEAREST,b.CLAMP_TO_EDGE),S.u_depth_size_inv=[1,1]),m&&m.useMeterToDem&&V){const J=(1<<V.tileID.canonical.z)*f.mercatorZfromAltitude(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;S.u_meter_to_dem=J}m&&m.labelPlaneMatrixInv&&(S.u_label_plane_matrix_inv=m.labelPlaneMatrixInv),u.setTerrainUniformValues(w,S)}renderToBackBuffer(n){const u=this.painter,m=this.painter.context;0!==n.length&&(m.bindFramebuffer.set(null),m.viewport.set([0,0,u.width,u.height]),this.renderingToTexture=!1,function(w,b,S,A,P){if("globe"===w.transform.projection.name)!function(O,L,V,Y,te){const J=O.context,H=J.gl;let se,ie;const he=O.options.showTerrainWireframe?2:0,de=(qe,Qe)=>{if(ie===qe)return;const ke=[Do[qe],"PROJECTION_GLOBE_VIEW"];Qe&&ke.push(Do[he]),se=O.useProgram("globeRaster",null,ke),ie=qe},ce=O.colorModeForRenderPass(),le=new f.DepthMode(H.LEQUAL,f.DepthMode.ReadWrite,O.depthRangeFor3D);Fn.update(te);const we=O.transform,ze=f.calculateGlobeMercatorMatrix(we),Be=[f.mercatorXfromLng(we.center.lng),f.mercatorYfromLat(we.center.lat)],Le=O.globeSharedBuffers;if((he?[!1,!0]:[!1]).forEach(qe=>{ie=-1;const Qe=qe?H.LINES:H.TRIANGLES;for(const ke of Y){const gt=V.getTile(ke),dt=f.StencilMode.disabled,It=L.prevTerrainTileForTile[ke.key],et=L.terrainTileForTile[ke.key];ou(It,et)&&Fn.newMorphing(ke.key,It,et,te,250),J.activeTexture.set(H.TEXTURE0),gt.texture.bind(H.LINEAR,H.CLAMP_TO_EDGE);const Mt=Fn.getMorphValuesForProxy(ke.key),Jt=Mt?1:0,Et={useDenormalizedUpVectorScale:!0};Mt&&f.extend$1(Et,{morphing:{srcDemTile:Mt.from,dstDemTile:Mt.to,phase:f.easeCubicInOut(Mt.phase)}});const bt=Float32Array.from(we.globeMatrix),Ot=f.globeTileLatLngCorners(ke.canonical),fr=f.getGridMatrix(ke.canonical,Ot),Ht=nf(we.projMatrix,bt,ze,f.globeToMercatorTransition(we.zoom),Be,fr);if(de(Jt,qe),L.setupElevationDraw(gt,se,Et),O.prepareDrawProgram(J,se,ke.toUnwrapped()),Le){const[rr,Dr,vi]=qe?Le.getWirefameBuffers(O.context):Le.getGridBuffers();se.draw(J,Qe,le,dt,ce,f.CullFaceMode.backCCW,Ht,"globe_raster",rr,Dr,vi)}}}),Le){se=O.useProgram("globeRaster",null,["GLOBE_POLES","PROJECTION_GLOBE_VIEW"]);for(const qe of Y){const{x:Qe,y:ke,z:gt}=qe.canonical,dt=0===ke,It=ke===(1<<gt)-1,[et,Mt,Jt,Et]=Le.getPoleBuffers(gt);if(Et&&(dt||It)){const bt=V.getTile(qe);J.activeTexture.set(H.TEXTURE0),bt.texture.bind(H.LINEAR,H.CLAMP_TO_EDGE);let Ot=f.globePoleMatrixForTile(gt,Qe,we);const fr=(Ht,rr)=>Ht.draw(J,H.TRIANGLES,le,f.StencilMode.disabled,ce,f.CullFaceMode.disabled,nf(we.projMatrix,Ot,Ot,0,Be),"globe_pole_raster",rr,Jt,Et);L.setupElevationDraw(bt,se,{}),O.prepareDrawProgram(J,se,qe.toUnwrapped()),dt&&fr(se,et),It&&(Ot=f.scale(f.create(),Ot,[1,-1,1]),fr(se,Mt))}}}}(w,b,S,A,P);else{const O=w.context,L=O.gl;let V,Y;const te=w.options.showTerrainWireframe?2:0,J=(de,ce)=>{if(Y===de)return;const le=[Do[de]];ce&&le.push(Do[te]),V=w.useProgram("terrainRaster",null,le),Y=de},H=w.colorModeForRenderPass(),se=new f.DepthMode(L.LEQUAL,f.DepthMode.ReadWrite,w.depthRangeFor3D);Fn.update(P);const ie=w.transform,he=6*Math.pow(1.5,22-ie.zoom)*b.exaggeration();(te?[!1,!0]:[!1]).forEach(de=>{Y=-1;const ce=de?L.LINES:L.TRIANGLES,[le,we]=de?b.getWirefameBuffer():[b.gridIndexBuffer,b.gridSegments];for(const ze of A){const Be=S.getTile(ze),Le=f.StencilMode.disabled,qe=b.prevTerrainTileForTile[ze.key],Qe=b.terrainTileForTile[ze.key];ou(qe,Qe)&&Fn.newMorphing(ze.key,qe,Qe,P,250),O.activeTexture.set(L.TEXTURE0),Be.texture.bind(L.LINEAR,L.CLAMP_TO_EDGE,L.LINEAR_MIPMAP_NEAREST);const ke=Fn.getMorphValuesForProxy(ze.key),gt=ke?1:0;let dt;ke&&(dt={morphing:{srcDemTile:ke.from,dstDemTile:ke.to,phase:f.easeCubicInOut(ke.phase)}});const It=Gs(ze.projMatrix,eh(ze.canonical,ie.renderWorldCopies)?he/10:he);J(gt,de),b.setupElevationDraw(Be,V,dt),w.prepareDrawProgram(O,V,ze.toUnwrapped()),V.draw(O,ce,se,Le,H,f.CullFaceMode.backCCW,It,"terrain_raster",b.gridBuffer,le,we)}})}}(u,this,this.proxySourceCache,n,this._updateTimestamp),this.renderingToTexture=!0,n.splice(0,n.length))}renderBatch(n){if(0===this._drapedRenderBatches.length)return n+1;this.renderingToTexture=!0;const u=this.painter,m=this.painter.context,w=this.proxySourceCache,b=this.proxiedCoords[w.id],S=this._drapedRenderBatches.shift(),A=[],P=u.style.order;let O=0;for(const L of b){const V=w.getTileByID(L.proxyTileKey),Y=w.proxyCachedFBO[L.key]?w.proxyCachedFBO[L.key][n]:void 0,te=void 0!==Y?w.renderCache[Y]:this.pool[O++],J=void 0!==Y;if(V.texture=te.tex,J&&!te.dirty){A.push(V.tileID);continue}let H;m.bindFramebuffer.set(te.fb.framebuffer),this.renderedToTile=!1,te.dirty&&(m.clear({color:f.Color.transparent,stencil:0}),te.dirty=!1);for(let se=S.start;se<=S.end;++se){const ie=u.style._layers[P[se]];if(ie.isHidden(u.transform.zoom))continue;const he=u.style._getLayerSourceCache(ie),de=he?this.proxyToSource[L.key][he.id]:[L];if(!de)continue;const ce=de;m.viewport.set([0,0,te.fb.width,te.fb.height]),H!==(he?he.id:null)&&(this._setupStencil(te,de,ie,he),H=he?he.id:null),u.renderLayer(u,he,ie,ce)}this.renderedToTile?(te.dirty=!0,A.push(V.tileID)):J||--O,5===O&&(O=0,this.renderToBackBuffer(A))}return this.renderToBackBuffer(A),this.renderingToTexture=!1,m.bindFramebuffer.set(null),m.viewport.set([0,0,u.width,u.height]),S.end+1}postRender(){}renderCacheEfficiency(n){const u=n.order.length;if(0===u)return{efficiency:100};let m,w=0,b=0,S=!1;for(let A=0;A<u;++A){const P=n._layers[n.order[A]];this._style.isLayerDraped(P)?(S&&++w,++b):S||(S=!0,m=P.id)}return 0===b?{efficiency:100}:{efficiency:100*(1-w/b),firstUndrapedLayer:m}}getMinElevationBelowMSL(){let n=0;return this._visibleDemTiles.filter(u=>u.dem).forEach(u=>{n=Math.min(n,u.dem.tree.minimums[0])}),0===n?n:(n-30)*this._exaggeration}raycast(n,u,m){if(!this._visibleDemTiles)return null;const w=this._visibleDemTiles.filter(b=>b.dem).map(b=>{const S=b.tileID,A=Math.pow(2,S.overscaledZ),{x:P,y:O}=S.canonical,L=P/A,V=(P+1)/A,Y=O/A,te=(O+1)/A;return{minx:L,miny:Y,maxx:V,maxy:te,t:b.dem.tree.raycastRoot(L,Y,V,te,n,u,m),tile:b}});w.sort((b,S)=>(null!==b.t?b.t:Number.MAX_VALUE)-(null!==S.t?S.t:Number.MAX_VALUE));for(const b of w){if(null==b.t)return null;const S=b.tile.dem.tree.raycast(b.minx,b.miny,b.maxx,b.maxy,n,u,m);if(null!=S)return S}return null}_createFBO(){const n=this.painter.context,u=n.gl,m=this.drapeBufferSize;n.activeTexture.set(u.TEXTURE0);const w=new f.Texture(n,{width:m[0],height:m[1],data:null},u.RGBA);w.bind(u.LINEAR,u.CLAMP_TO_EDGE);const b=n.createFramebuffer(m[0],m[1],!1);return b.colorAttachment.set(w.texture),b.depthAttachment=new hl(n,b.framebuffer),void 0===this._sharedDepthStencil?(this._sharedDepthStencil=n.createRenderbuffer(n.gl.DEPTH_STENCIL,m[0],m[1]),this._stencilRef=0,b.depthAttachment.set(this._sharedDepthStencil),n.clear({stencil:0})):b.depthAttachment.set(this._sharedDepthStencil),n.extTextureFilterAnisotropic&&!n.extTextureFilterAnisotropicForceOff&&u.texParameterf(u.TEXTURE_2D,n.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,n.extTextureFilterAnisotropicMax),{fb:b,tex:w,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._style.light&&this._style.light.hasTransition())return!0;for(const n in this._style._sourceCaches)if(this._style._sourceCaches[n].hasTransition())return!0;return this._style.order.some(n=>{const u=this._style._layers[n],m=u.isHidden(this.painter.transform.zoom),w=u.getCrossfadeParameters(),b=!!w&&1!==w.t,S=u.hasTransition();return"custom"!==u.type&&!m&&(b||S)})}_clearRasterFadeFromRenderCache(){let n=!1;for(const u in this._style._sourceCaches)if(this._style._sourceCaches[u]._source instanceof G){n=!0;break}if(n)for(let u=0;u<this._style.order.length;++u){const m=this._style._layers[this._style.order[u]],w=m.isHidden(this.painter.transform.zoom),b=this._style._getLayerSourceCache(m);if("raster"!==m.type||w||!b)continue;const S=m.paint.get("raster-fade-duration");for(const A of this.proxyCoords){const P=this.proxyToSource[A.key][b.id];if(P)for(const O of P){const L=cu(b.getTile(O),b.findLoadedParent(O,0),b,this.painter.transform,S);(1!==L.opacity||0!==L.mix)&&this._clearRenderCacheForTile(b.id,O)}}}}_setupDrapedRenderBatches(){const n=this._style.order,u=n.length;if(0===u)return;const m=[];let w,b=0,S=this._style._layers[n[b]];for(;!this._style.isLayerDraped(S)&&S.isHidden(this.painter.transform.zoom)&&++b<u;)S=this._style._layers[n[b]];for(;b<u;++b){const A=this._style._layers[n[b]];A.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(A)?void 0===w&&(w=b):void 0!==w&&(m.push({start:w,end:b-1}),w=void 0))}void 0!==w&&m.push({start:w,end:b-1}),this._drapedRenderBatches=m}_setupRenderCache(n){const u=this.proxySourceCache;if(this._shouldDisableRenderCache()||this._invalidateRenderCache){if(this._invalidateRenderCache=!1,u.renderCache.length>u.renderCachePool.length){const S=Object.values(u.proxyCachedFBO);u.proxyCachedFBO={};for(let A=0;A<S.length;++A){const P=Object.values(S[A]);u.renderCachePool.push(...P)}}return}this._clearRasterFadeFromRenderCache();const m=this.proxyCoords,w=this._tilesDirty;for(let S=m.length-1;S>=0;S--){const A=m[S];if(u.getTileByID(A.key),void 0!==u.proxyCachedFBO[A.key]){const P=n[A.key],O=this.proxyToSource[A.key];let L=0;for(const V in O){const Y=O[V],te=P[V];if(!te||te.length!==Y.length||Y.some((J,H)=>J!==te[H]||w[V]&&w[V].hasOwnProperty(J.key))){L=-1;break}++L}for(const V in u.proxyCachedFBO[A.key])u.renderCache[u.proxyCachedFBO[A.key][V]].dirty=L<0||L!==Object.values(P).length}}const b=[...this._drapedRenderBatches];b.sort((S,A)=>A.end-A.start-(S.end-S.start));for(const S of b)for(const A of m){if(u.proxyCachedFBO[A.key])continue;let P=u.renderCachePool.pop();void 0===P&&u.renderCache.length<50&&(P=u.renderCache.length,u.renderCache.push(this._createFBO())),void 0!==P&&(u.proxyCachedFBO[A.key]={},u.proxyCachedFBO[A.key][S.start]=P,u.renderCache[P].dirty=!0)}this._tilesDirty={}}_setupStencil(n,u,m,w){if(!w||!this._sourceTilesOverlap[w.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const b=this.painter.context,S=b.gl;if(u.length<=1)return void(this._overlapStencilType=!1);let A;if(m.isTileClipped())A=u.length,this._overlapStencilMode.test={func:S.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(u[0].overscaledZ>u[u.length-1].overscaledZ))return void(this._overlapStencilType=!1);A=1,this._overlapStencilMode.test={func:S.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+A>255&&(b.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=A,this._overlapStencilMode.ref=this._stencilRef,m.isTileClipped()&&this._renderTileClippingMasks(u,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return"Clip"===this._overlapStencilType||"Mask"===this._overlapStencilType}stencilModeForRTTOverlap(n){return this.renderingToTexture&&this._overlapStencilType?("Clip"===this._overlapStencilType&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs.get(n.key)||0),this._overlapStencilMode):f.StencilMode.disabled}_renderTileClippingMasks(n,u){const m=this.painter,w=this.painter.context,b=w.gl;m._tileClippingMaskIDs.clear(),w.setColorMode(f.ColorMode.disabled),w.setDepthMode(f.DepthMode.disabled);const S=m.useProgram("clippingMask");for(const A of n){const P=--u;m._tileClippingMaskIDs.set(A.key,P),S.draw(w,b.TRIANGLES,f.DepthMode.disabled,new f.StencilMode({func:b.ALWAYS,mask:0},P,255,b.KEEP,b.KEEP,b.REPLACE),f.ColorMode.disabled,f.CullFaceMode.disabled,lu(A.projMatrix),"$clipping",m.tileExtentBuffer,m.quadTriangleIndexBuffer,m.tileExtentSegments)}}pointCoordinate(n){const u=this.painter.transform;if(n.x<0||n.x>u.width||n.y<0||n.y>u.height)return null;const m=[n.x,n.y,1,1];f.transformMat4$1(m,m,u.pixelMatrixInverse),f.scale$1(m,m,1/m[3]),m[0]/=u.worldSize,m[1]/=u.worldSize;const w=u._camera.position,b=f.mercatorZfromAltitude(1,u.center.lat),S=[w[0],w[1],w[2]/b,0],A=f.subtract([],m.slice(0,3),S);f.normalize(A,A);const P=this.raycast(S,A,this._exaggeration);return null!==P&&P?(f.scaleAndAdd(S,S,A,P),S[3]=S[2],S[2]*=b,S):null}drawDepth(){const n=this.painter,u=n.context,m=this.proxySourceCache,w=Math.ceil(n.width),b=Math.ceil(n.height);if(!this._depthFBO||this._depthFBO.width===w&&this._depthFBO.height===b||(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0),!this._depthFBO){const S=u.gl,A=u.createFramebuffer(w,b,!0);u.activeTexture.set(S.TEXTURE0);const P=new f.Texture(u,{width:w,height:b,data:null},S.RGBA);P.bind(S.NEAREST,S.CLAMP_TO_EDGE),A.colorAttachment.set(P.texture);const O=u.createRenderbuffer(u.gl.DEPTH_COMPONENT16,w,b);A.depthAttachment.set(O),this._depthFBO=A,this._depthTexture=P}u.bindFramebuffer.set(this._depthFBO.framebuffer),u.viewport.set([0,0,w,b]),function(S,A,P,O){if("globe"===S.transform.projection.name)return;const L=S.context,V=L.gl;L.clear({depth:1});const Y=S.useProgram("terrainDepth"),te=new f.DepthMode(V.LESS,f.DepthMode.ReadWrite,S.depthRangeFor3D);for(const J of O){const H=P.getTile(J),se=Gs(J.projMatrix,0);A.setupElevationDraw(H,Y),Y.draw(L,V.TRIANGLES,te,f.StencilMode.disabled,f.ColorMode.unblended,f.CullFaceMode.backCCW,se,"terrain_depth",A.gridBuffer,A.gridIndexBuffer,A.gridNoSkirtSegments)}}(n,this,m,this.proxyCoords)}_setupProxiedCoordsForOrtho(n,u,m){if(n.getSource()instanceof Ee)return this._setupProxiedCoordsForImageSource(n,u,m);this._findCoveringTileCache[n.id]=this._findCoveringTileCache[n.id]||{};const w=this.proxiedCoords[n.id]=[],b=this.proxyCoords;for(let A=0;A<b.length;A++){const P=b[A],O=this._findTileCoveringTileID(P,n);if(O){const L=this._createProxiedId(P,O,m[P.key]&&m[P.key][n.id]);w.push(L),this.proxyToSource[P.key][n.id]=[L]}}let S=!1;for(let A=0;A<u.length;A++){const P=n.getTile(u[A]);if(!P||!P.hasData())continue;const O=this._findTileCoveringTileID(P.tileID,this.proxySourceCache);if(O&&O.tileID.canonical.z!==P.tileID.canonical.z){const L=this.proxyToSource[O.tileID.key][n.id],V=this._createProxiedId(O.tileID,P,m[O.tileID.key]&&m[O.tileID.key][n.id]);L?L.splice(L.length-1,0,V):this.proxyToSource[O.tileID.key][n.id]=[V],w.push(V),S=!0}}this._sourceTilesOverlap[n.id]=S}_setupProxiedCoordsForImageSource(n,u,m){if(!n.getSource().loaded())return;const w=this.proxiedCoords[n.id]=[],b=this.proxyCoords,S=n.getSource(),A=new f.pointGeometry(S.tileID.x,S.tileID.y)._div(1<<S.tileID.z),P=S.coordinates.map(f.MercatorCoordinate.fromLngLat).reduce((L,V)=>(L.min.x=Math.min(L.min.x,V.x-A.x),L.min.y=Math.min(L.min.y,V.y-A.y),L.max.x=Math.max(L.max.x,V.x-A.x),L.max.y=Math.max(L.max.y,V.y-A.y),L),{min:new f.pointGeometry(Number.MAX_VALUE,Number.MAX_VALUE),max:new f.pointGeometry(-Number.MAX_VALUE,-Number.MAX_VALUE)}),O=(L,V)=>{const Y=L.wrap+L.canonical.x/(1<<L.canonical.z),te=L.canonical.y/(1<<L.canonical.z),J=f.EXTENT/(1<<L.canonical.z),H=V.wrap+V.canonical.x/(1<<V.canonical.z),se=V.canonical.y/(1<<V.canonical.z);return Y+J<H+P.min.x||Y>H+P.max.x||te+J<se+P.min.y||te>se+P.max.y};for(let L=0;L<b.length;L++){const V=b[L];for(let Y=0;Y<u.length;Y++){const te=n.getTile(u[Y]);if(!te||!te.hasData()||O(V,te.tileID))continue;const J=this._createProxiedId(V,te,m[V.key]&&m[V.key][n.id]),H=this.proxyToSource[V.key][n.id];H?H.push(J):this.proxyToSource[V.key][n.id]=[J],w.push(J)}}}_createProxiedId(n,u,m){let w=this.orthoMatrix;if(m){const b=m.find(S=>S.key===u.tileID.key);if(b)return b}if(u.tileID.key!==n.key){const b=n.canonical.z-u.tileID.canonical.z;let S,A,P;w=f.create();const O=u.tileID.wrap-n.wrap<<n.overscaledZ;b>0?(S=f.EXTENT>>b,A=S*((u.tileID.canonical.x<<b)-n.canonical.x+O),P=S*((u.tileID.canonical.y<<b)-n.canonical.y)):(S=f.EXTENT<<-b,A=f.EXTENT*(u.tileID.canonical.x-(n.canonical.x+O<<-b)),P=f.EXTENT*(u.tileID.canonical.y-(n.canonical.y<<-b))),f.ortho(w,0,S,0,S,0,1),f.translate(w,w,[A,P,0])}return new uu(u.tileID,n.key,w)}_findTileCoveringTileID(n,u){let m=u.getTile(n);if(m&&m.hasData())return m;const w=this._findCoveringTileCache[u.id],b=w[n.key];if(m=b?u.getTileByID(b):null,m&&m.hasData()||null===b)return m;let S=m?m.tileID:n,A=S.overscaledZ;const P=u.getSource().minzoom,O=[];if(!b){const V=u.getSource().maxzoom;if(n.canonical.z>=V){const Y=n.canonical.z-V;u.getSource().reparseOverscaled?(A=Math.max(n.canonical.z+2,u.transform.tileZoom),S=new f.OverscaledTileID(A,n.wrap,V,n.canonical.x>>Y,n.canonical.y>>Y)):0!==Y&&(A=V,S=new f.OverscaledTileID(A,n.wrap,V,n.canonical.x>>Y,n.canonical.y>>Y))}S.key!==n.key&&(O.push(S.key),m=u.getTile(S))}const L=V=>{O.forEach(Y=>{w[Y]=V}),O.length=0};for(A-=1;A>=P&&(!m||!m.hasData());A--){m&&L(m.tileID.key);const V=S.calculateScaledKey(A);if(m=u.getTileByID(V),m&&m.hasData())break;const Y=w[V];if(null===Y)break;void 0===Y?O.push(V):m=u.getTileByID(Y)}return L(m?m.tileID.key:null),m&&m.hasData()?m:null}findDEMTileFor(n){return this.enabled?this._findTileCoveringTileID(n,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(n,u){let m=this._tilesDirty[n];m||(m=this._tilesDirty[n]={}),m[u.key]=!0}getWirefameBuffer(){if(!this.wireframeSegments){const n=function(u){let m=0;const w=new f.StructArrayLayout2ui4,b=131;for(let S=1;S<129;S++){for(let A=1;A<129;A++)m=S*b+A,w.emplaceBack(m,m+1),w.emplaceBack(m,m+b),w.emplaceBack(m+1,m+b),128===S&&w.emplaceBack(m+b,m+b+1);w.emplaceBack(m+1,m+1+b)}return w}();this.wireframeIndexBuffer=this.painter.context.createIndexBuffer(n),this.wireframeSegments=f.SegmentVector.simpleSegment(0,0,this.gridBuffer.length,n.length)}return[this.wireframeIndexBuffer,this.wireframeSegments]}}function _c(d){const n=[];for(let u=0;u<d.length;u++){if(null===d[u])continue;const m=d[u].split(" ");n.push(m.pop())}return n}class Yi{static cacheKey(n,u,m){let w=`${n}${m?m.cacheKey:""}`;for(const b of u)w+=`/${b}`;return w}constructor(n,u,m,w,b,S){const A=n.gl;this.program=A.createProgram();const P=_c(m.staticAttributes),O=w?w.getBinderAttributes():[],L=P.concat(O),V=m.staticUniforms?_c(m.staticUniforms):[],Y=w?w.getBinderUniforms():[],te=V.concat(Y),J=[];for(const le of te)J.indexOf(le)<0&&J.push(le);let H=w?w.defines():[];H=H.concat(S.map(le=>`#define ${le}`));const se=H.concat("\n#ifdef GL_ES\nprecision mediump float;\n#else\n\n#if !defined(lowp)\n#define lowp\n#endif\n\n#if !defined(mediump)\n#define mediump\n#endif\n\n#if !defined(highp)\n#define highp\n#endif\n\n#endif",xl,Na.fragmentSource,Ba.fragmentSource,m.fragmentSource).join("\n"),ie=H.concat("\n#ifdef GL_ES\nprecision highp float;\n#else\n\n#if !defined(lowp)\n#define lowp\n#endif\n\n#if !defined(mediump)\n#define mediump\n#endif\n\n#if !defined(highp)\n#define highp\n#endif\n\n#endif",xl,Na.vertexSource,Ba.vertexSource,Mo.vertexSource,m.vertexSource).join("\n"),he=A.createShader(A.FRAGMENT_SHADER);if(A.isContextLost())return void(this.failedToCreate=!0);A.shaderSource(he,se),A.compileShader(he),A.attachShader(this.program,he);const de=A.createShader(A.VERTEX_SHADER);if(A.isContextLost())return void(this.failedToCreate=!0);A.shaderSource(de,ie),A.compileShader(de),A.attachShader(this.program,de),this.attributes={};const ce={};this.numAttributes=L.length;for(let le=0;le<this.numAttributes;le++)L[le]&&(A.bindAttribLocation(this.program,le,L[le]),this.attributes[L[le]]=le);A.linkProgram(this.program),A.deleteShader(de),A.deleteShader(he);for(let le=0;le<J.length;le++){const we=J[le];if(we&&!ce[we]){const ze=A.getUniformLocation(this.program,we);ze&&(ce[we]=ze)}}var le,we;this.fixedUniforms=b(n,ce),this.binderUniforms=w?w.getUniforms(n,ce):[],-1!==S.indexOf("TERRAIN")&&(this.terrainUniforms={u_dem:new f.Uniform1i(le=n,(we=ce).u_dem),u_dem_prev:new f.Uniform1i(le,we.u_dem_prev),u_dem_unpack:new f.Uniform4f(le,we.u_dem_unpack),u_dem_tl:new f.Uniform2f(le,we.u_dem_tl),u_dem_scale:new f.Uniform1f(le,we.u_dem_scale),u_dem_tl_prev:new f.Uniform2f(le,we.u_dem_tl_prev),u_dem_scale_prev:new f.Uniform1f(le,we.u_dem_scale_prev),u_dem_size:new f.Uniform1f(le,we.u_dem_size),u_dem_lerp:new f.Uniform1f(le,we.u_dem_lerp),u_exaggeration:new f.Uniform1f(le,we.u_exaggeration),u_depth:new f.Uniform1i(le,we.u_depth),u_depth_size_inv:new f.Uniform2f(le,we.u_depth_size_inv),u_meter_to_dem:new f.Uniform1f(le,we.u_meter_to_dem),u_label_plane_matrix_inv:new f.UniformMatrix4f(le,we.u_label_plane_matrix_inv),u_tile_tl_up:new f.Uniform3f(le,we.u_tile_tl_up),u_tile_tr_up:new f.Uniform3f(le,we.u_tile_tr_up),u_tile_br_up:new f.Uniform3f(le,we.u_tile_br_up),u_tile_bl_up:new f.Uniform3f(le,we.u_tile_bl_up),u_tile_up_scale:new f.Uniform1f(le,we.u_tile_up_scale)}),-1!==S.indexOf("FOG")&&(this.fogUniforms=((le,we)=>({u_fog_matrix:new f.UniformMatrix4f(le,we.u_fog_matrix),u_fog_range:new f.Uniform2f(le,we.u_fog_range),u_fog_color:new f.Uniform4f(le,we.u_fog_color),u_fog_horizon_blend:new f.Uniform1f(le,we.u_fog_horizon_blend),u_fog_temporal_offset:new f.Uniform1f(le,we.u_fog_temporal_offset)}))(n,ce))}setTerrainUniformValues(n,u){if(!this.terrainUniforms)return;const m=this.terrainUniforms;if(!this.failedToCreate){n.program.set(this.program);for(const w in u)m[w].set(u[w])}}setFogUniformValues(n,u){if(!this.fogUniforms)return;const m=this.fogUniforms;if(!this.failedToCreate){n.program.set(this.program);for(const w in u)m[w].location&&m[w].set(u[w])}}draw(n,u,m,w,b,S,A,P,O,L,V,Y,te,J,H,se){const ie=n.gl;if(this.failedToCreate)return;n.program.set(this.program),n.setDepthMode(m),n.setStencilMode(w),n.setColorMode(b),n.setCullFace(S);for(const de of Object.keys(this.fixedUniforms))this.fixedUniforms[de].set(A[de]);J&&J.setUniforms(n,this.binderUniforms,Y,{zoom:te});const he={[ie.LINES]:2,[ie.TRIANGLES]:3,[ie.LINE_STRIP]:1}[u];for(const de of V.get()){const ce=de.vaos||(de.vaos={});(ce[P]||(ce[P]=new dc)).bind(n,this,O,J?J.getPaintVertexBuffers():[],L,de.vertexOffset,H,se),ie.drawElements(u,de.primitiveLength*he,ie.UNSIGNED_SHORT,de.primitiveOffset*he*2)}}}function yl(d,n,u){const m=1/cn(u,1,n.transform.tileZoom),w=Math.pow(2,u.tileID.overscaledZ),b=u.tileSize*Math.pow(2,n.transform.tileZoom)/w,S=b*(u.tileID.canonical.x+u.tileID.wrap*w),A=b*u.tileID.canonical.y;return{u_image:0,u_texsize:u.imageAtlasTexture.size,u_scale:[m,d.fromScale,d.toScale],u_fade:d.t,u_pixel_coord_upper:[S>>16,A>>16],u_pixel_coord_lower:[65535&S,65535&A]}}const hu=f.create(),fu=(d,n,u,m,w,b,S,A,P)=>{const O=n.style.light,L=O.properties.get("position"),V=[L.x,L.y,L.z],Y=f.create$1();"viewport"===O.properties.get("anchor")&&(f.fromRotation(Y,-n.transform.angle),f.transformMat3(V,V,Y));const te=O.properties.get("color"),J=n.transform,H={u_matrix:d,u_lightpos:V,u_lightintensity:O.properties.get("intensity"),u_lightcolor:[te.r,te.g,te.b],u_vertical_gradient:+u,u_opacity:m,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:hu,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0};return"globe"===J.projection.name&&(H.u_tile_id=[w.canonical.x,w.canonical.y,1<<w.canonical.z],H.u_zoom_transition=S,H.u_inv_rot_matrix=P,H.u_merc_center=A,H.u_up_dir=J.projection.upVector(new f.CanonicalTileID(0,0,0),A[0]*f.EXTENT,A[1]*f.EXTENT),H.u_height_lift=b),H},du=(d,n,u,m,w,b,S,A,P,O,L)=>{const V=fu(d,n,u,m,w,A,P,O,L),Y={u_height_factor:-Math.pow(2,w.overscaledZ)/S.tileSize/8};return f.extend(V,yl(b,n,S),Y)},Dn=d=>({u_matrix:d}),pu=(d,n,u,m)=>f.extend(Dn(d),yl(u,n,m)),mu=(d,n)=>({u_matrix:d,u_world:n}),th=(d,n,u,m,w)=>f.extend(pu(d,n,u,m),{u_world:w}),Ua=f.create(),Kn=(d,n,u,m,w,b)=>{const S=d.transform,A="globe"===S.projection.name;let P;if("map"===b.paint.get("circle-pitch-alignment"))if(A){const L=f.globePixelsToTileUnits(S.zoom,n.canonical);P=Float32Array.from([L,0,0,L])}else P=S.calculatePixelsToTileUnitsMatrix(u);else P=new Float32Array([S.pixelsToGLUnits[0],0,0,S.pixelsToGLUnits[1]]);const O={u_camera_to_center_distance:S.cameraToCenterDistance,u_matrix:d.translatePosMatrix(n.projMatrix,u,b.paint.get("circle-translate"),b.paint.get("circle-translate-anchor")),u_device_pixel_ratio:f.exported.devicePixelRatio,u_extrude_scale:P,u_inv_rot_matrix:Ua,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};return A&&(O.u_inv_rot_matrix=m,O.u_merc_center=w,O.u_tile_id=[n.canonical.x,n.canonical.y,1<<n.canonical.z],O.u_zoom_transition=f.globeToMercatorTransition(S.zoom),O.u_up_dir=S.projection.upVector(n.canonical,w[0],w[1])),O},sd=d=>{const n=[];return"map"===d.paint.get("circle-pitch-alignment")&&n.push("PITCH_WITH_MAP"),"map"===d.paint.get("circle-pitch-scale")&&n.push("SCALE_WITH_MAP"),n},sf=(d,n,u)=>{const m=f.EXTENT/u.tileSize;return{u_matrix:d,u_camera_to_center_distance:n.cameraToCenterDistance,u_extrude_scale:[n.pixelsToGLUnits[0]/m,n.pixelsToGLUnits[1]/m]}},Po=(d,n,u=1)=>({u_matrix:d,u_color:n,u_overlay:0,u_overlay_scale:u}),od=f.create(),of=(d,n,u,m,w,b,S)=>{const A=d.transform,P="globe"===A.projection.name,O=P?f.globePixelsToTileUnits(A.zoom,n.canonical):cn(u,1,b),L={u_matrix:n.projMatrix,u_extrude_scale:O,u_intensity:S,u_inv_rot_matrix:od,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};return P&&(L.u_inv_rot_matrix=m,L.u_merc_center=w,L.u_tile_id=[n.canonical.x,n.canonical.y,1<<n.canonical.z],L.u_zoom_transition=f.globeToMercatorTransition(A.zoom),L.u_up_dir=A.projection.upVector(n.canonical,w[0],w[1])),L},lf=(d,n,u,m,w,b,S)=>{const A=d.transform,P=A.calculatePixelsToTileUnitsMatrix(n),O={u_matrix:wn(d,n,u,w),u_pixels_to_tile_units:P,u_device_pixel_ratio:S,u_units_to_pixels:[1/A.pixelsToGLUnits[0],1/A.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:b,u_texsize:[0,0],u_scale:[0,0,0],u_mix:0,u_alpha_discard_threshold:0};if(Lo(u)){const L=vn(n,d.transform);O.u_texsize=n.lineAtlasTexture.size,O.u_scale=[L,m.fromScale,m.toScale],O.u_mix=m.t}return O},rh=(d,n,u,m,w,b)=>{const S=d.transform,A=vn(n,S);return{u_matrix:wn(d,n,u,w),u_texsize:n.imageAtlasTexture.size,u_pixels_to_tile_units:S.calculatePixelsToTileUnitsMatrix(n),u_device_pixel_ratio:b,u_image:0,u_scale:[A,m.fromScale,m.toScale],u_fade:m.t,u_units_to_pixels:[1/S.pixelsToGLUnits[0],1/S.pixelsToGLUnits[1]],u_alpha_discard_threshold:0}};function vn(d,n){return 1/cn(d,1,n.tileZoom)}function wn(d,n,u,m){return d.translatePosMatrix(m||n.tileID.projMatrix,n,u.paint.get("line-translate"),u.paint.get("line-translate-anchor"))}function Lo(d){const n=d.paint.get("line-dasharray").value;return n.value||"constant"!==n.kind}const Ro=(d,n,u,m,w,b)=>{return{u_matrix:d,u_tl_parent:n,u_scale_parent:u,u_fade_t:m.mix,u_opacity:m.opacity*w.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:w.paint.get("raster-brightness-min"),u_brightness_high:w.paint.get("raster-brightness-max"),u_saturation_factor:(A=w.paint.get("raster-saturation"),A>0?1-1/(1.001-A):-A),u_contrast_factor:(S=w.paint.get("raster-contrast"),S>0?1/(1-S):1+S),u_spin_weights:ih(w.paint.get("raster-hue-rotate")),u_perspective_transform:b};var S,A};function ih(d){d*=Math.PI/180;const n=Math.sin(d),u=Math.cos(d);return[(2*u+1)/3,(-Math.sqrt(3)*n-u+1)/3,(Math.sqrt(3)*n-u+1)/3]}const $s=f.create(),_u=(d,n,u,m,w,b,S,A,P,O,L,V,Y,te)=>{const J=w.transform,H={u_is_size_zoom_constant:+("constant"===d||"source"===d),u_is_size_feature_constant:+("constant"===d||"camera"===d),u_size_t:n?n.uSizeT:0,u_size:n?n.uSize:0,u_camera_to_center_distance:J.cameraToCenterDistance,u_rotate_symbol:+u,u_aspect_ratio:J.width/J.height,u_fade_change:w.options.fadeDuration?w.symbolFadeChange:1,u_matrix:b,u_label_plane_matrix:S,u_coord_matrix:A,u_is_text:+P,u_pitch_with_map:+m,u_texsize:O,u_texture:0,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:$s,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:$s};return"globe"===J.projection.name&&(H.u_tile_id=[L.canonical.x,L.canonical.y,1<<L.canonical.z],H.u_zoom_transition=V,H.u_inv_rot_matrix=te,H.u_merc_center=Y,H.u_camera_forward=J._camera.forward(),H.u_ecef_origin=f.globeECEFOrigin(J.globeMatrix,L.toUnwrapped()),H.u_tile_matrix=Float32Array.from(J.globeMatrix)),H},Oo=(d,n,u,m,w,b,S,A,P,O,L,V,Y,te,J)=>{const{cameraToCenterDistance:H,_pitch:se}=w.transform;return f.extend(_u(d,n,u,m,w,b,S,A,P,O,V,Y,te,J),{u_gamma_scale:m?H*Math.cos(w.terrain?0:se):1,u_device_pixel_ratio:f.exported.devicePixelRatio,u_is_halo:+L})},vl=(d,n,u,m,w,b,S,A,P,O,L,V,Y,te)=>f.extend(Oo(d,n,u,m,w,b,S,A,!0,P,!0,L,V,Y,te),{u_texsize_icon:O,u_texture_icon:1}),cf=(d,n,u)=>({u_matrix:d,u_opacity:n,u_color:u}),ar=(d,n,u,m,w,b)=>f.extend(function(S,A,P,O){const L=P.imageManager.getPattern(S.from.toString()),V=P.imageManager.getPattern(S.to.toString()),{width:Y,height:te}=P.imageManager.getPixelSize(),J=Math.pow(2,O.tileID.overscaledZ),H=O.tileSize*Math.pow(2,P.transform.tileZoom)/J,se=H*(O.tileID.canonical.x+O.tileID.wrap*J),ie=H*O.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:L.tl,u_pattern_br_a:L.br,u_pattern_tl_b:V.tl,u_pattern_br_b:V.br,u_texsize:[Y,te],u_mix:A.t,u_pattern_size_a:L.displaySize,u_pattern_size_b:V.displaySize,u_scale_a:A.fromScale,u_scale_b:A.toScale,u_tile_units_to_pixels:1/cn(O,1,P.transform.tileZoom),u_pixel_coord_upper:[se>>16,ie>>16],u_pixel_coord_lower:[65535&se,65535&ie]}}(m,b,u,w),{u_matrix:d,u_opacity:n}),Er={fillExtrusion:(d,n)=>({u_matrix:new f.UniformMatrix4f(d,n.u_matrix),u_lightpos:new f.Uniform3f(d,n.u_lightpos),u_lightintensity:new f.Uniform1f(d,n.u_lightintensity),u_lightcolor:new f.Uniform3f(d,n.u_lightcolor),u_vertical_gradient:new f.Uniform1f(d,n.u_vertical_gradient),u_opacity:new f.Uniform1f(d,n.u_opacity),u_tile_id:new f.Uniform3f(d,n.u_tile_id),u_zoom_transition:new f.Uniform1f(d,n.u_zoom_transition),u_inv_rot_matrix:new f.UniformMatrix4f(d,n.u_inv_rot_matrix),u_merc_center:new f.Uniform2f(d,n.u_merc_center),u_up_dir:new f.Uniform3f(d,n.u_up_dir),u_height_lift:new f.Uniform1f(d,n.u_height_lift)}),fillExtrusionPattern:(d,n)=>({u_matrix:new f.UniformMatrix4f(d,n.u_matrix),u_lightpos:new f.Uniform3f(d,n.u_lightpos),u_lightintensity:new f.Uniform1f(d,n.u_lightintensity),u_lightcolor:new f.Uniform3f(d,n.u_lightcolor),u_vertical_gradient:new f.Uniform1f(d,n.u_vertical_gradient),u_height_factor:new f.Uniform1f(d,n.u_height_factor),u_tile_id:new f.Uniform3f(d,n.u_tile_id),u_zoom_transition:new f.Uniform1f(d,n.u_zoom_transition),u_inv_rot_matrix:new f.UniformMatrix4f(d,n.u_inv_rot_matrix),u_merc_center:new f.Uniform2f(d,n.u_merc_center),u_up_dir:new f.Uniform3f(d,n.u_up_dir),u_height_lift:new f.Uniform1f(d,n.u_height_lift),u_image:new f.Uniform1i(d,n.u_image),u_texsize:new f.Uniform2f(d,n.u_texsize),u_pixel_coord_upper:new f.Uniform2f(d,n.u_pixel_coord_upper),u_pixel_coord_lower:new f.Uniform2f(d,n.u_pixel_coord_lower),u_scale:new f.Uniform3f(d,n.u_scale),u_fade:new f.Uniform1f(d,n.u_fade),u_opacity:new f.Uniform1f(d,n.u_opacity)}),fill:(d,n)=>({u_matrix:new f.UniformMatrix4f(d,n.u_matrix)}),fillPattern:(d,n)=>({u_matrix:new f.UniformMatrix4f(d,n.u_matrix),u_image:new f.Uniform1i(d,n.u_image),u_texsize:new f.Uniform2f(d,n.u_texsize),u_pixel_coord_upper:new f.Uniform2f(d,n.u_pixel_coord_upper),u_pixel_coord_lower:new f.Uniform2f(d,n.u_pixel_coord_lower),u_scale:new f.Uniform3f(d,n.u_scale),u_fade:new f.Uniform1f(d,n.u_fade)}),fillOutline:(d,n)=>({u_matrix:new f.UniformMatrix4f(d,n.u_matrix),u_world:new f.Uniform2f(d,n.u_world)}),fillOutlinePattern:(d,n)=>({u_matrix:new f.UniformMatrix4f(d,n.u_matrix),u_world:new f.Uniform2f(d,n.u_world),u_image:new f.Uniform1i(d,n.u_image),u_texsize:new f.Uniform2f(d,n.u_texsize),u_pixel_coord_upper:new f.Uniform2f(d,n.u_pixel_coord_upper),u_pixel_coord_lower:new f.Uniform2f(d,n.u_pixel_coord_lower),u_scale:new f.Uniform3f(d,n.u_scale),u_fade:new f.Uniform1f(d,n.u_fade)}),circle:(d,n)=>({u_camera_to_center_distance:new f.Uniform1f(d,n.u_camera_to_center_distance),u_extrude_scale:new f.UniformMatrix2f(d,n.u_extrude_scale),u_device_pixel_ratio:new f.Uniform1f(d,n.u_device_pixel_ratio),u_matrix:new f.UniformMatrix4f(d,n.u_matrix),u_inv_rot_matrix:new f.UniformMatrix4f(d,n.u_inv_rot_matrix),u_merc_center:new f.Uniform2f(d,n.u_merc_center),u_tile_id:new f.Uniform3f(d,n.u_tile_id),u_zoom_transition:new f.Uniform1f(d,n.u_zoom_transition),u_up_dir:new f.Uniform3f(d,n.u_up_dir)}),collisionBox:(d,n)=>({u_matrix:new f.UniformMatrix4f(d,n.u_matrix),u_camera_to_center_distance:new f.Uniform1f(d,n.u_camera_to_center_distance),u_extrude_scale:new f.Uniform2f(d,n.u_extrude_scale)}),collisionCircle:(d,n)=>({u_matrix:new f.UniformMatrix4f(d,n.u_matrix),u_inv_matrix:new f.UniformMatrix4f(d,n.u_inv_matrix),u_camera_to_center_distance:new f.Uniform1f(d,n.u_camera_to_center_distance),u_viewport_size:new f.Uniform2f(d,n.u_viewport_size)}),debug:(d,n)=>({u_color:new f.UniformColor(d,n.u_color),u_matrix:new f.UniformMatrix4f(d,n.u_matrix),u_overlay:new f.Uniform1i(d,n.u_overlay),u_overlay_scale:new f.Uniform1f(d,n.u_overlay_scale)}),clippingMask:(d,n)=>({u_matrix:new f.UniformMatrix4f(d,n.u_matrix)}),heatmap:(d,n)=>({u_extrude_scale:new f.Uniform1f(d,n.u_extrude_scale),u_intensity:new f.Uniform1f(d,n.u_intensity),u_matrix:new f.UniformMatrix4f(d,n.u_matrix),u_inv_rot_matrix:new f.UniformMatrix4f(d,n.u_inv_rot_matrix),u_merc_center:new f.Uniform2f(d,n.u_merc_center),u_tile_id:new f.Uniform3f(d,n.u_tile_id),u_zoom_transition:new f.Uniform1f(d,n.u_zoom_transition),u_up_dir:new f.Uniform3f(d,n.u_up_dir)}),heatmapTexture:(d,n)=>({u_image:new f.Uniform1i(d,n.u_image),u_color_ramp:new f.Uniform1i(d,n.u_color_ramp),u_opacity:new f.Uniform1f(d,n.u_opacity)}),hillshade:(d,n)=>({u_matrix:new f.UniformMatrix4f(d,n.u_matrix),u_image:new f.Uniform1i(d,n.u_image),u_latrange:new f.Uniform2f(d,n.u_latrange),u_light:new f.Uniform2f(d,n.u_light),u_shadow:new f.UniformColor(d,n.u_shadow),u_highlight:new f.UniformColor(d,n.u_highlight),u_accent:new f.UniformColor(d,n.u_accent)}),hillshadePrepare:(d,n)=>({u_matrix:new f.UniformMatrix4f(d,n.u_matrix),u_image:new f.Uniform1i(d,n.u_image),u_dimension:new f.Uniform2f(d,n.u_dimension),u_zoom:new f.Uniform1f(d,n.u_zoom),u_unpack:new f.Uniform4f(d,n.u_unpack)}),line:(d,n)=>({u_matrix:new f.UniformMatrix4f(d,n.u_matrix),u_pixels_to_tile_units:new f.UniformMatrix2f(d,n.u_pixels_to_tile_units),u_device_pixel_ratio:new f.Uniform1f(d,n.u_device_pixel_ratio),u_units_to_pixels:new f.Uniform2f(d,n.u_units_to_pixels),u_dash_image:new f.Uniform1i(d,n.u_dash_image),u_gradient_image:new f.Uniform1i(d,n.u_gradient_image),u_image_height:new f.Uniform1f(d,n.u_image_height),u_texsize:new f.Uniform2f(d,n.u_texsize),u_scale:new f.Uniform3f(d,n.u_scale),u_mix:new f.Uniform1f(d,n.u_mix),u_alpha_discard_threshold:new f.Uniform1f(d,n.u_alpha_discard_threshold)}),linePattern:(d,n)=>({u_matrix:new f.UniformMatrix4f(d,n.u_matrix),u_texsize:new f.Uniform2f(d,n.u_texsize),u_pixels_to_tile_units:new f.UniformMatrix2f(d,n.u_pixels_to_tile_units),u_device_pixel_ratio:new f.Uniform1f(d,n.u_device_pixel_ratio),u_image:new f.Uniform1i(d,n.u_image),u_units_to_pixels:new f.Uniform2f(d,n.u_units_to_pixels),u_scale:new f.Uniform3f(d,n.u_scale),u_fade:new f.Uniform1f(d,n.u_fade),u_alpha_discard_threshold:new f.Uniform1f(d,n.u_alpha_discard_threshold)}),raster:(d,n)=>({u_matrix:new f.UniformMatrix4f(d,n.u_matrix),u_tl_parent:new f.Uniform2f(d,n.u_tl_parent),u_scale_parent:new f.Uniform1f(d,n.u_scale_parent),u_fade_t:new f.Uniform1f(d,n.u_fade_t),u_opacity:new f.Uniform1f(d,n.u_opacity),u_image0:new f.Uniform1i(d,n.u_image0),u_image1:new f.Uniform1i(d,n.u_image1),u_brightness_low:new f.Uniform1f(d,n.u_brightness_low),u_brightness_high:new f.Uniform1f(d,n.u_brightness_high),u_saturation_factor:new f.Uniform1f(d,n.u_saturation_factor),u_contrast_factor:new f.Uniform1f(d,n.u_contrast_factor),u_spin_weights:new f.Uniform3f(d,n.u_spin_weights),u_perspective_transform:new f.Uniform2f(d,n.u_perspective_transform)}),symbolIcon:(d,n)=>({u_is_size_zoom_constant:new f.Uniform1i(d,n.u_is_size_zoom_constant),u_is_size_feature_constant:new f.Uniform1i(d,n.u_is_size_feature_constant),u_size_t:new f.Uniform1f(d,n.u_size_t),u_size:new f.Uniform1f(d,n.u_size),u_camera_to_center_distance:new f.Uniform1f(d,n.u_camera_to_center_distance),u_rotate_symbol:new f.Uniform1i(d,n.u_rotate_symbol),u_aspect_ratio:new f.Uniform1f(d,n.u_aspect_ratio),u_fade_change:new f.Uniform1f(d,n.u_fade_change),u_matrix:new f.UniformMatrix4f(d,n.u_matrix),u_label_plane_matrix:new f.UniformMatrix4f(d,n.u_label_plane_matrix),u_coord_matrix:new f.UniformMatrix4f(d,n.u_coord_matrix),u_is_text:new f.Uniform1i(d,n.u_is_text),u_pitch_with_map:new f.Uniform1i(d,n.u_pitch_with_map),u_texsize:new f.Uniform2f(d,n.u_texsize),u_tile_id:new f.Uniform3f(d,n.u_tile_id),u_zoom_transition:new f.Uniform1f(d,n.u_zoom_transition),u_inv_rot_matrix:new f.UniformMatrix4f(d,n.u_inv_rot_matrix),u_merc_center:new f.Uniform2f(d,n.u_merc_center),u_camera_forward:new f.Uniform3f(d,n.u_camera_forward),u_tile_matrix:new f.UniformMatrix4f(d,n.u_tile_matrix),u_ecef_origin:new f.Uniform3f(d,n.u_ecef_origin),u_texture:new f.Uniform1i(d,n.u_texture)}),symbolSDF:(d,n)=>({u_is_size_zoom_constant:new f.Uniform1i(d,n.u_is_size_zoom_constant),u_is_size_feature_constant:new f.Uniform1i(d,n.u_is_size_feature_constant),u_size_t:new f.Uniform1f(d,n.u_size_t),u_size:new f.Uniform1f(d,n.u_size),u_camera_to_center_distance:new f.Uniform1f(d,n.u_camera_to_center_distance),u_rotate_symbol:new f.Uniform1i(d,n.u_rotate_symbol),u_aspect_ratio:new f.Uniform1f(d,n.u_aspect_ratio),u_fade_change:new f.Uniform1f(d,n.u_fade_change),u_matrix:new f.UniformMatrix4f(d,n.u_matrix),u_label_plane_matrix:new f.UniformMatrix4f(d,n.u_label_plane_matrix),u_coord_matrix:new f.UniformMatrix4f(d,n.u_coord_matrix),u_is_text:new f.Uniform1i(d,n.u_is_text),u_pitch_with_map:new f.Uniform1i(d,n.u_pitch_with_map),u_texsize:new f.Uniform2f(d,n.u_texsize),u_texture:new f.Uniform1i(d,n.u_texture),u_gamma_scale:new f.Uniform1f(d,n.u_gamma_scale),u_device_pixel_ratio:new f.Uniform1f(d,n.u_device_pixel_ratio),u_tile_id:new f.Uniform3f(d,n.u_tile_id),u_zoom_transition:new f.Uniform1f(d,n.u_zoom_transition),u_inv_rot_matrix:new f.UniformMatrix4f(d,n.u_inv_rot_matrix),u_merc_center:new f.Uniform2f(d,n.u_merc_center),u_camera_forward:new f.Uniform3f(d,n.u_camera_forward),u_tile_matrix:new f.UniformMatrix4f(d,n.u_tile_matrix),u_ecef_origin:new f.Uniform3f(d,n.u_ecef_origin),u_is_halo:new f.Uniform1i(d,n.u_is_halo)}),symbolTextAndIcon:(d,n)=>({u_is_size_zoom_constant:new f.Uniform1i(d,n.u_is_size_zoom_constant),u_is_size_feature_constant:new f.Uniform1i(d,n.u_is_size_feature_constant),u_size_t:new f.Uniform1f(d,n.u_size_t),u_size:new f.Uniform1f(d,n.u_size),u_camera_to_center_distance:new f.Uniform1f(d,n.u_camera_to_center_distance),u_rotate_symbol:new f.Uniform1i(d,n.u_rotate_symbol),u_aspect_ratio:new f.Uniform1f(d,n.u_aspect_ratio),u_fade_change:new f.Uniform1f(d,n.u_fade_change),u_matrix:new f.UniformMatrix4f(d,n.u_matrix),u_label_plane_matrix:new f.UniformMatrix4f(d,n.u_label_plane_matrix),u_coord_matrix:new f.UniformMatrix4f(d,n.u_coord_matrix),u_is_text:new f.Uniform1i(d,n.u_is_text),u_pitch_with_map:new f.Uniform1i(d,n.u_pitch_with_map),u_texsize:new f.Uniform2f(d,n.u_texsize),u_texsize_icon:new f.Uniform2f(d,n.u_texsize_icon),u_texture:new f.Uniform1i(d,n.u_texture),u_texture_icon:new f.Uniform1i(d,n.u_texture_icon),u_gamma_scale:new f.Uniform1f(d,n.u_gamma_scale),u_device_pixel_ratio:new f.Uniform1f(d,n.u_device_pixel_ratio),u_is_halo:new f.Uniform1i(d,n.u_is_halo)}),background:(d,n)=>({u_matrix:new f.UniformMatrix4f(d,n.u_matrix),u_opacity:new f.Uniform1f(d,n.u_opacity),u_color:new f.UniformColor(d,n.u_color)}),backgroundPattern:(d,n)=>({u_matrix:new f.UniformMatrix4f(d,n.u_matrix),u_opacity:new f.Uniform1f(d,n.u_opacity),u_image:new f.Uniform1i(d,n.u_image),u_pattern_tl_a:new f.Uniform2f(d,n.u_pattern_tl_a),u_pattern_br_a:new f.Uniform2f(d,n.u_pattern_br_a),u_pattern_tl_b:new f.Uniform2f(d,n.u_pattern_tl_b),u_pattern_br_b:new f.Uniform2f(d,n.u_pattern_br_b),u_texsize:new f.Uniform2f(d,n.u_texsize),u_mix:new f.Uniform1f(d,n.u_mix),u_pattern_size_a:new f.Uniform2f(d,n.u_pattern_size_a),u_pattern_size_b:new f.Uniform2f(d,n.u_pattern_size_b),u_scale_a:new f.Uniform1f(d,n.u_scale_a),u_scale_b:new f.Uniform1f(d,n.u_scale_b),u_pixel_coord_upper:new f.Uniform2f(d,n.u_pixel_coord_upper),u_pixel_coord_lower:new f.Uniform2f(d,n.u_pixel_coord_lower),u_tile_units_to_pixels:new f.Uniform1f(d,n.u_tile_units_to_pixels)}),terrainRaster:Fo,terrainDepth:Fo,skybox:(d,n)=>({u_matrix:new f.UniformMatrix4f(d,n.u_matrix),u_sun_direction:new f.Uniform3f(d,n.u_sun_direction),u_cubemap:new f.Uniform1i(d,n.u_cubemap),u_opacity:new f.Uniform1f(d,n.u_opacity),u_temporal_offset:new f.Uniform1f(d,n.u_temporal_offset)}),skyboxGradient:(d,n)=>({u_matrix:new f.UniformMatrix4f(d,n.u_matrix),u_color_ramp:new f.Uniform1i(d,n.u_color_ramp),u_center_direction:new f.Uniform3f(d,n.u_center_direction),u_radius:new f.Uniform1f(d,n.u_radius),u_opacity:new f.Uniform1f(d,n.u_opacity),u_temporal_offset:new f.Uniform1f(d,n.u_temporal_offset)}),skyboxCapture:(d,n)=>({u_matrix_3f:new f.UniformMatrix3f(d,n.u_matrix_3f),u_sun_direction:new f.Uniform3f(d,n.u_sun_direction),u_sun_intensity:new f.Uniform1f(d,n.u_sun_intensity),u_color_tint_r:new f.Uniform4f(d,n.u_color_tint_r),u_color_tint_m:new f.Uniform4f(d,n.u_color_tint_m),u_luminance:new f.Uniform1f(d,n.u_luminance)}),globeRaster:(d,n)=>({u_proj_matrix:new f.UniformMatrix4f(d,n.u_proj_matrix),u_globe_matrix:new f.UniformMatrix4f(d,n.u_globe_matrix),u_merc_matrix:new f.UniformMatrix4f(d,n.u_merc_matrix),u_zoom_transition:new f.Uniform1f(d,n.u_zoom_transition),u_merc_center:new f.Uniform2f(d,n.u_merc_center),u_image0:new f.Uniform1i(d,n.u_image0),u_grid_matrix:new f.UniformMatrix3f(d,n.u_grid_matrix)}),globeAtmosphere:(d,n)=>({u_frustum_tl:new f.Uniform3f(d,n.u_frustum_tl),u_frustum_tr:new f.Uniform3f(d,n.u_frustum_tr),u_frustum_br:new f.Uniform3f(d,n.u_frustum_br),u_frustum_bl:new f.Uniform3f(d,n.u_frustum_bl),u_globe_pos:new f.Uniform3f(d,n.u_globe_pos),u_globe_radius:new f.Uniform1f(d,n.u_globe_radius),u_opacity:new f.Uniform1f(d,n.u_opacity),u_fadeout_range:new f.Uniform1f(d,n.u_fadeout_range),u_start_color:new f.Uniform3f(d,n.u_start_color),u_end_color:new f.Uniform3f(d,n.u_end_color)})};let wl;function uf(d,n,u,m,w,b,S){const A=d.context,P=A.gl,O=d.useProgram("collisionBox"),L=[];let V=0,Y=0;for(let de=0;de<m.length;de++){const ce=m[de],le=n.getTile(ce),we=le.getBucket(u);if(!we)continue;let ze=ce.projMatrix;0===w[0]&&0===w[1]||(ze=d.translatePosMatrix(ce.projMatrix,le,w,b));const Be=S?we.textCollisionBox:we.iconCollisionBox,Le=we.collisionCircleArray;if(Le.length>0){const qe=f.create(),Qe=ze;f.mul(qe,we.placementInvProjMatrix,d.transform.glCoordMatrix),f.mul(qe,qe,we.placementViewportMatrix),L.push({circleArray:Le,circleOffset:Y,transform:Qe,invTransform:qe}),V+=Le.length/4,Y=V}Be&&(d.terrain&&d.terrain.setupElevationDraw(le,O),O.draw(A,P.LINES,f.DepthMode.disabled,f.StencilMode.disabled,d.colorModeForRenderPass(),f.CullFaceMode.disabled,sf(ze,d.transform,le),u.id,Be.layoutVertexBuffer,Be.indexBuffer,Be.segments,null,d.transform.zoom,null,Be.collisionVertexBuffer,Be.collisionVertexBufferExt))}if(!S||!L.length)return;const te=d.useProgram("collisionCircle"),J=new f.StructArrayLayout2f1f2i16;J.resize(4*V),J._trim();let H=0;for(const de of L)for(let ce=0;ce<de.circleArray.length/4;ce++){const le=4*ce,we=de.circleArray[le+0],ze=de.circleArray[le+1],Be=de.circleArray[le+2],Le=de.circleArray[le+3];J.emplace(H++,we,ze,Be,Le,0),J.emplace(H++,we,ze,Be,Le,1),J.emplace(H++,we,ze,Be,Le,2),J.emplace(H++,we,ze,Be,Le,3)}(!wl||wl.length<2*V)&&(wl=function(de){const ce=2*de,le=new f.StructArrayLayout3ui6;le.resize(ce),le._trim();for(let we=0;we<ce;we++){const ze=6*we;le.uint16[ze+0]=4*we+0,le.uint16[ze+1]=4*we+1,le.uint16[ze+2]=4*we+2,le.uint16[ze+3]=4*we+2,le.uint16[ze+4]=4*we+3,le.uint16[ze+5]=4*we+0}return le}(V));const se=A.createIndexBuffer(wl,!0),ie=A.createVertexBuffer(J,f.collisionCircleLayout.members,!0);for(const de of L){const ce={u_matrix:de.transform,u_inv_matrix:de.invTransform,u_camera_to_center_distance:(he=d.transform).cameraToCenterDistance,u_viewport_size:[he.width,he.height]};te.draw(A,P.TRIANGLES,f.DepthMode.disabled,f.StencilMode.disabled,d.colorModeForRenderPass(),f.CullFaceMode.disabled,ce,u.id,ie,se,f.SegmentVector.simpleSegment(0,2*de.circleOffset,de.circleArray.length,de.circleArray.length/2),null,d.transform.zoom,null,null,null)}var he;ie.destroy(),se.destroy()}const zo=f.create();function gc(d,n,u,m,w,b){const{horizontalAlign:S,verticalAlign:A}=f.getAnchorAlignment(d),P=-(S-.5)*n,O=-(A-.5)*u,L=f.evaluateVariableOffset(d,m);return new f.pointGeometry((P/w+L[0])*b,(O/w+L[1])*b)}function Fi(d,n,u,m,w,b,S,A,P,O,L,V){const Y=d.text.placedSymbolArray,te=d.text.dynamicLayoutVertexArray,J=d.icon.dynamicLayoutVertexArray,H={},se=A.projMatrix,ie=b.elevation,he=V.upVectorScale(A.canonical,b.center.lat,b.worldSize);te.clear();for(let de=0;de<Y.length;de++){const ce=Y.get(de),le=d.allowVerticalPlacement&&!ce.placedOrientation,we=ce.hidden||!ce.crossTileID||le?null:m[ce.crossTileID];if(we){const ze=new f.pointGeometry(ce.tileAnchorX,ce.tileAnchorY),Be=V.upVector(A.canonical,ze.x,ze.y),Le=ie?ie.getAtTileOffset(A,ze.x,ze.y):0,qe=yn([ce.projectedAnchorX+Le*Be[0]*he.metersToTile,ce.projectedAnchorY+Le*Be[1]*he.metersToTile,ce.projectedAnchorZ+Le*Be[2]*he.metersToTile],u?se:S),Qe=Lr(b.cameraToCenterDistance,qe.signedDistanceFromCamera);let ke=w.evaluateSizeForFeature(d.textSizeData,O,ce)*Qe/f.ONE_EM;u&&(ke*=d.tilePixelRatio/P);const{width:gt,height:dt,anchor:It,textOffset:et,textScale:Mt}=we,Jt=gc(It,gt,dt,et,Mt,ke),Et=u?Cn(ze.add(Jt),S,Le*he.metersToLabelSpace).point:qe.point.add(n?Jt.rotate(-b.angle):Jt),bt=d.allowVerticalPlacement&&ce.placedOrientation===f.WritingMode.vertical?Math.PI/2:0;for(let Ot=0;Ot<ce.numGlyphs;Ot++)f.addDynamicAttributes(te,Et,bt);L&&ce.associatedIconIndex>=0&&(H[ce.associatedIconIndex]={shiftedAnchor:Et,angle:bt})}else Oi(ce.numGlyphs,te)}if(L){J.clear();const de=d.icon.placedSymbolArray;for(let ce=0;ce<de.length;ce++){const le=de.get(ce);if(le.hidden)Oi(le.numGlyphs,J);else{const we=H[ce];if(we)for(let ze=0;ze<le.numGlyphs;ze++)f.addDynamicAttributes(J,we.shiftedAnchor,we.angle);else Oi(le.numGlyphs,J)}}d.icon.dynamicLayoutVertexBuffer.updateData(J)}d.text.dynamicLayoutVertexBuffer.updateData(te)}function hf(d,n,u){return u.iconsInText&&n?"symbolTextAndIcon":d?"symbolSDF":"symbolIcon"}function bl(d,n,u,m,w,b,S,A,P,O,L,V){const Y=d.context,te=Y.gl,J=d.transform,H="map"===A,se="map"===P,ie=H&&"point"!==u.layout.get("symbol-placement"),he=H&&!se&&!ie,de=void 0!==u.layout.get("symbol-sort-key").constantOr(1);let ce=!1;const le=d.depthModeForSublayer(0,f.DepthMode.ReadOnly),we=[f.mercatorXfromLng(J.center.lng),f.mercatorYfromLat(J.center.lat)],ze=u.layout.get("text-variable-anchor"),Be="globe"===J.projection.name,Le=Be?f.globeToMercatorTransition(J.zoom):0,qe=[],Qe=[];d.terrain&&se&&Qe.push("PITCH_WITH_MAP_TERRAIN"),Be&&Qe.push("PROJECTION_GLOBE_VIEW");for(const ke of m){const gt=n.getTile(ke),dt=gt.getBucket(u);if(!dt||dt.projection!==J.projection.name)continue;const It=w?dt.text:dt.icon;if(!It||dt.fullyClipped||!It.segments.get().length)continue;const et=It.programConfigurations.get(u.id),Mt=w||dt.sdfIcons,Jt=w?dt.textSizeData:dt.iconSizeData,Et=se||0!==J.pitch,bt=f.evaluateSizeForZoom(Jt,J.zoom);let Ot,fr,Ht,rr,Dr=[0,0],vi=null;if(w){if(fr=gt.glyphAtlasTexture,Ht=te.LINEAR,Ot=gt.glyphAtlasTexture.size,dt.iconsInText){Dr=gt.imageAtlasTexture.size,vi=gt.imageAtlasTexture;const ha="composite"===Jt.kind||"camera"===Jt.kind;rr=Et||d.options.rotating||d.options.zooming||ha?te.LINEAR:te.NEAREST}}else{const ha=1!==u.layout.get("icon-size").constantOr(0)||dt.iconsNeedLinear;fr=gt.imageAtlasTexture,Ht=Mt||d.options.rotating||d.options.zooming||ha||Et?te.LINEAR:te.NEAREST,Ot=gt.imageAtlasTexture.size}const Tn=d.transform.calculatePixelsToTileUnitsMatrix(gt),ui=Ao(ke.projMatrix,gt.tileID.canonical,se,H,d.transform,Tn),Ki=d.terrain&&se&&ie?f.invert(f.create(),ui):zo,pn=fl(ke.projMatrix,gt.tileID.canonical,se,H,d.transform,Tn),Rn=ze&&dt.hasTextData(),Ks="none"!==u.layout.get("icon-text-fit")&&Rn&&dt.hasIconData();if(ie){const ha=J.elevation,fa=ha?ha.getAtTileOffsetFunc(ke,J.center.lat,J.worldSize,J.projection):$o=>[0,0,0];lc(dt,ke.projMatrix,d,w,ui,pn,se,O,fa,ke)}const Qa=ie||w&&ze||Ks,pi=d.translatePosMatrix(ke.projMatrix,gt,b,S),mi=Qa?zo:ui,Zr=d.translatePosMatrix(pn,gt,b,S,!0),Ci=J.projection.createInversionMatrix(J,ke.canonical),On=Qa?Qe.concat(["PROJECTED_POS_ON_VIEWPORT"]):Qe,hi=Mt&&0!==u.paint.get(w?"text-halo-width":"icon-halo-width").constantOr(1);let ua;ua=Mt?dt.iconsInText?vl(Jt.kind,bt,he,se,d,pi,mi,Zr,Ot,Dr,ke,Le,we,Ci):Oo(Jt.kind,bt,he,se,d,pi,mi,Zr,w,Ot,!0,ke,Le,we,Ci):_u(Jt.kind,bt,he,se,d,pi,mi,Zr,w,Ot,ke,Le,we,Ci);const Ll={program:d.useProgram(hf(Mt,w,dt),et,On),buffers:It,uniformValues:ua,atlasTexture:fr,atlasTextureIcon:vi,atlasInterpolation:Ht,atlasInterpolationIcon:rr,isSDF:Mt,hasHalo:hi,tile:gt,labelPlaneMatrixInv:Ki};if(de&&dt.canOverlap){ce=!0;const ha=It.segments.get();for(const fa of ha)qe.push({segments:new f.SegmentVector([fa]),sortKey:fa.sortKey,state:Ll})}else qe.push({segments:It.segments,sortKey:0,state:Ll})}ce&&qe.sort((ke,gt)=>ke.sortKey-gt.sortKey);for(const ke of qe){const gt=ke.state;if(d.terrain&&d.terrain.setupElevationDraw(gt.tile,gt.program,{useDepthForOcclusion:!Be,labelPlaneMatrixInv:gt.labelPlaneMatrixInv}),Y.activeTexture.set(te.TEXTURE0),gt.atlasTexture.bind(gt.atlasInterpolation,te.CLAMP_TO_EDGE),gt.atlasTextureIcon&&(Y.activeTexture.set(te.TEXTURE1),gt.atlasTextureIcon&&gt.atlasTextureIcon.bind(gt.atlasInterpolationIcon,te.CLAMP_TO_EDGE)),gt.isSDF){const dt=gt.uniformValues;gt.hasHalo&&(dt.u_is_halo=1,xc(gt.buffers,ke.segments,u,d,gt.program,le,L,V,dt)),dt.u_is_halo=0}xc(gt.buffers,ke.segments,u,d,gt.program,le,L,V,gt.uniformValues)}}function xc(d,n,u,m,w,b,S,A,P){const O=m.context;w.draw(O,O.gl.TRIANGLES,b,S,A,f.CullFaceMode.disabled,P,u.id,d.layoutVertexBuffer,d.indexBuffer,n,u.paint,m.transform.zoom,d.programConfigurations.get(u.id),d.dynamicLayoutVertexBuffer,d.opacityVertexBuffer)}function gu(d,n,u,m,w,b,S){const A=d.context.gl,P=u.paint.get("fill-pattern"),O=P&&P.constantOr(1),L=u.getCrossfadeParameters();let V,Y,te,J,H;S?(Y=O&&!u.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",V=A.LINES):(Y=O?"fillPattern":"fill",V=A.TRIANGLES);for(const se of m){const ie=n.getTile(se);if(O&&!ie.patternsLoaded())continue;const he=ie.getBucket(u);if(!he)continue;d.prepareDrawTile();const de=he.programConfigurations.get(u.id),ce=d.useProgram(Y,de);O&&(d.context.activeTexture.set(A.TEXTURE0),ie.imageAtlasTexture.bind(A.LINEAR,A.CLAMP_TO_EDGE),de.updatePaintBuffers(L));const le=P.constantOr(null);if(le&&ie.imageAtlas){const ze=ie.imageAtlas,Be=ze.patternPositions[le.to.toString()],Le=ze.patternPositions[le.from.toString()];Be&&Le&&de.setConstantPatternPositions(Be,Le)}const we=d.translatePosMatrix(se.projMatrix,ie,u.paint.get("fill-translate"),u.paint.get("fill-translate-anchor"));if(S){J=he.indexBuffer2,H=he.segments2;const ze=d.terrain&&d.terrain.renderingToTexture?d.terrain.drapeBufferSize:[A.drawingBufferWidth,A.drawingBufferHeight];te="fillOutlinePattern"===Y&&O?th(we,d,L,ie,ze):mu(we,ze)}else J=he.indexBuffer,H=he.segments,te=O?pu(we,d,L,ie):Dn(we);d.prepareDrawProgram(d.context,ce,se.toUnwrapped()),ce.draw(d.context,V,w,d.stencilModeForClipping(se),b,f.CullFaceMode.disabled,te,u.id,he.layoutVertexBuffer,J,H,u.paint,d.transform.zoom,de)}}function us(d,n,u,m,w,b,S){const A=d.context,P=A.gl,O=d.transform,L=u.paint.get("fill-extrusion-pattern"),V=L.constantOr(1),Y=u.getCrossfadeParameters(),te=u.paint.get("fill-extrusion-opacity"),J=function(de){if("globe"!==de.projection.name)return 0;const ce=Math.PI/32,le=Math.tan(ce),we=f.earthRadius;return we*Math.sqrt(1+2*le*le)-we}(O),H="globe"===O.projection.name,se=H?f.globeToMercatorTransition(O.zoom):0,ie=[f.mercatorXfromLng(O.center.lng),f.mercatorYfromLat(O.center.lat)],he=[];H&&he.push("PROJECTION_GLOBE_VIEW");for(const de of m){const ce=n.getTile(de),le=ce.getBucket(u);if(!le||le.projection!==O.projection.name)continue;const we=le.programConfigurations.get(u.id),ze=d.useProgram(V?"fillExtrusionPattern":"fillExtrusion",we,he);if(d.terrain){const gt=d.terrain;if(d.style.terrainSetForDrapingOnly())gt.setupElevationDraw(ce,ze,{useMeterToDem:!0});else{if(!le.enableTerrain)continue;if(gt.setupElevationDraw(ce,ze,{useMeterToDem:!0}),Di(A,n,de,le,u,gt),!le.centroidVertexBuffer){const dt=ze.attributes.a_centroid_pos;void 0!==dt&&P.vertexAttrib2f(dt,0,0)}}}V&&(d.context.activeTexture.set(P.TEXTURE0),ce.imageAtlasTexture.bind(P.LINEAR,P.CLAMP_TO_EDGE),we.updatePaintBuffers(Y));const Be=L.constantOr(null);if(Be&&ce.imageAtlas){const gt=ce.imageAtlas,dt=gt.patternPositions[Be.to.toString()],It=gt.patternPositions[Be.from.toString()];dt&&It&&we.setConstantPatternPositions(dt,It)}const Le=d.translatePosMatrix(de.projMatrix,ce,u.paint.get("fill-extrusion-translate"),u.paint.get("fill-extrusion-translate-anchor")),qe=O.projection.createInversionMatrix(O,de.canonical),Qe=u.paint.get("fill-extrusion-vertical-gradient"),ke=V?du(Le,d,Qe,te,de,Y,ce,J,se,ie,qe):fu(Le,d,Qe,te,de,J,se,ie,qe);d.prepareDrawProgram(A,ze,de.toUnwrapped()),ze.draw(A,A.gl.TRIANGLES,w,b,S,f.CullFaceMode.backCCW,ke,u.id,le.layoutVertexBuffer,le.indexBuffer,le.segments,u.paint,d.transform.zoom,we,d.terrain?le.centroidVertexBuffer:null,H?le.layoutVertexExtBuffer:null)}}function Di(d,n,u,m,w,b){const S=[ie=>{let he=ie.canonical.x-1,de=ie.wrap;return he<0&&(he=(1<<ie.canonical.z)-1,de--),new f.OverscaledTileID(ie.overscaledZ,de,ie.canonical.z,he,ie.canonical.y)},ie=>{let he=ie.canonical.x+1,de=ie.wrap;return he===1<<ie.canonical.z&&(he=0,de++),new f.OverscaledTileID(ie.overscaledZ,de,ie.canonical.z,he,ie.canonical.y)},ie=>new f.OverscaledTileID(ie.overscaledZ,ie.wrap,ie.canonical.z,ie.canonical.x,(0===ie.canonical.y?1<<ie.canonical.z:ie.canonical.y)-1),ie=>new f.OverscaledTileID(ie.overscaledZ,ie.wrap,ie.canonical.z,ie.canonical.x,ie.canonical.y===(1<<ie.canonical.z)-1?0:ie.canonical.y+1)],A=ie=>{const he=n.getSource().minzoom,de=le=>{const we=n.getTileByID(le);if(we&&we.hasData())return we.getBucket(w)},ce=[0,-1,1];for(const le of ce){if(ie.overscaledZ+le<he)continue;const we=de(ie.calculateScaledKey(ie.overscaledZ+le));if(we)return we}},P=[0,0,0],O=(ie,he)=>(P[0]=Math.min(ie.min.y,he.min.y),P[1]=Math.max(ie.max.y,he.max.y),P[2]=f.EXTENT-he.min.x>ie.max.x?he.min.x-f.EXTENT:ie.max.x,P),L=(ie,he)=>(P[0]=Math.min(ie.min.x,he.min.x),P[1]=Math.max(ie.max.x,he.max.x),P[2]=f.EXTENT-he.min.y>ie.max.y?he.min.y-f.EXTENT:ie.max.y,P),V=[(ie,he)=>O(ie,he),(ie,he)=>O(he,ie),(ie,he)=>L(ie,he),(ie,he)=>L(he,ie)],Y=new f.pointGeometry(0,0);let te,J,H;const se=(ie,he,de,ce,le)=>{const we=[[ce?de:ie,ce?ie:de,0],[ce?de:he,ce?he:de,0]],ze=le<0?f.EXTENT+le:le,Be=[ce?ze:(ie+he)/2,ce?(ie+he)/2:ze,0];return 0===de&&le<0||0!==de&&le>0?b.getForTilePoints(H,[Be],!0,J):we.push(Be),b.getForTilePoints(u,we,!0,te),Math.max(we[0][2],we[1][2],Be[2])/b.exaggeration()};for(let ie=0;ie<4;ie++){const he=(ie<2?1:5)-ie,de=m.borders[ie];if(0===de.length)continue;const ce=H=S[ie](u),le=A(ce);if(!(le&&le instanceof f.FillExtrusionBucket&&le.enableTerrain)||m.borderDoneWithNeighborZ[ie]===le.canonical.z&&le.borderDoneWithNeighborZ[he]===m.canonical.z||(J=b.findDEMTileFor(ce),!J||!J.dem))continue;if(!te){const Le=b.findDEMTileFor(u);if(!Le||!Le.dem)return;te=Le}const we=le.borders[he];let ze=0;const Be=le.borderDoneWithNeighborZ[he]!==m.canonical.z;if(m.canonical.z===le.canonical.z){for(let Le=0;Le<de.length;Le++){const qe=m.featuresOnBorder[de[Le]],Qe=qe.borders[ie];let ke;for(;ze<we.length&&(ke=le.featuresOnBorder[we[ze]],!(ke.borders[he][1]>Qe[0]+3));)Be&&le.encodeCentroid(void 0,ke,!1),ze++;if(ke&&ze<we.length){const gt=ze;let dt=0;for(;!(ke.borders[he][0]>Qe[1]-3)&&(dt++,++ze!==we.length);)ke=le.featuresOnBorder[we[ze]];if(ke=le.featuresOnBorder[we[gt]],qe.intersectsCount()>1||ke.intersectsCount()>1||1!==dt){1!==dt&&(ze=gt),m.encodeCentroid(void 0,qe,!1),Be&&le.encodeCentroid(void 0,ke,!1);continue}const It=V[ie](qe,ke),et=ie%2?f.EXTENT-1:0;Y.x=se(It[0],Math.min(f.EXTENT-1,It[1]),et,ie<2,It[2]),Y.y=0,m.encodeCentroid(Y,qe,!1),Be&&le.encodeCentroid(Y,ke,!1)}else m.encodeCentroid(void 0,qe,!1)}m.borderDoneWithNeighborZ[ie]=le.canonical.z,m.needsCentroidUpdate=!0,Be&&(le.borderDoneWithNeighborZ[he]=m.canonical.z,le.needsCentroidUpdate=!0)}else{for(const Le of de)m.encodeCentroid(void 0,m.featuresOnBorder[Le],!1);if(Be){for(const Le of we)le.encodeCentroid(void 0,le.featuresOnBorder[Le],!1);le.borderDoneWithNeighborZ[he]=m.canonical.z,le.needsCentroidUpdate=!0}m.borderDoneWithNeighborZ[ie]=le.canonical.z,m.needsCentroidUpdate=!0}}(m.needsCentroidUpdate||!m.centroidVertexBuffer&&0!==m.centroidVertexArray.length)&&m.uploadCentroid(d)}const xu=new f.Color(1,0,0,1),nh=new f.Color(0,1,0,1),ah=new f.Color(0,0,1,1),Tl=new f.Color(1,0,1,1),yu=new f.Color(0,1,1,1);function Ct(d,n,u,m){yc(d,0,n+u/2,d.transform.width,u,m)}function oa(d,n,u,m){yc(d,n-u/2,0,u,d.transform.height,m)}function yc(d,n,u,m,w,b){const S=d.context,A=S.gl;A.enable(A.SCISSOR_TEST),A.scissor(n*f.exported.devicePixelRatio,u*f.exported.devicePixelRatio,m*f.exported.devicePixelRatio,w*f.exported.devicePixelRatio),S.clear({color:b}),A.disable(A.SCISSOR_TEST)}function Ei(d,n,u){const m=d.context,w=m.gl,b="globe"===d.transform.projection.name,S=u.projMatrix,A=d.useProgram("debug",null,b?["PROJECTION_GLOBE_VIEW"]:null),P=n.getTileByID(u.key);d.terrain&&d.terrain.setupElevationDraw(P,A);const O=f.DepthMode.disabled,L=f.StencilMode.disabled,V=d.colorModeForRenderPass(),Y="$debug";m.activeTexture.set(w.TEXTURE0),d.emptyTexture.bind(w.LINEAR,w.CLAMP_TO_EDGE),b?P._makeGlobeTileDebugBuffers(d.context,d.transform.projection):P._makeDebugTileBoundsBuffers(d.context,d.transform.projection);const te=P._tileDebugBuffer||d.debugBuffer,J=P._tileDebugIndexBuffer||d.debugIndexBuffer,H=P._tileDebugSegments||d.debugSegments;A.draw(m,w.LINE_STRIP,O,L,V,f.CullFaceMode.disabled,Po(S,f.Color.red),Y,te,J,H,null,null,null,P._globeTileDebugBorderBuffer);const se=P.latestRawTileData,ie=Math.floor((se&&se.byteLength||0)/1024),he=n.getTile(u).tileSize,de=512/Math.min(he,512)*(u.overscaledZ/d.transform.zoom)*.5;let ce=u.canonical.toString();u.overscaledZ!==u.canonical.z&&(ce+=` => ${u.overscaledZ}`),function(Be,Le){Be.initDebugOverlayCanvas();const qe=Be.debugOverlayCanvas,Qe=Be.context.gl,ke=Be.debugOverlayCanvas.getContext("2d");ke.clearRect(0,0,qe.width,qe.height),ke.shadowColor="white",ke.shadowBlur=2,ke.lineWidth=1.5,ke.strokeStyle="white",ke.textBaseline="top",ke.font="bold 36px Open Sans, sans-serif",ke.fillText(Le,5,5),ke.strokeText(Le,5,5),Be.debugOverlayTexture.update(qe),Be.debugOverlayTexture.bind(Qe.LINEAR,Qe.CLAMP_TO_EDGE)}(d,`${ce} ${ie}kb`);const le=P._tileDebugTextBuffer||d.debugBuffer,we=P._tileDebugTextIndexBuffer||d.quadTriangleIndexBuffer,ze=P._tileDebugTextSegments||d.debugSegments;A.draw(m,w.TRIANGLES,O,L,f.ColorMode.alphaBlended,f.CullFaceMode.disabled,Po(S,f.Color.transparent,de),Y,le,we,ze,null,null,null,P._globeTileDebugTextBuffer)}const Ws=f.createLayout([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:Kr}=Ws;function ii(d,n,u,m){d.emplaceBack(n,u,m)}class Pn{constructor(n){this.vertexArray=new f.StructArrayLayout3f12,this.indices=new f.StructArrayLayout3ui6,ii(this.vertexArray,-1,-1,1),ii(this.vertexArray,1,-1,1),ii(this.vertexArray,-1,1,1),ii(this.vertexArray,1,1,1),ii(this.vertexArray,-1,-1,-1),ii(this.vertexArray,1,-1,-1),ii(this.vertexArray,-1,1,-1),ii(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=n.createVertexBuffer(this.vertexArray,Kr),this.indexBuffer=n.createIndexBuffer(this.indices),this.segment=f.SegmentVector.simpleSegment(0,0,36,12)}}function Xs(d,n,u,m,w,b){const S=d.gl,A=n.paint.get("sky-atmosphere-color"),P=n.paint.get("sky-atmosphere-halo-color"),O=n.paint.get("sky-atmosphere-sun-intensity"),L={u_matrix_3f:f.fromMat4(f.create$1(),m),u_sun_direction:w,u_sun_intensity:O,u_color_tint_r:[(J=A).r,J.g,J.b,J.a],u_color_tint_m:[(H=P).r,H.g,H.b,H.a],u_luminance:5e-5};var J,H;S.framebufferTexture2D(S.FRAMEBUFFER,S.COLOR_ATTACHMENT0,S.TEXTURE_CUBE_MAP_POSITIVE_X+b,n.skyboxTexture,0),u.draw(d,S.TRIANGLES,f.DepthMode.disabled,f.StencilMode.disabled,f.ColorMode.unblended,f.CullFaceMode.frontCW,L,"skyboxCapture",n.skyboxGeometry.vertexBuffer,n.skyboxGeometry.indexBuffer,n.skyboxGeometry.segment)}function la(d,n){return f.transformMat4(d,d,n)}const sh={symbol:function(d,n,u,m,w){if("translucent"!==d.renderPass)return;const b=f.StencilMode.disabled,S=d.colorModeForRenderPass();u.layout.get("text-variable-anchor")&&function(A,P,O,L,V,Y,te){const J=P.transform,H="map"===V,se="map"===Y;for(const ie of A){const he=L.getTile(ie),de=he.getBucket(O);if(!de||de.projection!==J.projection.name||!de.text||!de.text.segments.get().length)continue;const ce=f.evaluateSizeForZoom(de.textSizeData,J.zoom),le=P.transform.calculatePixelsToTileUnitsMatrix(he),we=Ao(ie.projMatrix,he.tileID.canonical,se,H,P.transform,le),ze="none"!==O.layout.get("icon-text-fit")&&de.hasIconData();if(ce){const Be=Math.pow(2,J.zoom-he.tileID.overscaledZ);Fi(de,H,se,te,f.symbolSize,J,we,ie,Be,ce,ze,J.projection)}}}(m,d,u,n,u.layout.get("text-rotation-alignment"),u.layout.get("text-pitch-alignment"),w),0!==u.paint.get("icon-opacity").constantOr(1)&&bl(d,n,u,m,!1,u.paint.get("icon-translate"),u.paint.get("icon-translate-anchor"),u.layout.get("icon-rotation-alignment"),u.layout.get("icon-pitch-alignment"),u.layout.get("icon-keep-upright"),b,S),0!==u.paint.get("text-opacity").constantOr(1)&&bl(d,n,u,m,!0,u.paint.get("text-translate"),u.paint.get("text-translate-anchor"),u.layout.get("text-rotation-alignment"),u.layout.get("text-pitch-alignment"),u.layout.get("text-keep-upright"),b,S),n.map.showCollisionBoxes&&(uf(d,n,u,m,u.paint.get("text-translate"),u.paint.get("text-translate-anchor"),!0),uf(d,n,u,m,u.paint.get("icon-translate"),u.paint.get("icon-translate-anchor"),!1))},circle:function(d,n,u,m){if("translucent"!==d.renderPass)return;const w=u.paint.get("circle-opacity"),b=u.paint.get("circle-stroke-width"),S=u.paint.get("circle-stroke-opacity"),A=void 0!==u.layout.get("circle-sort-key").constantOr(1);if(0===w.constantOr(1)&&(0===b.constantOr(1)||0===S.constantOr(1)))return;const P=d.context,O=P.gl,L=d.transform,V=d.depthModeForSublayer(0,f.DepthMode.ReadOnly),Y=f.StencilMode.disabled,te=d.colorModeForRenderPass(),J="globe"===L.projection.name,H=[f.mercatorXfromLng(L.center.lng),f.mercatorYfromLat(L.center.lat)],se=[];for(let he=0;he<m.length;he++){const de=m[he],ce=n.getTile(de),le=ce.getBucket(u);if(!le)continue;const we=le.programConfigurations.get(u.id),ze=sd(u);J&&ze.push("PROJECTION_GLOBE_VIEW");const Be=d.useProgram("circle",we,ze),Le=le.layoutVertexBuffer,qe=le.globeExtVertexBuffer,Qe=le.indexBuffer,ke=L.projection.createInversionMatrix(L,de.canonical),gt={programConfiguration:we,program:Be,layoutVertexBuffer:Le,globeExtVertexBuffer:qe,indexBuffer:Qe,uniformValues:Kn(d,de,ce,ke,H,u),tile:ce};if(A){const dt=le.segments.get();for(const It of dt)se.push({segments:new f.SegmentVector([It]),sortKey:It.sortKey,state:gt})}else se.push({segments:le.segments,sortKey:0,state:gt})}A&&se.sort((he,de)=>he.sortKey-de.sortKey);const ie={useDepthForOcclusion:!J};for(const he of se){const{programConfiguration:de,program:ce,layoutVertexBuffer:le,globeExtVertexBuffer:we,indexBuffer:ze,uniformValues:Be,tile:Le}=he.state,qe=he.segments;d.terrain&&d.terrain.setupElevationDraw(Le,ce,ie),d.prepareDrawProgram(P,ce,Le.tileID.toUnwrapped()),ce.draw(P,O.TRIANGLES,V,Y,te,f.CullFaceMode.disabled,Be,u.id,le,ze,qe,u.paint,L.zoom,de,J?we:null)}},heatmap:function(d,n,u,m){if(0!==u.paint.get("heatmap-opacity"))if("offscreen"===d.renderPass){const w=d.context,b=w.gl,S=f.StencilMode.disabled,A=new f.ColorMode([b.ONE,b.ONE],f.Color.transparent,[!0,!0,!0,!0]);(function(Y,te,J){const H=Y.gl;Y.activeTexture.set(H.TEXTURE1),Y.viewport.set([0,0,te.width/4,te.height/4]);let se=J.heatmapFbo;if(se)H.bindTexture(H.TEXTURE_2D,se.colorAttachment.get()),Y.bindFramebuffer.set(se.framebuffer);else{const ie=H.createTexture();H.bindTexture(H.TEXTURE_2D,ie),H.texParameteri(H.TEXTURE_2D,H.TEXTURE_WRAP_S,H.CLAMP_TO_EDGE),H.texParameteri(H.TEXTURE_2D,H.TEXTURE_WRAP_T,H.CLAMP_TO_EDGE),H.texParameteri(H.TEXTURE_2D,H.TEXTURE_MIN_FILTER,H.LINEAR),H.texParameteri(H.TEXTURE_2D,H.TEXTURE_MAG_FILTER,H.LINEAR),se=J.heatmapFbo=Y.createFramebuffer(te.width/4,te.height/4,!1),function(he,de,ce,le){const we=he.gl;we.texImage2D(we.TEXTURE_2D,0,we.RGBA,de.width/4,de.height/4,0,we.RGBA,he.extRenderToTextureHalfFloat?he.extTextureHalfFloat.HALF_FLOAT_OES:we.UNSIGNED_BYTE,null),le.colorAttachment.set(ce)}(Y,te,ie,se)}})(w,d,u),w.clear({color:f.Color.transparent});const P=d.transform,O="globe"===P.projection.name,L=O?["PROJECTION_GLOBE_VIEW"]:null,V=[f.mercatorXfromLng(P.center.lng),f.mercatorYfromLat(P.center.lat)];for(let Y=0;Y<m.length;Y++){const te=m[Y];if(n.hasRenderableParent(te))continue;const J=n.getTile(te),H=J.getBucket(u);if(!H)continue;const se=H.programConfigurations.get(u.id),ie=d.useProgram("heatmap",se,L),{zoom:he}=d.transform;d.terrain&&d.terrain.setupElevationDraw(J,ie),d.prepareDrawProgram(w,ie,te.toUnwrapped());const de=P.projection.createInversionMatrix(P,te.canonical);ie.draw(w,b.TRIANGLES,f.DepthMode.disabled,S,A,f.CullFaceMode.disabled,of(d,te,J,de,V,he,u.paint.get("heatmap-intensity")),u.id,H.layoutVertexBuffer,H.indexBuffer,H.segments,u.paint,d.transform.zoom,se,O?H.globeExtVertexBuffer:null)}w.viewport.set([0,0,d.width,d.height])}else"translucent"===d.renderPass&&(d.context.setColorMode(d.colorModeForRenderPass()),function(w,b){const S=w.context,A=S.gl,P=b.heatmapFbo;if(!P)return;S.activeTexture.set(A.TEXTURE0),A.bindTexture(A.TEXTURE_2D,P.colorAttachment.get()),S.activeTexture.set(A.TEXTURE1);let O=b.colorRampTexture;O||(O=b.colorRampTexture=new f.Texture(S,b.colorRamp,A.RGBA)),O.bind(A.LINEAR,A.CLAMP_TO_EDGE),w.useProgram("heatmapTexture").draw(S,A.TRIANGLES,f.DepthMode.disabled,f.StencilMode.disabled,w.colorModeForRenderPass(),f.CullFaceMode.disabled,{u_image:0,u_color_ramp:1,u_opacity:b.paint.get("heatmap-opacity")},b.id,w.viewportBuffer,w.quadTriangleIndexBuffer,w.viewportSegments,b.paint,w.transform.zoom)}(d,u))},line:function(d,n,u,m){if("translucent"!==d.renderPass)return;const w=u.paint.get("line-opacity"),b=u.paint.get("line-width");if(0===w.constantOr(1)||0===b.constantOr(1))return;const S=d.depthModeForSublayer(0,f.DepthMode.ReadOnly),A=d.colorModeForRenderPass(),P=d.terrain&&d.terrain.renderingToTexture?1:f.exported.devicePixelRatio,O=u.paint.get("line-dasharray"),L=O.constantOr(1),V=u.layout.get("line-cap"),Y=u.paint.get("line-pattern"),te=Y.constantOr(1),J=u.paint.get("line-gradient"),H=u.getCrossfadeParameters(),se=te?"linePattern":"line",ie=d.context,he=ie.gl,de=(le=>{const we=[];Lo(le)&&we.push("RENDER_LINE_DASH"),le.paint.get("line-gradient")&&we.push("RENDER_LINE_GRADIENT");const ze=le.paint.get("line-pattern").constantOr(1),Be=1!==le.paint.get("line-opacity").constantOr(1);return!ze&&Be&&we.push("RENDER_LINE_ALPHA_DISCARD"),we})(u);let ce=de.includes("RENDER_LINE_ALPHA_DISCARD");d.terrain&&d.terrain.clipOrMaskOverlapStencilType()&&(ce=!1);for(const le of m){const we=n.getTile(le);if(te&&!we.patternsLoaded())continue;const ze=we.getBucket(u);if(!ze)continue;d.prepareDrawTile();const Be=ze.programConfigurations.get(u.id),Le=d.useProgram(se,Be,de),qe=Y.constantOr(null);if(qe&&we.imageAtlas){const et=we.imageAtlas,Mt=et.patternPositions[qe.to.toString()],Jt=et.patternPositions[qe.from.toString()];Mt&&Jt&&Be.setConstantPatternPositions(Mt,Jt)}const Qe=O.constantOr(null),ke=V.constantOr(null);if(!te&&Qe&&ke&&we.lineAtlas){const et=we.lineAtlas,Mt=et.getDash(Qe.to,ke),Jt=et.getDash(Qe.from,ke);Mt&&Jt&&Be.setConstantPatternPositions(Mt,Jt)}const gt=d.terrain?le.projMatrix:null,dt=te?rh(d,we,u,H,gt,P):lf(d,we,u,H,gt,ze.lineClipsArray.length,P);if(J){const et=ze.gradients[u.id];let Mt=et.texture;if(u.gradientVersion!==et.version){let Jt=256;if(u.stepInterpolant){const Et=n.getSource().maxzoom,bt=le.canonical.z===Et?Math.ceil(1<<d.transform.maxZoom-le.canonical.z):1;Jt=f.clamp(f.nextPowerOfTwo(ze.maxLineLength/f.EXTENT*1024*bt),256,ie.maxTextureSize)}et.gradient=f.renderColorRamp({expression:u.gradientExpression(),evaluationKey:"lineProgress",resolution:Jt,image:et.gradient||void 0,clips:ze.lineClipsArray}),et.texture?et.texture.update(et.gradient):et.texture=new f.Texture(ie,et.gradient,he.RGBA),et.version=u.gradientVersion,Mt=et.texture}ie.activeTexture.set(he.TEXTURE1),Mt.bind(u.stepInterpolant?he.NEAREST:he.LINEAR,he.CLAMP_TO_EDGE)}L&&(ie.activeTexture.set(he.TEXTURE0),we.lineAtlasTexture.bind(he.LINEAR,he.REPEAT),Be.updatePaintBuffers(H)),te&&(ie.activeTexture.set(he.TEXTURE0),we.imageAtlasTexture.bind(he.LINEAR,he.CLAMP_TO_EDGE),Be.updatePaintBuffers(H)),d.prepareDrawProgram(ie,Le,le.toUnwrapped());const It=et=>{Le.draw(ie,he.TRIANGLES,S,et,A,f.CullFaceMode.disabled,dt,u.id,ze.layoutVertexBuffer,ze.indexBuffer,ze.segments,u.paint,d.transform.zoom,Be,ze.layoutVertexBuffer2)};if(ce){const et=d.stencilModeForClipping(le).ref;0===et&&d.terrain&&ie.clear({stencil:0});const Mt={func:he.EQUAL,mask:255};dt.u_alpha_discard_threshold=.8,It(new f.StencilMode(Mt,et,255,he.KEEP,he.KEEP,he.INVERT)),dt.u_alpha_discard_threshold=0,It(new f.StencilMode(Mt,et,255,he.KEEP,he.KEEP,he.KEEP))}else It(d.stencilModeForClipping(le))}ce&&(d.resetStencilClippingMasks(),d.terrain&&ie.clear({stencil:0}))},fill:function(d,n,u,m){const w=u.paint.get("fill-color"),b=u.paint.get("fill-opacity");if(0===b.constantOr(1))return;const S=d.colorModeForRenderPass(),A=u.paint.get("fill-pattern"),P=d.opaquePassEnabledForLayer()&&!A.constantOr(1)&&1===w.constantOr(f.Color.transparent).a&&1===b.constantOr(0)?"opaque":"translucent";if(d.renderPass===P){const O=d.depthModeForSublayer(1,"opaque"===d.renderPass?f.DepthMode.ReadWrite:f.DepthMode.ReadOnly);gu(d,n,u,m,O,S,!1)}if("translucent"===d.renderPass&&u.paint.get("fill-antialias")){const O=d.depthModeForSublayer(u.getPaintProperty("fill-outline-color")?2:0,f.DepthMode.ReadOnly);gu(d,n,u,m,O,S,!0)}},"fill-extrusion":function(d,n,u,m){const w=u.paint.get("fill-extrusion-opacity");if(0!==w&&"translucent"===d.renderPass){const b=new f.DepthMode(d.context.gl.LEQUAL,f.DepthMode.ReadWrite,d.depthRangeFor3D);if(1!==w||u.paint.get("fill-extrusion-pattern").constantOr(1))us(d,n,u,m,b,f.StencilMode.disabled,f.ColorMode.disabled),us(d,n,u,m,b,d.stencilModeFor3D(),d.colorModeForRenderPass()),d.resetStencilClippingMasks();else{const S=d.colorModeForRenderPass();us(d,n,u,m,b,f.StencilMode.disabled,S)}}},hillshade:function(d,n,u,m){if("offscreen"!==d.renderPass&&"translucent"!==d.renderPass)return;const w=d.context,b=d.depthModeForSublayer(0,f.DepthMode.ReadOnly),S=d.colorModeForRenderPass(),A=d.terrain&&d.terrain.renderingToTexture,[P,O]="translucent"!==d.renderPass||A?[{},m]:d.stencilConfigForOverlap(m);for(const L of O){const V=n.getTile(L);if(V.needsHillshadePrepare&&"offscreen"===d.renderPass)Qu(d,V,u,b,f.StencilMode.disabled,S);else if("translucent"===d.renderPass){const Y=A&&d.terrain?d.terrain.stencilModeForRTTOverlap(L):P[L.overscaledZ];rf(d,L,V,u,b,Y,S)}}w.viewport.set([0,0,d.width,d.height]),d.resetStencilClippingMasks()},raster:function(d,n,u,m,w,b){if("translucent"!==d.renderPass||0===u.paint.get("raster-opacity")||!m.length)return;const S=d.context,A=S.gl,P=n.getSource(),O=d.useProgram("raster"),L=d.colorModeForRenderPass(),V=d.terrain&&d.terrain.renderingToTexture,[Y,te]=P instanceof Ee||V?[{},m]:d.stencilConfigForOverlap(m),J=te[te.length-1].overscaledZ,H=!d.options.moving;for(const se of te){const ie=V?f.DepthMode.disabled:d.depthModeForSublayer(se.overscaledZ-J,1===u.paint.get("raster-opacity")?f.DepthMode.ReadWrite:f.DepthMode.ReadOnly,A.LESS),he=se.toUnwrapped(),de=n.getTile(se);if(V&&(!de||!de.hasData()))continue;const ce=V?se.projMatrix:d.transform.calculateProjMatrix(he,H),le=d.terrain&&V?d.terrain.stencilModeForRTTOverlap(se):Y[se.overscaledZ],we=b?0:u.paint.get("raster-fade-duration");de.registerFadeDuration(we);const ze=n.findLoadedParent(se,0),Be=cu(de,ze,n,d.transform,we);let Le,qe;d.terrain&&d.terrain.prepareDrawTile();const Qe="nearest"===u.paint.get("raster-resampling")?A.NEAREST:A.LINEAR;S.activeTexture.set(A.TEXTURE0),de.texture.bind(Qe,A.CLAMP_TO_EDGE),S.activeTexture.set(A.TEXTURE1),ze?(ze.texture.bind(Qe,A.CLAMP_TO_EDGE),Le=Math.pow(2,ze.tileID.overscaledZ-de.tileID.overscaledZ),qe=[de.tileID.canonical.x*Le%1,de.tileID.canonical.y*Le%1]):de.texture.bind(Qe,A.CLAMP_TO_EDGE);const ke=Ro(ce,qe||[0,0],Le||1,Be,u,P instanceof Ee?P.perspectiveTransform:[0,0]);if(d.prepareDrawProgram(S,O,he),P instanceof Ee)P.boundsBuffer&&P.boundsSegments&&O.draw(S,A.TRIANGLES,ie,f.StencilMode.disabled,L,f.CullFaceMode.disabled,ke,u.id,P.boundsBuffer,d.quadTriangleIndexBuffer,P.boundsSegments);else{const{tileBoundsBuffer:gt,tileBoundsIndexBuffer:dt,tileBoundsSegments:It}=d.getTileBoundsBuffers(de);O.draw(S,A.TRIANGLES,ie,le,L,f.CullFaceMode.disabled,ke,u.id,gt,dt,It)}}d.resetStencilClippingMasks()},background:function(d,n,u,m){const w=u.paint.get("background-color"),b=u.paint.get("background-opacity");if(0===b)return;const S=d.context,A=S.gl,P=d.transform,O=P.tileSize,L=u.paint.get("background-pattern");if(d.isPatternMissing(L))return;const V=!L&&1===w.a&&1===b&&d.opaquePassEnabledForLayer()?"opaque":"translucent";if(d.renderPass!==V)return;const Y=f.StencilMode.disabled,te=d.depthModeForSublayer(0,"opaque"===V?f.DepthMode.ReadWrite:f.DepthMode.ReadOnly),J=d.colorModeForRenderPass(),H=d.useProgram(L?"backgroundPattern":"background");let se,ie=m;ie||(se=d.getBackgroundTiles(),ie=Object.values(se).map(de=>de.tileID)),L&&(S.activeTexture.set(A.TEXTURE0),d.imageManager.bind(d.context));const he=u.getCrossfadeParameters();for(const de of ie){const ce=de.toUnwrapped(),le=m?de.projMatrix:d.transform.calculateProjMatrix(ce);d.prepareDrawTile();const we=n?n.getTile(de):se?se[de.key]:new f.Tile(de,O,P.zoom,d),ze=L?ar(le,b,d,L,{tileID:de,tileSize:O},he):cf(le,b,w);d.prepareDrawProgram(S,H,ce);const{tileBoundsBuffer:Be,tileBoundsIndexBuffer:Le,tileBoundsSegments:qe}=d.getTileBoundsBuffers(we);H.draw(S,A.TRIANGLES,te,Y,J,f.CullFaceMode.disabled,ze,u.id,Be,Le,qe)}},sky:function(d,n,u){const m=d.transform,w="mercator"===m.projection.name||"globe"===m.projection.name?1:f.smoothstep(7,8,m.zoom),b=u.paint.get("sky-opacity")*w;if(0===b)return;const S=d.context,A=u.paint.get("sky-type"),P=new f.DepthMode(S.gl.LEQUAL,f.DepthMode.ReadOnly,[0,1]),O=d.frameCounter/1e3%1;"atmosphere"===A?"offscreen"===d.renderPass?u.needsSkyboxCapture(d)&&(function(L,V,Y,te){const J=L.context,H=J.gl;let se=V.skyboxFbo;if(!se){se=V.skyboxFbo=J.createFramebuffer(32,32,!1),V.skyboxGeometry=new Pn(J),V.skyboxTexture=J.gl.createTexture(),H.bindTexture(H.TEXTURE_CUBE_MAP,V.skyboxTexture),H.texParameteri(H.TEXTURE_CUBE_MAP,H.TEXTURE_WRAP_S,H.CLAMP_TO_EDGE),H.texParameteri(H.TEXTURE_CUBE_MAP,H.TEXTURE_WRAP_T,H.CLAMP_TO_EDGE),H.texParameteri(H.TEXTURE_CUBE_MAP,H.TEXTURE_MIN_FILTER,H.LINEAR),H.texParameteri(H.TEXTURE_CUBE_MAP,H.TEXTURE_MAG_FILTER,H.LINEAR);for(let ce=0;ce<6;++ce)H.texImage2D(H.TEXTURE_CUBE_MAP_POSITIVE_X+ce,0,H.RGBA,32,32,0,H.RGBA,H.UNSIGNED_BYTE,null)}J.bindFramebuffer.set(se.framebuffer),J.viewport.set([0,0,32,32]);const ie=V.getCenter(L,!0),he=L.useProgram("skyboxCapture"),de=new Float64Array(16);f.identity(de),f.rotateY(de,de,.5*-Math.PI),Xs(J,V,he,de,ie,0),f.identity(de),f.rotateY(de,de,.5*Math.PI),Xs(J,V,he,de,ie,1),f.identity(de),f.rotateX(de,de,.5*-Math.PI),Xs(J,V,he,de,ie,2),f.identity(de),f.rotateX(de,de,.5*Math.PI),Xs(J,V,he,de,ie,3),f.identity(de),Xs(J,V,he,de,ie,4),f.identity(de),f.rotateY(de,de,Math.PI),Xs(J,V,he,de,ie,5),J.viewport.set([0,0,L.width,L.height])}(d,u),u.markSkyboxValid(d)):"sky"===d.renderPass&&function(L,V,Y,te,J){const H=L.context,se=H.gl,ie=L.transform,he=L.useProgram("skybox");H.activeTexture.set(se.TEXTURE0),se.bindTexture(se.TEXTURE_CUBE_MAP,V.skyboxTexture);const de={u_matrix:ie.skyboxMatrix,u_sun_direction:V.getCenter(L,!1),u_cubemap:0,u_opacity:te,u_temporal_offset:J};L.prepareDrawProgram(H,he),he.draw(H,se.TRIANGLES,Y,f.StencilMode.disabled,L.colorModeForRenderPass(),f.CullFaceMode.backCW,de,"skybox",V.skyboxGeometry.vertexBuffer,V.skyboxGeometry.indexBuffer,V.skyboxGeometry.segment)}(d,u,P,b,O):"gradient"===A&&"sky"===d.renderPass&&function(L,V,Y,te,J){const H=L.context,se=H.gl,ie=L.transform,he=L.useProgram("skyboxGradient");V.skyboxGeometry||(V.skyboxGeometry=new Pn(H)),H.activeTexture.set(se.TEXTURE0);let de=V.colorRampTexture;de||(de=V.colorRampTexture=new f.Texture(H,V.colorRamp,se.RGBA)),de.bind(se.LINEAR,se.CLAMP_TO_EDGE);const ce=(le=ie.skyboxMatrix,we=V.getCenter(L,!1),ze=V.paint.get("sky-gradient-radius"),Be=te,Le=J,{u_matrix:le,u_color_ramp:0,u_center_direction:we,u_radius:f.degToRad(ze),u_opacity:Be,u_temporal_offset:Le});var le,we,ze,Be,Le;L.prepareDrawProgram(H,he),he.draw(H,se.TRIANGLES,Y,f.StencilMode.disabled,L.colorModeForRenderPass(),f.CullFaceMode.backCW,ce,"skyboxGradient",V.skyboxGeometry.vertexBuffer,V.skyboxGeometry.indexBuffer,V.skyboxGeometry.segment)}(d,u,P,b,O)},debug:function(d,n,u){for(let m=0;m<u.length;m++)Ei(d,n,u[m])},custom:function(d,n,u){const m=d.context,w=u.implementation;if(d.transform.projection.unsupportedLayers&&d.transform.projection.unsupportedLayers.includes("custom"))f.warnOnce("Custom layers are not yet supported with non-mercator projections. Use mercator to enable custom layers.");else if("offscreen"===d.renderPass){const b=w.prerender;b&&(d.setCustomLayerDefaults(),m.setColorMode(d.colorModeForRenderPass()),b.call(w,m.gl,d.transform.customLayerMatrix()),m.setDirty(),d.setBaseState())}else if("translucent"===d.renderPass){d.setCustomLayerDefaults(),m.setColorMode(d.colorModeForRenderPass()),m.setStencilMode(f.StencilMode.disabled);const b="3d"===w.renderingMode?new f.DepthMode(d.context.gl.LEQUAL,f.DepthMode.ReadWrite,d.depthRangeFor3D):d.depthModeForSublayer(0,f.DepthMode.ReadOnly);m.setDepthMode(b),w.render(m.gl,d.transform.customLayerMatrix()),m.setDirty(),d.setBaseState(),m.bindFramebuffer.set(null)}}};class oh{constructor(n,u){this.context=new Z(n),this.transform=u,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.setup(),this.numSublayers=f.SourceCache.maxUnderzooming+f.SourceCache.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new au,this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={},this._tileClippingMaskIDs=new Map,this._skippedStencilTileIDs=new Set}updateTerrain(n,u){const m=!!n&&!!n.terrain&&this.transform.projection.supportsTerrain;if(!(m||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new Yn(this,n));const w=this._terrain;this.transform.elevation=m?w:null,w.update(n,this.transform,u)}_updateFog(n){const u=n.fog;if(!u||u.getOpacity(this.transform.pitch)<1||u.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[m,w]=u.getFovAdjustedRange(this.transform._fov);if(m>w)return void(this.transform.fogCullDistSq=null);const b=m+.78*(w-m);this.transform.fogCullDistSq=b*b}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled?this._terrain:null}resize(n,u){if(this.width=n*f.exported.devicePixelRatio,this.height=u*f.exported.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const m of this.style.order)this.style._layers[m].resize()}setup(){const n=this.context,u=new f.StructArrayLayout2i4;u.emplaceBack(0,0),u.emplaceBack(f.EXTENT,0),u.emplaceBack(0,f.EXTENT),u.emplaceBack(f.EXTENT,f.EXTENT),this.tileExtentBuffer=n.createVertexBuffer(u,f.posAttributes.members),this.tileExtentSegments=f.SegmentVector.simpleSegment(0,0,4,2);const m=new f.StructArrayLayout2i4;m.emplaceBack(0,0),m.emplaceBack(f.EXTENT,0),m.emplaceBack(0,f.EXTENT),m.emplaceBack(f.EXTENT,f.EXTENT),this.debugBuffer=n.createVertexBuffer(m,f.posAttributes.members),this.debugSegments=f.SegmentVector.simpleSegment(0,0,4,5);const w=new f.StructArrayLayout2i4;w.emplaceBack(-1,-1),w.emplaceBack(1,-1),w.emplaceBack(-1,1),w.emplaceBack(1,1),this.viewportBuffer=n.createVertexBuffer(w,f.posAttributes.members),this.viewportSegments=f.SegmentVector.simpleSegment(0,0,4,2);const b=new f.StructArrayLayout4i8;b.emplaceBack(0,0,0,0),b.emplaceBack(f.EXTENT,0,f.EXTENT,0),b.emplaceBack(0,f.EXTENT,0,f.EXTENT),b.emplaceBack(f.EXTENT,f.EXTENT,f.EXTENT,f.EXTENT),this.mercatorBoundsBuffer=n.createVertexBuffer(b,f.boundsAttributes.members),this.mercatorBoundsSegments=f.SegmentVector.simpleSegment(0,0,4,2);const S=new f.StructArrayLayout3ui6;S.emplaceBack(0,1,2),S.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=n.createIndexBuffer(S);const A=new f.StructArrayLayout1ui2;for(const O of[0,1,3,2,0])A.emplaceBack(O);this.debugIndexBuffer=n.createIndexBuffer(A),this.emptyTexture=new f.Texture(n,new f.RGBAImage({width:1,height:1},Uint8Array.of(0,0,0,0)),n.gl.RGBA),this.identityMat=f.create();const P=this.context.gl;this.stencilClearMode=new f.StencilMode({func:P.ALWAYS,mask:0},0,255,P.ZERO,P.ZERO,P.ZERO),this.loadTimeStamps.push(f.window.performance.now())}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(n){return n._makeTileBoundsBuffers(this.context,this.transform.projection),n._tileBoundsBuffer?{tileBoundsBuffer:n._tileBoundsBuffer,tileBoundsIndexBuffer:n._tileBoundsIndexBuffer,tileBoundsSegments:n._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const n=this.context,u=n.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs.clear(),this._skippedStencilTileIDs.clear(),this.useProgram("clippingMask").draw(n,u.TRIANGLES,f.DepthMode.disabled,this.stencilClearMode,f.ColorMode.disabled,f.CullFaceMode.disabled,lu(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs.clear(),this._skippedStencilTileIDs.clear())}_renderTileClippingMasks(n,u,m){if(!u||this.currentStencilSource===u.id||!n.isTileClipped()||!m||0===m.length)return;const w=[];let b=!1;if(this._tileClippingMaskIDs&&!this.terrain){for(const L of m)if(this._tileClippingMaskIDs.has(L.key)||(b=!0),this._skippedStencilTileIDs.has(L.key)){if(!u.getTile(L).getBucket(n))continue;this._skippedStencilTileIDs.delete(L.key),w.push(L)}if(!b&&0===w.length)return}const S=this.context,A=S.gl;S.setColorMode(f.ColorMode.disabled),S.setDepthMode(f.DepthMode.disabled);const P=this.useProgram("clippingMask"),O=L=>{const V=u.getTile(L),{tileBoundsBuffer:Y,tileBoundsIndexBuffer:te,tileBoundsSegments:J}=this.getTileBoundsBuffers(V);P.draw(S,A.TRIANGLES,f.DepthMode.disabled,new f.StencilMode({func:A.GREATER,mask:255},this._tileClippingMaskIDs.get(L.key)||0,255,A.KEEP,A.KEEP,A.REPLACE),f.ColorMode.disabled,f.CullFaceMode.disabled,lu(L.projMatrix),"$clipping",Y,te,J)};if(!b&&w.length>0)for(const L of w)O(L);else{(0===this._tileClippingMaskIDs.size||this.nextStencilID+m.length>256)&&this.clearStencil(),this._tileClippingMaskIDs.clear(),this._skippedStencilTileIDs.clear();for(const L of m)this._tileClippingMaskIDs.set(L.key,this.nextStencilID++),u.getTile(L).getBucket(n)?O(L):this._skippedStencilTileIDs.add(L.key)}0===this._skippedStencilTileIDs.size&&(this.currentStencilSource=u.id)}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const n=this.nextStencilID++,u=this.context.gl;return new f.StencilMode({func:u.NOTEQUAL,mask:255},n,255,u.KEEP,u.KEEP,u.REPLACE)}stencilModeForClipping(n){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(n);const u=this.context.gl;return new f.StencilMode({func:u.EQUAL,mask:255},this._tileClippingMaskIDs.get(n.key)||0,0,u.KEEP,u.KEEP,u.REPLACE)}stencilConfigForOverlap(n){const u=this.context.gl,m=n.sort((S,A)=>A.overscaledZ-S.overscaledZ),w=m[m.length-1].overscaledZ,b=m[0].overscaledZ-w+1;if(b>1){this.currentStencilSource=void 0,this.nextStencilID+b>256&&this.clearStencil();const S={};for(let A=0;A<b;A++)S[A+w]=new f.StencilMode({func:u.GEQUAL,mask:255},A+this.nextStencilID,255,u.KEEP,u.KEEP,u.REPLACE);return this.nextStencilID+=b,[S,m]}return[{[w]:f.StencilMode.disabled},m]}colorModeForRenderPass(){const n=this.context.gl;return this._showOverdrawInspector?new f.ColorMode([n.CONSTANT_COLOR,n.ONE],new f.Color(.125,.125,.125,0),[!0,!0,!0,!0]):"opaque"===this.renderPass?f.ColorMode.unblended:f.ColorMode.alphaBlended}depthModeForSublayer(n,u,m){if(!this.opaquePassEnabledForLayer())return f.DepthMode.disabled;const w=1-((1+this.currentLayer)*this.numSublayers+n)*this.depthEpsilon;return new f.DepthMode(m||this.context.gl.LEQUAL,u,[w,w])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(n,u){this.style=n,this.options=u,this.lineAtlas=n.lineAtlas,this.imageManager=n.imageManager,this.glyphManager=n.glyphManager,this.symbolFadeChange=n.placement.symbolFadeChange(f.exported.now()),this.imageManager.beginFrame();const m=this.style.order,w=this.style._sourceCaches;for(const O in w){const L=w[O];L.used&&L.prepare(this.context)}const b={},S={},A={};for(const O in w){const L=w[O];b[O]=L.getVisibleCoordinates(),S[O]=b[O].slice().reverse(),A[O]=L.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let O=0;O<m.length;O++)if(this.style._layers[m[O]].is3D()){this.opaquePassCutoff=O;break}if(this.terrain&&(this.terrain.updateTileBinding(A),this.opaquePassCutoff=0),"globe"!==this.transform.projection.name||this.globeSharedBuffers||(this.globeSharedBuffers=new f.GlobeSharedBuffers(this.context)),!f.isMapAuthenticated(this.context.gl))return;this.renderPass="offscreen";for(const O of m){const L=this.style._layers[O],V=n._getLayerSourceCache(L);if(!L.hasOffscreenPass()||L.isHidden(this.transform.zoom))continue;const Y=V?S[V.id]:void 0;("custom"===L.type||L.isSky()||Y&&Y.length)&&this.renderLayer(this,V,L,Y)}this.depthRangeFor3D=[0,1-(n.order.length+2)*this.numSublayers*this.depthEpsilon],this.terrain&&(this.style.hasSymbolLayers()||this.style.hasCircleLayers())&&this.terrain.drawDepth(),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]);let P=f.Color.transparent;if(this.style.fog&&this.style.fog.getOpacity(this.transform.pitch)&&(P=this.style.fog.properties.get("color")),this.context.clear({color:u.showOverdrawInspector?f.Color.black:P,depth:1}),this.clearStencil(),this._showOverdrawInspector=u.showOverdrawInspector,this.renderPass="opaque",!this.terrain)for(this.currentLayer=m.length-1;this.currentLayer>=0;this.currentLayer--){const O=this.style._layers[m[this.currentLayer]],L=n._getLayerSourceCache(O);if(O.isSky())continue;const V=L?S[L.id]:void 0;this._renderTileClippingMasks(O,L,V),this.renderLayer(this,L,O,V)}if(this.renderPass="sky",(f.globeToMercatorTransition(this.transform.zoom)>0||"globe"!==this.transform.projection.name)&&this.transform.isHorizonVisible())for(this.currentLayer=0;this.currentLayer<m.length;this.currentLayer++){const O=this.style._layers[m[this.currentLayer]],L=n._getLayerSourceCache(O);O.isSky()&&this.renderLayer(this,L,O,L?S[L.id]:void 0)}for("globe"===this.transform.projection.name&&function(O){const L=O.context,V=L.gl,Y=O.transform,te=new f.DepthMode(V.LEQUAL,f.DepthMode.ReadOnly,[0,1]),J=O.useProgram("globeAtmosphere"),H=Y.centerOffset,se=Y._camera.getCameraToClipPerspective(Y._fov,Y.width/Y.height,Y._nearZ,Y._farZ);se[8]=2*-H.x/Y.width,se[9]=2*H.y/Y.height;const ie=f.invert([],se),he=f.mul([],ie,Y.projMatrix),de={u_frustum_tl:la([-1,1,1],ie),u_frustum_tr:la([1,1,1],ie),u_frustum_br:la([1,-1,1],ie),u_frustum_bl:la([-1,-1,1],ie),u_globe_pos:la([Y.globeMatrix[12],Y.globeMatrix[13],Y.globeMatrix[14]],he),u_globe_radius:Y.worldSize/2/Math.PI-1,u_opacity:1-f.globeToMercatorTransition(Y.zoom),u_fadeout_range:2,u_start_color:[1,1,1],u_end_color:[.0118,.7451,.9882]};O.prepareDrawProgram(L,J);const ce=O.globeSharedBuffers;ce&&J.draw(L,V.TRIANGLES,te,f.StencilMode.disabled,f.ColorMode.alphaBlended,f.CullFaceMode.backCW,de,"skybox",ce.atmosphereVertexBuffer,ce.atmosphereIndexBuffer,ce.atmosphereSegments)}(this),this.renderPass="translucent",this.currentLayer=0;this.currentLayer<m.length;){const O=this.style._layers[m[this.currentLayer]],L=n._getLayerSourceCache(O);if(O.isSky()){++this.currentLayer;continue}if(this.terrain&&this.style.isLayerDraped(O)){if(O.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer);continue}const V=L?("symbol"===O.type?A:S)[L.id]:void 0;this._renderTileClippingMasks(O,L,L?b[L.id]:void 0),this.renderLayer(this,L,O,V),++this.currentLayer}if(this.terrain&&this.terrain.postRender(),this.options.showTileBoundaries||this.options.showQueryGeometry){let O=null;f.values(this.style._layers).forEach(L=>{const V=n._getLayerSourceCache(L);V&&!L.isHidden(this.transform.zoom)&&(!O||O.getSource().maxzoom<V.getSource().maxzoom)&&(O=V)}),O&&this.options.showTileBoundaries&&sh.debug(this,O,O.getVisibleCoordinates())}this.options.showPadding&&function(O){const L=O.transform.padding;Ct(O,O.transform.height-(L.top||0),3,xu),Ct(O,L.bottom||0,3,nh),oa(O,L.left||0,3,ah),oa(O,O.transform.width-(L.right||0),3,Tl);const V=O.transform.centerPoint;var Y,te,J,H;yc(Y=O,(te=V.x)-1,(J=O.transform.height-V.y)-10,2,20,H=yu),yc(Y,te-10,J-1,20,2,H)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(f.window.performance.now()),this.saveCanvasCopy())}renderLayer(n,u,m,w){m.isHidden(this.transform.zoom)||("background"===m.type||"sky"===m.type||"custom"===m.type||w&&w.length)&&(this.id=m.id,this.gpuTimingStart(m),n.transform.projection.unsupportedLayers&&n.transform.projection.unsupportedLayers.includes(m.type)||sh[m.type](n,u,m,w,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(n){if(!this.options.gpuTiming)return;const u=this.context.extTimerQuery;let m=this.gpuTimers[n.id];m||(m=this.gpuTimers[n.id]={calls:0,cpuTime:0,query:u.createQueryEXT()}),m.calls++,u.beginQueryEXT(u.TIME_ELAPSED_EXT,m.query)}gpuTimingEnd(){if(!this.options.gpuTiming)return;const n=this.context.extTimerQuery;n.endQueryEXT(n.TIME_ELAPSED_EXT)}collectGpuTimers(){const n=this.gpuTimers;return this.gpuTimers={},n}queryGpuTimers(n){const u={};for(const m in n){const w=n[m],b=this.context.extTimerQuery,S=b.getQueryObjectEXT(w.query,b.QUERY_RESULT_EXT)/1e6;b.deleteQueryEXT(w.query),u[m]=S}return u}translatePosMatrix(n,u,m,w,b){if(!m[0]&&!m[1])return n;const S=b?"map"===w?this.transform.angle:0:"viewport"===w?-this.transform.angle:0;if(S){const O=Math.sin(S),L=Math.cos(S);m=[m[0]*L-m[1]*O,m[0]*O+m[1]*L]}const A=[b?m[0]:cn(u,m[0],this.transform.zoom),b?m[1]:cn(u,m[1],this.transform.zoom),0],P=new Float32Array(16);return f.translate(P,n,A),P}saveTileTexture(n){const u=this._tileTextures[n.size[0]];u?u.push(n):this._tileTextures[n.size[0]]=[n]}getTileTexture(n){const u=this._tileTextures[n];return u&&u.length>0?u.pop():null}isPatternMissing(n){if(!n)return!1;if(!n.from||!n.to)return!0;const u=this.imageManager.getPattern(n.from.toString()),m=this.imageManager.getPattern(n.to.toString());return!u||!m}currentGlobalDefines(){const n=this.terrain&&this.terrain.renderingToTexture,u=this.style&&this.style.fog,m=[];return this.terrain&&!this.terrain.renderingToTexture&&m.push("TERRAIN"),u&&!n&&0!==u.getOpacity(this.transform.pitch)&&m.push("FOG"),n&&m.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&m.push("OVERDRAW_INSPECTOR"),m}useProgram(n,u,m){this.cache=this.cache||{};const w=m||[],b=this.currentGlobalDefines().concat(w),S=Yi.cacheKey(n,b,u);return this.cache[S]||(this.cache[S]=new Yi(this.context,n,fc[n],u,Er[n],b)),this.cache[S]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const n=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(n.FUNC_ADD)}initDebugOverlayCanvas(){null==this.debugOverlayCanvas&&(this.debugOverlayCanvas=f.window.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new f.Texture(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this._terrain&&this._terrain.destroy(),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}prepareDrawProgram(n,u,m){if(this.terrain&&this.terrain.renderingToTexture)return;const w=this.style.fog;if(w){const b=w.getOpacity(this.transform.pitch);0!==b&&u.setFogUniformValues(n,((S,A,P,O)=>{const L=A.properties.get("color"),V=S.frameCounter/1e3%1,Y=[L.r/L.a,L.g/L.a,L.b/L.a,O];return{u_fog_matrix:P?S.transform.calculateFogTileMatrix(P):S.identityMat,u_fog_range:A.getFovAdjustedRange(S.transform._fov),u_fog_color:Y,u_fog_horizon_blend:A.properties.get("horizon-blend"),u_fog_temporal_offset:V}})(this,w,m,b))}}setTileLoadedFlag(n){this.tileLoaded=n}saveCanvasCopy(){this.frameCopies.push(this.canvasCopy()),this.tileLoaded=!1}canvasCopy(){const n=this.context.gl,u=n.createTexture();return n.bindTexture(n.TEXTURE_2D,u),n.copyTexImage2D(n.TEXTURE_2D,0,n.RGBA,0,0,n.drawingBufferWidth,n.drawingBufferHeight,0),u}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const n=this.style&&this.style.fog;return!!n&&0!==n.getOpacity(this.transform.pitch)}getBackgroundTiles(){const n=this._backgroundTiles,u=this._backgroundTiles={},m=this.transform.coveringTiles({tileSize:512});for(const w of m)u[w.key]=n[w.key]||new f.Tile(w,512,this.transform.tileZoom,this);return u}clearBackgroundTiles(){this._backgroundTiles={}}}class hs{constructor(n=0,u=0,m=0,w=0){if(isNaN(n)||n<0||isNaN(u)||u<0||isNaN(m)||m<0||isNaN(w)||w<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=n,this.bottom=u,this.left=m,this.right=w}interpolate(n,u,m){return null!=u.top&&null!=n.top&&(this.top=f.number(n.top,u.top,m)),null!=u.bottom&&null!=n.bottom&&(this.bottom=f.number(n.bottom,u.bottom,m)),null!=u.left&&null!=n.left&&(this.left=f.number(n.left,u.left,m)),null!=u.right&&null!=n.right&&(this.right=f.number(n.right,u.right,m)),this}getCenter(n,u){const m=f.clamp((this.left+n-this.right)/2,0,n),w=f.clamp((this.top+u-this.bottom)/2,0,u);return new f.pointGeometry(m,w)}equals(n){return this.top===n.top&&this.bottom===n.bottom&&this.left===n.left&&this.right===n.right}clone(){return new hs(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function ff(d,n){const u=f.getColumn(d,3);f.fromQuat(d,n),f.setColumn(d,3,u)}function Jn(d,n){const u=f.identity$1([]);return f.rotateZ$1(u,u,-n),f.rotateX$1(u,u,-d),u}function El(d,n){const u=[d[0],d[1],0],m=[n[0],n[1],0];if(f.length(u)>=1e-15){const S=f.normalize([],u);f.scale$2(m,S,f.dot(m,S)),n[0]=m[0],n[1]=m[1]}const w=f.cross([],n,d);if(f.len(w)<1e-15)return null;const b=Math.atan2(-w[1],w[0]);return Jn(Math.atan2(Math.sqrt(d[0]*d[0]+d[1]*d[1]),-d[2]),b)}class Si{constructor(n,u){this.position=n,this.orientation=u}get position(){return this._position}set position(n){if(n){const u=n instanceof f.MercatorCoordinate?n:new f.MercatorCoordinate(n[0],n[1],n[2]);this._renderWorldCopies&&(u.x=f.wrap(u.x,0,1)),this._position=u}else this._position=null}lookAtPoint(n,u){if(this.orientation=null,!this.position)return;const m=this._elevation?this._elevation.getAtPointOrZero(f.MercatorCoordinate.fromLngLat(n)):0,w=this.position,b=f.MercatorCoordinate.fromLngLat(n,m),S=[b.x-w.x,b.y-w.y,b.z-w.z];u||(u=[0,0,1]),u[2]=Math.abs(u[2]),this.orientation=El(S,u)}setPitchBearing(n,u){this.orientation=Jn(f.degToRad(n),f.degToRad(-u))}}class fn{constructor(n,u){this._transform=f.identity([]),this.orientation=u,this.position=n}get mercatorPosition(){const n=this.position;return new f.MercatorCoordinate(n[0],n[1],n[2])}get position(){const n=f.getColumn(this._transform,3);return[n[0],n[1],n[2]]}set position(n){var u;n&&f.setColumn(this._transform,3,[(u=n)[0],u[1],u[2],1])}get orientation(){return this._orientation}set orientation(n){this._orientation=n||f.identity$1([]),n&&ff(this._transform,this._orientation)}getPitchBearing(){const n=this.forward(),u=this.right();return{bearing:Math.atan2(-u[1],u[0]),pitch:Math.atan2(Math.sqrt(n[0]*n[0]+n[1]*n[1]),-n[2])}}setPitchBearing(n,u){this._orientation=Jn(n,u),ff(this._transform,this._orientation)}forward(){const n=f.getColumn(this._transform,2);return[-n[0],-n[1],-n[2]]}up(){const n=f.getColumn(this._transform,1);return[-n[0],-n[1],-n[2]]}right(){const n=f.getColumn(this._transform,0);return[n[0],n[1],n[2]]}getCameraToWorld(n,u){const m=new Float64Array(16);return f.invert(m,this.getWorldToCamera(n,u)),m}getWorldToCameraPosition(n,u,m){const w=this.position;f.scale$2(w,w,-n);const b=new Float64Array(16);return f.fromScaling(b,[m,m,m]),f.translate(b,b,w),b[10]*=u,b}getWorldToCamera(n,u){const m=new Float64Array(16),w=new Float64Array(4),b=this.position;return f.conjugate(w,this._orientation),f.scale$2(b,b,-n),f.fromQuat(m,w),f.translate(m,m,b),m[1]*=-1,m[5]*=-1,m[9]*=-1,m[13]*=-1,m[8]*=u,m[9]*=u,m[10]*=u,m[11]*=u,m}getCameraToClipPerspective(n,u,m,w){const b=new Float64Array(16);return f.perspective(b,n,u,m,w),b}getDistanceToElevation(n){const u=0===n?0:f.mercatorZfromAltitude(n,this.position[1]),m=this.forward();return(u-this.position[2])/m[2]}clone(){return new fn([...this.position],[...this.orientation])}}function vu(d,n){const u=mr(d),m=function(b,S,A,P,O){const L=new f.LngLat(A.lng-180*Ha,A.lat),V=new f.LngLat(A.lng+180*Ha,A.lat),Y=b.project(L.lng,L.lat),te=b.project(V.lng,V.lat),J=-Math.atan2(te.y-Y.y,te.x-Y.x),H=f.MercatorCoordinate.fromLngLat(A);H.y=f.clamp(H.y,-.999975,.999975);const se=H.toLngLat(),ie=b.project(se.lng,se.lat),he=f.MercatorCoordinate.fromLngLat(se);he.x+=Ha;const de=he.toLngLat(),ce=b.project(de.lng,de.lat),le=Bo(ce.x-ie.x,ce.y-ie.y,J),we=f.MercatorCoordinate.fromLngLat(se);we.y+=Ha;const ze=we.toLngLat(),Be=b.project(ze.lng,ze.lat),Le=Bo(Be.x-ie.x,Be.y-ie.y,J),qe=Math.abs(le.x)/Math.abs(Le.y),Qe=f.identity([]);f.rotateZ(Qe,Qe,-J*(1-(O?0:P)));const ke=f.identity([]);return f.scale(ke,ke,[1,1-(1-qe)*P,1]),ke[4]=-Le.x/Le.y*P,f.rotateZ(ke,ke,J),f.multiply$1(ke,Qe,ke),ke}(d.projection,0,d.center,u,n),w=wu(d);return f.scale(m,m,[w,w,1]),m}function wu(d){const n=d.projection,u=mr(d),m=bu(n,d.center),w=bu(n,f.LngLat.convert(n.center));return Math.pow(2,m*u+(1-u)*w)}function mr(d){const n=d.projection.range;if(!n)return 0;const u=Math.max(d.width,d.height),m=Math.log(u/1024)/Math.LN2;return f.smoothstep(n[0]+m,n[1]+m,d.zoom)}const Ha=1/4e4;function bu(d,n){const u=f.clamp(n.lat,-f.MAX_MERCATOR_LATITUDE,f.MAX_MERCATOR_LATITUDE),m=new f.LngLat(n.lng-180*Ha,u),w=new f.LngLat(n.lng+180*Ha,u),b=d.project(m.lng,u),S=d.project(w.lng,u),A=f.MercatorCoordinate.fromLngLat(m),P=f.MercatorCoordinate.fromLngLat(w),O=S.x-b.x,L=S.y-b.y,V=P.x-A.x,Y=P.y-A.y,te=Math.sqrt((V*V+Y*Y)/(O*O+L*L));return Math.log(te)/Math.LN2}function Bo(d,n,u){const m=Math.cos(u),w=Math.sin(u);return{x:d*m-n*w,y:d*w+n*m}}class xi{constructor(n,u,m,w,b,S,A){this.tileSize=512,this._renderWorldCopies=void 0===b||b,this._minZoom=n||0,this._maxZoom=u||22,this._minPitch=null==m?0:m,this._maxPitch=null==w?60:w,this.setProjection(S),this.setMaxBounds(A),this.width=0,this.height=0,this._center=new f.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new hs,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._distanceTileDataCache={},this._camera=new fn,this._centerAltitude=0,this._centerAltitudeValidForExaggeration=0,this._averageElevation=0,this.cameraElevationReference="ground",this._projectionScaler=1,this._horizonShift=.1}clone(){const n=new xi(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection());return n._elevation=this._elevation,n._centerAltitude=this._centerAltitude,n._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,n.tileSize=this.tileSize,n.width=this.width,n.height=this.height,n.cameraElevationReference=this.cameraElevationReference,n._center=this._center,n._setZoom(this.zoom),n._seaLevelZoom=this._seaLevelZoom,n.angle=this.angle,n._fov=this._fov,n._pitch=this._pitch,n._nearZ=this._nearZ,n._farZ=this._farZ,n._averageElevation=this._averageElevation,n._unmodified=this._unmodified,n._edgeInsets=this._edgeInsets.clone(),n._camera=this._camera.clone(),n._calcMatrices(),n.freezeTileCoverage=this.freezeTileCoverage,n}get elevation(){return this._elevation}set elevation(n){this._elevation!==n&&(this._elevation=n,this._updateCameraOnTerrain(),this._calcMatrices())}updateElevation(n){const u=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(null==this._seaLevelZoom||u)&&this._updateCameraOnTerrain(),(n||u)&&this._constrainCameraAltitude(),this._calcMatrices()}getProjection(){return f.pick(this.projection,["name","center","parallels"])}setProjection(n){null==n&&(n={name:"mercator"}),this.projectionOptions=n;const u=this.projection?this.getProjection():void 0;this.projection=f.getProjection(n);const m=this.getProjection();return ut(u,m)?null:(this._calcMatrices(),m)}get minZoom(){return this._minZoom}set minZoom(n){this._minZoom!==n&&(this._minZoom=n,this.zoom=Math.max(this.zoom,n))}get maxZoom(){return this._maxZoom}set maxZoom(n){this._maxZoom!==n&&(this._maxZoom=n,this.zoom=Math.min(this.zoom,n))}get minPitch(){return this._minPitch}set minPitch(n){this._minPitch!==n&&(this._minPitch=n,this.pitch=Math.max(this.pitch,n))}get maxPitch(){return this._maxPitch}set maxPitch(n){this._maxPitch!==n&&(this._maxPitch=n,this.pitch=Math.min(this.pitch,n))}get renderWorldCopies(){return this._renderWorldCopies&&!0===this.projection.supportsWorldCopies}set renderWorldCopies(n){void 0===n?n=!0:null===n&&(n=!1),this._renderWorldCopies=n}get worldSize(){return this.tileSize*this.scale}get cameraWorldSize(){const n=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(n))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.cameraWorldSize)}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new f.pointGeometry(this.width,this.height)}get bearing(){return f.wrap(this.rotation,-180,180)}set bearing(n){this.rotation=n}get rotation(){return-this.angle/Math.PI*180}set rotation(n){const u=-n*Math.PI/180;var m,w,b,S,A,P,O,L,V,Y;this.angle!==u&&(this._unmodified=!1,this.angle=u,this._calcMatrices(),this.rotationMatrix=(m=new f.ARRAY_TYPE(4),f.ARRAY_TYPE!=Float32Array&&(m[1]=0,m[2]=0),m[0]=1,m[3]=1,m),w=this.rotationMatrix,S=this.angle,A=(b=this.rotationMatrix)[0],P=b[1],O=b[2],L=b[3],V=Math.sin(S),Y=Math.cos(S),w[0]=A*Y+O*V,w[1]=P*Y+L*V,w[2]=A*-V+O*Y,w[3]=P*-V+L*Y)}get pitch(){return this._pitch/Math.PI*180}set pitch(n){const u=f.clamp(n,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==u&&(this._unmodified=!1,this._pitch=u,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(n){n=Math.max(.01,Math.min(60,n)),this._fov!==n&&(this._unmodified=!1,this._fov=n/180*Math.PI,this._calcMatrices())}get averageElevation(){return this._averageElevation}set averageElevation(n){this._averageElevation=n,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(n){const u=Math.min(Math.max(n,this.minZoom),this.maxZoom);this._zoom!==u&&(this._unmodified=!1,this._setZoom(u),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(n){this._zoom=n,this.scale=this.zoomScale(n),this.tileZoom=Math.floor(n),this.zoomFraction=n-this.tileZoom}_updateCameraOnTerrain(){if(!this._elevation||!this._elevation.isDataAvailableAtPoint(this.locationCoordinate(this.center)))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=0);const n=this._elevation;this._centerAltitude=n.getAtPointOrZero(this.locationCoordinate(this.center)),this._centerAltitudeValidForExaggeration=n.exaggeration(),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){0!==this._centerAltitudeValidForExaggeration&&(this._seaLevelZoom=this._zoomFromMercatorZ((this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize))}sampleAverageElevation(){if(!this._elevation)return 0;const n=this._elevation,u=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],m=this.horizonLineFromTop();let w=0,b=0;for(let S=0;S<u.length;S++){const A=new f.pointGeometry(u[S][0]*this.width,m+u[S][1]*(this.height-m)),P=n.pointCoordinate(A);if(!P)continue;const O=1/Math.hypot(P[0]-this._camera.position[0],P[1]-this._camera.position[1]);w+=P[3]*O,b+=O}return 0===b?NaN:w/b}get center(){return this._center}set center(n){n.lat===this._center.lat&&n.lng===this._center.lng||(this._unmodified=!1,this._center=n,this._terrainEnabled()&&("ground"===this.cameraElevationReference?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(null==this._seaLevelZoom||!this._elevation)return;const n=this._seaLevelZoom,u=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),m=this.pixelsPerMeter/this.worldSize*u,w=this._mercatorZfromZoom(n),b=this._mercatorZfromZoom(this._maxZoom),S=Math.max(w-m,b);this._setZoom(this._zoomFromMercatorZ(S))}get padding(){return this._edgeInsets.toJSON()}set padding(n){this._edgeInsets.equals(n)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,n,1),this._calcMatrices())}computeZoomRelativeTo(n){const u=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,n.toAltitude()));let m;m=n.z<this._camera.position[2]?[u.x,u.y,u.z]:[n.x,n.y,n.z];const w=f.length(f.sub([],this._camera.position,m));return f.clamp(this._zoomFromMercatorZ(w),this._minZoom,this._maxZoom)}setFreeCameraOptions(n){if(!this.height||!n.position&&!n.orientation)return;this._updateCameraState();let u=!1;if(n.orientation&&!f.exactEquals(n.orientation,this._camera.orientation)&&(u=this._setCameraOrientation(n.orientation)),n.position){const m=[n.position.x,n.position.y,n.position.z];f.exactEquals$1(m,this._camera.position)||(this._setCameraPosition(m),u=!0)}u&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const n=this._camera.position,u=new Si;return u.position=new f.MercatorCoordinate(n[0],n[1],n[2]),u.orientation=this._camera.orientation,u._elevation=this.elevation,u._renderWorldCopies=this.renderWorldCopies,u}_setCameraOrientation(n){if(!f.length$1(n))return!1;f.normalize$1(n,n);const u=f.transformQuat([],[0,0,-1],n),m=f.transformQuat([],[0,-1,0],n);if(m[2]<0)return!1;const w=El(u,m);return!!w&&(this._camera.orientation=w,!0)}_setCameraPosition(n){const u=this.zoomScale(this.minZoom)*this.tileSize,m=this.zoomScale(this.maxZoom)*this.tileSize,w=this.cameraToCenterDistance;n[2]=f.clamp(n[2],w/m,w/u),this._camera.position=n}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(n){return this._edgeInsets.equals(n)}interpolatePadding(n,u,m){this._unmodified=!1,this._edgeInsets.interpolate(n,u,m),this._constrain(),this._calcMatrices()}coveringZoomLevel(n){const u=(n.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/n.tileSize));return Math.max(0,u)}getVisibleUnwrappedCoordinates(n){const u=[new f.UnwrappedTileID(0,n)];if(this.renderWorldCopies){const m=this.pointCoordinate(new f.pointGeometry(0,0)),w=this.pointCoordinate(new f.pointGeometry(this.width,0)),b=this.pointCoordinate(new f.pointGeometry(this.width,this.height)),S=this.pointCoordinate(new f.pointGeometry(0,this.height)),A=Math.floor(Math.min(m.x,w.x,b.x,S.x)),P=Math.floor(Math.max(m.x,w.x,b.x,S.x)),O=1;for(let L=A-O;L<=P+O;L++)0!==L&&u.push(new f.UnwrappedTileID(L,n))}return u}coveringTiles(n){let u=this.coveringZoomLevel(n);const m=u,w=this.elevation&&!n.isTerrainDEM,b="mercator"===this.projection.name;if(void 0!==n.minzoom&&u<n.minzoom)return[];void 0!==n.maxzoom&&u>n.maxzoom&&(u=n.maxzoom);const S=this.locationCoordinate(this.center),A=this.center.lat,P=1<<u,O=[P*S.x,P*S.y,0],L="globe"===this.projection.name,V=!L,Y=f.Frustum.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,u,V),te=L?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),J=P*f.mercatorZfromAltitude(1,this.center.lat),H=this._camera.position[2]/f.mercatorZfromAltitude(1,this.center.lat),se=[P*te.x,P*te.y,H*(V?1:J)],ie=this.cameraToCenterDistance/n.tileSize*(n.roundZoom?1:.502),he=this.pitch<=60&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace?u:0,de=n.isTerrainDEM&&this._elevation?1e4*this._elevation.exaggeration():this._centerAltitude,ce=n.isTerrainDEM?-de:this._elevation?this._elevation.getMinElevationBelowMSL():0,le=this.projection.isReprojectedInTileSpace?wu(this):1,we=et=>{const Jt=new f.MercatorCoordinate(et.x+25e-6,et.y,et.z),Et=new f.MercatorCoordinate(et.x,et.y+25e-6,et.z),bt=et.toLngLat(),Ot=Jt.toLngLat(),fr=Et.toLngLat(),Ht=this.locationCoordinate(bt),rr=this.locationCoordinate(Ot),Dr=this.locationCoordinate(fr),vi=Math.hypot(rr.x-Ht.x,rr.y-Ht.y),Tn=Math.hypot(Dr.x-Ht.x,Dr.y-Ht.y);return Math.sqrt(vi*Tn)*le/25e-6},ze=et=>{const Mt=de,Jt=ce;return{aabb:f.tileAABB(this,P,0,0,0,et,Jt,Mt,this.projection),zoom:0,x:0,y:0,minZ:Jt,maxZ:Mt,wrap:et,fullyVisible:!1}},Be=[];let Le=[];const qe=u,Qe=n.reparseOverscaled?m:u,ke=et=>et*et,gt=ke((H-this._centerAltitude)*J),dt=et=>{if(!this._elevation||!et.tileID||!b)return;const Mt=this._elevation.getMinMaxForTile(et.tileID),Jt=et.aabb;Mt?(Jt.min[2]=Mt.min,Jt.max[2]=Mt.max,Jt.center[2]=(Jt.min[2]+Jt.max[2])/2):(et.shouldSplit=It(et),et.shouldSplit||(Jt.min[2]=Jt.max[2]=Jt.center[2]=this._centerAltitude))},It=et=>{if(et.zoom<he)return!0;if(et.zoom===qe)return!1;if(null!=et.shouldSplit)return et.shouldSplit;const Mt=et.aabb.distanceX(se),Jt=et.aabb.distanceY(se);let Et=gt,bt=1;if(L){Et=ke(et.aabb.distanceZ(se));const fr=Math.pow(2,et.zoom),Ht=f.latFromMercatorY((et.y+1)/fr),rr=f.latFromMercatorY(et.y/fr),Dr=Math.min(Math.max(A,Ht),rr),vi=f.circumferenceAtLatitude(Dr)/f.circumferenceAtLatitude(A);bt=Math.min(vi,1)}else if(w&&(Et=ke(et.aabb.distanceZ(se)*J)),this.projection.isReprojectedInTileSpace&&m<=5){const fr=Math.pow(2,et.zoom),Ht=we(new f.MercatorCoordinate((et.x+.5)/fr,(et.y+.5)/fr));bt=Ht>.85?1:Ht}const Ot=Mt*Mt+Jt*Jt+Et;return Ot<ke((1<<qe-et.zoom)*ie*bt*((fr,Ht)=>{if(Ht*ke(.707)<fr)return 1;const rr=Math.sqrt(Ht/fr);return rr/(1.4144271570014144+(Math.pow(1.1,rr-1.4144271570014144+1)-1)/(1.1-1)-1)})(Math.max(Et,gt),Ot))};if(this.renderWorldCopies)for(let et=1;et<=3;et++)Be.push(ze(-et)),Be.push(ze(et));for(Be.push(ze(0));Be.length>0;){const et=Be.pop(),Mt=et.x,Jt=et.y;let Et=et.fullyVisible;if(!Et){const bt=et.aabb.intersects(Y);if(0===bt)continue;Et=2===bt}if(et.zoom!==qe&&It(et))for(let bt=0;bt<4;bt++){const Ot=(Mt<<1)+bt%2,fr=(Jt<<1)+(bt>>1),Ht={aabb:b?et.aabb.quadrant(bt):f.tileAABB(this,P,et.zoom+1,Ot,fr,et.wrap,et.minZ,et.maxZ,this.projection),zoom:et.zoom+1,x:Ot,y:fr,wrap:et.wrap,fullyVisible:Et,tileID:void 0,shouldSplit:void 0,minZ:et.minZ,maxZ:et.maxZ};w&&!L&&(Ht.tileID=new f.OverscaledTileID(et.zoom+1===qe?Qe:et.zoom+1,et.wrap,et.zoom+1,Ot,fr),dt(Ht)),Be.push(Ht)}else{const bt=et.zoom===qe?Qe:et.zoom;if(n.minzoom&&n.minzoom>bt)continue;const Ot=O[0]-(.5+Mt+(et.wrap<<et.zoom))*(1<<u-et.zoom),fr=O[1]-.5-Jt,Ht=et.tileID?et.tileID:new f.OverscaledTileID(bt,et.wrap,et.zoom,Mt,Jt);Le.push({tileID:Ht,distanceSq:Ot*Ot+fr*fr})}}if(this.fogCullDistSq){const et=this.fogCullDistSq,Mt=this.horizonLineFromTop();Le=Le.filter(Jt=>{const Et=[0,0,0,1],bt=[f.EXTENT,f.EXTENT,0,1],Ot=this.calculateFogTileMatrix(Jt.tileID.toUnwrapped());f.transformMat4$1(Et,Et,Ot),f.transformMat4$1(bt,bt,Ot);const fr=f.getAABBPointSquareDist(Et,bt);if(0===fr)return!0;let Ht=!1;const rr=this._elevation;if(rr&&fr>et&&0!==Mt){const Dr=this.calculateProjMatrix(Jt.tileID.toUnwrapped());let vi;n.isTerrainDEM||(vi=rr.getMinMaxForTile(Jt.tileID)),vi||(vi={min:ce,max:de});const Tn=f.furthestTileCorner(this.rotation),ui=[Tn[0]*f.EXTENT,Tn[1]*f.EXTENT,vi.max];f.transformMat4(ui,ui,Dr),Ht=(1-ui[1])*this.height*.5<Mt}return fr<et||Ht})}return Le.sort((et,Mt)=>et.distanceSq-Mt.distanceSq).map(et=>et.tileID)}resize(n,u){this.width=n,this.height=u,this.pixelsToGLUnits=[2/n,-2/u],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(n){return Math.pow(2,n)}scaleZoom(n){return Math.log(n)/Math.LN2}project(n){const u=f.clamp(n.lat,-f.MAX_MERCATOR_LATITUDE,f.MAX_MERCATOR_LATITUDE),m=this.projection.project(n.lng,u);return new f.pointGeometry(m.x*this.worldSize,m.y*this.worldSize)}unproject(n){return this.projection.unproject(n.x/this.worldSize,n.y/this.worldSize)}get point(){return this.project(this.center)}setLocationAtPoint(n,u){let m,w;const b=this.centerPoint;if("globe"===this.projection.name){const A=this.worldSize;m=(u.x-b.x)/A,w=(u.y-b.y)/A}else{const A=this.pointCoordinate(u),P=this.pointCoordinate(b);m=A.x-P.x,w=A.y-P.y}const S=this.locationCoordinate(n);this.setLocation(new f.MercatorCoordinate(S.x-m,S.y-w))}setLocation(n){this.center=this.coordinateLocation(n),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(n){return this.projection.locationPoint(this,n)}locationPoint3D(n){return this._coordinatePoint(this.locationCoordinate(n),!0)}pointLocation(n){return this.coordinateLocation(this.pointCoordinate(n))}pointLocation3D(n){return this.coordinateLocation(this.pointCoordinate3D(n))}locationCoordinate(n,u){const m=u?f.mercatorZfromAltitude(u,n.lat):void 0,w=this.projection.project(n.lng,n.lat);return new f.MercatorCoordinate(w.x,w.y,m)}coordinateLocation(n){return this.projection.unproject(n.x,n.y)}pointRayIntersection(n,u){const m=null!=u?u:this._centerAltitude,w=[n.x,n.y,0,1],b=[n.x,n.y,1,1];f.transformMat4$1(w,w,this.pixelMatrixInverse),f.transformMat4$1(b,b,this.pixelMatrixInverse);const S=b[3];f.scale$1(w,w,1/w[3]),f.scale$1(b,b,1/S);const A=w[2],P=b[2];return{p0:w,p1:b,t:A===P?0:(m-A)/(P-A)}}screenPointToMercatorRay(n){const u=[n.x,n.y,0,1],m=[n.x,n.y,1,1];return f.transformMat4$1(u,u,this.pixelMatrixInverse),f.transformMat4$1(m,m,this.pixelMatrixInverse),f.scale$1(u,u,1/u[3]),f.scale$1(m,m,1/m[3]),u[2]=f.mercatorZfromAltitude(u[2],this._center.lat)*this.worldSize,m[2]=f.mercatorZfromAltitude(m[2],this._center.lat)*this.worldSize,f.scale$1(u,u,1/this.worldSize),f.scale$1(m,m,1/this.worldSize),new f.Ray([u[0],u[1],u[2]],f.normalize([],f.sub([],m,u)))}rayIntersectionCoordinate(n){const{p0:u,p1:m,t:w}=n,b=f.mercatorZfromAltitude(u[2],this._center.lat),S=f.mercatorZfromAltitude(m[2],this._center.lat);return new f.MercatorCoordinate(f.number(u[0],m[0],w)/this.worldSize,f.number(u[1],m[1],w)/this.worldSize,f.number(b,S,w))}pointCoordinate(n,u=this._centerAltitude){return this.projection.pointCoordinate(this,n.x,n.y,u)}pointCoordinate3D(n){if(!this.elevation)return this.pointCoordinate(n);const u=this.elevation;let m=this.elevation.pointCoordinate(n);if(m)return new f.MercatorCoordinate(m[0],m[1],m[2]);let w=0,b=this.horizonLineFromTop();if(n.y>b)return this.pointCoordinate(n);const S=.02*b,A=n.clone();for(let P=0;P<10&&b-w>S;P++){A.y=f.number(w,b,.66);const O=u.pointCoordinate(A);O?(b=A.y,m=O):w=A.y}return m?new f.MercatorCoordinate(m[0],m[1],m[2]):this.pointCoordinate(n)}isPointAboveHorizon(n){if(this.elevation)return!this.elevation.pointCoordinate(n);{const u=this.horizonLineFromTop();return n.y<u}}_coordinatePoint(n,u){const m=u&&this.elevation?this.elevation.getAtPointOrZero(n,this._centerAltitude):this._centerAltitude,w=[n.x*this.worldSize,n.y*this.worldSize,m+n.toAltitude(),1];return f.transformMat4$1(w,w,this.pixelMatrix),w[3]>0?new f.pointGeometry(w[0]/w[3],w[1]/w[3]):new f.pointGeometry(Number.MAX_VALUE,Number.MAX_VALUE)}_getBounds(n,u){const m=new f.pointGeometry(this._edgeInsets.left,this._edgeInsets.top),w=new f.pointGeometry(this.width-this._edgeInsets.right,this._edgeInsets.top),b=new f.pointGeometry(this.width-this._edgeInsets.right,this.height-this._edgeInsets.bottom),S=new f.pointGeometry(this._edgeInsets.left,this.height-this._edgeInsets.bottom);let A=this.pointCoordinate(m,n),P=this.pointCoordinate(w,n);const O=this.pointCoordinate(b,u),L=this.pointCoordinate(S,u),V=(Y,te)=>(te.y-Y.y)/(te.x-Y.x);return A.y>1&&P.y>=0?A=new f.MercatorCoordinate((1-L.y)/V(L,A)+L.x,1):A.y<0&&P.y<=1&&(A=new f.MercatorCoordinate(-L.y/V(L,A)+L.x,0)),P.y>1&&A.y>=0?P=new f.MercatorCoordinate((1-O.y)/V(O,P)+O.x,1):P.y<0&&A.y<=1&&(P=new f.MercatorCoordinate(-O.y/V(O,P)+O.x,0)),(new f.LngLatBounds).extend(this.coordinateLocation(A)).extend(this.coordinateLocation(P)).extend(this.coordinateLocation(L)).extend(this.coordinateLocation(O))}_getBounds3D(){const n=this.elevation;if(!n.visibleDemTiles.length)return this._getBounds(0,0);const u=n.visibleDemTiles.reduce((m,w)=>{if(w.dem){const b=w.dem.tree;m.min=Math.min(m.min,b.minimums[0]),m.max=Math.max(m.max,b.maximums[0])}return m},{min:Number.MAX_VALUE,max:0});return this._getBounds(u.min*n.exaggeration(),u.max*n.exaggeration())}getBounds(){return this._terrainEnabled()?this._getBounds3D():this._getBounds(0,0)}horizonLineFromTop(n=!0){const u=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))+this.centerOffset.y,m=this.height/2-u*(1-this._horizonShift);return n?Math.max(0,m):m}getMaxBounds(){return this.maxBounds}setMaxBounds(n){this.maxBounds=n,this.minLat=-f.MAX_MERCATOR_LATITUDE,this.maxLat=f.MAX_MERCATOR_LATITUDE,this.minLng=-180,this.maxLng=180,n&&(this.minLat=n.getSouth(),this.maxLat=n.getNorth(),this.minLng=n.getWest(),this.maxLng=n.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=f.mercatorXfromLng(this.minLng)*this.tileSize,this.worldMaxX=f.mercatorXfromLng(this.maxLng)*this.tileSize,this.worldMinY=f.mercatorYfromLat(this.maxLat)*this.tileSize,this.worldMaxY=f.mercatorYfromLat(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(n,u){return this.projection.createTileMatrix(this,u,n)}calculateDistanceTileData(n){const u=n.key,m=this._distanceTileDataCache;if(m[u])return m[u];const w=n.canonical,b=1/this.height,S=this.cameraWorldSize/this.zoomScale(w.z),A=(w.x+Math.pow(2,w.z)*n.wrap)*S,P=w.y*S,O=this.point,L=this.angle,V=Math.sin(-L),Y=-Math.cos(-L);return m[u]={bearing:[V,Y],center:[(O.x-A)*b,(O.y-P)*b],scale:S/f.EXTENT*b},m[u]}calculateFogTileMatrix(n){const u=n.key,m=this._fogTileMatrixCache;if(m[u])return m[u];const w=this.calculatePosMatrix(n,this.cameraWorldSize);return f.multiply$1(w,this.worldToFogMatrix,w),m[u]=new Float32Array(w),m[u]}calculateProjMatrix(n,u=!1){const m=n.key,w=u?this._alignedProjMatrixCache:this._projMatrixCache;if(w[m])return w[m];const b=this.calculatePosMatrix(n,this.worldSize);return f.multiply$1(b,this.projection.isReprojectedInTileSpace?this.mercatorMatrix:u?this.alignedProjMatrix:this.projMatrix,b),w[m]=new Float32Array(b),w[m]}calculatePixelsToTileUnitsMatrix(n){const u=n.tileID.key,m=this._pixelsToTileUnitsCache;if(m[u])return m[u];const w=function(b,S){const{scale:A}=b.tileTransform,P=A*f.EXTENT/(b.tileSize*Math.pow(2,S.zoom-b.tileID.overscaledZ+b.tileID.canonical.z));return O=new Float32Array(4),Y=(L=S.inverseAdjustmentMatrix)[1],te=L[2],J=L[3],se=(V=[P,P])[1],O[0]=L[0]*(H=V[0]),O[1]=Y*H,O[2]=te*se,O[3]=J*se,O;var O,L,V,Y,te,J,H,se}(n,this);return m[u]=w,m[u]}customLayerMatrix(){return this.mercatorMatrix.slice()}recenterOnTerrain(){if(!this._elevation)return;const n=this._elevation;this._updateCameraState();const u=f.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,m=this._computeCameraPosition(u),w=this._camera.forward(),b=f.mercatorZfromAltitude(1,this._center.lat);m[2]/=b,w[2]/=b,f.normalize(w,w);const S=n.raycast(m,w,n.exaggeration());if(S){const A=f.scaleAndAdd([],m,w,S),P=new f.MercatorCoordinate(A[0],A[1],f.mercatorZfromAltitude(A[2],f.latFromMercatorY(A[1]))),O=(P.z+f.length([P.x-m[0],P.y-m[1],P.z-m[2]*b]))*this._projectionScaler;this._seaLevelZoom=this._zoomFromMercatorZ(O),this._centerAltitude=P.toAltitude(),this._center=this.coordinateLocation(P),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCameraAltitude(){if(!this._elevation)return;const n=this._elevation;this._updateCameraState();const u=f.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,m=this._computeCameraPosition(u),w=n.getAtPointOrZero(new f.MercatorCoordinate(...m)),b=this._minimumHeightOverTerrain()*Math.cos(f.degToRad(this._maxPitch)),S=this._camera.position[2]-this.pixelsPerMeter/this.worldSize*w;if(S<b){const A=this.locationCoordinate(this._center,this._centerAltitude),P=[A.x-m[0],A.y-m[1],A.z-m[2]],O=f.length(P);P[2]-=(b-S)/this._projectionScaler;const L=f.length(P);if(0===L)return;f.scale$2(P,P,O/L*this._projectionScaler),this._camera.position=[A.x-P[0],A.y-P[1],A.z*this._projectionScaler-P[2]],this._camera.orientation=El(P,this._camera.up()),this._updateStateFromCamera()}}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;if(this._constraining=!0,this.projection.isReprojectedInTileSpace){const V=this.center;return V.lat=f.clamp(V.lat,this.minLat,this.maxLat),!this.maxBounds&&this.renderWorldCopies||(V.lng=f.clamp(V.lng,this.minLng,this.maxLng)),this.center=V,void(this._constraining=!1)}const n=this._unmodified,{x:u,y:m}=this.point;let w=0,b=u,S=m;const A=this.width/2,P=this.height/2,O=this.worldMinY*this.scale,L=this.worldMaxY*this.scale;if(m-P<O&&(S=O+P),m+P>L&&(S=L-P),L-O<this.height&&(w=Math.max(w,this.height/(L-O)),S=(L+O)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const V=this.worldMinX*this.scale,Y=this.worldMaxX*this.scale,te=this.worldSize/2-(V+Y)/2;b=(u+te+this.worldSize)%this.worldSize-te,b-A<V&&(b=V+A),b+A>Y&&(b=Y-A),Y-V<this.width&&(w=Math.max(w,this.width/(Y-V)),b=(Y+V)/2)}b===u&&S===m||(this.center=this.unproject(new f.pointGeometry(b,S))),w&&(this.zoom+=this.scaleZoom(w)),this._constrainCameraAltitude(),this._unmodified=n,this._constraining=!1}_minZoomForBounds(){let n=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(n=Math.max(n,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),n}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const n=this._fov/2,u=this.centerOffset,m=this.pixelsPerMeter;this._projectionScaler=m/(f.mercatorZfromAltitude(1,this.center.lat)*this.worldSize),this.cameraToCenterDistance=.5/Math.tan(n)*this.height*this._projectionScaler,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const w=this._camera.getWorldToCamera(this.worldSize,"meters"===this.projection.zAxisUnit?m:1),b=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);b[8]=2*-u.x/this.width,b[9]=2*u.y/this.height;let S=f.mul([],b,w);if(this.projection.isReprojectedInTileSpace){const ce=this.locationCoordinate(this.center),le=f.identity([]);f.translate(le,le,[ce.x*this.worldSize,ce.y*this.worldSize,0]),f.multiply$1(le,le,vu(this)),f.translate(le,le,[-ce.x*this.worldSize,-ce.y*this.worldSize,0]),f.multiply$1(S,S,le),this.inverseAdjustmentMatrix=function(we){const ze=vu(we,!0);return rl([],[ze[0],ze[1],ze[4],ze[5]])}(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];this.mercatorMatrix=f.scale([],S,[this.worldSize,this.worldSize,this.worldSize/m,1]),this.projMatrix=S,this.invProjMatrix=f.invert(new Float64Array(16),this.projMatrix);const A=new Float32Array(16);f.identity(A),f.scale(A,A,[1,-1,1]),f.rotateX(A,A,this._pitch),f.rotateZ(A,A,this.angle);const P=f.perspective(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ),O=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;P[8]=2*-u.x/this.width,P[9]=2*(u.y+O)/this.height,this.skyboxMatrix=f.multiply$1(A,P,A);const L=this.point,V=L.x,Y=L.y,te=this.width%2/2,J=this.height%2/2,H=Math.cos(this.angle),se=Math.sin(this.angle),ie=V-Math.round(V)+H*te+se*J,he=Y-Math.round(Y)+H*J+se*te,de=new Float64Array(S);if(f.translate(de,de,[ie>.5?ie-1:ie,he>.5?he-1:he,0]),this.alignedProjMatrix=de,S=f.create(),f.scale(S,S,[this.width/2,-this.height/2,1]),f.translate(S,S,[1,-1,0]),this.labelPlaneMatrix=S,S=f.create(),f.scale(S,S,[1,-1,1]),f.translate(S,S,[-1,-1,0]),f.scale(S,S,[2/this.width,2/this.height,1]),this.glCoordMatrix=S,this.pixelMatrix=f.multiply$1(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),this._calcFogMatrices(),this._distanceTileDataCache={},S=f.invert(new Float64Array(16),this.pixelMatrix),!S)throw new Error("failed to invert matrix");this.pixelMatrixInverse=S,this.globeMatrix="globe"===this.projection.name?f.calculateGlobeMatrix(this):S,this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const n=this.cameraWorldSize,u=this.cameraPixelsPerMeter,m=this._camera.position,w=1/this.height,b=[n,n,u];f.scale$2(b,b,w),f.scale$2(m,m,-1),f.multiply$2(m,m,b);const S=f.create();f.translate(S,S,m),f.scale(S,S,b),this.mercatorFogMatrix=S,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(n,u,w)}_computeCameraPosition(n){const u=(n=n||this.pixelsPerMeter)/this.pixelsPerMeter,m=this._camera.forward(),w=this.point,b=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*u-n/this.worldSize*this._centerAltitude;return[w.x/this.worldSize-m[0]*b,w.y/this.worldSize-m[1]*b,n/this.worldSize*this._centerAltitude-m[2]*b]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(n){const u=this._maxCameraBoundsDistance()*Math.cos(this._pitch),m=n[2];let w=1;m>0&&(w=Math.min((u-this._camera.position[2])/m,1)),this._camera.position=f.scaleAndAdd([],this._camera.position,n,w),this._updateStateFromCamera(),this.projection.wrap&&(this.center=this.center.wrap())}_updateStateFromCamera(){const n=this._camera.position,u=this._camera.forward(),{pitch:m,bearing:w}=this._camera.getPitchBearing(),b=f.mercatorZfromAltitude(this._centerAltitude,this.center.lat)*this._projectionScaler,S=this._mercatorZfromZoom(this._maxZoom)*Math.cos(f.degToRad(this._maxPitch)),A=Math.max((n[2]-b)/Math.cos(m),S),P=this._zoomFromMercatorZ(A);f.scaleAndAdd(n,n,u,A),this._pitch=f.clamp(m,f.degToRad(this.minPitch),f.degToRad(this.maxPitch)),this.angle=f.wrap(w,-Math.PI,Math.PI),this._setZoom(f.clamp(P,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new f.MercatorCoordinate(n[0],n[1],n[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(n){return Math.pow(2,n)*this.tileSize}_mercatorZfromZoom(n){return this.cameraToCenterDistance/this._worldSizeFromZoom(n)}_minimumHeightOverTerrain(){const n=Math.min((null!=this._seaLevelZoom?this._seaLevelZoom:this._zoom)+2,this._maxZoom);return this._mercatorZfromZoom(n)}_zoomFromMercatorZ(n){return this.scaleZoom(this.cameraToCenterDistance/(n*this.tileSize))}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(f.warnOnce("Terrain is not yet supported with alternate projections. Use mercator to enable terrain."),1))}anyCornerOffEdge(n,u){const m=Math.min(n.x,u.x),w=Math.max(n.x,u.x),b=Math.min(n.y,u.y),S=Math.max(n.y,u.y);if(b<this.horizonLineFromTop(!1))return!0;if("mercator"!==this.projection.name)return!1;const A=[new f.pointGeometry(m,b),new f.pointGeometry(w,S),new f.pointGeometry(m,S),new f.pointGeometry(w,b)],P=this.renderWorldCopies?-3:0,O=this.renderWorldCopies?4:1;for(const L of A){const V=this.pointRayIntersection(L);if(V.t<0)return!0;const Y=this.rayIntersectionCoordinate(V);if(Y.x<P||Y.y<0||Y.x>O||Y.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+f.radToDeg(this.fovAboveCenter)>88||this.anyCornerOffEdge(new f.pointGeometry(0,0),new f.pointGeometry(this.width,this.height))}zoomDeltaToMovement(n,u){const m=f.length(f.sub([],this._camera.position,n)),w=this._zoomFromMercatorZ(m)+u;return m-this._mercatorZfromZoom(w)}getCameraPoint(){const n=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new f.pointGeometry(0,n))}}function lh(d,n){let u=!1,m=null;const w=()=>{m=null,u&&(d(),m=setTimeout(w,n),u=!1)};return()=>(u=!0,m||w(),m)}class ch{constructor(n){this._hashName=n&&encodeURIComponent(n),f.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=lh(this._updateHashUnthrottled.bind(this),300)}addTo(n){return this._map=n,f.window.addEventListener("hashchange",this._onHashChange,!1),n.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),f.window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(n){const u=this._map;if(!u)return"";const m=u.getCenter(),w=Math.round(100*u.getZoom())/100,b=Math.ceil((w*Math.LN2+Math.log(512/360/.5))/Math.LN10),S=Math.pow(10,b),A=Math.round(m.lng*S)/S,P=Math.round(m.lat*S)/S,O=u.getBearing(),L=u.getPitch();let V="";if(V+=n?`/${A}/${P}/${w}`:`${w}/${P}/${A}`,(O||L)&&(V+="/"+Math.round(10*O)/10),L&&(V+=`/${Math.round(L)}`),this._hashName){const Y=this._hashName;let te=!1;const J=f.window.location.hash.slice(1).split("&").map(H=>{const se=H.split("=")[0];return se===Y?(te=!0,`${se}=${V}`):H}).filter(H=>H);return te||J.push(`${Y}=${V}`),`#${J.join("&")}`}return`#${V}`}_getCurrentHash(){const n=f.window.location.hash.replace("#","");if(this._hashName){let u;return n.split("&").map(m=>m.split("=")).forEach(m=>{m[0]===this._hashName&&(u=m)}),(u&&u[1]||"").split("/")}return n.split("/")}_onHashChange(){const n=this._map;if(!n)return!1;const u=this._getCurrentHash();if(u.length>=3&&!u.some(m=>isNaN(m))){const m=n.dragRotate.isEnabled()&&n.touchZoomRotate.isEnabled()?+(u[3]||0):n.getBearing();return n.jumpTo({center:[+u[2],+u[1]],zoom:+u[0],bearing:m,pitch:+(u[4]||0)}),!0}return!1}_updateHashUnthrottled(){const n=f.window.location.href.replace(/(#.+)?$/,this.getHashString());f.window.history.replaceState(f.window.history.state,null,n)}}const fs={linearity:.3,easing:f.bezier(0,0,.3,1)},dn=f.extend({deceleration:2500,maxSpeed:1400},fs),df=f.extend({deceleration:20,maxSpeed:1400},fs),pf=f.extend({deceleration:1e3,maxSpeed:360},fs),gr=f.extend({deceleration:1e3,maxSpeed:90},fs);class Za{constructor(n){this._map=n,this.clear()}clear(){this._inertiaBuffer=[]}record(n){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:f.exported.now(),settings:n})}_drainInertiaBuffer(){const n=this._inertiaBuffer,u=f.exported.now();for(;n.length>0&&u-n[0].time>160;)n.shift()}_onMoveEnd(n){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const u={zoom:0,bearing:0,pitch:0,pan:new f.pointGeometry(0,0),pinchAround:void 0,around:void 0};for(const{settings:b}of this._inertiaBuffer)u.zoom+=b.zoomDelta||0,u.bearing+=b.bearingDelta||0,u.pitch+=b.pitchDelta||0,b.panDelta&&u.pan._add(b.panDelta),b.around&&(u.around=b.around),b.pinchAround&&(u.pinchAround=b.pinchAround);const m=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,w={};if(u.pan.mag()){const b=Ni(u.pan.mag(),m,f.extend({},dn,n||{}));w.offset=u.pan.mult(b.amount/u.pan.mag()),w.center=this._map.transform.center,vc(w,b)}if(u.zoom){const b=Ni(u.zoom,m,df);w.zoom=this._map.transform.zoom+b.amount,vc(w,b)}if(u.bearing){const b=Ni(u.bearing,m,pf);w.bearing=this._map.transform.bearing+f.clamp(b.amount,-179,179),vc(w,b)}if(u.pitch){const b=Ni(u.pitch,m,gr);w.pitch=this._map.transform.pitch+b.amount,vc(w,b)}if(w.zoom||w.bearing){const b=void 0===u.pinchAround?u.around:u.pinchAround;w.around=b?this._map.unproject(b):this._map.getCenter()}return this.clear(),w.noMoveStart=!0,w}}function vc(d,n){(!d.duration||d.duration<n.duration)&&(d.duration=n.duration,d.easing=n.easing)}function Ni(d,n,u){const{maxSpeed:m,linearity:w,deceleration:b}=u,S=f.clamp(d*w/(n/1e3),-m,m),A=Math.abs(S)/(b*w);return{easing:u.easing,duration:1e3*A,amount:S*(A/2)}}class Sr extends f.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(n,u,m,w={}){const b=Ia(u.getCanvasContainer(),m),S=u.unproject(b);super(n,f.extend({point:b,lngLat:S,originalEvent:m},w)),this._defaultPrevented=!1,this.target=u}}class No extends f.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(n,u,m){const w="touchend"===n?m.changedTouches:m.touches,b=wr(u.getCanvasContainer(),w),S=b.map(P=>u.unproject(P)),A=b.reduce((P,O,L,V)=>P.add(O.div(V.length)),new f.pointGeometry(0,0));super(n,{points:b,point:A,lngLats:S,lngLat:u.unproject(A),originalEvent:m}),this._defaultPrevented=!1}}class ld extends f.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(n,u,m){super(n,{originalEvent:m}),this._defaultPrevented=!1}}class ni{constructor(n,u){this._map=n,this._clickTolerance=u.clickTolerance}reset(){this._mousedownPos=void 0}wheel(n){return this._firePreventable(new ld(n.type,this._map,n))}mousedown(n,u){return this._mousedownPos=u,this._firePreventable(new Sr(n.type,this._map,n))}mouseup(n){this._map.fire(new Sr(n.type,this._map,n))}preclick(n){const u=f.extend({},n);u.type="preclick",this._map.fire(new Sr(u.type,this._map,u))}click(n,u){this._mousedownPos&&this._mousedownPos.dist(u)>=this._clickTolerance||(this.preclick(n),this._map.fire(new Sr(n.type,this._map,n)))}dblclick(n){return this._firePreventable(new Sr(n.type,this._map,n))}mouseover(n){this._map.fire(new Sr(n.type,this._map,n))}mouseout(n){this._map.fire(new Sr(n.type,this._map,n))}touchstart(n){return this._firePreventable(new No(n.type,this._map,n))}touchmove(n){this._map.fire(new No(n.type,this._map,n))}touchend(n){this._map.fire(new No(n.type,this._map,n))}touchcancel(n){this._map.fire(new No(n.type,this._map,n))}_firePreventable(n){if(this._map.fire(n),n.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Ya{constructor(n){this._map=n}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(n){this._map.fire(new Sr(n.type,this._map,n))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Sr("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(n){this._delayContextMenu?this._contextMenuEvent=n:this._map.fire(new Sr(n.type,this._map,n)),this._map.listens("contextmenu")&&n.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class uh{constructor(n,u){this._map=n,this._el=n.getCanvasContainer(),this._container=n.getContainer(),this._clickTolerance=u.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(n,u){this.isEnabled()&&n.shiftKey&&0===n.button&&(Gn(),this._startPos=this._lastPos=u,this._active=!0)}mousemoveWindow(n,u){if(!this._active)return;const m=u;if(this._lastPos.equals(m)||!this._box&&m.dist(this._startPos)<this._clickTolerance)return;const w=this._startPos;this._lastPos=m,this._box||(this._box=Rt("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",n));const b=Math.min(w.x,m.x),S=Math.max(w.x,m.x),A=Math.min(w.y,m.y),P=Math.max(w.y,m.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${b}px,${A}px)`,this._box.style.width=S-b+"px",this._box.style.height=P-A+"px")})}mouseupWindow(n,u){if(!this._active||0!==n.button)return;const m=this._startPos,w=u;if(this.reset(),po(),m.x!==w.x||m.y!==w.y)return this._map.fire(new f.Event("boxzoomend",{originalEvent:n})),{cameraAnimation:b=>b.fitScreenCoordinates(m,w,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",n)}keydown(n){this._active&&27===n.keyCode&&(this.reset(),this._fireEvent("boxzoomcancel",n))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),ho(),delete this._startPos,delete this._lastPos}_fireEvent(n,u){return this._map.fire(new f.Event(n,{originalEvent:u}))}}function ds(d,n){const u={};for(let m=0;m<d.length;m++)u[d[m].identifier]=n[m];return u}class Ka{constructor(n){this.reset(),this.numTouches=n.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(n,u,m){(this.centroid||m.length>this.numTouches)&&(this.aborted=!0),this.aborted||(0===this.startTime&&(this.startTime=n.timeStamp),m.length===this.numTouches&&(this.centroid=function(w){const b=new f.pointGeometry(0,0);for(const S of w)b._add(S);return b.div(w.length)}(u),this.touches=ds(m,u)))}touchmove(n,u,m){if(this.aborted||!this.centroid)return;const w=ds(m,u);for(const b in this.touches){const S=this.touches[b],A=w[b];(!A||A.dist(S)>30)&&(this.aborted=!0)}}touchend(n,u,m){if((!this.centroid||n.timeStamp-this.startTime>500)&&(this.aborted=!0),0===m.length){const w=!this.aborted&&this.centroid;if(this.reset(),w)return w}}}class Uo{constructor(n){this.singleTap=new Ka(n),this.numTaps=n.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(n,u,m){this.singleTap.touchstart(n,u,m)}touchmove(n,u,m){this.singleTap.touchmove(n,u,m)}touchend(n,u,m){const w=this.singleTap.touchend(n,u,m);if(w){const b=n.timeStamp-this.lastTime<500,S=!this.lastTap||this.lastTap.dist(w)<30;if(b&&S||this.reset(),this.count++,this.lastTime=n.timeStamp,this.lastTap=w,this.count===this.numTaps)return this.reset(),w}}}class Dt{constructor(){this._zoomIn=new Uo({numTouches:1,numTaps:2}),this._zoomOut=new Uo({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(n,u,m){this._zoomIn.touchstart(n,u,m),this._zoomOut.touchstart(n,u,m)}touchmove(n,u,m){this._zoomIn.touchmove(n,u,m),this._zoomOut.touchmove(n,u,m)}touchend(n,u,m){const w=this._zoomIn.touchend(n,u,m),b=this._zoomOut.touchend(n,u,m);return w?(this._active=!0,n.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:S=>S.easeTo({duration:300,zoom:S.getZoom()+1,around:S.unproject(w)},{originalEvent:n})}):b?(this._active=!0,n.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:S=>S.easeTo({duration:300,zoom:S.getZoom()-1,around:S.unproject(b)},{originalEvent:n})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const yi={0:1,2:2};class Sl{constructor(n){this.reset(),this._clickTolerance=n.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(n,u){return!1}_move(n,u){return{}}mousedown(n,u){if(this._lastPoint)return;const m=Ql(n);this._correctButton(n,m)&&(this._lastPoint=u,this._eventButton=m)}mousemoveWindow(n,u){const m=this._lastPoint;if(m)if(n.preventDefault(),null!=this._eventButton&&function(w,b){const S=yi[b];return void 0===w.buttons||(w.buttons&S)!==S}(n,this._eventButton))this.reset();else if(this._moved||!(u.dist(m)<this._clickTolerance))return this._moved=!0,this._lastPoint=u,this._move(m,u)}mouseupWindow(n){this._lastPoint&&Ql(n)===this._eventButton&&(this._moved&&po(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Al extends Sl{mousedown(n,u){super.mousedown(n,u),this._lastPoint&&(this._active=!0)}_correctButton(n,u){return 0===u&&!n.ctrlKey}_move(n,u){return{around:u,panDelta:u.sub(n)}}}class Zo extends Sl{_correctButton(n,u){return 0===u&&n.ctrlKey||2===u}_move(n,u){const m=.8*(u.x-n.x);if(m)return this._active=!0,{bearingDelta:m}}contextmenu(n){n.preventDefault()}}class kl extends Sl{_correctButton(n,u){return 0===u&&n.ctrlKey||2===u}_move(n,u){const m=-.5*(u.y-n.y);if(m)return this._active=!0,{pitchDelta:m}}contextmenu(n){n.preventDefault()}}class di{constructor(n,u){this._map=n,this._el=n.getCanvasContainer(),this._minTouches=1,this._clickTolerance=u.clickTolerance||1,this.reset(),f.bindAll(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new f.pointGeometry(0,0)}touchstart(n,u,m){return this._calculateTransform(n,u,m)}touchmove(n,u,m){if(this._active&&!(m.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(1===m.length)return void this._showTouchPanBlockerAlert();"hidden"!==this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return n.preventDefault(),this._calculateTransform(n,u,m)}}touchend(n,u,m){this._calculateTransform(n,u,m),this._active&&m.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(n,u,m){m.length>0&&(this._active=!0);const w=ds(m,u),b=new f.pointGeometry(0,0),S=new f.pointGeometry(0,0);let A=0;for(const O in w){const L=w[O],V=this._touches[O];V&&(b._add(L),S._add(L.sub(V)),A++,w[O]=L)}if(this._touches=w,A<this._minTouches||!S.mag())return;const P=S.div(A);return this._sum._add(P),this._sum.mag()<this._clickTolerance?void 0:{around:b.div(A),panDelta:P}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=Rt("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){"hidden"===this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="visible"),this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show")},500)}}class ca{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(n){}_move(n,u,m){return{}}touchstart(n,u,m){this._firstTwoTouches||m.length<2||(this._firstTwoTouches=[m[0].identifier,m[1].identifier],this._start([u[0],u[1]]))}touchmove(n,u,m){const w=this._firstTwoTouches;if(!w)return;n.preventDefault();const[b,S]=w,A=wc(m,u,b),P=wc(m,u,S);if(!A||!P)return;const O=this._aroundCenter?null:A.add(P).div(2);return this._move([A,P],O,n)}touchend(n,u,m){if(!this._firstTwoTouches)return;const[w,b]=this._firstTwoTouches,S=wc(m,u,w),A=wc(m,u,b);S&&A||(this._active&&po(),this.reset())}touchcancel(){this.reset()}enable(n){this._enabled=!0,this._aroundCenter=!!n&&"center"===n.around}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function wc(d,n,u){for(let m=0;m<d.length;m++)if(d[m].identifier===u)return n[m]}function Tu(d,n){return Math.log(d/n)/Math.LN2}class mf extends ca{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(n){this._startDistance=this._distance=n[0].dist(n[1])}_move(n,u){const m=this._distance;if(this._distance=n[0].dist(n[1]),this._active||!(Math.abs(Tu(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Tu(this._distance,m),pinchAround:u}}}function hh(d,n){return 180*d.angleWith(n)/Math.PI}class Eu extends ca{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(n){this._startVector=this._vector=n[0].sub(n[1]),this._minDiameter=n[0].dist(n[1])}_move(n,u){const m=this._vector;if(this._vector=n[0].sub(n[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:hh(this._vector,m),pinchAround:u}}_isBelowThreshold(n){this._minDiameter=Math.min(this._minDiameter,n.mag());const u=25/(Math.PI*this._minDiameter)*360,m=hh(n,this._startVector);return Math.abs(m)<u}}function Cl(d){return Math.abs(d.y)>Math.abs(d.x)}class bc extends ca{constructor(n){super(),this._map=n}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(n){this._lastPoints=n,Cl(n[0].sub(n[1]))&&(this._valid=!1)}_move(n,u,m){const w=this._lastPoints;if(!w)return;const b=n[0].sub(w[0]),S=n[1].sub(w[1]);return this._map._cooperativeGestures&&m.touches.length<3||(this._valid=this.gestureBeginsVertically(b,S,m.timeStamp),!this._valid)?void 0:(this._lastPoints=n,this._active=!0,{pitchDelta:(b.y+S.y)/2*-.5})}gestureBeginsVertically(n,u,m){if(void 0!==this._valid)return this._valid;const w=n.mag()>=2,b=u.mag()>=2;if(!w&&!b)return;if(!w||!b)return null==this._firstMove&&(this._firstMove=m),m-this._firstMove<100&&void 0;const S=n.y>0==u.y>0;return Cl(n)&&Cl(u)&&S}}const tn={panStep:100,bearingStep:15,pitchStep:10};class Il{constructor(){const n=tn;this._panStep=n.panStep,this._bearingStep=n.bearingStep,this._pitchStep=n.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(n){if(n.altKey||n.ctrlKey||n.metaKey)return;let u=0,m=0,w=0,b=0,S=0;switch(n.keyCode){case 61:case 107:case 171:case 187:u=1;break;case 189:case 109:case 173:u=-1;break;case 37:n.shiftKey?m=-1:(n.preventDefault(),b=-1);break;case 39:n.shiftKey?m=1:(n.preventDefault(),b=1);break;case 38:n.shiftKey?w=1:(n.preventDefault(),S=-1);break;case 40:n.shiftKey?w=-1:(n.preventDefault(),S=1);break;default:return}return this._rotationDisabled&&(m=0,w=0),{cameraAnimation:A=>{const P=A.getZoom();A.easeTo({duration:300,easeId:"keyboardHandler",easing:At,zoom:u?Math.round(P)+u*(n.shiftKey?2:1):P,bearing:A.getBearing()+m*this._bearingStep,pitch:A.getPitch()+w*this._pitchStep,offset:[-b*this._panStep,-S*this._panStep],center:A.getCenter()},{originalEvent:n})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function At(d){return d*(2-d)}const Tc=4.000244140625;class _f{constructor(n,u){this._map=n,this._el=n.getCanvasContainer(),this._handler=u,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222,f.bindAll(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert","_isFullscreen"],this)}setZoomRate(n){this._defaultZoomRate=n}setWheelZoomRate(n){this._wheelZoomRate=n}isEnabled(){return!!this._enabled}isActive(){return!!this._active||void 0!==this._finishTimeout}isZooming(){return!!this._zooming}enable(n){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!n&&"center"===n.around,this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(n){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(n.ctrlKey||n.metaKey||this.isZooming()||this._isFullscreen()))return void this._showBlockerAlert();"hidden"!==this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let u=n.deltaMode===f.window.WheelEvent.DOM_DELTA_LINE?40*n.deltaY:n.deltaY;const m=f.exported.now(),w=m-(this._lastWheelEventTime||0);this._lastWheelEventTime=m,0!==u&&u%Tc==0?this._type="wheel":0!==u&&Math.abs(u)<4?this._type="trackpad":w>400?(this._type=null,this._lastValue=u,this._timeout=setTimeout(this._onTimeout,40,n)):this._type||(this._type=Math.abs(w*u)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,u+=this._lastValue)),n.shiftKey&&u&&(u/=4),this._type&&(this._lastWheelEvent=n,this._delta-=u,this._active||this._start(n)),n.preventDefault()}_onTimeout(n){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(n)}_start(n){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const u=Ia(this._el,n);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:u,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const n=this._map.transform,u=()=>n._terrainEnabled()&&this._aroundCoord?n.computeZoomRelativeTo(this._aroundCoord):n.zoom;if(0!==this._delta){const P="wheel"===this._type&&Math.abs(this._delta)>Tc?this._wheelZoomRate:this._defaultZoomRate;let O=2/(1+Math.exp(-Math.abs(this._delta*P)));this._delta<0&&0!==O&&(O=1/O);const L=u(),V=Math.pow(2,L),Y="number"==typeof this._targetZoom?n.zoomScale(this._targetZoom):V;this._targetZoom=Math.min(n.maxZoom,Math.max(n.minZoom,n.scaleZoom(Y*O))),"wheel"===this._type&&(this._startZoom=u(),this._easing=this._smoothOutEasing(200)),this._delta=0}const m="number"==typeof this._targetZoom?this._targetZoom:u(),w=this._startZoom,b=this._easing;let S,A=!1;if("wheel"===this._type&&w&&b){const P=Math.min((f.exported.now()-this._lastWheelEventTime)/200,1),O=b(P);S=f.number(w,m,O),P<1?this._frameId||(this._frameId=!0):A=!0}else S=m,A=!0;return this._active=!0,A&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!A,zoomDelta:S-u(),around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(n){let u=f.ease;if(this._prevEase){const m=this._prevEase,w=(f.exported.now()-m.start)/m.duration,b=m.easing(w+.01)-m.easing(w),S=.27/Math.sqrt(b*b+1e-4)*.01,A=Math.sqrt(.0729-S*S);u=f.bezier(S,A,.25,1)}return this._prevEase={start:f.exported.now(),duration:n,easing:u},u}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=Rt("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(f.window.navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_isFullscreen(){return!!f.window.document.fullscreenElement||!!f.window.document.webkitFullscreenElement}_showBlockerAlert(){"hidden"===this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="visible"),this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show")},200)}}class Su{constructor(n,u){this._clickZoom=n,this._tapZoom=u}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class Ml{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(n,u){return n.preventDefault(),{cameraAnimation:m=>{m.easeTo({duration:300,zoom:m.getZoom()+(n.shiftKey?-1:1),around:m.unproject(u)},{originalEvent:n})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Pi{constructor(){this._tap=new Uo({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(n,u,m){this._swipePoint||(this._tapTime&&n.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?m.length>0&&(this._swipePoint=u[0],this._swipeTouch=m[0].identifier):this._tap.touchstart(n,u,m))}touchmove(n,u,m){if(this._tapTime){if(this._swipePoint){if(m[0].identifier!==this._swipeTouch)return;const w=u[0],b=w.y-this._swipePoint.y;return this._swipePoint=w,n.preventDefault(),this._active=!0,{zoomDelta:b/128}}}else this._tap.touchmove(n,u,m)}touchend(n,u,m){this._tapTime?this._swipePoint&&0===m.length&&this.reset():this._tap.touchend(n,u,m)&&(this._tapTime=n.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class ps{constructor(n,u,m){this._el=n,this._mousePan=u,this._touchPan=m}enable(n){this._inertiaOptions=n||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Qn{constructor(n,u,m){this._pitchWithRotate=n.pitchWithRotate,this._mouseRotate=u,this._mousePitch=m}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class gf{constructor(n,u,m,w){this._el=n,this._touchZoom=u,this._touchRotate=m,this._tapDragZoom=w,this._rotationDisabled=!1,this._enabled=!0}enable(n){this._touchZoom.enable(n),this._rotationDisabled||this._touchRotate.enable(n),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const Ec=d=>d.zoom||d.drag||d.pitch||d.rotate;class Au extends f.Event{}class fh{constructor(){this.constants=[1,1,.01],this.radius=0}setup(n,u){const m=f.sub([],u,n);this.radius=f.length(m[2]<0?f.div([],m,this.constants):[m[0],m[1],0])}projectRay(n){f.div(n,n,this.constants),f.normalize(n,n),f.mul$1(n,n,this.constants);const u=f.scale$2([],n,this.radius);if(u[2]>0){const m=f.scale$2([],[0,0,1],f.dot(u,[0,0,1])),w=f.scale$2([],f.normalize([],[u[0],u[1],0]),this.radius),b=f.add([],u,f.scale$2([],f.sub([],f.add([],w,m),u),2));u[0]=b[0],u[1]=b[1]}return u}}function Vo(d){return d.panDelta&&d.panDelta.mag()||d.zoomDelta||d.bearingDelta||d.pitchDelta}class Sc{constructor(n,u){this._map=n,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Za(n),this._bearingSnap=u.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new fh,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(u),f.bindAll(["handleEvent","handleWindowEvent"],this);const m=this._el;this._listeners=[[m,"touchstart",{passive:!0}],[m,"touchmove",{passive:!1}],[m,"touchend",void 0],[m,"touchcancel",void 0],[m,"mousedown",void 0],[m,"mousemove",void 0],[m,"mouseup",void 0],[f.window.document,"mousemove",{capture:!0}],[f.window.document,"mouseup",void 0],[m,"mouseover",void 0],[m,"mouseout",void 0],[m,"dblclick",void 0],[m,"click",void 0],[m,"keydown",{capture:!1}],[m,"keyup",void 0],[m,"wheel",{passive:!1}],[m,"contextmenu",void 0],[f.window,"blur",void 0]];for(const[w,b,S]of this._listeners)w.addEventListener(b,w===f.window.document?this.handleWindowEvent:this.handleEvent,S)}destroy(){for(const[n,u,m]of this._listeners)n.removeEventListener(u,n===f.window.document?this.handleWindowEvent:this.handleEvent,m)}_addDefaultHandlers(n){const u=this._map,m=u.getCanvasContainer();this._add("mapEvent",new ni(u,n));const w=u.boxZoom=new uh(u,n);this._add("boxZoom",w);const b=new Dt,S=new Ml;u.doubleClickZoom=new Su(S,b),this._add("tapZoom",b),this._add("clickZoom",S);const A=new Pi;this._add("tapDragZoom",A);const P=u.touchPitch=new bc(u);this._add("touchPitch",P);const O=new Zo(n),L=new kl(n);u.dragRotate=new Qn(n,O,L),this._add("mouseRotate",O,["mousePitch"]),this._add("mousePitch",L,["mouseRotate"]);const V=new Al(n),Y=new di(u,n);u.dragPan=new ps(m,V,Y),this._add("mousePan",V),this._add("touchPan",Y,["touchZoom","touchRotate"]);const te=new Eu,J=new mf;u.touchZoomRotate=new gf(m,J,te,A),this._add("touchRotate",te,["touchPan","touchZoom"]),this._add("touchZoom",J,["touchPan","touchRotate"]),this._add("blockableMapEvent",new Ya(u));const H=u.scrollZoom=new _f(u,this);this._add("scrollZoom",H,["mousePan"]);const se=u.keyboard=new Il;this._add("keyboard",se);for(const ie of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])n.interactive&&n[ie]&&u[ie].enable(n[ie])}_add(n,u,m){this._handlers.push({handlerName:n,handler:u,allowed:m}),this._handlersById[n]=u}stop(n){if(!this._updatingCamera){for(const{handler:u}of this._handlers)u.reset();this._inertia.clear(),this._fireEvents({},{},n),this._changes=[]}}isActive(){for(const{handler:n}of this._handlers)if(n.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!Ec(this._eventsInProgress)||this.isZooming()}_blockedByActive(n,u,m){for(const w in n)if(w!==m&&(!u||u.indexOf(w)<0))return!0;return!1}handleWindowEvent(n){this.handleEvent(n,`${n.type}Window`)}_getMapTouches(n){const u=[];for(const m of n)this._el.contains(m.target)&&u.push(m);return u}handleEvent(n,u){this._updatingCamera=!0;const m="renderFrame"===n.type,w=m?void 0:n,b={needsRenderFrame:!1},S={},A={},P=n.touches?this._getMapTouches(n.touches):void 0,O=P?wr(this._el,P):m?void 0:Ia(this._el,n);for(const{handlerName:Y,handler:te,allowed:J}of this._handlers){if(!te.isEnabled())continue;let H;this._blockedByActive(A,J,Y)?te.reset():te[u||n.type]&&(H=te[u||n.type](n,O,P),this.mergeHandlerResult(b,S,H,Y,w),H&&H.needsRenderFrame&&this._triggerRenderFrame()),(H||te.isActive())&&(A[Y]=te)}const L={};for(const Y in this._previousActiveHandlers)A[Y]||(L[Y]=w);this._previousActiveHandlers=A,(Object.keys(L).length||Vo(b))&&(this._changes.push([b,S,L]),this._triggerRenderFrame()),(Object.keys(A).length||Vo(b))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:V}=b;V&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],V(this._map))}mergeHandlerResult(n,u,m,w,b){if(!m)return;f.extend(n,m);const S={handlerName:w,originalEvent:m.originalEvent||b};void 0!==m.zoomDelta&&(u.zoom=S),void 0!==m.panDelta&&(u.drag=S),void 0!==m.pitchDelta&&(u.pitch=S),void 0!==m.bearingDelta&&(u.rotate=S)}_applyChanges(){const n={},u={},m={};for(const[w,b,S]of this._changes)w.panDelta&&(n.panDelta=(n.panDelta||new f.pointGeometry(0,0))._add(w.panDelta)),w.zoomDelta&&(n.zoomDelta=(n.zoomDelta||0)+w.zoomDelta),w.bearingDelta&&(n.bearingDelta=(n.bearingDelta||0)+w.bearingDelta),w.pitchDelta&&(n.pitchDelta=(n.pitchDelta||0)+w.pitchDelta),void 0!==w.around&&(n.around=w.around),void 0!==w.aroundCoord&&(n.aroundCoord=w.aroundCoord),void 0!==w.pinchAround&&(n.pinchAround=w.pinchAround),w.noInertia&&(n.noInertia=w.noInertia),f.extend(u,b),f.extend(m,S);this._updateMapTransform(n,u,m),this._changes=[]}_updateMapTransform(n,u,m){const w=this._map,b=w.transform,S=he=>[he.x,he.y,he.z];if((he=>{const de=this._eventsInProgress.drag;return de&&!this._handlersById[de.handlerName].isActive()})()&&!Vo(n)){const he=b.zoom;b.cameraElevationReference="sea",b.recenterOnTerrain(),b.cameraElevationReference="ground",he!==b.zoom&&this._map._update(!0)}if(!Vo(n))return void this._fireEvents(u,m,!0);let{panDelta:A,zoomDelta:P,bearingDelta:O,pitchDelta:L,around:V,aroundCoord:Y,pinchAround:te}=n;void 0!==te&&(V=te),(he=>u.drag&&!this._eventsInProgress.drag)()&&V&&(this._dragOrigin=S(b.pointCoordinate3D(V)),this._trackingEllipsoid.setup(b._camera.position,this._dragOrigin)),b.cameraElevationReference="sea",w._stop(!0),V=V||w.transform.centerPoint,O&&(b.bearing+=O),L&&(b.pitch+=L),b._updateCameraState();const J=[0,0,0];if(A){const he=b.pointCoordinate(V);if("globe"===b.projection.name){const de=f.latFromMercatorY(he.y),ce=b.center.lat,le=Math.min(f.mercatorZfromAltitude(1,de)/f.mercatorZfromAltitude(1,ce),2);A=A.rotate(-b.angle),J[0]=-A.x/b.worldSize*le,J[1]=-A.y/b.worldSize*le}else{const de=b.pointCoordinate(V.sub(A));he&&de&&(J[0]=de.x-he.x,J[1]=de.y-he.y)}}const H=b.zoom,se=[0,0,0];if(P){const he=S(Y||b.pointCoordinate3D(V)),de={dir:f.normalize([],f.sub([],he,b._camera.position))};if(de.dir[2]<0){const ce=b.zoomDeltaToMovement(he,P);f.scale$2(se,de.dir,ce)}}const ie=f.add(J,J,se);b._translateCameraConstrained(ie),P&&Math.abs(b.zoom-H)>1e-4&&b.recenterOnTerrain(),b.cameraElevationReference="ground",this._map._update(),n.noInertia||this._inertia.record(n),this._fireEvents(u,m,!0)}_fireEvents(n,u,m){const w=Ec(this._eventsInProgress),b=Ec(n),S={};for(const L in n){const{originalEvent:V}=n[L];this._eventsInProgress[L]||(S[`${L}start`]=V),this._eventsInProgress[L]=n[L]}!w&&b&&this._fireEvent("movestart",b.originalEvent);for(const L in S)this._fireEvent(L,S[L]);b&&this._fireEvent("move",b.originalEvent);for(const L in n){const{originalEvent:V}=n[L];this._fireEvent(L,V)}const A={};let P;for(const L in this._eventsInProgress){const{handlerName:V,originalEvent:Y}=this._eventsInProgress[L];this._handlersById[V].isActive()||(delete this._eventsInProgress[L],P=u[V]||Y,A[`${L}end`]=P)}for(const L in A)this._fireEvent(L,A[L]);const O=Ec(this._eventsInProgress);if(m&&(w||b)&&!O){this._updatingCamera=!0;const L=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),V=Y=>0!==Y&&-this._bearingSnap<Y&&Y<this._bearingSnap;L?(V(L.bearing||this._map.getBearing())&&(L.bearing=0),this._map.easeTo(L,{originalEvent:P})):(this._map.fire(new f.Event("moveend",{originalEvent:P})),V(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(n,u){this._map.fire(new f.Event(n,u?{originalEvent:u}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(n=>{this._frameId=void 0,this.handleEvent(new Au("renderFrame",{timeStamp:n})),this._applyChanges()})}_triggerRenderFrame(){void 0===this._frameId&&(this._frameId=this._requestFrame())}}const Ac="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class ku extends f.Evented{constructor(n,u){super(),this._moving=!1,this._zooming=!1,this.transform=n,this._bearingSnap=u.bearingSnap,f.bindAll(["_renderFrameCallback"],this)}getCenter(){return new f.LngLat(this.transform.center.lng,this.transform.center.lat)}setCenter(n,u){return this.jumpTo({center:n},u)}panBy(n,u,m){return n=f.pointGeometry.convert(n).mult(-1),this.panTo(this.transform.center,f.extend({offset:n},u),m)}panTo(n,u,m){return this.easeTo(f.extend({center:n},u),m)}getZoom(){return this.transform.zoom}setZoom(n,u){return this.jumpTo({zoom:n},u),this}zoomTo(n,u,m){return this.easeTo(f.extend({zoom:n},u),m)}zoomIn(n,u){return this.zoomTo(this.getZoom()+1,n,u),this}zoomOut(n,u){return this.zoomTo(this.getZoom()-1,n,u),this}getBearing(){return this.transform.bearing}setBearing(n,u){return this.jumpTo({bearing:n},u),this}getPadding(){return this.transform.padding}setPadding(n,u){return this.jumpTo({padding:n},u),this}rotateTo(n,u,m){return this.easeTo(f.extend({bearing:n},u),m)}resetNorth(n,u){return this.rotateTo(0,f.extend({duration:1e3},n),u),this}resetNorthPitch(n,u){return this.easeTo(f.extend({bearing:0,pitch:0,duration:1e3},n),u),this}snapToNorth(n,u){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(n,u):this}getPitch(){return this.transform.pitch}setPitch(n,u){return this.jumpTo({pitch:n},u),this}cameraForBounds(n,u){n=f.LngLatBounds.convert(n);const m=u&&u.bearing||0;return this._cameraForBoxAndBearing(n.getNorthWest(),n.getSouthEast(),m,u)}_extendCameraOptions(n){const u={top:0,bottom:0,right:0,left:0};if("number"==typeof(n=f.extend({padding:u,offset:[0,0],maxZoom:this.transform.maxZoom},n)).padding){const m=n.padding;n.padding={top:m,bottom:m,right:m,left:m}}return n.padding=f.extend(u,n.padding),n}_cameraForBoxAndBearing(n,u,m,w){const b=this._extendCameraOptions(w),S=this.transform,A=S.padding,P=S.project(f.LngLat.convert(n)),O=S.project(f.LngLat.convert(u)),L=new f.pointGeometry(P.x,O.y),V=new f.pointGeometry(O.x,P.y),Y=-f.degToRad(m),te=P.rotate(Y),J=O.rotate(Y),H=L.rotate(Y),se=V.rotate(Y),ie=new f.pointGeometry(Math.max(te.x,J.x,H.x,se.x),Math.max(te.y,J.y,H.y,se.y)),he=new f.pointGeometry(Math.min(te.x,J.x,H.x,se.x),Math.min(te.y,J.y,H.y,se.y)),de=ie.sub(he),ce=(S.width-((A.left||0)+(A.right||0)+b.padding.left+b.padding.right))/de.x,le=(S.height-((A.top||0)+(A.bottom||0)+b.padding.top+b.padding.bottom))/de.y;if(le<0||ce<0)return void f.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.");const we=Math.min(S.scaleZoom(S.scale*Math.min(ce,le)),b.maxZoom),ze="number"==typeof b.offset.x&&"number"==typeof b.offset.y?new f.pointGeometry(b.offset.x,b.offset.y):f.pointGeometry.convert(b.offset),Be=new f.pointGeometry((b.padding.left-b.padding.right)/2,(b.padding.top-b.padding.bottom)/2).rotate(m*Math.PI/180),Le=ze.add(Be).mult(S.scale/S.zoomScale(we));return{center:S.unproject(P.add(O).div(2).sub(Le)),zoom:we,bearing:m}}_cameraForBox(n,u,m,w,b){const S=this._extendCameraOptions(b);m=m||0,w=w||0,n=f.LngLat.convert(n),u=f.LngLat.convert(u);const A=this.transform.clone();A.padding=S.padding;const P=this.getFreeCameraOptions(),O=new f.LngLat(.5*(n.lng+u.lng),.5*(n.lat+u.lat)),L=.5*(m+w);if(A._camera.position[2]<f.mercatorZfromAltitude(L,O.lat))return void f.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.");P.lookAtPoint(O),A.setFreeCameraOptions(P);const V=f.MercatorCoordinate.fromLngLat(n),Y=f.MercatorCoordinate.fromLngLat(u),te=A.pointRayIntersection(A.centerPoint,L),J=[(H=A.rayIntersectionCoordinate(te)).x,H.y,H.z];var H;const se=A.screenPointToMercatorRay(A.centerPoint),ie="globe"!==A.projection.name;let he,de=0;do{const ce=Math.floor(A.zoom),le=1<<ce,we=Math.min(le*V.x,le*Y.x),ze=Math.min(le*V.y,le*Y.y),Be=Math.max(le*V.x,le*Y.x),Le=Math.max(le*V.y,le*Y.y),qe=new f.Aabb([we,ze,m],[Be,Le,w]),Qe=f.Frustum.fromInvProjectionMatrix(A.invProjMatrix,A.worldSize,ce,ie);if(2!==qe.intersects(Qe)){he&&(A._camera.position=f.scaleAndAdd([],A._camera.position,se.dir,-he),A._updateStateFromCamera());break}const ke=f.sub([],A._camera.position,J);he=.5*f.length(ke),A._camera.position=f.scaleAndAdd([],A._camera.position,se.dir,he);try{A._updateStateFromCamera()}catch(gt){return void f.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.")}}while(++de<10);return{center:A.center,zoom:A.zoom,bearing:A.bearing,pitch:A.pitch}}fitBounds(n,u,m){return this._fitInternal(this.cameraForBounds(n,u),u,m)}_raycastElevationBox(n,u){const m=this.transform.elevation;if(!m)return;const w=new f.pointGeometry(n.x,u.y),b=new f.pointGeometry(u.x,n.y),S=m.pointCoordinate(n);if(!S)return;const A=m.pointCoordinate(u);if(!A)return;const P=m.pointCoordinate(w);if(!P)return;const O=m.pointCoordinate(b);if(!O)return;const L=new f.MercatorCoordinate(S[0],S[1]).toLngLat(),V=new f.MercatorCoordinate(A[0],A[1]).toLngLat(),Y=new f.MercatorCoordinate(P[0],P[1]).toLngLat(),te=new f.MercatorCoordinate(O[0],O[1]).toLngLat(),J=Math.min(L.lng,Math.min(V.lng,Math.min(Y.lng,te.lng))),H=Math.min(L.lat,Math.min(V.lat,Math.min(Y.lat,te.lat))),se=Math.max(L.lng,Math.max(V.lng,Math.max(Y.lng,te.lng))),ie=Math.max(L.lat,Math.max(V.lat,Math.max(Y.lat,te.lat))),he=Math.min(S[3],Math.min(A[3],Math.min(P[3],O[3]))),de=Math.max(S[3],Math.max(A[3],Math.max(P[3],O[3])));return{minLngLat:new f.LngLat(J,H),maxLngLat:new f.LngLat(se,ie),minAltitude:he,maxAltitude:de}}fitScreenCoordinates(n,u,m,w,b){let S,A,P,O;const L=f.pointGeometry.convert(n),V=f.pointGeometry.convert(u),Y=this._raycastElevationBox(L,V);if(Y)S=Y.minLngLat,A=Y.maxLngLat,P=Y.minAltitude,O=Y.maxAltitude;else{if(this.transform.anyCornerOffEdge(L,V))return this;S=this.transform.pointLocation(L),A=this.transform.pointLocation(V)}return this._fitInternal(0===this.transform.pitch?this._cameraForBoxAndBearing(this.transform.pointLocation(f.pointGeometry.convert(n)),this.transform.pointLocation(f.pointGeometry.convert(u)),m,w):this._cameraForBox(S,A,P,O,w),w,b)}_fitInternal(n,u,m){return n?(delete(u=f.extend(n,u)).padding,u.linear?this.easeTo(u,m):this.flyTo(u,m)):this}jumpTo(n,u){this.stop();const m=n.preloadOnly?this.transform.clone():this.transform;let w=!1,b=!1,S=!1;return"zoom"in n&&m.zoom!==+n.zoom&&(w=!0,m.zoom=+n.zoom),void 0!==n.center&&(m.center=f.LngLat.convert(n.center)),"bearing"in n&&m.bearing!==+n.bearing&&(b=!0,m.bearing=+n.bearing),"pitch"in n&&m.pitch!==+n.pitch&&(S=!0,m.pitch=+n.pitch),null==n.padding||m.isPaddingEqual(n.padding)||(m.padding=n.padding),n.preloadOnly?(this._preloadTiles(m),this):(this.fire(new f.Event("movestart",u)).fire(new f.Event("move",u)),w&&this.fire(new f.Event("zoomstart",u)).fire(new f.Event("zoom",u)).fire(new f.Event("zoomend",u)),b&&this.fire(new f.Event("rotatestart",u)).fire(new f.Event("rotate",u)).fire(new f.Event("rotateend",u)),S&&this.fire(new f.Event("pitchstart",u)).fire(new f.Event("pitch",u)).fire(new f.Event("pitchend",u)),this.fire(new f.Event("moveend",u)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||f.warnOnce(Ac),this.transform.getFreeCameraOptions()}setFreeCameraOptions(n,u){const m=this.transform;if(!m.projection.supportsFreeCamera)return f.warnOnce(Ac),this;this.stop();const w=m.zoom,b=m.pitch,S=m.bearing;m.setFreeCameraOptions(n);const A=w!==m.zoom,P=b!==m.pitch,O=S!==m.bearing;return this.fire(new f.Event("movestart",u)).fire(new f.Event("move",u)),A&&this.fire(new f.Event("zoomstart",u)).fire(new f.Event("zoom",u)).fire(new f.Event("zoomend",u)),O&&this.fire(new f.Event("rotatestart",u)).fire(new f.Event("rotate",u)).fire(new f.Event("rotateend",u)),P&&this.fire(new f.Event("pitchstart",u)).fire(new f.Event("pitch",u)).fire(new f.Event("pitchend",u)),this.fire(new f.Event("moveend",u)),this}easeTo(n,u){this._stop(!1,n.easeId),(!1===(n=f.extend({offset:[0,0],duration:500,easing:f.ease},n)).animate||!n.essential&&f.exported.prefersReducedMotion)&&(n.duration=0);const m=this.transform,w=this.getZoom(),b=this.getBearing(),S=this.getPitch(),A=this.getPadding(),P="zoom"in n?+n.zoom:w,O="bearing"in n?this._normalizeBearing(n.bearing,b):b,L="pitch"in n?+n.pitch:S,V="padding"in n?n.padding:m.padding,Y=f.pointGeometry.convert(n.offset);let te,J,H;if("globe"===m.projection.name){const Le=f.MercatorCoordinate.fromLngLat(m.center),qe=Y.rotate(-m.angle);Le.x+=qe.x/m.worldSize,Le.y+=qe.y/m.worldSize;const Qe=Le.toLngLat(),ke=f.LngLat.convert(n.center||Qe);this._normalizeCenter(ke),te=m.centerPoint.add(qe),J=new f.pointGeometry(Le.x,Le.y).mult(m.worldSize),H=new f.pointGeometry(f.mercatorXfromLng(ke.lng),f.mercatorYfromLat(ke.lat)).mult(m.worldSize).sub(J)}else{te=m.centerPoint.add(Y);const Le=m.pointLocation(te),qe=f.LngLat.convert(n.center||Le);this._normalizeCenter(qe),J=m.project(Le),H=m.project(qe).sub(J)}const se=m.zoomScale(P-w);let ie,he;n.around&&(ie=f.LngLat.convert(n.around),he=m.locationPoint(ie));const de=this._zooming||P!==w,ce=this._rotating||b!==O,le=this._pitching||L!==S,we=!m.isPaddingEqual(V),ze=Le=>qe=>{if(de&&(Le.zoom=f.number(w,P,qe)),ce&&(Le.bearing=f.number(b,O,qe)),le&&(Le.pitch=f.number(S,L,qe)),we&&(Le.interpolatePadding(A,V,qe),te=Le.centerPoint.add(Y)),ie)Le.setLocationAtPoint(ie,he);else{const Qe=Le.zoomScale(Le.zoom-w),ke=P>w?Math.min(2,se):Math.max(.5,se),gt=Math.pow(ke,1-qe),dt=Le.unproject(J.add(H.mult(qe*gt)).mult(Qe));Le.setLocationAtPoint(Le.renderWorldCopies?dt.wrap():dt,te)}return n.preloadOnly||this._fireMoveEvents(u),Le};if(n.preloadOnly){const Le=this._emulate(ze,n.duration,m);return this._preloadTiles(Le),this}const Be={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=de,this._rotating=ce,this._pitching=le,this._padding=we,this._easeId=n.easeId,this._prepareEase(u,n.noMoveStart,Be),this._ease(ze(m),Le=>{m.recenterOnTerrain(),this._afterEase(u,Le)},n),this}_prepareEase(n,u,m={}){this._moving=!0,this.transform.cameraElevationReference="sea",u||m.moving||this.fire(new f.Event("movestart",n)),this._zooming&&!m.zooming&&this.fire(new f.Event("zoomstart",n)),this._rotating&&!m.rotating&&this.fire(new f.Event("rotatestart",n)),this._pitching&&!m.pitching&&this.fire(new f.Event("pitchstart",n))}_fireMoveEvents(n){this.fire(new f.Event("move",n)),this._zooming&&this.fire(new f.Event("zoom",n)),this._rotating&&this.fire(new f.Event("rotate",n)),this._pitching&&this.fire(new f.Event("pitch",n))}_afterEase(n,u){if(this._easeId&&u&&this._easeId===u)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const m=this._zooming,w=this._rotating,b=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,m&&this.fire(new f.Event("zoomend",n)),w&&this.fire(new f.Event("rotateend",n)),b&&this.fire(new f.Event("pitchend",n)),this.fire(new f.Event("moveend",n))}flyTo(n,u){if(!n.essential&&f.exported.prefersReducedMotion){const Et=f.pick(n,["center","zoom","bearing","pitch","around"]);return this.jumpTo(Et,u)}this.stop(),n=f.extend({offset:[0,0],speed:1.2,curve:1.42,easing:f.ease},n);const m=this.transform,w=this.getZoom(),b=this.getBearing(),S=this.getPitch(),A=this.getPadding(),P="zoom"in n?f.clamp(+n.zoom,m.minZoom,m.maxZoom):w,O="bearing"in n?this._normalizeBearing(n.bearing,b):b,L="pitch"in n?+n.pitch:S,V="padding"in n?n.padding:m.padding,Y=m.zoomScale(P-w),te=f.pointGeometry.convert(n.offset);let J=m.centerPoint.add(te);const H=m.pointLocation(J),se=f.LngLat.convert(n.center||H);this._normalizeCenter(se);const ie=m.project(H),he=m.project(se).sub(ie);let de=n.curve;const ce=Math.max(m.width,m.height),le=ce/Y,we=he.mag();if("minZoom"in n){const Et=f.clamp(Math.min(n.minZoom,w,P),m.minZoom,m.maxZoom),bt=ce/m.zoomScale(Et-w);de=Math.sqrt(bt/we*2)}const ze=de*de;function Be(Et){const bt=(le*le-ce*ce+(Et?-1:1)*ze*ze*we*we)/(2*(Et?le:ce)*ze*we);return Math.log(Math.sqrt(bt*bt+1)-bt)}function Le(Et){return(Math.exp(Et)-Math.exp(-Et))/2}function qe(Et){return(Math.exp(Et)+Math.exp(-Et))/2}const Qe=Be(0);let ke=function(Et){return qe(Qe)/qe(Qe+de*Et)},gt=function(Et){return ce*((qe(Qe)*(Le(bt=Qe+de*Et)/qe(bt))-Le(Qe))/ze)/we;var bt},dt=(Be(1)-Qe)/de;if(Math.abs(we)<1e-6||!isFinite(dt)){if(Math.abs(ce-le)<1e-6)return this.easeTo(n,u);const Et=le<ce?-1:1;dt=Math.abs(Math.log(le/ce))/de,gt=function(){return 0},ke=function(bt){return Math.exp(Et*de*bt)}}n.duration="duration"in n?+n.duration:1e3*dt/("screenSpeed"in n?+n.screenSpeed/de:+n.speed),n.maxDuration&&n.duration>n.maxDuration&&(n.duration=0);const It=b!==O,et=L!==S,Mt=!m.isPaddingEqual(V),Jt=Et=>bt=>{const Ot=bt*dt,fr=1/ke(Ot);Et.zoom=1===bt?P:w+Et.scaleZoom(fr),It&&(Et.bearing=f.number(b,O,bt)),et&&(Et.pitch=f.number(S,L,bt)),Mt&&(Et.interpolatePadding(A,V,bt),J=Et.centerPoint.add(te));const Ht=1===bt?se:Et.unproject(ie.add(he.mult(gt(Ot))).mult(fr));return Et.setLocationAtPoint(Et.renderWorldCopies?Ht.wrap():Ht,J),Et._updateCameraOnTerrain(),n.preloadOnly||this._fireMoveEvents(u),Et};if(n.preloadOnly){const Et=this._emulate(Jt,n.duration,m);return this._preloadTiles(Et),this}return this._zooming=!0,this._rotating=It,this._pitching=et,this._padding=Mt,this._prepareEase(u,!1),this._ease(Jt(m),()=>this._afterEase(u),n),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(n,u){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const m=this._onEaseEnd;this._onEaseEnd=void 0,m.call(this,u)}if(!n){const m=this.handlers;m&&m.stop(!1)}return this}_ease(n,u,m){!1===m.animate||0===m.duration?(n(1),u()):(this._easeStart=f.exported.now(),this._easeOptions=m,this._onEaseFrame=n,this._onEaseEnd=u,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const n=Math.min((f.exported.now()-this._easeStart)/this._easeOptions.duration,1),u=this._onEaseFrame;u&&u(this._easeOptions.easing(n)),n<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(n,u){n=f.wrap(n,-180,180);const m=Math.abs(n-u);return Math.abs(n-360-u)<m&&(n-=360),Math.abs(n+360-u)<m&&(n+=360),n}_normalizeCenter(n){const u=this.transform;if(!u.renderWorldCopies||u.maxBounds)return;const m=n.lng-u.center.lng;n.lng+=m>180?-360:m<-180?360:0}_emulate(n,u,m){const w=Math.ceil(15*u/1e3),b=[],S=n(m.clone());for(let A=0;A<=w;A++){const P=S(A/w);b.push(P.clone())}return b}}class kc{constructor(n={}){this.options=n,f.bindAll(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(n){const u=this.options&&this.options.compact;return this._map=n,this._container=Rt("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=Rt("button","mapboxgl-ctrl-attrib-button",this._container),Rt("span","mapboxgl-ctrl-icon",this._compactButton).setAttribute("aria-hidden","true"),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=Rt("div","mapboxgl-ctrl-attrib-inner",this._container),this._innerContainer.setAttribute("role","list"),u&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),void 0===u&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_setElementTitle(n,u){const m=this._map._getUIString(`AttributionControl.${u}`);n.setAttribute("aria-label",m),n.removeAttribute("title"),n.firstElementChild&&n.firstElementChild.setAttribute("title",m)}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let n=this._editLink;n||(n=this._editLink=this._container.querySelector(".mapbox-improve-map"));const u=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||f.config.ACCESS_TOKEN}];if(n){const m=u.reduce((w,b,S)=>(b.value&&(w+=`${b.key}=${b.value}${S<u.length-1?"&":""}`),w),"?");n.href=`${f.config.FEEDBACK_URL}/${m}${this._map._hash?this._map._hash.getHashString(!0):""}`,n.rel="noopener nofollow",this._setElementTitle(n,"MapFeedback")}}_updateData(n){!n||"metadata"!==n.sourceDataType&&"visibility"!==n.sourceDataType&&"style"!==n.dataType||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let n=[];if(this._map.style.stylesheet){const w=this._map.style.stylesheet;this.styleOwner=w.owner,this.styleId=w.id}const u=this._map.style._sourceCaches;for(const w in u){const b=u[w];if(b.used){const S=b.getSource();S.attribution&&n.indexOf(S.attribution)<0&&n.push(S.attribution)}}n.sort((w,b)=>w.length-b.length),n=n.filter((w,b)=>{for(let S=b+1;S<n.length;S++)if(n[S].indexOf(w)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?n=[...this.options.customAttribution,...n]:n.unshift(this.options.customAttribution));const m=n.join(" | ");m!==this._attribHTML&&(this._attribHTML=m,n.length?(this._innerContainer.innerHTML=m,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class jo{constructor(){f.bindAll(["_updateLogo","_updateCompact"],this)}onAdd(n){this._map=n,this._container=Rt("div","mapboxgl-ctrl");const u=Rt("a","mapboxgl-ctrl-logo");return u.target="_blank",u.rel="noopener nofollow",u.href="https://www.mapbox.com/",u.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),u.setAttribute("rel","noopener nofollow"),this._container.appendChild(u),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(n){n&&"metadata"!==n.sourceDataType||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const n=this._map.style._sourceCaches;if(0===Object.entries(n).length)return!0;for(const u in n){const m=n[u].getSource();if(m.hasOwnProperty("mapbox_logo")&&!m.mapbox_logo)return!1}return!0}_updateCompact(){const n=this._container.children;if(n.length){const u=n[0];this._map.getCanvasContainer().offsetWidth<250?u.classList.add("mapboxgl-compact"):u.classList.remove("mapboxgl-compact")}}}class dh{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(n){const u=++this._id;return this._queue.push({callback:n,id:u,cancelled:!1}),u}remove(n){const u=this._currentlyRunning,m=u?this._queue.concat(u):this._queue;for(const w of m)if(w.id===n)return void(w.cancelled=!0)}run(n=0){const u=this._currentlyRunning=this._queue;this._queue=[];for(const m of u)if(!m.cancelled&&(m.callback(n),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}function Fl(d,n,u){if(d=new f.LngLat(d.lng,d.lat),n){const m=new f.LngLat(d.lng-360,d.lat),w=new f.LngLat(d.lng+360,d.lat),b=360*Math.ceil(Math.abs(d.lng-u.center.lng)/360),S=u.locationPoint(d).distSqr(n),A=n.x<0||n.y<0||n.x>u.width||n.y>u.height;u.locationPoint(m).distSqr(n)<S&&(A||Math.abs(m.lng-u.center.lng)<b)?d=m:u.locationPoint(w).distSqr(n)<S&&(A||Math.abs(w.lng-u.center.lng)<b)&&(d=w)}for(;Math.abs(d.lng-u.center.lng)>180;){const m=u.locationPoint(d);if(m.x>=0&&m.y>=0&&m.x<=u.width&&m.y<=u.height)break;d.lng>u.center.lng?d.lng-=360:d.lng+=360}return d}const Cc={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};class Dl extends f.Evented{constructor(n,u){if(super(),(n instanceof f.window.HTMLElement||u)&&(n=f.extend({element:n},u)),f.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),this._anchor=n&&n.anchor||"center",this._color=n&&n.color||"#3FB1CE",this._scale=n&&n.scale||1,this._draggable=n&&n.draggable||!1,this._clickTolerance=n&&n.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=n&&n.rotation||0,this._rotationAlignment=n&&n.rotationAlignment||"auto",this._pitchAlignment=n&&n.pitchAlignment&&"auto"!==n.pitchAlignment?n.pitchAlignment:this._rotationAlignment,this._updateMoving=()=>this._update(!0),n&&n.element)this._element=n.element,this._offset=f.pointGeometry.convert(n&&n.offset||[0,0]);else{this._defaultMarker=!0,this._element=Rt("div");const w=41,b=27,S=Zt("svg",{display:"block",height:w*this._scale+"px",width:b*this._scale+"px",viewBox:`0 0 ${b} ${w}`},this._element),A=Zt("radialGradient",{id:"shadowGradient"},Zt("defs",{},S));Zt("stop",{offset:"10%","stop-opacity":.4},A),Zt("stop",{offset:"100%","stop-opacity":.05},A),Zt("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},S),Zt("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},S),Zt("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},S),Zt("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},S),this._offset=f.pointGeometry.convert(n&&n.offset||[0,-14])}this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",w=>{w.preventDefault()}),this._element.addEventListener("mousedown",w=>{w.preventDefault()});const m=this._element.classList;for(const w in Cc)m.remove(`mapboxgl-marker-anchor-${w}`);m.add(`mapboxgl-marker-anchor-${this._anchor}`),this._popup=null}addTo(n){return n===this._map||(this.remove(),this._map=n,n.getCanvasContainer().appendChild(this._element),n.on("move",this._updateMoving),n.on("moveend",this._update),n.on("remove",this._clearFadeTimer),n._addMarker(this),this.setDraggable(this._draggable),this._update(),n.on("click",this._onMapClick)),this}remove(){const n=this._map;return n&&(n.off("click",this._onMapClick),n.off("move",this._updateMoving),n.off("moveend",this._update),n.off("mousedown",this._addDragHandler),n.off("touchstart",this._addDragHandler),n.off("mouseup",this._onUp),n.off("touchend",this._onUp),n.off("mousemove",this._onMove),n.off("touchmove",this._onMove),n.off("remove",this._clearFadeTimer),n._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(n){return this._lngLat=f.LngLat.convert(n),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}getElement(){return this._element}setPopup(n){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),n){if(!("offset"in n.options)){const w=Math.sqrt(Math.pow(13.5,2)/2);n.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[w,-1*(24.6+w)],"bottom-right":[-w,-1*(24.6+w)],left:[13.5,-24.6],right:[-13.5,-24.6]}:this._offset}this._popup=n,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(n){const u=n.code,m=n.charCode||n.keyCode;"Space"!==u&&"Enter"!==u&&32!==m&&13!==m||this.togglePopup()}_onMapClick(n){const u=n.originalEvent.target,m=this._element;this._popup&&(u===m||m.contains(u))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const n=this._popup;return n?(n.isOpen()?(n.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(n.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_evaluateOpacity(){const n=this._map;if(!n)return;const u=this._pos;if(!u||u.x<0||u.x>n.transform.width||u.y<0||u.y>n.transform.height)return void this._clearFadeTimer();const m=n.unproject(u);let w=!1;if(n.transform._terrainEnabled()&&n.getTerrain()){const S=n.getFreeCameraOptions();if(S.position){const A=S.position.toLngLat();w=A.distanceTo(m)<.9*A.distanceTo(this._lngLat)}}const b=(1-n._queryFogOpacity(m))*(w?.2:1);this._element.style.opacity=`${b}`,this._popup&&this._popup._setOpacity(`${b}`),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const n=this._pos;if(!n)return;const u=this._offset.mult(this._scale),m=this._calculatePitch(),w=this._calculateRotation();this._element.style.transform=`\n            translate(${n.x}px, ${n.y}px) ${Cc[this._anchor]}\n            rotateX(${m}deg) rotateZ(${w}deg)\n            translate(${u.x}px, ${u.y}px)\n        `}_calculatePitch(){return"viewport"===this._pitchAlignment||"auto"===this._pitchAlignment?0:this._map&&"map"===this._pitchAlignment?this._map.getPitch():0}_calculateRotation(){return"viewport"===this._rotationAlignment||"auto"===this._rotationAlignment?this._rotation:this._map&&"map"===this._rotationAlignment?this._rotation-this._map.getBearing():0}_update(n){f.window.cancelAnimationFrame(this._updateFrameId);const u=this._map;u&&(u.transform.renderWorldCopies&&(this._lngLat=Fl(this._lngLat,this._pos,u.transform)),this._pos=u.project(this._lngLat),!0===n?this._updateFrameId=f.window.requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),u._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),!u.getTerrain()&&!u.getFog()||this._fadeTimer||(this._fadeTimer=setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(n){return this._offset=f.pointGeometry.convert(n),this._update(),this}_onMove(n){const u=this._map;if(u){if(!this._isDragging){const m=this._clickTolerance||u._clickTolerance;this._isDragging=n.point.dist(this._pointerdownPos)>=m}this._isDragging&&(this._pos=n.point.sub(this._positionDelta),this._lngLat=u.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none","pending"===this._state&&(this._state="active",this.fire(new f.Event("dragstart"))),this.fire(new f.Event("drag")))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const n=this._map;n&&(n.off("mousemove",this._onMove),n.off("touchmove",this._onMove)),"active"===this._state&&this.fire(new f.Event("dragend")),this._state="inactive"}_addDragHandler(n){const u=this._map;u&&this._element.contains(n.originalEvent.target)&&(n.preventDefault(),this._positionDelta=n.point.sub(this._pos),this._pointerdownPos=n.point,this._state="pending",u.on("mousemove",this._onMove),u.on("touchmove",this._onMove),u.once("mouseup",this._onUp),u.once("touchend",this._onUp))}setDraggable(n){this._draggable=!!n;const u=this._map;return u&&(n?(u.on("mousedown",this._addDragHandler),u.on("touchstart",this._addDragHandler)):(u.off("mousedown",this._addDragHandler),u.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(n){return this._rotation=n||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(n){return this._rotationAlignment=n||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(n){return this._pitchAlignment=n&&"auto"!==n?n:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}}class xf{constructor(n){this.jumpTo(n)}getValue(n){if(n<=this._startTime)return this._start;if(n>=this._endTime)return this._end;const u=f.easeCubicInOut((n-this._startTime)/(this._endTime-this._startTime));return this._start*(1-u)+this._end*u}isEasing(n){return n>=this._startTime&&n<=this._endTime}jumpTo(n){this._startTime=-1/0,this._endTime=-1/0,this._start=n,this._end=n}easeTo(n,u,m){this._start=this.getValue(u),this._end=n,this._startTime=u,this._endTime=u+m}}const ph={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use \u2318 + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"},Cu={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,optimizeForTerrain:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,crossSourceCollisions:!0};function qo(d){d.parentNode&&d.parentNode.removeChild(d)}const Iu={showCompass:!0,showZoom:!0,visualizePitch:!1};class Ic{constructor(n,u,m=!1){this._clickTolerance=10,this.element=u,this.mouseRotate=new Zo({clickTolerance:n.dragRotate._mouseRotate._clickTolerance}),this.map=n,m&&(this.mousePitch=new kl({clickTolerance:n.dragRotate._mousePitch._clickTolerance})),f.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),u.addEventListener("mousedown",this.mousedown),u.addEventListener("touchstart",this.touchstart,{passive:!1}),u.addEventListener("touchmove",this.touchmove),u.addEventListener("touchend",this.touchend),u.addEventListener("touchcancel",this.reset)}down(n,u){this.mouseRotate.mousedown(n,u),this.mousePitch&&this.mousePitch.mousedown(n,u),Gn()}move(n,u){const m=this.map,w=this.mouseRotate.mousemoveWindow(n,u),b=w&&w.bearingDelta;if(b&&m.setBearing(m.getBearing()+b),this.mousePitch){const S=this.mousePitch.mousemoveWindow(n,u),A=S&&S.pitchDelta;A&&m.setPitch(m.getPitch()+A)}}off(){const n=this.element;n.removeEventListener("mousedown",this.mousedown),n.removeEventListener("touchstart",this.touchstart,{passive:!1}),n.removeEventListener("touchmove",this.touchmove),n.removeEventListener("touchend",this.touchend),n.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){ho(),f.window.removeEventListener("mousemove",this.mousemove),f.window.removeEventListener("mouseup",this.mouseup)}mousedown(n){this.down(f.extend({},n,{ctrlKey:!0,preventDefault:()=>n.preventDefault()}),Ia(this.element,n)),f.window.addEventListener("mousemove",this.mousemove),f.window.addEventListener("mouseup",this.mouseup)}mousemove(n){this.move(n,Ia(this.element,n))}mouseup(n){this.mouseRotate.mouseupWindow(n),this.mousePitch&&this.mousePitch.mouseupWindow(n),this.offTemp()}touchstart(n){1!==n.targetTouches.length?this.reset():(this._startPos=this._lastPos=wr(this.element,n.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>n.preventDefault()},this._startPos))}touchmove(n){1!==n.targetTouches.length?this.reset():(this._lastPos=wr(this.element,n.targetTouches)[0],this.move({preventDefault:()=>n.preventDefault()},this._lastPos))}touchend(n){0===n.targetTouches.length&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}const Ln={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1};let bn,Go=0,Hs=!1;const Ys={maxWidth:100,unit:"metric"};function xa(d,n,u){const m=u&&u.maxWidth||100,w=d._containerHeight/2,b=d._containerWidth/2-m/2,S=d.unproject([b,w]),A=d.unproject([b+m,w]),P=S.distanceTo(A);if(u&&"imperial"===u.unit){const O=3.2808*P;O>5280?Pl(n,m,O/5280,d._getUIString("ScaleControl.Miles"),d):Pl(n,m,O,d._getUIString("ScaleControl.Feet"),d)}else u&&"nautical"===u.unit?Pl(n,m,P/1852,d._getUIString("ScaleControl.NauticalMiles"),d):P>=1e3?Pl(n,m,P/1e3,d._getUIString("ScaleControl.Kilometers"),d):Pl(n,m,P,d._getUIString("ScaleControl.Meters"),d)}function Pl(d,n,u,m,w){const b=function(A){const P=Math.pow(10,`${Math.floor(A)}`.length-1);let O=A/P;return O=O>=10?10:O>=5?5:O>=3?3:O>=2?2:O>=1?1:function(L){const V=Math.pow(10,Math.ceil(-Math.log(L)/Math.LN10));return Math.round(L*V)/V}(O),P*O}(u),S=b/u;w._requestDomTask(()=>{d.style.width=n*S+"px",d.innerHTML=`${b}&nbsp;${m}`})}const ai={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},qr=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function Mc(d=new f.pointGeometry(0,0),n="bottom"){if("number"==typeof d){const u=Math.round(Math.sqrt(.5*Math.pow(d,2)));switch(n){case"top":return new f.pointGeometry(0,d);case"top-left":return new f.pointGeometry(u,u);case"top-right":return new f.pointGeometry(-u,u);case"bottom":return new f.pointGeometry(0,-d);case"bottom-left":return new f.pointGeometry(u,-u);case"bottom-right":return new f.pointGeometry(-u,-u);case"left":return new f.pointGeometry(d,0);case"right":return new f.pointGeometry(-d,0)}return new f.pointGeometry(0,0)}return d instanceof f.pointGeometry||Array.isArray(d)?f.pointGeometry.convert(d):f.pointGeometry.convert(d[n]||[0,0])}const Ja={version:f.version,supported:_,setRTLTextPlugin:f.setRTLTextPlugin,getRTLTextPluginStatus:f.getRTLTextPluginStatus,Map:class extends ku{constructor(d){if(null!=(d=f.extend({},Cu,d)).minZoom&&null!=d.maxZoom&&d.minZoom>d.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(null!=d.minPitch&&null!=d.maxPitch&&d.minPitch>d.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(null!=d.minPitch&&d.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(null!=d.maxPitch&&d.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(d.antialias&&f.isSafariWithAntialiasingBug(f.window)&&(d.antialias=!1,f.warnOnce("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new xi(d.minZoom,d.maxZoom,d.minPitch,d.maxPitch,d.renderWorldCopies),d),this._interactive=d.interactive,this._minTileCacheSize=d.minTileCacheSize,this._maxTileCacheSize=d.maxTileCacheSize,this._failIfMajorPerformanceCaveat=d.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=d.preserveDrawingBuffer,this._antialias=d.antialias,this._trackResize=d.trackResize,this._bearingSnap=d.bearingSnap,this._refreshExpiredTiles=d.refreshExpiredTiles,this._fadeDuration=d.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=d.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=d.collectResourceTiming,this._optimizeForTerrain=d.optimizeForTerrain,this._renderTaskQueue=new dh,this._domRenderTaskQueue=new dh,this._controls=[],this._markers=[],this._mapId=f.uniqueId(),this._locale=f.extend({},ph,d.locale),this._clickTolerance=d.clickTolerance,this._cooperativeGestures=d.cooperativeGestures,this._containerWidth=0,this._containerHeight=0,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new xf(0),this._explicitProjection=null,this._requestManager=new f.RequestManager(d.transformRequest,d.accessToken,d.testMode),this._silenceAuthErrors=!!d.testMode,"string"==typeof d.container){if(this._container=f.window.document.getElementById(d.container),!this._container)throw new Error(`Container '${d.container}' not found.`)}else{if(!(d.container instanceof f.window.HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=d.container}if(this._container.childNodes.length>0&&f.warnOnce("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),d.maxBounds&&this.setMaxBounds(d.maxBounds),f.bindAll(["_onWindowOnline","_onWindowResize","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),void 0===this.painter)throw new Error("Failed to initialize WebGL.");this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),void 0!==f.window&&(f.window.addEventListener("online",this._onWindowOnline,!1),f.window.addEventListener("resize",this._onWindowResize,!1),f.window.addEventListener("orientationchange",this._onWindowResize,!1),f.window.addEventListener("webkitfullscreenchange",this._onWindowResize,!1)),this.handlers=new Sc(this,d),this._localFontFamily=d.localFontFamily,this._localIdeographFontFamily=d.localIdeographFontFamily,d.style&&this.setStyle(d.style,{localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),d.projection&&this.setProjection(d.projection),this._hash=d.hash&&new ch("string"==typeof d.hash&&d.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:d.center,zoom:d.zoom,bearing:d.bearing,pitch:d.pitch}),d.bounds&&(this.resize(),this.fitBounds(d.bounds,f.extend({},d.fitBoundsOptions,{duration:0})))),this.resize(),d.attributionControl&&this.addControl(new kc({customAttribution:d.customAttribution})),this._logoControl=new jo,this.addControl(this._logoControl,d.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",n=>{this._update("style"===n.dataType),this.fire(new f.Event(`${n.dataType}data`,n))}),this.on("dataloading",n=>{this.fire(new f.Event(`${n.dataType}dataloading`,n))})}_getMapId(){return this._mapId}addControl(d,n){if(void 0===n&&(n=d.getDefaultPosition?d.getDefaultPosition():"top-right"),!d||!d.onAdd)return this.fire(new f.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const u=d.onAdd(this);this._controls.push(d);const m=this._controlPositions[n];return-1!==n.indexOf("bottom")?m.insertBefore(u,m.firstChild):m.appendChild(u),this}removeControl(d){if(!d||!d.onRemove)return this.fire(new f.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const n=this._controls.indexOf(d);return n>-1&&this._controls.splice(n,1),d.onRemove(this),this}hasControl(d){return this._controls.indexOf(d)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(d){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const n=!this._moving;return n&&this.fire(new f.Event("movestart",d)).fire(new f.Event("move",d)),this.fire(new f.Event("resize",d)),n&&this.fire(new f.Event("moveend",d)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(d){return this.transform.setMaxBounds(f.LngLatBounds.convert(d)),this._update()}setMinZoom(d){if((d=null==d?-2:d)>=-2&&d<=this.transform.maxZoom)return this.transform.minZoom=d,this._update(),this.getZoom()<d?this.setZoom(d):this.fire(new f.Event("zoomstart")).fire(new f.Event("zoom")).fire(new f.Event("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(d){if((d=null==d?22:d)>=this.transform.minZoom)return this.transform.maxZoom=d,this._update(),this.getZoom()>d?this.setZoom(d):this.fire(new f.Event("zoomstart")).fire(new f.Event("zoom")).fire(new f.Event("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(d){if((d=null==d?0:d)<0)throw new Error("minPitch must be greater than or equal to 0");if(d>=0&&d<=this.transform.maxPitch)return this.transform.minPitch=d,this._update(),this.getPitch()<d?this.setPitch(d):this.fire(new f.Event("pitchstart")).fire(new f.Event("pitch")).fire(new f.Event("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(d){if((d=null==d?85:d)>85)throw new Error("maxPitch must be less than or equal to 85");if(d>=this.transform.minPitch)return this.transform.maxPitch=d,this._update(),this.getPitch()>d?this.setPitch(d):this.fire(new f.Event("pitchstart")).fire(new f.Event("pitch")).fire(new f.Event("pitchend")),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(d){return this.transform.renderWorldCopies=d,this._update()}getProjection(){return this._explicitProjection?this._explicitProjection:this.style&&this.style.stylesheet&&this.style.stylesheet.projection?this.style.stylesheet.projection:{name:"mercator",center:[0,0]}}setProjection(d){return this._lazyInitEmptyStyle(),d?"string"==typeof d&&(d={name:d}):d=null,this._updateProjection(d)}_updateProjection(d){null===d&&(this._explicitProjection=null);const n=d||this.getProjection(),u=this.transform.setProjection(n);if(d&&(this._explicitProjection=this.transform.getProjection()),u){this.painter.clearBackgroundTiles();for(const m in this.style._sourceCaches)this.style._sourceCaches[m].clearTiles();this.style.applyProjectionUpdate(),this._update(!0)}return this}project(d){return this.transform.locationPoint3D(f.LngLat.convert(d))}unproject(d){return this.transform.pointLocation3D(f.pointGeometry.convert(d))}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_createDelegatedListener(d,n,u){if("mouseenter"===d||"mouseover"===d){let m=!1;const w=S=>{const A=n.filter(O=>this.getLayer(O)),P=A.length?this.queryRenderedFeatures(S.point,{layers:A}):[];P.length?m||(m=!0,u.call(this,new Sr(d,this,S.originalEvent,{features:P}))):m=!1},b=()=>{m=!1};return{layers:new Set(n),listener:u,delegates:{mousemove:w,mouseout:b}}}if("mouseleave"===d||"mouseout"===d){let m=!1;const w=S=>{const A=n.filter(P=>this.getLayer(P));(A.length?this.queryRenderedFeatures(S.point,{layers:A}):[]).length?m=!0:m&&(m=!1,u.call(this,new Sr(d,this,S.originalEvent)))},b=S=>{m&&(m=!1,u.call(this,new Sr(d,this,S.originalEvent)))};return{layers:new Set(n),listener:u,delegates:{mousemove:w,mouseout:b}}}{const m=w=>{const b=n.filter(A=>this.getLayer(A)),S=b.length?this.queryRenderedFeatures(w.point,{layers:b}):[];S.length&&(w.features=S,u.call(this,w),delete w.features)};return{layers:new Set(n),listener:u,delegates:{[d]:m}}}}on(d,n,u){if(void 0===u)return super.on(d,n);Array.isArray(n)||(n=[n]);const m=this._createDelegatedListener(d,n,u);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[d]=this._delegatedListeners[d]||[],this._delegatedListeners[d].push(m);for(const w in m.delegates)this.on(w,m.delegates[w]);return this}once(d,n,u){if(void 0===u)return super.once(d,n);Array.isArray(n)||(n=[n]);const m=this._createDelegatedListener(d,n,u);for(const w in m.delegates)this.once(w,m.delegates[w]);return this}off(d,n,u){if(void 0===u)return super.off(d,n);n=new Set(Array.isArray(n)?n:[n]);const m=(b,S)=>{if(b.size!==S.size)return!1;for(const A of b)if(!S.has(A))return!1;return!0},w=this._delegatedListeners?this._delegatedListeners[d]:void 0;return w&&(b=>{for(let S=0;S<b.length;S++){const A=b[S];if(A.listener===u&&m(A.layers,n)){for(const P in A.delegates)this.off(P,A.delegates[P]);return b.splice(S,1),this}}})(w),this}queryRenderedFeatures(d,n){return this.style?(void 0!==n||void 0===d||d instanceof f.pointGeometry||Array.isArray(d)||(n=d,d=void 0),this.style.queryRenderedFeatures(d=d||[[0,0],[this.transform.width,this.transform.height]],n=n||{},this.transform)):[]}querySourceFeatures(d,n){return this.style.querySourceFeatures(d,n)}queryTerrainElevation(d,n){const u=this.transform.elevation;return u?(n=f.extend({},{exaggerated:!0},n),u.getAtPoint(f.MercatorCoordinate.fromLngLat(d),null,n.exaggerated)):null}setStyle(d,n){return!1!==(n=f.extend({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},n)).diff&&n.localIdeographFontFamily===this._localIdeographFontFamily&&n.localFontFamily===this._localFontFamily&&this.style&&d?(this._diffStyle(d,n),this):(this._localIdeographFontFamily=n.localIdeographFontFamily,this._localFontFamily=n.localFontFamily,this._updateStyle(d,n))}_getUIString(d){const n=this._locale[d];if(null==n)throw new Error(`Missing UI string '${d}'`);return n}_updateStyle(d,n){return this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),d&&(this.style=new Hn(this,n||{}),this.style.setEventedParent(this,{style:this.style}),"string"==typeof d?this.style.loadURL(d):this.style.loadJSON(d)),this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new Hn(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(d,n){if("string"==typeof d){const u=this._requestManager.normalizeStyleURL(d),m=this._requestManager.transformRequest(u,f.ResourceType.Style);f.getJSON(m,(w,b)=>{w?this.fire(new f.ErrorEvent(w)):b&&this._updateDiff(b,n)})}else"object"==typeof d&&this._updateDiff(d,n)}_updateDiff(d,n){try{this.style.setState(d)&&this._update(!0)}catch(u){f.warnOnce(`Unable to perform style diff: ${u.message||u.error||u}.  Rebuilding the style from scratch.`),this._updateStyle(d,n)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(f.warnOnce("There is no style added to the map."),!1)}addSource(d,n){return this._lazyInitEmptyStyle(),this.style.addSource(d,n),this._update(!0)}isSourceLoaded(d){return!!this.style&&this.style._isSourceCacheLoaded(d)}areTilesLoaded(){const d=this.style&&this.style._sourceCaches;for(const n in d){const u=d[n]._tiles;for(const m in u){const w=u[m];if("loaded"!==w.state&&"errored"!==w.state)return!1}}return!0}addSourceType(d,n,u){this._lazyInitEmptyStyle(),this.style.addSourceType(d,n,u)}removeSource(d){return this.style.removeSource(d),this._updateTerrain(),this._update(!0)}getSource(d){return this.style.getSource(d)}addImage(d,n,{pixelRatio:u=1,sdf:m=!1,stretchX:w,stretchY:b,content:S}={}){if(this._lazyInitEmptyStyle(),n instanceof f.window.HTMLImageElement||f.window.ImageBitmap&&n instanceof f.window.ImageBitmap){const{width:A,height:P,data:O}=f.exported.getImageData(n);this.style.addImage(d,{data:new f.RGBAImage({width:A,height:P},O),pixelRatio:u,stretchX:w,stretchY:b,content:S,sdf:m,version:0})}else if(void 0===n.width||void 0===n.height)this.fire(new f.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:A,height:P}=n,O=n;this.style.addImage(d,{data:new f.RGBAImage({width:A,height:P},new Uint8Array(O.data)),pixelRatio:u,stretchX:w,stretchY:b,content:S,sdf:m,version:0,userImage:O}),O.onAdd&&O.onAdd(this,d)}}updateImage(d,n){const u=this.style.getImage(d);if(!u)return void this.fire(new f.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const m=n instanceof f.window.HTMLImageElement||f.window.ImageBitmap&&n instanceof f.window.ImageBitmap?f.exported.getImageData(n):n,{width:w,height:b}=m;void 0!==w&&void 0!==b?w===u.data.width&&b===u.data.height?(u.data.replace(m.data,!(n instanceof f.window.HTMLImageElement||f.window.ImageBitmap&&n instanceof f.window.ImageBitmap)),this.style.updateImage(d,u)):this.fire(new f.ErrorEvent(new Error("The width and height of the updated image must be that same as the previous version of the image"))):this.fire(new f.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")))}hasImage(d){return d?!!this.style.getImage(d):(this.fire(new f.ErrorEvent(new Error("Missing required image id"))),!1)}removeImage(d){this.style.removeImage(d)}loadImage(d,n){f.getImage(this._requestManager.transformRequest(d,f.ResourceType.Image),(u,m)=>{n(u,m instanceof f.window.HTMLImageElement?f.exported.getImageData(m):m)})}listImages(){return this.style.listImages()}addLayer(d,n){return this._lazyInitEmptyStyle(),this.style.addLayer(d,n),this._update(!0)}moveLayer(d,n){return this.style.moveLayer(d,n),this._update(!0)}removeLayer(d){return this.style.removeLayer(d),this._update(!0)}getLayer(d){return this.style.getLayer(d)}setLayerZoomRange(d,n,u){return this.style.setLayerZoomRange(d,n,u),this._update(!0)}setFilter(d,n,u={}){return this.style.setFilter(d,n,u),this._update(!0)}getFilter(d){return this.style.getFilter(d)}setPaintProperty(d,n,u,m={}){return this.style.setPaintProperty(d,n,u,m),this._update(!0)}getPaintProperty(d,n){return this.style.getPaintProperty(d,n)}setLayoutProperty(d,n,u,m={}){return this.style.setLayoutProperty(d,n,u,m),this._update(!0)}getLayoutProperty(d,n){return this.style.getLayoutProperty(d,n)}setLight(d,n={}){return this._lazyInitEmptyStyle(),this.style.setLight(d,n),this._update(!0)}getLight(){return this.style.getLight()}setTerrain(d){return this._lazyInitEmptyStyle(),!d&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(d),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(d){return this._lazyInitEmptyStyle(),this.style.setFog(d),this._update(!0)}getFog(){return this.style?this.style.getFog():null}_queryFogOpacity(d){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(f.LngLat.convert(d),this.transform):0}setFeatureState(d,n){return this.style.setFeatureState(d,n),this._update()}removeFeatureState(d,n){return this.style.removeFeatureState(d,n),this._update()}getFeatureState(d){return this.style.getFeatureState(d)}_updateContainerDimensions(){if(!this._container)return;const d=this._container.getBoundingClientRect().width||400,n=this._container.getBoundingClientRect().height||300;let u,m,w,b=this._container;for(;b&&(!m||!w);){const S=f.window.getComputedStyle(b).transform;S&&"none"!==S&&(u=S.match(/matrix.*\((.+)\)/)[1].split(", "),u[0]&&"0"!==u[0]&&"1"!==u[0]&&(m=u[0]),u[3]&&"0"!==u[3]&&"1"!==u[3]&&(w=u[3])),b=b.parentElement}this._containerWidth=m?Math.abs(d/m):d,this._containerHeight=w?Math.abs(n/w):n}_detectMissingCSS(){"rgb(250, 128, 114)"!==f.window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")&&f.warnOnce("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const d=this._container;d.classList.add("mapboxgl-map"),(this._missingCSSCanary=Rt("div","mapboxgl-canary",d)).style.visibility="hidden",this._detectMissingCSS();const n=this._canvasContainer=Rt("div","mapboxgl-canvas-container",d);this._interactive&&n.classList.add("mapboxgl-interactive"),this._canvas=Rt("canvas","mapboxgl-canvas",n),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const u=this._controlContainer=Rt("div","mapboxgl-control-container",d),m=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(w=>{m[w]=Rt("div",`mapboxgl-ctrl-${w}`,u)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(d,n){const u=f.exported.devicePixelRatio||1;this._canvas.width=u*Math.ceil(d),this._canvas.height=u*Math.ceil(n),this._canvas.style.width=`${d}px`,this._canvas.style.height=`${n}px`}_addMarker(d){this._markers.push(d)}_removeMarker(d){const n=this._markers.indexOf(d);-1!==n&&this._markers.splice(n,1)}_setupPainter(){const d=f.extend({},_.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),n=this._canvas.getContext("webgl",d)||this._canvas.getContext("experimental-webgl",d);n?(f.storeAuthState(n,!0),this.painter=new oh(n,this.transform),this.on("data",u=>{"source"===u.dataType&&this.painter.setTileLoadedFlag(!0)}),f.exported$1.testSupport(n)):this.fire(new f.ErrorEvent(new Error("Failed to initialize WebGL")))}_contextLost(d){d.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new f.Event("webglcontextlost",{originalEvent:d}))}_contextRestored(d){this._setupPainter(),this.resize(),this._update(),this.fire(new f.Event("webglcontextrestored",{originalEvent:d}))}_onMapScroll(d){if(d.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(d){return this.style?(this._styleDirty=this._styleDirty||d,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(d){return this._update(),this._renderTaskQueue.add(d)}_cancelRenderFrame(d){this._renderTaskQueue.remove(d)}_requestDomTask(d){!this.loaded()||this.loaded()&&!this.isMoving()?d():this._domRenderTaskQueue.add(d)}_render(d){let n;const u=this.painter.context.extTimerQuery,m=f.exported.now();if(this.listens("gpu-timing-frame")&&(n=u.createQueryEXT(),u.beginQueryEXT(u.TIME_ELAPSED_EXT,n)),this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(d),this._domRenderTaskQueue.run(d),this._removed)return;let w=!1;const b=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const P=this.transform.zoom,O=this.transform.pitch,L=f.exported.now();this.style.zoomHistory.update(P,L);const V=new f.EvaluationParameters(P,{now:L,fadeDuration:b,pitch:O,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),Y=V.crossFadingFactor();1===Y&&Y===this._crossFadingFactor||(w=!0,this._crossFadingFactor=Y),this.style.update(V)}this.style&&this.style.fog&&this.style.fog.hasTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let S=!1;if(this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),S=this._updateAverageElevation(m),this.style._updateSources(this.transform),this._forceMarkerUpdate()):S=this._updateAverageElevation(m),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,b,this._crossSourceCollisions),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showTerrainWireframe:this.showTerrainWireframe,showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:b,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),speedIndexTiming:this.speedIndexTiming}),this.fire(new f.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new f.Event("load"))),this.style&&(this.style.hasTransitions()||w)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),this.listens("gpu-timing-frame")){const P=f.exported.now()-m;u.endQueryEXT(u.TIME_ELAPSED_EXT,n),setTimeout(()=>{const O=u.getQueryObjectEXT(n,u.QUERY_RESULT_EXT)/1e6;u.deleteQueryEXT(n),this.fire(new f.Event("gpu-timing-frame",{cpuTime:P,gpuTime:O}))},50)}if(this.listens("gpu-timing-layer")){const P=this.painter.collectGpuTimers();setTimeout(()=>{const O=this.painter.queryGpuTimers(P);this.fire(new f.Event("gpu-timing-layer",{layerTimes:O}))},50)}const A=this._sourcesDirty||this._styleDirty||this._placementDirty||S;if(A||this._repaint)this.triggerRepaint();else{const P=!this.isMoving()&&this.loaded();if(P&&(S=this._updateAverageElevation(m,!0)),S)this.triggerRepaint();else if(this._triggerFrame(!1),P&&(this.fire(new f.Event("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const O=this._calculateSpeedIndex();this.fire(new f.Event("speedindexcompleted",{speedIndex:O})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||A||(this._fullyLoaded=!0,this._authenticate())}_forceMarkerUpdate(){for(const d of this._markers)d._update()}_updateAverageElevation(d,n=!1){const u=m=>(this.transform.averageElevation=m,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return 0!==this.transform.averageElevation&&u(0);if((n||d-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(d)){const m=this.transform.averageElevation;let w=this.transform.sampleAverageElevation(),b=!1;this.transform.elevation&&(b=this.transform.elevation.exaggeration()!==this._averageElevationExaggeration,this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(w)?w=0:this._averageElevationLastSampledAt=d;const S=Math.abs(m-w);if(S>1){if(this._isInitialLoad||b)return this._averageElevation.jumpTo(w),u(w);this._averageElevation.easeTo(w,d,300)}else if(S>1e-4)return this._averageElevation.jumpTo(w),u(w)}return!!this._averageElevation.isEasing(d)&&u(this._averageElevation.getValue(d))}_authenticate(){f.getMapSessionAPI(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,d=>{if(d&&(d.message===f.AUTH_ERR_MSG||401===d.status)){const n=this.painter.context.gl;f.storeAuthState(n,!1),this._logoControl instanceof jo&&this._logoControl._updateLogo(),n&&n.clear(n.DEPTH_BUFFER_BIT|n.COLOR_BUFFER_BIT|n.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new f.ErrorEvent(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),f.postMapLoadEvent(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_updateTerrain(){this.painter.updateTerrain(this.style,this.isMoving()||this.isRotating()||this.isZooming())}_calculateSpeedIndex(){const d=this.painter.canvasCopy(),n=this.painter.getCanvasCopiesAndTimestamps();n.timeStamps.push(performance.now());const u=this.painter.context.gl,m=u.createFramebuffer();function w(b){u.framebufferTexture2D(u.FRAMEBUFFER,u.COLOR_ATTACHMENT0,u.TEXTURE_2D,b,0);const S=new Uint8Array(u.drawingBufferWidth*u.drawingBufferHeight*4);return u.readPixels(0,0,u.drawingBufferWidth,u.drawingBufferHeight,u.RGBA,u.UNSIGNED_BYTE,S),S}return u.bindFramebuffer(u.FRAMEBUFFER,m),this._canvasPixelComparison(w(d),n.canvasCopies.map(w),n.timeStamps)}_canvasPixelComparison(d,n,u){let m=u[1]-u[0];const w=d.length/4;for(let b=0;b<n.length;b++){const S=n[b];let A=0;for(let P=0;P<S.length;P+=4)S[P]===d[P]&&S[P+1]===d[P+1]&&S[P+2]===d[P+2]&&S[P+3]===d[P+3]&&(A+=1);m+=(u[b+2]-u[b+1])*(1-A/w)}return m}remove(){this._hash&&this._hash.remove();for(const n of this._controls)n.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),void 0!==f.window&&(f.window.removeEventListener("resize",this._onWindowResize,!1),f.window.removeEventListener("orientationchange",this._onWindowResize,!1),f.window.removeEventListener("webkitfullscreenchange",this._onWindowResize,!1),f.window.removeEventListener("online",this._onWindowOnline,!1));const d=this.painter.context.gl.getExtension("WEBGL_lose_context");d&&d.loseContext(),qo(this._canvasContainer),qo(this._controlContainer),qo(this._missingCSSCanary),this._container.classList.remove("mapboxgl-map"),f.removeAuthState(this.painter.context.gl),this._removed=!0,this.fire(new f.Event("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(d){this._renderNextFrame=this._renderNextFrame||d,this.style&&!this._frame&&(this._frame=f.exported.frame(n=>{const u=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,u&&this._render(n)}))}_preloadTiles(d){const n=this.style?Object.values(this.style._sourceCaches):[];return f.asyncAll(n,(u,m)=>u._preloadTiles(d,m),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(d){this._trackResize&&this.resize({originalEvent:d})._update()}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(d){this._showTileBoundaries!==d&&(this._showTileBoundaries=d,this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(d){this._showTerrainWireframe!==d&&(this._showTerrainWireframe=d,this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(d){this._speedIndexTiming!==d&&(this._speedIndexTiming=d,this._update())}get showPadding(){return!!this._showPadding}set showPadding(d){this._showPadding!==d&&(this._showPadding=d,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(d){this._showCollisionBoxes!==d&&(this._showCollisionBoxes=d,d?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(d){this._showOverdrawInspector!==d&&(this._showOverdrawInspector=d,this._update())}get repaint(){return!!this._repaint}set repaint(d){this._repaint!==d&&(this._repaint=d,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(d){this._vertices=d,this._update()}_setCacheLimits(d,n){f.setCacheLimits(d,n)}get version(){return f.version}},NavigationControl:class{constructor(d){this.options=f.extend({},Iu,d),this._container=Rt("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",n=>n.preventDefault()),this.options.showZoom&&(f.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",n=>{this._map&&this._map.zoomIn({},{originalEvent:n})}),Rt("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",n=>{this._map&&this._map.zoomOut({},{originalEvent:n})}),Rt("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(f.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",n=>{const u=this._map;u&&(this.options.visualizePitch?u.resetNorthPitch({},{originalEvent:n}):u.resetNorth({},{originalEvent:n}))}),this._compassIcon=Rt("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const d=this._map;if(!d)return;const n=d.getZoom(),u=n===d.getMaxZoom(),m=n===d.getMinZoom();this._zoomInButton.disabled=u,this._zoomOutButton.disabled=m,this._zoomInButton.setAttribute("aria-disabled",u.toString()),this._zoomOutButton.setAttribute("aria-disabled",m.toString())}_rotateCompassArrow(){const d=this._map;if(!d)return;const n=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(d.transform.pitch*(Math.PI/180)),.5)}) rotateX(${d.transform.pitch}deg) rotateZ(${d.transform.angle*(180/Math.PI)}deg)`:`rotate(${d.transform.angle*(180/Math.PI)}deg)`;d._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=n)})}onAdd(d){return this._map=d,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),d.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&d.on("pitch",this._rotateCompassArrow),d.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Ic(d,this._compass,this.options.visualizePitch)),this._container}onRemove(){const d=this._map;d&&(this._container.remove(),this.options.showZoom&&d.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&d.off("pitch",this._rotateCompassArrow),d.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(d,n){const u=Rt("button",d,this._container);return u.type="button",u.addEventListener("click",n),u}_setButtonTitle(d,n){if(!this._map)return;const u=this._map._getUIString(`NavigationControl.${n}`);d.setAttribute("aria-label",u),d.firstElementChild&&d.firstElementChild.setAttribute("title",u)}},GeolocateControl:class extends f.Evented{constructor(d){super(),this.options=f.extend({},Ln,d),f.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=lh(this._updateMarkerRotation,20)}onAdd(d){var n;return this._map=d,this._container=Rt("div","mapboxgl-ctrl mapboxgl-ctrl-group"),n=this._setupUI,void 0!==bn?n(bn):void 0!==f.window.navigator.permissions?f.window.navigator.permissions.query({name:"geolocation"}).then(u=>{bn="denied"!==u.state,n(bn)}):(bn=!!f.window.navigator.geolocation,n(bn)),this._container}onRemove(){void 0!==this._geolocationWatchID&&(f.window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,Go=0,Hs=!1}_isOutOfMapMaxBounds(d){const n=this._map.getMaxBounds(),u=d.coords;return!!n&&(u.longitude<n.getWest()||u.longitude>n.getEast()||u.latitude<n.getSouth()||u.latitude>n.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(d){if(this._map){if(this._isOutOfMapMaxBounds(d))return this._setErrorState(),this.fire(new f.Event("outofmaxbounds",d)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=d,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&"OFF"!==this._watchState&&this._updateMarker(d),this.options.trackUserLocation&&"ACTIVE_LOCK"!==this._watchState||this._updateCamera(d),this.options.showUserLocation&&this._dotElement.classList.remove("mapboxgl-user-location-dot-stale"),this.fire(new f.Event("geolocate",d)),this._finish()}}_updateCamera(d){const n=new f.LngLat(d.coords.longitude,d.coords.latitude),u=d.coords.accuracy,m=this._map.getBearing(),w=f.extend({bearing:m},this.options.fitBoundsOptions);this._map.fitBounds(n.toBounds(u),w,{geolocateSource:!0})}_updateMarker(d){if(d){const n=new f.LngLat(d.coords.longitude,d.coords.latitude);this._accuracyCircleMarker.setLngLat(n).addTo(this._map),this._userLocationDotMarker.setLngLat(n).addTo(this._map),this._accuracy=d.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const d=this._map._containerHeight/2,n=this._map.unproject([0,d]),u=this._map.unproject([100,d]),m=n.distanceTo(u)/100,w=Math.ceil(2*this._accuracy/m);this._circleElement.style.width=`${w}px`,this._circleElement.style.height=`${w}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&"number"==typeof this._heading?(this._userLocationDotMarker.setRotation(this._heading),this._dotElement.classList.add("mapboxgl-user-location-show-heading")):(this._dotElement.classList.remove("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(d){if(this._map){if(this.options.trackUserLocation)if(1===d.code){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const n=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",n),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",n),void 0!==this._geolocationWatchID&&this._clearWatch()}else{if(3===d.code&&Hs)return;this._setErrorState()}"OFF"!==this._watchState&&this.options.showUserLocation&&this._dotElement.classList.add("mapboxgl-user-location-dot-stale"),this.fire(new f.Event("error",d)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(d){if(this._container.addEventListener("contextmenu",n=>n.preventDefault()),this._geolocateButton=Rt("button","mapboxgl-ctrl-geolocate",this._container),Rt("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",!1===d){f.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");const n=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",n),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",n)}else{const n=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",n),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",n)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=Rt("div","mapboxgl-user-location"),this._dotElement.appendChild(Rt("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(Rt("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new Dl({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=Rt("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Dl({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",n=>{n.geolocateSource||"ACTIVE_LOCK"!==this._watchState||n.originalEvent&&"resize"===n.originalEvent.type||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new f.Event("trackuserlocationend")))})}_onDeviceOrientation(d){this._userLocationDotMarker&&(d.webkitCompassHeading?this._heading=d.webkitCompassHeading:!0===d.absolute&&(this._heading=-1*d.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return f.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new f.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":Go--,Hs=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new f.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new f.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if("OFF"===this._watchState&&void 0!==this._geolocationWatchID)this._clearWatch();else if(void 0===this._geolocationWatchID){let d;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),Go++,Go>1?(d={maximumAge:6e5,timeout:0},Hs=!0):(d=this.options.positionOptions,Hs=!1),this._geolocationWatchID=f.window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,d),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else f.window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const d=()=>{f.window.addEventListener("ondeviceorientationabsolute"in f.window?"deviceorientationabsolute":"deviceorientation",this._onDeviceOrientation)};void 0!==f.window.DeviceMotionEvent&&"function"==typeof f.window.DeviceMotionEvent.requestPermission?DeviceOrientationEvent.requestPermission().then(n=>{"granted"===n&&d()}).catch(console.error):d()}_clearWatch(){f.window.navigator.geolocation.clearWatch(this._geolocationWatchID),f.window.removeEventListener("deviceorientation",this._onDeviceOrientation),f.window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:kc,ScaleControl:class{constructor(d){this.options=f.extend({},Ys,d),f.bindAll(["_onMove","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_onMove(){xa(this._map,this._container,this.options)}onAdd(d){return this._map=d,this._container=Rt("div","mapboxgl-ctrl mapboxgl-ctrl-scale",d.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._onMove),this._map=void 0}setUnit(d){this.options.unit=d,xa(this._map,this._container,this.options)}},FullscreenControl:class{constructor(d){this._fullscreen=!1,d&&d.container&&(d.container instanceof f.window.HTMLElement?this._container=d.container:f.warnOnce("Full screen control 'container' must be a DOM element.")),f.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in f.window.document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in f.window.document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(d){return this._map=d,this._container||(this._container=this._map.getContainer()),this._controlContainer=Rt("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",f.warnOnce("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,f.window.document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!f.window.document.fullscreenEnabled&&!f.window.document.webkitFullscreenEnabled)}_setupUI(){const d=this._fullscreenButton=Rt("button","mapboxgl-ctrl-fullscreen",this._controlContainer);Rt("span","mapboxgl-ctrl-icon",d).setAttribute("aria-hidden","true"),d.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),f.window.document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const d=this._getTitle();this._fullscreenButton.setAttribute("aria-label",d),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",d)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(f.window.document.fullscreenElement||f.window.document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?f.window.document.exitFullscreen?f.window.document.exitFullscreen():f.window.document.webkitCancelFullScreen&&f.window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends f.Evented{constructor(d){super(),this.options=f.extend(Object.create(ai),d),f.bindAll(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(d&&d.className?d.className.trim().split(/\s+/):[])}addTo(d){return this._map&&this.remove(),this._map=d,this.options.closeOnClick&&d.on("preclick",this._onClose),this.options.closeOnMove&&d.on("move",this._onClose),d.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(d.on("mousemove",this._onMouseEvent),d.on("mouseup",this._onMouseEvent),d._canvasContainer.classList.add("mapboxgl-track-pointer")):d.on("move",this._update),this.fire(new f.Event("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const d=this._map;return d&&(d.off("move",this._update),d.off("move",this._onClose),d.off("preclick",this._onClose),d.off("click",this._onClose),d.off("remove",this.remove),d.off("mousemove",this._onMouseEvent),d.off("mouseup",this._onMouseEvent),d.off("drag",this._onMouseEvent),this._map=void 0),this.fire(new f.Event("close")),this}getLngLat(){return this._lngLat}setLngLat(d){this._lngLat=f.LngLat.convert(d),this._pos=null,this._trackPointer=!1,this._update();const n=this._map;return n&&(n.on("move",this._update),n.off("mousemove",this._onMouseEvent),n._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const d=this._map;return d&&(d.off("move",this._update),d.on("mousemove",this._onMouseEvent),d.on("drag",this._onMouseEvent),d._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(d){return this.setDOMContent(f.window.document.createTextNode(d))}setHTML(d){const n=f.window.document.createDocumentFragment(),u=f.window.document.createElement("body");let m;for(u.innerHTML=d;m=u.firstChild,m;)n.appendChild(m);return this.setDOMContent(n)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(d){return this.options.maxWidth=d,this._update(),this}setDOMContent(d){let n=this._content;if(n)for(;n.hasChildNodes();)n.firstChild&&n.removeChild(n.firstChild);else n=this._content=Rt("div","mapboxgl-popup-content",this._container||void 0);if(n.appendChild(d),this.options.closeButton){const u=this._closeButton=Rt("button","mapboxgl-popup-close-button",n);u.type="button",u.setAttribute("aria-label","Close popup"),u.setAttribute("aria-hidden","true"),u.innerHTML="&#215;",u.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(d){return this._classList.add(d),this._updateClassList(),this}removeClassName(d){return this._classList.delete(d),this._updateClassList(),this}setOffset(d){return this.options.offset=d,this._update(),this}toggleClassName(d){let n;return this._classList.delete(d)?n=!1:(this._classList.add(d),n=!0),this._updateClassList(),n}_onMouseEvent(d){this._update(d.point)}_getAnchor(d){if(this.options.anchor)return this.options.anchor;const n=this._map,u=this._container,m=this._pos;if(!n||!u||!m)return"bottom";const w=u.offsetWidth,b=u.offsetHeight,S=m.x<w/2,A=m.x>n.transform.width-w/2;if(m.y+d<b)return S?"top-left":A?"top-right":"top";if(m.y>n.transform.height-b){if(S)return"bottom-left";if(A)return"bottom-right"}return S?"left":A?"right":"bottom"}_updateClassList(){const d=this._container;if(!d)return;const n=[...this._classList];n.push("mapboxgl-popup"),this._anchor&&n.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&n.push("mapboxgl-popup-track-pointer"),d.className=n.join(" ")}_update(d){const n=this._map,u=this._content;if(!n||!this._lngLat&&!this._trackPointer||!u)return;let m=this._container;if(m||(m=this._container=Rt("div","mapboxgl-popup",n.getContainer()),this._tip=Rt("div","mapboxgl-popup-tip",m),m.appendChild(u)),this.options.maxWidth&&m.style.maxWidth!==this.options.maxWidth&&(m.style.maxWidth=this.options.maxWidth),n.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=Fl(this._lngLat,this._pos,n.transform)),!this._trackPointer||d){const w=this._pos=this._trackPointer&&d?d:n.project(this._lngLat),b=Mc(this.options.offset),S=this._anchor=this._getAnchor(b.y),A=Mc(this.options.offset,S),P=w.add(A).round();n._requestDomTask(()=>{this._container&&S&&(this._container.style.transform=`${Cc[S]} translate(${P.x}px,${P.y}px)`)})}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const d=this._container.querySelector(qr);d&&d.focus()}_onClose(){this.remove()}_setOpacity(d){this._content&&(this._content.style.opacity=d),this._tip&&(this._tip.style.opacity=d)}},Marker:Dl,Style:Hn,LngLat:f.LngLat,LngLatBounds:f.LngLatBounds,Point:f.pointGeometry,MercatorCoordinate:f.MercatorCoordinate,FreeCameraOptions:Si,Evented:f.Evented,config:f.config,prewarm:function(){nr().acquire(tr)},clearPrewarmedResources:function(){const d=Kt;d&&(d.isPreloaded()&&1===d.numActive()?(d.release(tr),Kt=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get accessToken(){return f.config.ACCESS_TOKEN},set accessToken(d){f.config.ACCESS_TOKEN=d},get baseApiUrl(){return f.config.API_URL},set baseApiUrl(d){f.config.API_URL=d},get workerCount(){return Yt.workerCount},set workerCount(d){Yt.workerCount=d},get maxParallelImageRequests(){return f.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(d){f.config.MAX_PARALLEL_IMAGE_REQUESTS=d},clearStorage(d){f.clearTileCache(d)},workerUrl:"",workerClass:null,setNow:f.exported.setNow,restoreNow:f.exported.restoreNow};return Ja}),Ri}()}}]);